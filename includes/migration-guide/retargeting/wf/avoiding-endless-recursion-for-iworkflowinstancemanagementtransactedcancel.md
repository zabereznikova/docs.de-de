---
ms.openlocfilehash: ab9431780422dfece5dcf8007d13e6d584f5118f
ms.sourcegitcommit: 721c3e4bdbb1ea0bb420818ec944c538fe5c513a
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 12/01/2020
ms.locfileid: "96478099"
---
### <a name="avoiding-endless-recursion-for-iworkflowinstancemanagementtransactedcancel-and-iworkflowinstancemanagementtransactedterminate"></a><span data-ttu-id="8b091-101">Vermeiden von Endlosrekursion für IWorkflowInstanceManagement.TransactedCancel und IWorkflowInstanceManagement.TransactedTerminate</span><span class="sxs-lookup"><span data-stu-id="8b091-101">Avoiding endless recursion for IWorkflowInstanceManagement.TransactedCancel and IWorkflowInstanceManagement.TransactedTerminate</span></span>

#### <a name="details"></a><span data-ttu-id="8b091-102">Details</span><span class="sxs-lookup"><span data-stu-id="8b091-102">Details</span></span>

<span data-ttu-id="8b091-103">Wenn Sie <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedCancel%2A?displayProperty=nameWithType>- oder <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedTerminate%2A?displayProperty=nameWithType>-APIs verwenden, um eine Worklowdienstinstanz abzubrechen oder zu beenden, kann für die Workflowinstanz unter bestimmten Umständen aufgrund von Endlosrekursion ein Stapelüberlauf auftreten, wenn die `Workflow`-Laufzeit versucht, die Dienstinstanz als Teil der Verarbeitung der Anforderung persistent zu speichern.</span><span class="sxs-lookup"><span data-stu-id="8b091-103">Under some circumstances when using <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedCancel%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedTerminate%2A?displayProperty=nameWithType> APIs to cancel or terminate a workflow service instance, the workflow instance may encounter a stack overflow due to endless recursion when the `Workflow` runtime attempts to persist the service instance as part of processing the request.</span></span> <span data-ttu-id="8b091-104">Das Problem tritt auf, wenn sich die Workflowinstanz in einem Zustand befindet, in dem sie auf den Abschluss einer anderen ausstehenden WCF-Anforderung an einen anderen Dienst wartet.</span><span class="sxs-lookup"><span data-stu-id="8b091-104">The problem occurs if the workflow instance is in a state where it is waiting for some other outstanding WCF request to another service to complete.</span></span> <span data-ttu-id="8b091-105">Die Vorgänge `TransactedCancel` und `TransactedTerminate` erstellen Arbeitselemente, die für die Workflowdienstinstanz in die Warteschlange eingereiht werden.</span><span class="sxs-lookup"><span data-stu-id="8b091-105">The `TransactedCancel` and `TransactedTerminate` operations create work items that are queued for the workflow service instance.</span></span> <span data-ttu-id="8b091-106">Diese Arbeitselemente werden nicht im Rahmen der Verarbeitung der `TransactedCancel/TransactedTerminate`-Anforderung ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="8b091-106">These work items are not executed as part of the processing of the `TransactedCancel/TransactedTerminate` request.</span></span> <span data-ttu-id="8b091-107">Da die Workflowdienstinstanz damit ausgelastet ist, auf den Abschluss der anderen ausstehenden WCF-Anforderung zu warten, verbleibt das erstellte Arbeitselement in der Warteschlange.</span><span class="sxs-lookup"><span data-stu-id="8b091-107">Because the workflow service instance is busy waiting for the other outstanding WCF request to complete, the work item created remains queued.</span></span> <span data-ttu-id="8b091-108">Der `TransactedCancel/TransactedTerminate`-Vorgang wird abgeschlossen, und die Steuerung wird zurück an den Client übergeben.</span><span class="sxs-lookup"><span data-stu-id="8b091-108">The `TransactedCancel/TransactedTerminate` operation completes and control is returned back to the client.</span></span> <span data-ttu-id="8b091-109">Wenn die dem `TransactedCancel/TransactedTerminate`-Vorgang zugeordnete Transaktion den Commit versucht, muss sie den Zustand der Workflowdienstinstanz persistent speichern.</span><span class="sxs-lookup"><span data-stu-id="8b091-109">When the transaction associated with the `TransactedCancel/TransactedTerminate` operation attempts to commit, it needs to persist the workflow service instance state.</span></span> <span data-ttu-id="8b091-110">Da aber für die Instanz eine ausstehende `WCF`-Anforderung vorliegt, kann die Workflowruntime die Workflowdienstinstanz nicht persistent speichern, und eine Endlosrekursionsschleife führt zum Stapelüberlauf. Da `TransactedCancel` und `TransactedTerminate` nur ein Arbeitselement im Speicher erstellen, besitzt die Tatsache, dass eine Transaktion vorhanden ist, keinerlei Auswirkung.</span><span class="sxs-lookup"><span data-stu-id="8b091-110">But because there is an outstanding `WCF` request for the instance, the Workflow runtime cannot persist the workflow service instance, and an endless recursion loop leads to the stack overflow.Because `TransactedCancel` and `TransactedTerminate` only create a work item in memory, the fact that a transaction exists doesn't have any effect.</span></span> <span data-ttu-id="8b091-111">Durch ein Rollback der Transaktion wird das Arbeitselement nicht verworfen. Zur Lösung dieses Problems wurde ab .NET Framework 4.7.2 eine `AppSetting` eingeführt, die `web.config/app.config` des Workflowdiensts hinzugefügt werden kann und angibt, dass Transaktionen für `TransactedCancel` und `TransactedTerminate` ignoriert werden sollen.</span><span class="sxs-lookup"><span data-stu-id="8b091-111">A rollback of the transaction does not discard the work item.To address this issue, starting in .NET Framework 4.7.2, we have introduced an `AppSetting` that can be added to the `web.config/app.config` of the workflow service that tells it to ignore transactions for `TransactedCancel` and `TransactedTerminate`.</span></span> <span data-ttu-id="8b091-112">Auf diese Weise kann die Transaktion einen Commit ausführen, ohne warten zu müssen, bis die Workflowinstanz dauerhaft gespeichert wurde.</span><span class="sxs-lookup"><span data-stu-id="8b091-112">This allows the transaction to commit without waiting for the workflow instance to persist.</span></span> <span data-ttu-id="8b091-113">Das AppSetting-Element für dieses Feature hat den Namen `microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate`.</span><span class="sxs-lookup"><span data-stu-id="8b091-113">The AppSetting for this feature is named `microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate`.</span></span> <span data-ttu-id="8b091-114">Der Wert `true` gibt an, dass die Transaktion ignoriert werden soll, um so den Stapelüberlauf zu vermeiden.</span><span class="sxs-lookup"><span data-stu-id="8b091-114">A value of `true` indicates that the transaction should be ignored, thus avoiding the stack overflow.</span></span> <span data-ttu-id="8b091-115">Der Standardwert dieser AppSetting ist `false`. Vorhandene Workflowdienstinstanzen sind daher nicht betroffen.</span><span class="sxs-lookup"><span data-stu-id="8b091-115">The default value of this AppSetting is `false`, so existing workflow service instances are not affected.</span></span>

#### <a name="suggestion"></a><span data-ttu-id="8b091-116">Vorschlag</span><span class="sxs-lookup"><span data-stu-id="8b091-116">Suggestion</span></span>

<span data-ttu-id="8b091-117">Wenn Sie AppFabric oder einen anderen <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement>-Client verwenden und beim Versuch, eine Workflowinstanz abzubrechen oder zu beenden, ein Stapelüberlauf in der Workflowdienstinstanz auftritt, können Sie Folgendes zum Abschnitt `<appSettings>` der Datei „web.config/app.config“ für den Workflowdienst hinzufügen:</span><span class="sxs-lookup"><span data-stu-id="8b091-117">If you are using AppFabric or another <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> client and are encountering a stack overflow in the workflow service instance when trying to cancel or terminate a workflow instance, you can add the following to the `<appSettings>` section of the web.config/app.config file for the workflow service:</span></span>

<pre><code class="lang-xml">&lt;add key=&quot;microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate&quot; value=&quot;true&quot;/&gt;&#13;&#10;</code></pre>

<span data-ttu-id="8b091-118">Wenn dieses Problem nicht auftritt, müssen Sie diese Aktion nicht ausführen.</span><span class="sxs-lookup"><span data-stu-id="8b091-118">If you are not encountering the problem, you do not need to do this.</span></span>

| <span data-ttu-id="8b091-119">name</span><span class="sxs-lookup"><span data-stu-id="8b091-119">Name</span></span>    | <span data-ttu-id="8b091-120">Wert</span><span class="sxs-lookup"><span data-stu-id="8b091-120">Value</span></span>       |
|:--------|:------------|
| <span data-ttu-id="8b091-121">Bereich</span><span class="sxs-lookup"><span data-stu-id="8b091-121">Scope</span></span>   | <span data-ttu-id="8b091-122">Microsoft Edge</span><span class="sxs-lookup"><span data-stu-id="8b091-122">Edge</span></span>        |
| <span data-ttu-id="8b091-123">Version</span><span class="sxs-lookup"><span data-stu-id="8b091-123">Version</span></span> | <span data-ttu-id="8b091-124">4.7.2</span><span class="sxs-lookup"><span data-stu-id="8b091-124">4.7.2</span></span>       |
| <span data-ttu-id="8b091-125">Typ</span><span class="sxs-lookup"><span data-stu-id="8b091-125">Type</span></span>    | <span data-ttu-id="8b091-126">Neuzuweisung</span><span class="sxs-lookup"><span data-stu-id="8b091-126">Retargeting</span></span> |
