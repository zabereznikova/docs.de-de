### <a name="avoiding-endless-recursion-for-iworkflowinstancemanagementtransactedcancel-and-iworkflowinstancemanagementtransactedterminate"></a>Vermeiden von Endlosrekursion für IWorkflowInstanceManagement.TransactedCancel und IWorkflowInstanceManagement.TransactedTerminate

|   |   |
|---|---|
|Details|Wenn Sie <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedCancel%2A?displayProperty=nameWithType>- oder <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedTerminate%2A?displayProperty=nameWithType>-APIs verwenden, um eine Worklowdienstinstanz abzubrechen oder zu beenden, kann für die Workflowinstanz unter bestimmten Umständen aufgrund von Endlosrekursion ein Stapelüberlauf auftreten, wenn die <code>Workflow</code>-Laufzeit versucht, die Dienstinstanz als Teil der Verarbeitung der Anforderung persistent zu speichern. Das Problem tritt auf, wenn sich die Workflowinstanz in einem Zustand befindet, in dem sie auf den Abschluss einer anderen ausstehenden WCF-Anforderung an einen anderen Dienst wartet. Die <code>TransactedCancel</code>- und <code>TransactedTerminate</code>-Vorgänge erstellen Arbeitselemente, die für die Workflowdienstinstanz in der Warteschlange gespeichert werden. Diese Arbeitselemente werden nicht im Rahmen der Verarbeitung der <code>TransactedCancel/TransactedTerminate</code>-Anforderung ausgeführt. Da die Workflowdienstinstanz damit ausgelastet ist, auf den Abschluss der anderen ausstehenden WCF-Anforderung zu warten, verbleibt das erstellte Arbeitselement in der Warteschlange. Der <code>TransactedCancel/TransactedTerminate</code>-Vorgang wird abgeschlossen, und die Steuerung wird zurück an den Client übergeben. Wenn die dem <code>TransactedCancel/TransactedTerminate</code>-Vorgang zugeordnete Transaktion den Commit versucht, muss sie den Zustand der Workflowdienstinstanz persistent speichern. Da aber für die Instanz eine ausstehende <code>WCF</code>-Anforderung vorliegt, kann die Workflowruntime die Workflowdienstinstanz nicht persistent speichern, und eine Endlosrekursionsschleife führt zum Stapelüberlauf. Da <code>TransactedCancel</code> und <code>TransactedTerminate</code> nur ein Arbeitselement im Speicher erstellen, besitzt die Tatsache, dass eine Transaktion vorhanden ist, keinerlei Auswirkung. Durch ein Rollback der Transaktion wird das Arbeitselement nicht verworfen. Zur Lösung dieses Problems wurde ab .NET Framework 4.7.2 eine <code>AppSetting</code> eingeführt, die <code>web.config/app.config</code> des Workflowdiensts hinzugefügt werden kann und angibt, dass Transaktionen für <code>TransactedCancel</code> und <code>TransactedTerminate</code> ignoriert werden sollen. Auf diese Weise kann die Transaktion einen Commit auszuführen, ohne zu warten, bis die Workflowinstanz persistent gespeichert wurde. Die AppSetting für dieses Feature heißt <code>microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate</code>. Der Wert <code>true</code> gibt an, dass die Transaktion ignoriert werden soll, um so den Stapelüberlauf zu vermeiden. Der Standardwert dieser AppSetting ist <code>false</code>. Vorhandene Workflowdienstinstanzen sind daher nicht betroffen.|
|Vorschlag|Wenn Sie AppFabric oder einen anderen <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement>-Client verwenden und beim Versuch, eine Workflowinstanz abzubrechen oder zu beenden, ein Stapelüberlauf in der Workflowdienstinstanz auftritt, können Sie Folgendes zum Abschnitt <code>&lt;appSettings&gt;</code> der Datei „web.config/app.config“ für den Workflowdienst hinzufügen:<pre><code class="lang-xml">&lt;add key=&quot;microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate&quot; value=&quot;true&quot;/&gt;&#13;&#10;</code></pre>Wenn dieses Problem nicht auftritt, müssen Sie diese Aktion nicht ausführen.|
|Bereich|Microsoft Edge|
|Version|4.7.2|
|Typ|Neuzuweisung|

