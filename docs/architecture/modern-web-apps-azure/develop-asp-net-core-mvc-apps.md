---
title: Entwickeln von ASP.NET Core MVC-Apps
description: Entwerfen moderner Webanwendungen mit ASP.NET Core und Azure | Entwickeln von ASP.NET Core-Apps
author: ardalis
ms.author: wiwagn
ms.date: 08/12/2020
no-loc:
- ':::no-loc(Blazor):::'
- ':::no-loc(WebAssembly):::'
ms.openlocfilehash: e746362657a25487e98ddac09fa4337b00dfe805
ms.sourcegitcommit: 5b475c1855b32cf78d2d1bbb4295e4c236f39464
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 09/24/2020
ms.locfileid: "91169127"
---
# <a name="develop-aspnet-core-mvc-apps"></a><span data-ttu-id="7ad9c-103">Entwickeln von ASP.NET Core MVC-Apps</span><span class="sxs-lookup"><span data-stu-id="7ad9c-103">Develop ASP.NET Core MVC apps</span></span>

> <span data-ttu-id="7ad9c-104">„Sie müssen nicht schon beim ersten Mal alles richtig machen,</span><span class="sxs-lookup"><span data-stu-id="7ad9c-104">"It's not important to get it right the first time.</span></span> <span data-ttu-id="7ad9c-105">aber unbedingt beim letzten Mal.“</span><span class="sxs-lookup"><span data-stu-id="7ad9c-105">It's vitally important to get it right the last time."</span></span>  
> <span data-ttu-id="7ad9c-106">_– Andrew Hunt and David Thomas_</span><span class="sxs-lookup"><span data-stu-id="7ad9c-106">_- Andrew Hunt and David Thomas_</span></span>

<span data-ttu-id="7ad9c-107">ASP.NET Core ist ein plattformübergreifendes Open-Source-Framework zum Erstellen moderner cloudoptimierter Webanwendungen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-107">ASP.NET Core is a cross-platform, open-source framework for building modern cloud-optimized web applications.</span></span> <span data-ttu-id="7ad9c-108">ASP.NET Core-Apps sind einfach und modular aufgebaut. Sie verfügen über integrierte Unterstützung für Dependency Injection, wodurch ihre Testfähigkeit und Verwaltbarkeit verbessert wird.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-108">ASP.NET Core apps are lightweight and modular, with built-in support for dependency injection, enabling greater testability and maintainability.</span></span> <span data-ttu-id="7ad9c-109">In Kombination mit MVC (einem Muster, das neben ansichtsbasierten Apps das Erstellen von modernen Web-APIs unterstützt) stellt ASP.NET Core ein leistungsstarkes Framework zum Erstellen von Unternehmenswebanwendungen dar.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-109">Combined with MVC, which supports building modern web APIs in addition to view-based apps, ASP.NET Core is a powerful framework with which to build enterprise web applications.</span></span>

## <a name="mvc-and-razor-pages"></a><span data-ttu-id="7ad9c-110">MVC und Razor Pages</span><span class="sxs-lookup"><span data-stu-id="7ad9c-110">MVC and Razor Pages</span></span>

<span data-ttu-id="7ad9c-111">ASP.NET Core MVC enthält viele Features, die für das Erstellen von webbasierten APIs und Apps nützlich sind.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-111">ASP.NET Core MVC offers many features that are useful for building web-based APIs and apps.</span></span> <span data-ttu-id="7ad9c-112">MVC bedeutet „Model View Controller“. Dabei handelt es sich um ein Benutzeroberflächenmuster, das die Zuständigkeit für die Reaktion auf Anforderungen von Benutzern aufteilt.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-112">The term MVC stands for "Model-View-Controller", a UI pattern that breaks up the responsibilities of responding to user requests into several parts.</span></span> <span data-ttu-id="7ad9c-113">Wenn Sie dieses Muster verwenden, können Sie ebenfalls Features als sogenannte Razor Pages in Ihre ASP.NET Core-Apps implementieren.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-113">In addition to following this pattern, you can also implement features in your ASP.NET Core apps as Razor Pages.</span></span> <span data-ttu-id="7ad9c-114">Razor Pages werden in ASP.NET Core MVC integriert und verwenden die gleichen Features für das Routing, Modellbindungen, Filter und die Autorisierung. Dafür werden jedoch nicht wie üblich verschiedene Ordner und Dateien für Controller, Modelle oder Ansichten und auch kein attributbasiertes Routing verwendet. Razor Pages werden in einem einzelnen Ordner (/Pages) gespeichert, das Routing basiert auf deren relativem Speicherort in diesem Ordner, und Anforderungen werden mit Handlern anstatt mit Controlleraktionen verarbeitet.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-114">Razor Pages are built into ASP.NET Core MVC, and use the same features for routing, model binding, filters, authorization, etc. However, instead of having separate folders and files for Controllers, Models, Views, etc. and using attribute-based routing, Razor Pages are placed in a single folder ("/Pages"), route based on their relative location in this folder, and handle requests with handlers instead of controller actions.</span></span> <span data-ttu-id="7ad9c-115">Folglich werden bei der Arbeit mit Razor Pages alle benötigten Dateien und Klassen in der Regel zusammen und nicht verteilt im Webprojekt bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-115">As a result, when working with Razor Pages, all of the files and classes you need are typically colocated, not spread throughout the web project.</span></span>

<span data-ttu-id="7ad9c-116">Wenn Sie eine neue ASP.NET Core-App erstellen, sollten Sie sich zuvor genau überlegen, was die erstellte App leisten soll.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-116">When you create a new ASP.NET Core App, you should have a plan in mind for the kind of app you want to build.</span></span> <span data-ttu-id="7ad9c-117">In Visual Studio können Sie aus mehreren Vorlagen auswählen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-117">In Visual Studio, you'll choose from several templates.</span></span> <span data-ttu-id="7ad9c-118">Am häufigsten werden die drei Projektvorlagen „Web-API“, „Webanwendung“ und „Webanwendung (Model View Controller)“ verwendet.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-118">The three most common project templates are Web API, Web Application, and Web Application (Model-View-Controller).</span></span> <span data-ttu-id="7ad9c-119">Sie können sich zwar nur beim Erstellen des Projekts für eine Vorlage entscheiden, aber die Entscheidung ist nicht endgültig.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-119">Although you can only make this decision when you first create a project, it's not an irrevocable decision.</span></span> <span data-ttu-id="7ad9c-120">Ein Projekt für Web-APIs verwendet Standard-MVCs, enthält aber standardmäßig keine Ansichten.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-120">The Web API project uses standard Model-View-Controller controllers – it just lacks Views by default.</span></span> <span data-ttu-id="7ad9c-121">Die Standardvorlage für Webanwendungen verwendet Razor Pages, enthält aber ebenfalls keinen Ordner für Ansichten.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-121">Likewise, the default Web Application template uses Razor Pages, and so also lacks a Views folder.</span></span> <span data-ttu-id="7ad9c-122">Sie können einen entsprechenden Ordner im Nachhinein zu diesen Projekten hinzufügen, um auf Ansichten basierendes Verhalten zu unterstützen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-122">You can add a Views folder to these projects later to support view-based behavior.</span></span> <span data-ttu-id="7ad9c-123">Web-API- und Model View Controller-Projekte enthalten standardmäßig keinen Pages-Ordner. Sie können diesen jedoch im Nachhinein hinzufügen, um Razor Pages zu unterstützen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-123">Web API and Model-View-Controller projects don't include a Pages folder by default, but you can add one later to support Razor Pages-based behavior.</span></span> <span data-ttu-id="7ad9c-124">Diese drei Vorlagen unterstützen drei verschiedene Arten der Standardbenutzerinteraktion: datenbasierte (Web-API), seitenbasierte und ansichtsbasierte Interaktionen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-124">You can think of these three templates as supporting three different kinds of default user interaction: data (web API), page-based, and view-based.</span></span> <span data-ttu-id="7ad9c-125">Sie können diese jedoch nach Bedarf alle in einem Projekt verwenden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-125">However, you can mix and match any or all of these within a single project if you wish.</span></span>

### <a name="why-razor-pages"></a><span data-ttu-id="7ad9c-126">Was spricht für Razor Pages?</span><span class="sxs-lookup"><span data-stu-id="7ad9c-126">Why Razor Pages?</span></span>

<span data-ttu-id="7ad9c-127">Razor Pages werden standardmäßig für neue Webanwendungen in Visual Studio verwendet.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-127">Razor Pages is the default approach for new web applications in Visual Studio.</span></span> <span data-ttu-id="7ad9c-128">Mithilfe von Razor Pages können Sie seitenbasierte Anwendungsfeatures (wie Nicht-Single-Page-Formulare) einfacher erstellen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-128">Razor Pages offers a simpler way of building page-based application features, such as non-SPA forms.</span></span> <span data-ttu-id="7ad9c-129">Wenn Controller und Ansichten verwendet werden, enthalten Anwendungen häufig sehr große Controller, die mit mehreren Abhängigkeiten und Ansichtsmodellen arbeiten und viele unterschiedliche Ansichten zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-129">Using controllers and views, it was common for applications to have very large controllers that worked with many different dependencies and view models and returned many different views.</span></span> <span data-ttu-id="7ad9c-130">Dadurch wird die Anwendung komplexer, und häufig sind Controller vorhanden, die das Single Responsibility Principle (Prinzip der eindeutigen Verantwortlichkeit) oder das Offen-Geschlossen-Prinzip nicht befolgen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-130">This resulted in more complexity and often resulted in controllers that didn't follow the Single Responsibility Principle or Open/Closed Principles effectively.</span></span> <span data-ttu-id="7ad9c-131">Dieses Problem wird durch Razor Pages behoben, indem die serverseitige Logik für eine bestimmte lokale Seite in einer Webanwendung mit entsprechendem Razor-Markup gekapselt wird.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-131">Razor Pages addresses this issue by encapsulating the server-side logic for a given logical "page" in a web application with its Razor markup.</span></span> <span data-ttu-id="7ad9c-132">Eine Razor Page ohne serverseitige Logik kann aus einer Razor-Datei bestehen (z.B. „Index.cshtml“).</span><span class="sxs-lookup"><span data-stu-id="7ad9c-132">A Razor Page that has no server-side logic can simply consist of a Razor file (for instance, "Index.cshtml").</span></span> <span data-ttu-id="7ad9c-133">Den meisten nicht trivialen Razor Pages ist jedoch eine Seitenmodellklasse zugeordnet, die üblicherweise genauso wie die Razor-Datei benannt wird, aber die Erweiterung „.cs“ aufweist (z.B. „Index.cshtml.cs“).</span><span class="sxs-lookup"><span data-stu-id="7ad9c-133">However, most non-trivial Razor Pages will have an associated page model class, which by convention is named the same as the Razor file with a ".cs" extension (for example, "Index.cshtml.cs").</span></span>

<span data-ttu-id="7ad9c-134">Das Seitenmodell einer Razor Page kombiniert die Zuständigkeit eines MVC-Controllers und eines Ansichtsmodells.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-134">A Razor Page's page model combines the responsibilities of an MVC controller and a viewmodel.</span></span> <span data-ttu-id="7ad9c-135">Anforderungen werden nicht mit Controlleraktionsmethoden verarbeitet, sondern Seitenmodellhandler wie OnGet() werden ausgeführt, um die zugehörige Seite standardmäßig zu rendern.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-135">Instead of handling requests with controller action methods, page model handlers like "OnGet()" are executed, rendering their associated page by default.</span></span> <span data-ttu-id="7ad9c-136">Durch Razor Pages wird das Erstellen einzelner Seiten in einer ASP.NET Core-App vereinfacht, während alle Architekturfeatures von ASP.NET Core MVC genutzt werden können.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-136">Razor Pages simplifies the process of building individual pages in an ASP.NET Core app, while still providing all the architectural features of ASP.NET Core MVC.</span></span> <span data-ttu-id="7ad9c-137">Diese sind für neue seitenbasierte Funktionen gut geeignet.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-137">They're a good default choice for new page-based functionality.</span></span>

### <a name="when-to-use-mvc"></a><span data-ttu-id="7ad9c-138">Wann sollten Sie MVC verwenden?</span><span class="sxs-lookup"><span data-stu-id="7ad9c-138">When to use MVC</span></span>

<span data-ttu-id="7ad9c-139">Wenn Sie Web-APIs erstellen, ist das MVC-Muster besser als Razor Pages geeignet.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-139">If you're building web APIs, the MVC pattern makes more sense than trying to use Razor Pages.</span></span> <span data-ttu-id="7ad9c-140">Wenn Ihr Projekt nur Web-API-Endpunkte verfügbar macht, sollten Sie idealerweise mit der Web-API-Projektvorlage beginnen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-140">If your project will only expose web API endpoints, you should ideally start from the Web API project template.</span></span> <span data-ttu-id="7ad9c-141">Andernfalls ist es auch ganz einfach, Controller und zugehörige API-Endpunkte zu einer beliebigen ASP.NET Core-App hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-141">Otherwise, it's easy to add controllers and associated API endpoints to any ASP.NET Core app.</span></span> <span data-ttu-id="7ad9c-142">Verwenden Sie den ansichtsbasierten MVC-Ansatz, wenn Sie eine vorhandene Anwendung mit geringem Aufwand von ASP.NET Core MVC 5 oder früher zu ASP.NET Core MVC migrieren möchten.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-142">Use the view-based MVC approach if you're migrating an existing application from ASP.NET MVC 5 or earlier to ASP.NET Core MVC and you want to do so with the least amount of effort.</span></span> <span data-ttu-id="7ad9c-143">Nach der Migration können Sie überprüfen, ob Razor Pages für neue Feature oder als gesamte Migration sinnvoll eingesetzt werden kann.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-143">Once you've made the initial migration, you can evaluate whether it makes sense to adopt Razor Pages for new features or even as a wholesale migration.</span></span>

<span data-ttu-id="7ad9c-144">Die Leistung Ihrer Web-App hängt nur geringfügig davon ab, ob Sie Razor Pages oder MVC-Ansichten verwenden, außerdem werden bei beiden Methoden Features wie Abhängigkeitsinjektion, Filter, Modellbindung, Validierung usw. unterstützt.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-144">Whether you choose to build your web app using Razor Pages or MVC views, your app will have similar performance and will include support for dependency injection, filters, model binding, validation, and so on.</span></span>

## <a name="mapping-requests-to-responses"></a><span data-ttu-id="7ad9c-145">Zuordnen von Anforderungen zu Antworten</span><span class="sxs-lookup"><span data-stu-id="7ad9c-145">Mapping requests to responses</span></span>

<span data-ttu-id="7ad9c-146">Im Wesentlichen dienen ASP.NET Core-Apps dazu, eingehende Anforderungen ausgehenden Antworten zuzuordnen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-146">At its heart, ASP.NET Core apps map incoming requests to outgoing responses.</span></span> <span data-ttu-id="7ad9c-147">Auf niedriger Ebene wird dazu Middleware verwendet. Daher kann es sein, dass ASP.NET Core-Apps und -Microservices ausschließlich aus benutzerdefinierter Middleware bestehen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-147">At a low level, this is done with middleware, and simple ASP.NET Core apps and microservices may be comprised solely of custom middleware.</span></span> <span data-ttu-id="7ad9c-148">Wenn Sie ASP.NET Core MVC verwenden, können Sie auf einer allgemeineren Ebene arbeiten und _Routen_ , _Controller_ und _Aktionen_ hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-148">When using ASP.NET Core MVC, you can work at a somewhat higher level, thinking in terms of _routes_ , _controllers_ , and _actions_.</span></span> <span data-ttu-id="7ad9c-149">Jede eingehende Anforderung wird mit der Routingtabelle der Anwendung verglichen, und wenn eine übereinstimmende Route gefunden wird, wird die zugewiesene Aktionsmethode (des Controllers) aufgerufen, um die Anforderung zu verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-149">Each incoming request is compared with the application's routing table, and if a matching route is found, the associated action method (belonging to a controller) is called to handle the request.</span></span> <span data-ttu-id="7ad9c-150">Wenn keine übereinstimmende Route gefunden wird, wird ein Fehlerhandler aufgerufen und das Ergebnis „NotFound“ zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-150">If no matching route is found, an error handler (in this case, returning a NotFound result) is called.</span></span>

<span data-ttu-id="7ad9c-151">ASP.NET Core MVC-Apps können entweder herkömmliche Routen oder Attributrouten oder beides gleichzeitig verwenden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-151">ASP.NET Core MVC apps can use conventional routes, attribute routes, or both.</span></span> <span data-ttu-id="7ad9c-152">Herkömmliche Routen werden als Code definiert und geben unter Verwendung einer wie im Folgenden dargestellten Syntax _Routingkonventionen_ an:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-152">Conventional routes are defined in code, specifying routing _conventions_ using syntax like in the example below:</span></span>

```csharp
app.UseEndpoints(endpoints =>
{
    endpoints.MapControllerRoute(name: "default", pattern: "{controller=Home}/{action=Index}/{id?}");
});
```

<span data-ttu-id="7ad9c-153">In diesem Beispiel wurde eine Route mit dem Namen „Standard“ der Routingtabelle hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-153">In this example, a route named "default" has been added to the routing table.</span></span> <span data-ttu-id="7ad9c-154">Sie definiert eine Routenvorlage mit Platzhaltern für den _Controller_ , die _Aktion_ und die _ID_. Für die Platzhalter für den Controller und die Aktion ist „Standard“ angegeben („Home“ bzw. „Index“). Der Platzhalter für die ID ist hingegen optional, da ein Fragezeichen („?“) hinzugefügt wurde.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-154">It defines a route template with placeholders for _controller_ , _action_ , and _id_. The controller and action placeholders have default specified ("Home" and "Index", respectively), and the id placeholder is optional (by virtue of a "?" applied to it).</span></span> <span data-ttu-id="7ad9c-155">Die hier definierte Konvention drückt aus, dass der erste Teil einer Anforderung dem Namen eines Controllers und der zweite Teil der Aktion entsprechen soll. Außerdem kann wenn nötig ein dritter Teil den ID-Parameter darstellen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-155">The convention defined here states that the first part of a request should correspond to the name of the controller, the second part to the action, and then if necessary a third part will represent an id parameter.</span></span> <span data-ttu-id="7ad9c-156">Herkömmliche Routen werden in der Regel an einer bestimmten Stelle wie der Methode „Configure“ in der Klasse „Startup“ für die Anwendung definiert.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-156">Conventional routes are typically defined in one place for the application, such as in the Configure method in the Startup class.</span></span>

<span data-ttu-id="7ad9c-157">Attributrouten gelten für Controller und Aktionen direkt und werden nicht global angegeben.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-157">Attribute routes are applied to controllers and actions directly, rather than specified globally.</span></span> <span data-ttu-id="7ad9c-158">Das hat den Vorteil, dass sie besser zu finden sind, wenn Sie eine bestimmte Methode betrachten. Andererseits bedeutet dies aber auch, dass die Routinginformationen nicht an einer bestimmten Stelle in der Anwendung gespeichert sind.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-158">This has the advantage of making them much more discoverable when you're looking at a particular method, but does mean that routing information is not kept in one place in the application.</span></span> <span data-ttu-id="7ad9c-159">Sie können mit Attributrouten problemlos mehrere Routen für eine bestimmte Aktion festlegen und gleichzeitig aber auch Routen zwischen Controllern und Aktionen kombinieren.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-159">With attribute routes, you can easily specify multiple routes for a given action, as well as combine routes between controllers and actions.</span></span> <span data-ttu-id="7ad9c-160">Zum Beispiel:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-160">For example:</span></span>

```csharp
[Route("Home")]
public class HomeController : Controller
{
    [Route("")] // Combines to define the route template "Home"
    [Route("Index")] // Combines to define route template "Home/Index"
    [Route("/")] // Does not combine, defines the route template ""
    public IActionResult Index() {}
}
```

<span data-ttu-id="7ad9c-161">Routen können über [HttpGet] und ähnliche Attribute angegeben werden, weshalb keine separaten [Route]-Attribute hinzugefügt werden müssen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-161">Routes can be specified on [HttpGet] and similar attributes, avoiding the need to add separate [Route] attributes.</span></span> <span data-ttu-id="7ad9c-162">Ebenso können wie folgt Token von Attributrouten verwendet werden, damit die Namen von Controllern oder Aktionen seltener wiederholt werden müssen:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-162">Attribute routes can also use tokens to reduce the need to repeat controller or action names, as shown below:</span></span>

```csharp
[Route("[controller]")]
public class ProductsController : Controller
{
    [Route("")] // Matches 'Products'
    [Route("Index")] // Matches 'Products/Index'
    public IActionResult Index() {}
}
```

<span data-ttu-id="7ad9c-163">Razor Pages nutzt kein Attributrouting.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-163">Razor Pages doesn't use attribute routing.</span></span> <span data-ttu-id="7ad9c-164">Sie können in der `@page`-Anweisung einer Razor Page jedoch zusätzliche Informationen zu Routingvorlagen angeben:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-164">You can specify additional route template information for a Razor Page as part of its `@page` directive:</span></span>

```csharp
@page "{id:int}"
```

<span data-ttu-id="7ad9c-165">Im vorherigen Beispiel hat die Seite Routen mit einem ganzzahligen `id`-Parameter abgeglichen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-165">In the previous example, the page in question would match a route with an integer `id` parameter.</span></span> <span data-ttu-id="7ad9c-166">Die Seite *Products.cshtml* , die sich im Stamm von `/Pages` befindet, würde beispielsweise folgende Route aufweisen:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-166">For example, the *Products.cshtml* page located in the root of `/Pages` would have this route:</span></span>

```csharp
"/Products/123"
```

<span data-ttu-id="7ad9c-167">Nachdem eine bestimmte Anforderung einer Route zugeordnet wurde, aber noch bevor die Aktionsmethode aufgerufen wird, führt ASP.NET Core MVC Vorgänge zur [Modellbindung](/aspnet/core/mvc/models/model-binding) und [Modellvalidierung](/aspnet/core/mvc/models/validation) für die Anforderung aus.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-167">Once a given request has been matched to a route, but before the action method is called, ASP.NET Core MVC will perform [model binding](/aspnet/core/mvc/models/model-binding) and [model validation](/aspnet/core/mvc/models/validation) on the request.</span></span> <span data-ttu-id="7ad9c-168">Die Modellbindung ist notwendig, um eingehende HTTP-Daten in .NET-Typen zu konvertieren, die als Parameter der aufzurufenden Aktionsmethode angegeben wurden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-168">Model binding is responsible for converting incoming HTTP data into the .NET types specified as parameters of the action method to be called.</span></span> <span data-ttu-id="7ad9c-169">Wenn z. B. die Aktionsmethode einen `int id`-Parameter erwartet, versucht die Modellbindung, diesen Parameter über einen Wert bereitzustellen, der Teil der Anforderung ist.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-169">For example, if the action method expects an `int id` parameter, model binding will attempt to provide this parameter from a value provided as part of the request.</span></span> <span data-ttu-id="7ad9c-170">Dafür sucht die Modellbindung nach bereitgestellten Formularwerten, Werten in der Route selbst und Werten von Abfragezeichenfolgen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-170">To do so, model binding looks for values in a posted form, values in the route itself, and query string values.</span></span> <span data-ttu-id="7ad9c-171">Wenn ein ID-Wert gefunden wird, wird dieser in eine ganze Zahl konvertiert, bevor dieser an die Aktionsmethode übergeben wird.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-171">Assuming an id value is found, it will be converted to an integer before being passed into the action method.</span></span>

<span data-ttu-id="7ad9c-172">Nach der Modellbindung, aber noch vor dem Aufruf der Aktionsmethode, wird eine Modellvalidierung vorgenommen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-172">After binding the model but before calling the action method, model validation occurs.</span></span> <span data-ttu-id="7ad9c-173">Die Modellvalidierung verwendet optionale Attribute für den Modelltyp. In diesem Zusammenhang kann ggf. sichergestellt werden, dass das bereitgestellte Modellobjekt mit bestimmten Anforderungen an Daten konform ist.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-173">Model validation uses optional attributes on the model type, and can help ensure that the provided model object conforms to certain data requirements.</span></span> <span data-ttu-id="7ad9c-174">Bestimmte Werte sind möglicherweise entsprechend den Anforderungen angegeben oder auf eine bestimmte Länge bzw. einen bestimmten numerischen Bereich beschränkt. Wenn Validierungsattribute angegeben sind, das Modell aber nicht deren Anforderungen entspricht, wird für die Eigenschaft „ModelState.IsValid“ FALSE zurückgegeben. Dann können die fehlerhaften Validierungsregeln an den Client gesendet werden, von dem die Anforderung ausgeht.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-174">Certain values may be specified as required, or limited to a certain length or numeric range, etc. If validation attributes are specified but the model does not conform to their requirements, the property ModelState.IsValid will be false, and the set of failing validation rules will be available to send to the client making the request.</span></span>

<span data-ttu-id="7ad9c-175">Wenn Sie die Modellvalidierung verwenden, sollten Sie stets überprüfen, ob das Modell gültig ist, bevor Sie einen Befehl ausführen, der Einfluss auf den Status haben kann. Dadurch stellen Sie sicher, dass die App nicht durch ungültige Daten beschädigt wird.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-175">If you're using model validation, you should be sure to always check that the model is valid before performing any state-altering commands, to ensure your app is not corrupted by invalid data.</span></span> <span data-ttu-id="7ad9c-176">Sie können einen [Filter](/aspnet/core/mvc/controllers/filters) verwenden, damit Sie nicht für jede Aktion Code für die Modellvalidierung hinzufügen müssen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-176">You can use a [filter](/aspnet/core/mvc/controllers/filters) to avoid the need to add code for this in every action.</span></span> <span data-ttu-id="7ad9c-177">Mithilfe von ASP.NET Core MVC-Filtern können Sie Gruppen von Anforderungen abfangen, damit allgemeine Richtlinien und übergreifende Aspekte gezielt angewendet werden können.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-177">ASP.NET Core MVC filters offer a way of intercepting groups of requests, so that common policies and cross-cutting concerns can be applied on a targeted basis.</span></span> <span data-ttu-id="7ad9c-178">Filter können sowohl auf individuelle Aktionen als auch auf vollständige Controller oder global auf eine ganze Anwendung angewendet werden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-178">Filters can be applied to individual actions, whole controllers, or globally for an application.</span></span>

<span data-ttu-id="7ad9c-179">Im Hinblick auf Web-APIs unterstützt ASP.NET Core MVC die [_Inhaltsaushandlung_](/aspnet/core/mvc/models/formatting). Dadurch können Anforderungen angeben, wie Antworten formatiert werden sollen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-179">For web APIs, ASP.NET Core MVC supports [_content negotiation_](/aspnet/core/mvc/models/formatting), allowing requests to specify how responses should be formatted.</span></span> <span data-ttu-id="7ad9c-180">Auf der Grundlage von in Anforderungen enthaltenen Headern formatieren Aktionen, die Daten zurückgeben, die Antworten in XML, JSON oder einem beliebigen anderen unterstützten Format.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-180">Based on headers provided in the request, actions returning data will format the response in XML, JSON, or another supported format.</span></span> <span data-ttu-id="7ad9c-181">Mithilfe dieses Features kann dieselbe API in mehreren Clients mit unterschiedlichen Anforderungen an das Datenformat verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-181">This feature enables the same API to be used by multiple clients with different data format requirements.</span></span>

<span data-ttu-id="7ad9c-182">Für Web-API-Projekte sollte das `[ApiController]`-Attribut verwendet werden, das auf einzelne Controller, eine Basiscontrollerklasse oder die gesamte Assembly angewendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-182">Web API projects should consider using the `[ApiController]` attribute, which can be applied to individual controllers, to a base controller class, or to the entire assembly.</span></span> <span data-ttu-id="7ad9c-183">Durch dieses Attribut wird eine automatische Modellüberprüfung hinzugefügt, und jede Aktion, bei der ein ungültiges Modell verwendet wird, gibt den Fehler „BadRequest“ mit Details zu den Überprüfungsfehlern zurück.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-183">This attribute adds automatic model validation checking and any action with an invalid model will return a BadRequest with the details of the validation errors.</span></span> <span data-ttu-id="7ad9c-184">Wenn dieses Attribut verwendet wird, müssen alle Aktionen eine Attributroute anstelle einer konventionellen Route aufweisen. Das Attribut gibt zudem ausführlichere Informationen zu aufgetretenen Fehlern zurück.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-184">The attribute also requires all actions have an attribute route, rather than using a conventional route, and returns more detailed ProblemDetails information in response to errors.</span></span>

### <a name="keeping-controllers-under-control"></a><span data-ttu-id="7ad9c-185">Steuern von Controllern</span><span class="sxs-lookup"><span data-stu-id="7ad9c-185">Keeping controllers under control</span></span>

<span data-ttu-id="7ad9c-186">Bei seitenbasierten Anwendungen sorgen Razor Pages dafür, dass Controller nicht zu groß werden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-186">For page-based applications, Razor Pages do a great job of keeping controllers from getting too large.</span></span> <span data-ttu-id="7ad9c-187">Jede einzelne Seite erhält eigene Dateien und Klassen, die nur für ihre Handler dediziert sind.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-187">Each individual page is given its own files and classes dedicated just to its handler(s).</span></span> <span data-ttu-id="7ad9c-188">Vor der Einführung von Razor Pages verfügten viele Anwendungen mit Fokus auf Ansichten über große Controllerklassen, die für viele verschiedene Aktionen und Ansichten zuständig sind.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-188">Prior to the introduction of Razor Pages, many view-centric applications would have large controller classes responsible for many different actions and views.</span></span> <span data-ttu-id="7ad9c-189">Diese Klassen werden auf natürliche Weise so vergrößert, dass sie viele Verantwortlichkeiten und Abhängigkeiten haben, was die Verwaltung erschwert.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-189">These classes would naturally grow to have many responsibilities and dependencies, making them harder to maintain.</span></span> <span data-ttu-id="7ad9c-190">Wenn Sie feststellen, dass Ihre ansichtsbasierten Controller zu groß werden, sollten Sie zur Verwendung von Razor Pages ein Refactoring in Erwägung ziehen oder ein Vermittlermuster einführen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-190">If you find your view-based controllers are growing too large, consider refactoring them to use Razor Pages, or introducing a pattern like mediator.</span></span>

<span data-ttu-id="7ad9c-191">Das Vermittlerentwurfsmuster wird verwendet, um die Kopplung zwischen Klassen zu reduzieren und gleichzeitig die Kommunikation zwischen diesen zuzulassen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-191">The mediator design pattern is used to reduce coupling between classes while allowing communication between them.</span></span> <span data-ttu-id="7ad9c-192">In ASP.NET Core MVC-Anwendungen wird dieses Muster häufig eingesetzt, um Controller in kleinere Teile aufzuteilen, indem *Handler* verwendet werden, die die Arbeit von Aktionsmethoden übernehmen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-192">In ASP.NET Core MVC applications, this pattern is frequently employed to break up controllers into smaller pieces by using *handlers* to do the work of action methods.</span></span> <span data-ttu-id="7ad9c-193">Hierzu wird häufig das beliebte [MediatR-NuGet-Paket](https://www.nuget.org/packages/MediatR/) verwendet.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-193">The popular [MediatR NuGet package](https://www.nuget.org/packages/MediatR/) is often used to accomplish this.</span></span> <span data-ttu-id="7ad9c-194">In der Regel enthalten Controller viele verschiedene Aktionsmethoden, die jeweils möglicherweise bestimmte Abhängigkeiten erfordern.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-194">Typically, controllers include many different action methods, each of which may require certain dependencies.</span></span> <span data-ttu-id="7ad9c-195">Diese für eine Aktion erforderlichen Abhängigkeiten müssen an den Konstruktor des Controllers übergeben werden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-195">The set of all dependencies required by any action must be passed into the controller's constructor.</span></span> <span data-ttu-id="7ad9c-196">Bei der Verwendung von MediatR befindet sich die einzige Instanz eines Controllers auf einer Instanz des Vermittlers.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-196">When using Mediatr, the only dependency a controller has is on an instance of the mediator.</span></span> <span data-ttu-id="7ad9c-197">Jede Aktion verwendet dann die Vermittlerinstanz, um eine Nachricht zu senden, die von einem Handler verarbeitet wird.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-197">Each action then uses the mediator instance to send a message, which is processed by a handler.</span></span> <span data-ttu-id="7ad9c-198">Der Handler ist für eine einzelne Aktion spezifisch und benötigt daher nur die für diese Aktion erforderlichen Abhängigkeiten.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-198">The handler is specific to a single action and thus only needs the dependencies required by that action.</span></span> <span data-ttu-id="7ad9c-199">Hier finden Sie ein Beispiel für einen Controller, der MediatR verwendet:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-199">An example of a controller using MediatR is shown here:</span></span>

```csharp
public class OrderController : Controller
{
    private readonly IMediator _mediator;

    public OrderController(IMediator mediator)
    {
        _mediator = mediator;
    }

    [HttpGet]
    public async Task<IActionResult> MyOrders()
    {
        var viewModel = await _mediator.Send(new GetMyOrders(User.Identity.Name));

        return View(viewModel);
    }

    // other actions implemented similarly
}
```

<span data-ttu-id="7ad9c-200">Bei der `MyOrders`-Aktion wird der `Send`-Befehl zum Senden einer `GetMyOrders`-Nachricht von dieser Klasse verarbeitet:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-200">In the `MyOrders` action, the call to `Send` a `GetMyOrders` message is handled by this class:</span></span>

```csharp
public class GetMyOrdersHandler : IRequestHandler<GetMyOrders, IEnumerable<OrderViewModel>>
{
    private readonly IOrderRepository _orderRepository;

    public GetMyOrdersHandler(IOrderRepository orderRepository)
    {
        _orderRepository = orderRepository;
    }

    public async Task<IEnumerable<OrderViewModel>> Handle(GetMyOrders request, CancellationToken cancellationToken)
    {
        var specification = new CustomerOrdersWithItemsSpecification(request.UserName);
        var orders = await _orderRepository.ListAsync(specification);

        return orders.Select(o => new OrderViewModel
        {
            OrderDate = o.OrderDate,
            OrderItems = o.OrderItems?.Select(oi => new OrderItemViewModel()
            {
                PictureUrl = oi.ItemOrdered.PictureUri,
                ProductId = oi.ItemOrdered.CatalogItemId,
                ProductName = oi.ItemOrdered.ProductName,
                UnitPrice = oi.UnitPrice,
                Units = oi.Units
            }).ToList(),
            OrderNumber = o.Id,
            ShippingAddress = o.ShipToAddress,
            Total = o.Total()
        });
    }
}
```

<span data-ttu-id="7ad9c-201">Das Endergebnis dieses Ansatzes ist, dass Controller viel kleiner und hauptsächlich auf das Routing und Modellbindungen ausgerichtet sind, während einzelne Handler für die spezifischen Aufgaben verantwortlich sind, die für einen bestimmten Endpunkt erforderlich sind.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-201">The end result of this approach is for controllers to be much smaller and focused primarily on routing and model binding, while individual handlers are responsible for the specific tasks needed by a given endpoint.</span></span> <span data-ttu-id="7ad9c-202">Anstelle von MediatR können Sie bei diesem Ansatz auch das [ApiEndpoints-NuGet-Paket](https://www.nuget.org/packages/Ardalis.ApiEndpoints/) verwenden, das versucht, API-Controllern dieselben Vorteile zu bieten, die Razor Pages ansichtsbasierten Controllern bieten.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-202">This approach can also be achieved without MediatR by using the [ApiEndpoints NuGet package](https://www.nuget.org/packages/Ardalis.ApiEndpoints/), which attempts to bring to API controllers the same benefits Razor Pages brings to view-based controllers.</span></span>

> ### <a name="references--mapping-requests-to-responses"></a><span data-ttu-id="7ad9c-203">Ressourcen: Zuordnen von Anforderungen zu Antworten</span><span class="sxs-lookup"><span data-stu-id="7ad9c-203">References – Mapping Requests to Responses</span></span>
>
> - <span data-ttu-id="7ad9c-204">**Routing to Controller Actions (Routing zu Controlleraktionen)** 
 > <https://docs.microsoft.com/aspnet/core/mvc/controllers/routing></span><span class="sxs-lookup"><span data-stu-id="7ad9c-204">**Routing to Controller Actions**
<https://docs.microsoft.com/aspnet/core/mvc/controllers/routing></span></span>
> - <span data-ttu-id="7ad9c-205">**Modellbindung in ASP.NET Core**
 > <https://docs.microsoft.com/aspnet/core/mvc/models/model-binding></span><span class="sxs-lookup"><span data-stu-id="7ad9c-205">**Model Binding**
<https://docs.microsoft.com/aspnet/core/mvc/models/model-binding></span></span>
> - <span data-ttu-id="7ad9c-206">**Model Validation (Modellvalidierung)** 
 > <https://docs.microsoft.com/aspnet/core/mvc/models/validation></span><span class="sxs-lookup"><span data-stu-id="7ad9c-206">**Model Validation**
<https://docs.microsoft.com/aspnet/core/mvc/models/validation></span></span>
> - <span data-ttu-id="7ad9c-207">**Filter in ASP.NET Core**
 > <https://docs.microsoft.com/aspnet/core/mvc/controllers/filters></span><span class="sxs-lookup"><span data-stu-id="7ad9c-207">**Filters**
<https://docs.microsoft.com/aspnet/core/mvc/controllers/filters></span></span>
> - <span data-ttu-id="7ad9c-208">**ApiController Attribute (ApiController-Attribut)** 
 > <https://docs.microsoft.com/aspnet/core/web-api/></span><span class="sxs-lookup"><span data-stu-id="7ad9c-208">**ApiController Attribute**
<https://docs.microsoft.com/aspnet/core/web-api/></span></span>

## <a name="working-with-dependencies"></a><span data-ttu-id="7ad9c-209">Arbeiten mit Abhängigkeiten</span><span class="sxs-lookup"><span data-stu-id="7ad9c-209">Working with dependencies</span></span>

<span data-ttu-id="7ad9c-210">Die Technik [Dependency Injection](/aspnet/core/fundamentals/dependency-injection) wird von ASP.NET Core unterstützt und intern verwendet.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-210">ASP.NET Core has built-in support for and internally makes use of a technique known as [dependency injection](/aspnet/core/fundamentals/dependency-injection).</span></span> <span data-ttu-id="7ad9c-211">Es handelt sich dabei um eine Technik, die die lose Kopplung von unterschiedlichen Teilen einer Anwendung ermöglicht.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-211">Dependency injection is a technique that enables loose coupling between different parts of an application.</span></span> <span data-ttu-id="7ad9c-212">Eine losere Kopplung stellt einen Vorteil dar, da dadurch verschiedene Teile der Anwendung besser isoliert voneinander getestet oder ersetzt werden können.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-212">Looser coupling is desirable because it makes it easier to isolate parts of the application, allowing for testing or replacement.</span></span> <span data-ttu-id="7ad9c-213">Außerdem wird es dadurch unwahrscheinlicher, dass eine Änderung eines Teils der Anwendung zu unerwarteten Auswirkungen auf die restliche Anwendung führen kann.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-213">It also makes it less likely that a change in one part of the application will have an unexpected impact somewhere else in the application.</span></span> <span data-ttu-id="7ad9c-214">Dependency Injection basiert auf dem Prinzip der Dependency Inversion und stellt häufig ein wichtiges Mittel dar, um das Offen/Geschlossen-Prinzip durchzusetzen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-214">Dependency injection is based on the dependency inversion principle, and is often key to achieving the open/closed principle.</span></span> <span data-ttu-id="7ad9c-215">Wenn Sie auswerten, wie die Anwendung mit ihren Abhängigkeiten funktioniert, sollten Sie schlecht strukturierten Code im [statischen Zusammenhang](https://deviq.com/static-cling/) vermeiden und den Leitsatz [New is Glue](https://ardalis.com/new-is-glue) („New“ ist klebrig) beachten.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-215">When evaluating how your application works with its dependencies, beware of the [static cling](https://deviq.com/static-cling/) code smell, and remember the aphorism "[new is glue](https://ardalis.com/new-is-glue)."</span></span>

<span data-ttu-id="7ad9c-216">Es entsteht ein statischer Zusammenhang, wenn Ihre Klassen statische Methoden aufrufen oder auf statische Eigenschaften zugreifen, die Nebenwirkungen oder Abhängigkeiten von der Infrastruktur umfassen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-216">Static cling occurs when your classes make calls to static methods, or access static properties, which have side effects or dependencies on infrastructure.</span></span> <span data-ttu-id="7ad9c-217">Wenn Sie z.B. über eine Methode verfügen, die eine statische Methode aufruft, die wiederum in eine Datenbank schreibt, wird Ihre Methode eng an die Datenbank gekoppelt.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-217">For example, if you have a method that calls a static method, which in turn writes to a database, your method is tightly coupled to the database.</span></span> <span data-ttu-id="7ad9c-218">Jegliches Element, das den Datenbankaufruf unterbricht, unterbricht auch die Methode.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-218">Anything that breaks that database call will break your method.</span></span> <span data-ttu-id="7ad9c-219">Es ist bekannt, dass es sehr schwierig ist, diese Methode zu testen, da dafür entweder kommerzielle Testbibliotheken erforderlich sind, die statische Aufrufe testen, oder die Tests nur mit einer aktiven Testdatenbank ausgeführt werden können.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-219">Testing such methods is notoriously difficult, since such tests either require commercial mocking libraries to mock the static calls, or can only be tested with a test database in place.</span></span> <span data-ttu-id="7ad9c-220">Statische Aufrufe, bei denen keine Abhängigkeiten von der Infrastruktur bestehen, insbesondere die vollständig zustandslosen, können ohne Bedenken aufgerufen werden und haben (abgesehen von Kopplungscode und statischen Aufrufen an sich) keine Auswirkung auf die Kopplung oder Testfähigkeit.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-220">Static calls that don't have any dependence on infrastructure, especially those that are completely stateless, are fine to call and have no impact on coupling or testability (beyond coupling code to the static call itself).</span></span>

<span data-ttu-id="7ad9c-221">Viele Entwickler kennen zwar das Risiko von statischen Zusammenhängen und globalen Status, koppeln ihren Code aber dennoch über direkte Instanziierung eng an bestimmte Implementierungen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-221">Many developers understand the risks of static cling and global state, but will still tightly couple their code to specific implementations through direct instantiation.</span></span> <span data-ttu-id="7ad9c-222">Der Leitsatz „new is glue“ („new“ fungiert als Klebstoff) soll an diese Kopplung erinnern und stellt keine generelle Verurteilung der Verwendung des Schlüsselworts `new` dar.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-222">"New is glue" is meant to be a reminder of this coupling, and not a general condemnation of the use of the `new` keyword.</span></span> <span data-ttu-id="7ad9c-223">Genauso wie statische Methodenaufrufe koppeln neue Instanzen von Typen ohne externe Abhängigkeiten Code nicht eng an die Implementierungsdetails, und sie erschweren auch nicht den Testvorgang.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-223">Just as with static method calls, new instances of types that have no external dependencies typically do not tightly couple code to implementation details or make testing more difficult.</span></span> <span data-ttu-id="7ad9c-224">Sie sollten aber jedes Mal, wenn eine Klasse instanziiert wird, überlegen, ob es sinnvoll ist, vordefinierten Code für diese Instanz an einem bestimmten Ort zu verwenden, oder ob Sie besser festlegen sollten, dass diese Instanz als eine Abhängigkeit abgefragt wird.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-224">But each time a class is instantiated, take just a brief moment to consider whether it makes sense to hard-code that specific instance in that particular location, or if it would be a better design to request that instance as a dependency.</span></span>

### <a name="declare-your-dependencies"></a><span data-ttu-id="7ad9c-225">Deklarieren Ihrer Abhängigkeiten</span><span class="sxs-lookup"><span data-stu-id="7ad9c-225">Declare your dependencies</span></span>

<span data-ttu-id="7ad9c-226">ASP.NET Core ist so konzipiert, dass Methoden und Klassen ihre jeweiligen Abhängigkeiten deklarieren und diese als Argumente anfordern.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-226">ASP.NET Core is built around having methods and classes declare their dependencies, requesting them as arguments.</span></span> <span data-ttu-id="7ad9c-227">ASP.NET-Anwendungen werden in der Regel in Startklassen eingerichtet, die so konfiguriert sind, dass sie an mehreren Stellen Dependency Injection unterstützen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-227">ASP.NET applications are typically set up in a Startup class, which itself is configured to support dependency injection at several points.</span></span> <span data-ttu-id="7ad9c-228">Wenn Ihre Startklasse über einen Konstruktor verfügt, kann sie über diesen wie folgt Abhängigkeiten anfordern:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-228">If your Startup class has a constructor, it can request dependencies through the constructor, like so:</span></span>

```csharp
public class Startup
{
    public Startup(IHostingEnvironment env)
    {
        var builder = new ConfigurationBuilder()
            .SetBasePath(env.ContentRootPath)
            .AddJsonFile("appsettings.json", optional: false, reloadOnChange: true)
            .AddJsonFile($"appsettings.{env.EnvironmentName}.json", optional: true);
    }
}
```

<span data-ttu-id="7ad9c-229">Die Startklasse ist von Bedeutung, weil es keine expliziten Typanforderungen an sie gibt.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-229">The Startup class is interesting in that there are no explicit type requirements for it.</span></span> <span data-ttu-id="7ad9c-230">Sie erbt weder von einer besonderen Basisstartklasse und implementiert auch keine bestimmte Schnittstelle.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-230">It doesn't inherit from a special Startup base class, nor does it implement any particular interface.</span></span> <span data-ttu-id="7ad9c-231">Sie können ihr optional einen Konstruktor zuweisen und beliebig viele Parameter für diesen angeben.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-231">You can give it a constructor, or not, and you can specify as many parameters on the constructor as you want.</span></span> <span data-ttu-id="7ad9c-232">Wenn der Web-Host, den Sie für Ihre Anwendung konfiguriert haben, startet, ruft dieser die von Ihnen festgelegte Startklasse auf und verwendet Dependency Injection, um jegliche Abhängigkeiten aufzufüllen, die die Startklasse erfordert.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-232">When the web host you've configured for your application starts, it will call the Startup class you've told it to use, and will use dependency injection to populate any dependencies the Startup class requires.</span></span> <span data-ttu-id="7ad9c-233">Wenn Sie Parameter anfordern, die nicht in den von ASP.NET Core verwendeten Dienstcontainern konfiguriert sind, wird eine Ausnahme ausgelöst. Wenn Sie sich jedoch nur auf die Abhängigkeiten beziehen, die dem Container bekannt sind, können Sie jede beliebige Anforderung senden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-233">Of course, if you request parameters that aren't configured in the services container used by ASP.NET Core, you'll get an exception, but as long as you stick to dependencies the container knows about, you can request anything you want.</span></span>

<span data-ttu-id="7ad9c-234">Dependency Injection ist in ASP.NET Core-Apps schon von Beginn an integriert, wenn Sie die Startinstanz erstellen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-234">Dependency injection is built into your ASP.NET Core apps right from the start, when you create the Startup instance.</span></span> <span data-ttu-id="7ad9c-235">Dies bezieht sich auch auf die Startklasse.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-235">It doesn't stop there for the Startup class.</span></span> <span data-ttu-id="7ad9c-236">Außerdem können Sie Abhängigkeiten in der Methode „Configure“ anfordern:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-236">You can also request dependencies in the Configure method:</span></span>

```csharp
public void Configure(IApplicationBuilder app,
    IHostingEnvironment env,
    ILoggerFactory loggerFactory)
{

}
```

<span data-ttu-id="7ad9c-237">Die Methode „ConfigureServices“ stellt eine Ausnahme in Bezug auf dieses Verhalten dar, da sie nur einen Parameter des Typs IServiceCollection benötigt.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-237">The ConfigureServices method is the exception to this behavior; it must take just one parameter of type IServiceCollection.</span></span> <span data-ttu-id="7ad9c-238">Sie muss nicht unbedingt Dependency Injection unterstützen, da sie einerseits dafür verantwortlich ist, dem Dienstcontainer Objekte hinzuzufügen, und andererseits über den IServiceCollection-Parameter Zugriff auf alle zu diesem Zeitpunkt konfigurierten Dienste hat.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-238">It doesn't really need to support dependency injection, since on the one hand it is responsible for adding objects to the services container, and on the other it has access to all currently configured services via the IServiceCollection parameter.</span></span> <span data-ttu-id="7ad9c-239">Daher können Sie in der gesamten Startklasse mit Abhängigkeiten arbeiten, die in der ASP.NET Core-Dienstauflistung definiert sind, indem Sie entweder den benötigten Dienst als Parameter anfordern oder Sie mit IServiceCollection in der Methode ConfigureServices arbeiten.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-239">Thus, you can work with dependencies defined in the ASP.NET Core services collection in every part of the Startup class, either by requesting the needed service as a parameter or by working with the IServiceCollection in ConfigureServices.</span></span>

> [!NOTE]
> <span data-ttu-id="7ad9c-240">Wenn Sie sicherstellen müssen, dass bestimmte Dienste in Ihrer Startup-Klasse verfügbar sind, können Sie diese mithilfe von WebHostBuilder und der ConfigureServices-Methode innerhalb des Aufrufs von CreateDefaultBuilder konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-240">If you need to ensure certain services are available to your Startup class, you can configure them using an IWebHostBuilder and its ConfigureServices method inside the CreateDefaultBuilder call.</span></span>

<span data-ttu-id="7ad9c-241">Bei der Startklasse handelt es sich um ein Modell zur Vorgehensweise bei der Strukturierung anderer Bestandteile Ihrer ASP.NET Core-Anwendung – angefangen bei Controllern über Middleware bis hin zu Filtern Ihrer eigenen Dienste.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-241">The Startup class is a model for how you should structure other parts of your ASP.NET Core application, from Controllers to Middleware to Filters to your own Services.</span></span> <span data-ttu-id="7ad9c-242">Auf jeden Fall sollten Sie das [Prinzip der expliziten Abhängigkeiten](https://deviq.com/explicit-dependencies-principle/) beachten und besser Ihre Abhängigkeiten anfordern als sie direkt zu erstellen sowie in der gesamten Anwendung Dependency Injection nutzen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-242">In each case, you should follow the [Explicit Dependencies Principle](https://deviq.com/explicit-dependencies-principle/), requesting your dependencies rather than directly creating them, and leveraging dependency injection throughout your application.</span></span> <span data-ttu-id="7ad9c-243">Achten Sie darauf, wo und wie Sie Implementierungen direkt instanziieren, insbesondere wenn es um Dienste und Objekte geht, die mit der Infrastruktur arbeiten und Nebenwirkungen haben.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-243">Be careful of where and how you directly instantiate implementations, especially services and objects that work with infrastructure or have side effects.</span></span> <span data-ttu-id="7ad9c-244">Sie sollten besser mit Abstraktionen arbeiten, die im Anwendungskern definiert sind und als Argumente an vordefinierte Verweise auf bestimmte Implementierungstypen übergeben wurden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-244">Prefer working with abstractions defined in your application core and passed in as arguments to hardcoding references to specific implementation types.</span></span>

## <a name="structuring-the-application"></a><span data-ttu-id="7ad9c-245">Strukturieren der Anwendung</span><span class="sxs-lookup"><span data-stu-id="7ad9c-245">Structuring the application</span></span>

<span data-ttu-id="7ad9c-246">Monolithische Anwendungen verfügen in der Regel über einen festgelegten Einstiegspunkt.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-246">Monolithic applications typically have a single entry point.</span></span> <span data-ttu-id="7ad9c-247">Bei ASP.NET Core-Webanwendungen stellt das ASP.NET Core-Webprojekt den Einstiegspunkt dar.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-247">In the case of an ASP.NET Core web application, the entry point will be the ASP.NET Core web project.</span></span> <span data-ttu-id="7ad9c-248">Das bedeutet jedoch nicht, dass die Projektmappe aus nur einem Projekt bestehen sollte.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-248">However, that doesn't mean the solution should consist of just a single project.</span></span> <span data-ttu-id="7ad9c-249">Sie sollten die Anwendung in verschiedene Schichten unterteilen, um dem Prinzip „Separation of Concerns“ zu folgen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-249">It's useful to break up the application into different layers in order to follow separation of concerns.</span></span> <span data-ttu-id="7ad9c-250">Wenn Sie dies tun, sollten Sie Ordner erstellen, um Projekte voneinander zu trennen und um so die Kapselung zu verbessern.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-250">Once broken up into layers, it's helpful to go beyond folders to separate projects, which can help achieve better encapsulation.</span></span> <span data-ttu-id="7ad9c-251">Der beste Ansatz, um diese Ziele mit einer ASP.NET Core-Anwendung zu erreichen, ist eine Abwandlung der in Kapitel 5 erläuterten sogenannten „Clean Architecture“.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-251">The best approach to achieve these goals with an ASP.NET Core application is a variation of the Clean Architecture discussed in chapter 5.</span></span> <span data-ttu-id="7ad9c-252">Wenn Sie diesem Ansatz folgen, besteht die Projektmappe dieser Anwendung aus separaten Bibliotheken für die Benutzeroberfläche, die Infrastruktur und das ApplicationCore-Projekt.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-252">Following this approach, the application's solution will comprise separate libraries for the UI, Infrastructure, and ApplicationCore.</span></span>

<span data-ttu-id="7ad9c-253">Neben diesen Projekten sind dann auch Testprojekte in der Anwendung enthalten (Informationen zum Testen finden Sie in Kapitel 9).</span><span class="sxs-lookup"><span data-stu-id="7ad9c-253">In addition to these projects, separate test projects are included as well (Testing is discussed in Chapter 9).</span></span>

<span data-ttu-id="7ad9c-254">Das Objektmodell und die Schnittstellen der Anwendung sollten im ApplicationCore-Projekt enthalten sein.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-254">The application's object model and interfaces should be placed in the ApplicationCore project.</span></span> <span data-ttu-id="7ad9c-255">Dann hat das Projekt so wenige Abhängigkeiten wie möglich, auf die die anderen Projekte in der Projektmappe verweisen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-255">This project will have as few dependencies as possible, and the other projects in the solution will reference it.</span></span> <span data-ttu-id="7ad9c-256">Sowohl Geschäftsentitäten, die beibehalten werden sollen, als auch Dienste, die nicht direkt von der Infrastruktur abhängig sind, werden im ApplicationCore-Projekt definiert.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-256">Business entities that need to be persisted are defined in the ApplicationCore project, as are services that do not directly depend on infrastructure.</span></span>

<span data-ttu-id="7ad9c-257">Im Infrastrukturprojekt sind Informationen zur Implementierung enthalten. Diese umfassen Hinweise zur Vorgehensweise im Hinblick auf die Persistenz und beim möglichen Senden von Benachrichtigungen an den Benutzer.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-257">Implementation details, such as how persistence is performed or how notifications might be sent to a user, are kept in the Infrastructure project.</span></span> <span data-ttu-id="7ad9c-258">Dieses Projekt verweist dann zwar auf implementierungsspezifische Pakete wie Entity Framework Core, sollte aber keine Informationen zu diesen Implementierungen außerhalb des Projekts verfügbar machen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-258">This project will reference implementation-specific packages such as Entity Framework Core, but should not expose details about these implementations outside of the project.</span></span> <span data-ttu-id="7ad9c-259">Infrastrukturdienste und Repositorys sollten Schnittstellen implementieren, die im ApplicationCore-Projekt definiert sind. Über die Persistenzimplementierungen dieses Projekts werden darin implementierte Entitäten abgerufen und gespeichert.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-259">Infrastructure services and repositories should implement interfaces that are defined in the ApplicationCore project, and its persistence implementations are responsible for retrieving and storing entities defined in ApplicationCore.</span></span>

<span data-ttu-id="7ad9c-260">Das ASP.NET Core-Benutzeroberflächenprojekt ist zwar verantwortlich für jegliche Aspekte im Hinblick auf die Benutzeroberflächenebene, es sollte jedoch keine Geschäftslogik oder Informationen zur Infrastruktur enthalten.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-260">The ASP.NET Core UI project is responsible for any UI level concerns, but should not include business logic or infrastructure details.</span></span> <span data-ttu-id="7ad9c-261">Bestenfalls sollte es sogar unabhängig vom Infrastrukturprojekt sein. Dadurch wird sichergestellt, dass nicht versehentlich eine Abhängigkeit zwischen zwei Projekten hergestellt wird.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-261">In fact, ideally it shouldn't even have a dependency on the Infrastructure project, which will help ensure no dependency between the two projects is introduced accidentally.</span></span> <span data-ttu-id="7ad9c-262">Dies erreichen Sie, indem Sie einen Dependency Injection-Container eines Drittanbieters wie Autofac verwenden. Damit können Sie Regeln für die einzelnen Projekte zu Dependency Injection in Module-Klassen festlegen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-262">This can be achieved using a third-party DI container like Autofac, which allows you to define DI rules in Module classes in each project.</span></span>

<span data-ttu-id="7ad9c-263">Alternativ können Sie auch festlegen, dass die Anwendung Microservices aufruft, die möglicherweise in individuellen Docker-Containern bereitgestellt werden, um die Anwendung von Informationen zur Implementierung zu entkoppeln.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-263">Another approach to decoupling the application from implementation details is to have the application call microservices, perhaps deployed in individual Docker containers.</span></span> <span data-ttu-id="7ad9c-264">Dadurch wird das Prinzip „Separation of Concerns“ noch deutlicher eingehalten, und es wird eine bessere Entkopplung vorgenommen als bei der Verwendung von Dependency Injection zwischen zwei Projekten. Allerdings ist diese Methode auch komplexer.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-264">This provides even greater separation of concerns and decoupling than leveraging DI between two projects, but has additional complexity.</span></span>

### <a name="feature-organization"></a><span data-ttu-id="7ad9c-265">Organisieren von Features</span><span class="sxs-lookup"><span data-stu-id="7ad9c-265">Feature organization</span></span>

<span data-ttu-id="7ad9c-266">Standardmäßig stellen ASP.NET Core-Anwendungen ihre eigene Ordnerstruktur her, die Controller, Ansichten und häufig auch ViewModels umfasst.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-266">By default, ASP.NET Core applications organize their folder structure to include Controllers and Views, and frequently ViewModels.</span></span> <span data-ttu-id="7ad9c-267">Clientseitiger Code, der diese Strukturen auf Serverseite unterstützen soll, wird in der Regel separat im wwwroot-Ordner gespeichert.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-267">Client-side code to support these server-side structures is typically stored separately in the wwwroot folder.</span></span> <span data-ttu-id="7ad9c-268">Es kann jedoch sein, dass bei größeren Anwendungen im Zusammenhang mit dieser Ordnerstruktur Probleme auftreten, da Sie häufig zwischen diesen Ordnern hin- und herwechseln müssen, wenn Sie an einem bestimmten Feature arbeiten.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-268">However, large applications may encounter problems with this organization, since working on any given feature often requires jumping between these folders.</span></span> <span data-ttu-id="7ad9c-269">Je mehr Dateien und Unterordner in einem Ordner gespeichert werden, desto schwieriger wird dies, und desto mehr müssen Sie im Projektmappen-Explorer scrollen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-269">This gets more and more difficult as the number of files and subfolders in each folder grows, resulting in a great deal of scrolling through Solution Explorer.</span></span> <span data-ttu-id="7ad9c-270">Wenn Sie dieses Problem vermeiden möchten, können Sie Anwendungscode anstatt nach Dateityp nach _Feature_ ordnen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-270">One solution to this problem is to organize application code by _feature_ instead of by file type.</span></span> <span data-ttu-id="7ad9c-271">Diese Strukturierung wird häufig als Featureordner oder [Feature Slices](/archive/msdn-magazine/2016/september/asp-net-core-feature-slices-for-asp-net-core-mvc) bezeichnet (siehe auch: [Vertical Slices (Vertikale Slices)](https://deviq.com/vertical-slices/)).</span><span class="sxs-lookup"><span data-stu-id="7ad9c-271">This organizational style is typically referred to as feature folders or [feature slices](/archive/msdn-magazine/2016/september/asp-net-core-feature-slices-for-asp-net-core-mvc) (see also: [Vertical Slices](https://deviq.com/vertical-slices/)).</span></span>

<span data-ttu-id="7ad9c-272">In diesem Zusammenhang unterstützt ASP.NET Core MVC die Verwendung verschiedener Bereiche.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-272">ASP.NET Core MVC supports Areas for this purpose.</span></span> <span data-ttu-id="7ad9c-273">Wenn Sie verschiedene Bereiche verwenden, können Sie verschiedene separate Ordner für Controller und Ansichten (sowie für jegliche zugeordneten Modelle) in jedem Bereichsordner erstellen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-273">Using areas, you can create separate sets of Controllers and Views folders (as well as any associated models) in each Area folder.</span></span> <span data-ttu-id="7ad9c-274">In Abbildung 7-1 wird eine Ordnerstruktur dargestellt, in der Bereiche verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-274">Figure 7-1 shows an example folder structure, using Areas.</span></span>

![Beispielstruktur mit Bereichen](./media/image7-1.png)

<span data-ttu-id="7ad9c-276">**Abbildung 7-1**.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-276">**Figure 7-1**.</span></span> <span data-ttu-id="7ad9c-277">Beispielstruktur mit Bereichen</span><span class="sxs-lookup"><span data-stu-id="7ad9c-277">Sample Area Organization</span></span>

<span data-ttu-id="7ad9c-278">Wenn Sie Bereiche verwenden, müssen Sie Attribute verwenden, um Ihre Controller mit den Namen der Bereiche zu versehen, zu denen sie gehören:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-278">When using Areas, you must use attributes to decorate your controllers with the name of the area to which they belong:</span></span>

```csharp
[Area("Catalog")]
public class HomeController
{}
```

<span data-ttu-id="7ad9c-279">Außerdem müssen Sie die Bereichsunterstützung zu Ihren Routen hinzufügen:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-279">You also need to add area support to your routes:</span></span>

```csharp
app.UseEndpoints(endpoints =>
{
    endpoints.MapControllerRoute(name: "areaRoute", pattern: "{area:exists}/{controller=Home}/{action=Index}/{id?}");
    endpoints.MapControllerRoute(name: "default", pattern: "{controller=Home}/{action=Index}/{id?}");
});
```

<span data-ttu-id="7ad9c-280">Neben der bereits integrierten Unterstützung von Bereichen können Sie auch ihre eigene Ordnerstruktur und Konventionen anstelle von Attributen und benutzerdefinierten Routen verwenden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-280">In addition to the built-in support for Areas, you can also use your own folder structure, and conventions in place of attributes and custom routes.</span></span> <span data-ttu-id="7ad9c-281">Dadurch können Sie über Featureordner verfügen, die keine separaten Ordner für Ansichten, Controller usw. umfassen. Dadurch bleibt die Hierarchie flach, und es werden alle verwandten Dateien für ein Feature gleichzeitig an einem Ort angezeigt.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-281">This would allow you to have feature folders that didn't include separate folders for Views, Controllers, etc., keeping the hierarchy flatter and making it easier to see all related files in a single place for each feature.</span></span>

<span data-ttu-id="7ad9c-282">ASP.NET Core verwendet integrierte Konventionstypen, um das Verhalten dieses Frameworks zu kontrollieren.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-282">ASP.NET Core uses built-in convention types to control its behavior.</span></span> <span data-ttu-id="7ad9c-283">Sie können diese Konventionen verändern oder ersetzen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-283">You can modify or replace these conventions.</span></span> <span data-ttu-id="7ad9c-284">Sie können beispielsweise eine Konvention erstellen, die automatisch anhand des Namespace, der in der Regel mit dem Ordner korreliert, in dem der Controller platziert ist, den Featurenamen für einen bestimmten Controller abruft:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-284">For example, you can create a convention that will automatically get the feature name for a given controller based on its namespace (which typically correlates to the folder in which the controller is located):</span></span>

```csharp
public class FeatureConvention : IControllerModelConvention
{
    public void Apply(ControllerModel controller)
    {
        controller.Properties.Add("feature",
        GetFeatureName(controller.ControllerType));
    }

    private string GetFeatureName(TypeInfo controllerType)
    {
        string[] tokens = controllerType.FullName.Split('.');
        if (!tokens.Any(t => t == "Features")) return "";
        string featureName = tokens
        .SkipWhile(t => !t.Equals("features",
        StringComparison.CurrentCultureIgnoreCase))
        .Skip(1)
        .Take(1)
        .FirstOrDefault();
        return featureName;
    }
}
```

<span data-ttu-id="7ad9c-285">Geben Sie dann diese Konvention als eine Option an, wenn Sie in ConfigureServices zu Ihrer Anwendung MVC-Unterstützung hinzufügen:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-285">You then specify this convention as an option when you add support for MVC to your application in ConfigureServices:</span></span>

```csharp
services.AddMvc(o => o.Conventions.Add(new FeatureConvention()));
```

<span data-ttu-id="7ad9c-286">ASP.NET Core MVC verwendet außerdem eine Konvention, um Ansichten zu finden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-286">ASP.NET Core MVC also uses a convention to locate views.</span></span> <span data-ttu-id="7ad9c-287">Sie können diese Konvention mit einer benutzerdefinierten Konvention überschreiben, indem Sie den obenstehend unter FeatureConvention angegebenen Featurenamen verwenden, damit in Ihren Featureordnern Ansichten gefunden werden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-287">You can override it with a custom convention so that views will be located in your feature folders (using the feature name provided by the FeatureConvention, above).</span></span> <span data-ttu-id="7ad9c-288">Weitere Informationen zu diesem Ansatz finden Sie im MSDN Magazine-Artikel [ASP.NET Core: Feature Slices für ASP.NET Core MVC](/archive/msdn-magazine/2016/september/asp-net-core-feature-slices-for-asp-net-core-mvc). Auf dieser Seite können Sie auch ein Beispiel herunterladen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-288">You can learn more about this approach and download a working sample from the MSDN Magazine article, [Feature Slices for ASP.NET Core MVC](/archive/msdn-magazine/2016/september/asp-net-core-feature-slices-for-asp-net-core-mvc).</span></span>

### <a name="apis-and-no-locblazor-applications"></a><span data-ttu-id="7ad9c-289">APIs und :::no-loc(Blazor):::-Anwendungen</span><span class="sxs-lookup"><span data-stu-id="7ad9c-289">APIs and :::no-loc(Blazor)::: applications</span></span>

<span data-ttu-id="7ad9c-290">Wenn Ihre Anwendung mehrere Web-APIs enthält, die gesichert werden müssen, sollten diese im Idealfall als separates Projekt von Ihrer Ansichts- oder Razor Pages-Anwendung konfiguriert werden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-290">If your application includes a set of web APIs which must be secured, these should ideally be configured as a separate project from your View or Razor Pages application.</span></span> <span data-ttu-id="7ad9c-291">Das Trennen von APIs (insbesondere von öffentlichen APIs) von der serverseitigen Webanwendung hat mehrere Vorteile.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-291">Separating APIs, especially public APIs, from your server-side web application has a number of benefits.</span></span> <span data-ttu-id="7ad9c-292">Diese Anwendungen weisen häufig eindeutige Bereitstellungs- und Lastmerkmale auf.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-292">These applications often will have unique deployment and load characteristics.</span></span> <span data-ttu-id="7ad9c-293">Es ist auch sehr wahrscheinlich, dass unterschiedliche Sicherheitsmechanismen verwendet werden, bei denen formularbasierte Standardanwendungen die cookiebasierte Authentifizierung und APIs verwenden, die wahrscheinlich eine tokenbasierte Authentifizierung nutzen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-293">They're also very likely to adopt different mechanisms for security, with standard form-based applications leveraging cookie-based authentication and APIs most likely using token-based authentication.</span></span>

<span data-ttu-id="7ad9c-294">Außerdem sollten :::no-loc(Blazor):::-Anwendungen unabhängig von der Verwendung von :::no-loc(Blazor)::: Server oder :::no-loc(Blazor)::: :::no-loc(WebAssembly)::: als separate Projekte erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-294">Additionally, :::no-loc(Blazor)::: applications, whether using :::no-loc(Blazor)::: Server or :::no-loc(Blazor)::: :::no-loc(WebAssembly):::, should be built as separate projects.</span></span> <span data-ttu-id="7ad9c-295">Die Anwendungen haben unterschiedliche Runtimeeigenschaften und Sicherheitsmodelle.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-295">The applications have different runtime characteristics as well as security models.</span></span> <span data-ttu-id="7ad9c-296">Sie verwenden wahrscheinlich gemeinsame gängige Typen für die serverseitige Webanwendung (oder das API-Projekt), und diese Typen sollten in einem gängigen freigegebenen Projekt definiert werden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-296">They're likely to share common types with the server-side web application (or API project), and these types should be defined in a common shared project.</span></span>

<span data-ttu-id="7ad9c-297">Wenn Sie eine :::no-loc(Blazor)::: :::no-loc(WebAssembly):::-Administratorbenutzeroberfläche zu eShopOnWeb hinzufügen, erfordert dies auch das Hinzufügen von mehreren neuen Projekten.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-297">The addition of a :::no-loc(Blazor)::: :::no-loc(WebAssembly)::: admin interface to eShopOnWeb required adding several new projects.</span></span> <span data-ttu-id="7ad9c-298">Dazu gehört mit `:::no-loc(Blazor):::Admin` auch das :::no-loc(Blazor)::: :::no-loc(WebAssembly):::-Projekt selbst.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-298">The :::no-loc(Blazor)::: :::no-loc(WebAssembly)::: project itself, `:::no-loc(Blazor):::Admin`.</span></span> <span data-ttu-id="7ad9c-299">Im `PublicApi`-Projekt werden mehrere neue API-Endpunkte definiert, die von `:::no-loc(Blazor):::Admin` verwendet und für die Verwendung der tokenbasierten Authentifizierung konfiguriert werden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-299">A new set of public API endpoints, used by `:::no-loc(Blazor):::Admin` and configured to use token-based authentication, is defined in the `PublicApi` project.</span></span> <span data-ttu-id="7ad9c-300">Bestimmte freigegebene Typen, die von beiden Projekten verwendet werden, werden in dem neuen `:::no-loc(Blazor):::Shared`-Projekt gespeichert.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-300">And certain shared types used by both of these projects are kept in a new `:::no-loc(Blazor):::Shared` project.</span></span>

<span data-ttu-id="7ad9c-301">Nun kommt möglicherweise die Frage auf, warum ein separates `:::no-loc(Blazor):::Shared`-Projekt hinzugefügt wird, wenn bereits ein gemeinsames `ApplicationCore`-Projekt vorhanden ist, das verwendet werden kann, um alle für `PublicApi` und `:::no-loc(Blazor):::Admin` erforderlichen Typen freizugeben.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-301">One might ask, why add a separate `:::no-loc(Blazor):::Shared` project when there is already a common `ApplicationCore` project that could be used to share any types required by both `PublicApi` and `:::no-loc(Blazor):::Admin`?</span></span> <span data-ttu-id="7ad9c-302">Dies liegt daran, dass dieses Projekt die gesamte Geschäftslogik der Anwendung enthält und somit wesentlich größer als notwendig ist, weshalb auch der Schutz auf dem Server notwendig ist.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-302">The answer is that this project includes all of the application's business logic and is thus much larger than necessary and also much more likely to need to be kept secure on the server.</span></span> <span data-ttu-id="7ad9c-303">Beachten Sie, dass jede Bibliothek, auf die `:::no-loc(Blazor):::Admin` verweist, beim Laden der :::no-loc(Blazor):::-Anwendung über die Browser der Benutzer heruntergeladen wird.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-303">Remember that any library referenced by `:::no-loc(Blazor):::Admin` will be downloaded to users' browsers when they load the :::no-loc(Blazor)::: application.</span></span>

<span data-ttu-id="7ad9c-304">Abhängig davon, ob das [„Back-Ends für Front-Ends“-Muster (BFF)](/azure/architecture/patterns/backends-for-frontends) verwendet wird, dürfen die von der :::no-loc(Blazor)::: :::no-loc(WebAssembly):::-App genutzten APIs ihre Typen nicht für :::no-loc(Blazor)::: freigeben.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-304">Depending on whether one is using the [Backends-For-Frontends (BFF) pattern](/azure/architecture/patterns/backends-for-frontends), the APIs consumed by the :::no-loc(Blazor)::: :::no-loc(WebAssembly)::: app may not share their types 100% with :::no-loc(Blazor):::.</span></span> <span data-ttu-id="7ad9c-305">Insbesondere kann eine öffentliche API, die von vielen verschiedenen Clients verwendet werden soll, eigene Anforderungs- und Ergebnistypen definieren, anstatt diese in einem clientspezifischen freigegebenen Projekt freizugeben.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-305">In particular, a public API that's meant to be consumed by many different clients may define its own request and result types, rather than sharing them in a client-specific shared project.</span></span> <span data-ttu-id="7ad9c-306">Im eShopOnWeb-Beispiel wird davon ausgegangen, dass das `PublicApi`-Projekt tatsächlich eine öffentliche API hostet, sodass nicht alle Anforderungs- und Antworttypen aus dem `:::no-loc(Blazor):::Shared`-Projekt stammen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-306">In the eShopOnWeb sample, the assumption is being made that the `PublicApi` project is, in fact, hosting a public API, so not all of its request and response types come from the `:::no-loc(Blazor):::Shared` project.</span></span>

### <a name="cross-cutting-concerns"></a><span data-ttu-id="7ad9c-307">Übergreifende Belange</span><span class="sxs-lookup"><span data-stu-id="7ad9c-307">Cross-cutting concerns</span></span>

<span data-ttu-id="7ad9c-308">Je größer die Anwendungen werden, desto wichtiger ist es, übergreifende Belange zu vermeiden, um Duplizierungen zu vermeiden und Konsistenz zu gewährleisten.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-308">As applications grow, it becomes increasingly important to factor out cross-cutting concerns to eliminate duplication and maintain consistency.</span></span> <span data-ttu-id="7ad9c-309">Unter übergreifenden Belangen für ASP.NET Core-Anwendungen sind u.a. die Authentifizierung, Modellvalidierungsregeln, Ausgabezwischenspeicherung und die Fehlerbehandlung zu verstehen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-309">Some examples of cross-cutting concerns in ASP.NET Core applications are authentication, model validation rules, output caching, and error handling, though there are many others.</span></span> <span data-ttu-id="7ad9c-310">In ASP.Net Core MVC ermöglichen [Filter](/aspnet/core/mvc/controllers/filters) Ihnen, Code vor oder nach bestimmten Schritten der Anforderungsverarbeitungspipeline auszuführen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-310">ASP.NET Core MVC [filters](/aspnet/core/mvc/controllers/filters) allow you to run code before or after certain steps in the request processing pipeline.</span></span> <span data-ttu-id="7ad9c-311">Beispielsweise kann ein Filter sowohl vor als auch nach der Modellbindung, einer Aktion oder dem Ergebnis einer Aktion ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-311">For instance, a filter can run before and after model binding, before and after an action, or before and after an action's result.</span></span> <span data-ttu-id="7ad9c-312">Sie können auch einen Autorisierungsfilter verwenden, um den Zugriff auf die restliche Pipeline zu steuern.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-312">You can also use an authorization filter to control access to the rest of the pipeline.</span></span> <span data-ttu-id="7ad9c-313">In Abbildung 7-2 wird dargestellt, wie Sie über möglicherweise konfigurierte Filter Ausführungsflows anfordern können.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-313">Figures 7-2 shows how request execution flows through filters, if configured.</span></span>

![Die Anforderung wird von Autorisierungsfilter, Ressourcenfilter, Modellbindung, Aktionsfilter, Aktionsausführung sowie Aktionsergebniskonvertierung, Ausnahmefilter, Ergebnisfilter und Ergebnisausführung verarbeitet.](./media/image7-2.png)

<span data-ttu-id="7ad9c-316">**Abbildung 7-2**.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-316">**Figure 7-2**.</span></span> <span data-ttu-id="7ad9c-317">Anfordern der Ausführung über Filter und Anforderungspipeline</span><span class="sxs-lookup"><span data-stu-id="7ad9c-317">Request execution through filters and request pipeline.</span></span>

<span data-ttu-id="7ad9c-318">Filter werden in der Regel als Attribute implementiert, damit Sie sie auf Controller oder Aktionen (oder sogar global) anwenden können.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-318">Filters are usually implemented as attributes, so you can apply them to controllers or actions (or even globally).</span></span> <span data-ttu-id="7ad9c-319">Wenn auf diese Weise Filter hinzugefügt werden, überschreiben die auf Aktionsebene angegebenen Filter entweder die auf Controllerebene angegebenen Filter, oder sie bauen auf diesen Filtern auf, die selbst globale Filter überschreiben.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-319">When added in this fashion, filters specified at the action level override or build upon filters specified at the controller level, which themselves override global filters.</span></span> <span data-ttu-id="7ad9c-320">Beispielsweise kann das Attribut \[Route\] verwendet werden, um Routen zwischen Controllern und Aktionen zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-320">For example, the \[Route\] attribute can be used to build up routes between controllers and actions.</span></span> <span data-ttu-id="7ad9c-321">Genauso kann auch die Autorisierung auf Controllerebene konfiguriert und dann von individuellen Aktionen überschrieben werden. Dies wird im folgenden Beispiel dargestellt:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-321">Likewise, authorization can be configured at the controller level, and then overridden by individual actions, as the following sample demonstrates:</span></span>

```csharp
[Authorize]
public class AccountController : Controller

{
    [AllowAnonymous] // overrides the Authorize attribute
    public async Task<IActionResult> Login() {}
    public async Task<IActionResult> ForgotPassword() {}
}
```

<span data-ttu-id="7ad9c-322">Die erste Methode (Login) verwendet den AllowAnonymous-Filter (Attribut), um den auf Controllerebene festgelegten Authorize-Filter zu überschreiben.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-322">The first method, Login, uses the AllowAnonymous filter (attribute) to override the Authorize filter set at the controller level.</span></span> <span data-ttu-id="7ad9c-323">Die ForgotPassword-Aktion sowie jede andere Aktion in der Klasse, die nicht über ein AllowAnonymous-Attribut verfügt, erfordert eine authentifizierte Anforderung.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-323">The ForgotPassword action (and any other action in the class that doesn't have an AllowAnonymous attribute) will require an authenticated request.</span></span>

<span data-ttu-id="7ad9c-324">Filter können verwendet werden, um Duplizierungen in Form von allgemeinen Richtlinien zur Fehlerbehandlung für APIs zu vermeiden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-324">Filters can be used to eliminate duplication in the form of common error handling policies for APIs.</span></span> <span data-ttu-id="7ad9c-325">Eine typische API-Richtlinie soll z.B. eine NotFound-Antwort auf Anforderungen zurückgeben, die auf nicht vorhandene Schlüssel verweisen. Wenn die Modellvalidierung fehlschlägt, soll hingegen eine BadRequest-Anforderung zurückgegeben werden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-325">For example, a typical API policy is to return a NotFound response to requests referencing keys that do not exist, and a BadRequest response if model validation fails.</span></span> <span data-ttu-id="7ad9c-326">Das folgende Beispiel veranschaulicht die Verwendung dieser beiden Richtlinien:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-326">The following example demonstrates these two policies in action:</span></span>

```csharp
[HttpPut("{id}")]
public async Task<IActionResult> Put(int id, [FromBody]Author author)
{
    if ((await _authorRepository.ListAsync()).All(a => a.Id != id))
    {
        return NotFound(id);
    }
    if (!ModelState.IsValid)
    {
        return BadRequest(ModelState);
    }
    author.Id = id;
    await _authorRepository.UpdateAsync(author);
    return Ok();
}
```

<span data-ttu-id="7ad9c-327">Vermeiden Sie, dass Ihre Aktionsmethoden mit bedingtem Code wie diesem überladen werden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-327">Don't allow your action methods to become cluttered with conditional code like this.</span></span> <span data-ttu-id="7ad9c-328">Pullen Sie die Richtlinien stattdessen in Filter, die nach Bedarf angewendet werden können.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-328">Instead, pull the policies into filters that can be applied on an as-needed basis.</span></span> <span data-ttu-id="7ad9c-329">In diesem Beispiel kann die Modellvalidierung, die jedes Mal erfolgen sollte, wenn ein Befehl an die API gesendet wird, durch das folgende Attribut ersetzt werden:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-329">In this example, the model validation check, which should occur anytime a command is sent to the API, can be replaced by the following attribute:</span></span>

```csharp
public class ValidateModelAttribute : ActionFilterAttribute
{
    public override void OnActionExecuting(ActionExecutingContext context)
    {
        if (!context.ModelState.IsValid)
        {
            context.Result = new BadRequestObjectResult(context.ModelState);
        }
    }
}
```

<span data-ttu-id="7ad9c-330">Sie können `ValidateModelAttribute` als NuGet-Abhängigkeit zu Ihrem Projekt hinzufügen, indem Sie das Paket [Ardalis.ValidateModel](https://www.nuget.org/packages/Ardalis.ValidateModel) einfügen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-330">You can add the `ValidateModelAttribute` to your project as a NuGet dependency by including the [Ardalis.ValidateModel](https://www.nuget.org/packages/Ardalis.ValidateModel) package.</span></span> <span data-ttu-id="7ad9c-331">Für APIs können Sie das `ApiController`-Attribut verwenden, um dieses Verhalten zu erzwingen, ohne einen separaten `ValidateModel`-Filter zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-331">For APIs, you can use the `ApiController` attribute to enforce this behavior without the need for a separate `ValidateModel` filter.</span></span>

<span data-ttu-id="7ad9c-332">Ebenso kann ein Filter verwendet werden, um zu überprüfen, ob ein Datensatz vorhanden ist, und um den Fehler 404 zurückzugeben, bevor die Aktion ausgeführt wird. Deshalb müssen diese Überprüfungen nicht mehr innerhalb der Aktion durchgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-332">Likewise, a filter can be used to check if a record exists and return a 404 before the action is executed, eliminating the need to perform these checks in the action.</span></span> <span data-ttu-id="7ad9c-333">Wenn Sie häufig verwendete Konventionen entfernt haben und Ihre Projektmappe so geordnet haben, dass Infrastrukturcode und Geschäftslogik von Ihrer Benutzeroberfläche getrennt sind, sollten Ihre MVC-Aktionsmethoden sehr dünn sein:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-333">Once you've pulled out common conventions and organized your solution to separate infrastructure code and business logic from your UI, your MVC action methods should be extremely thin:</span></span>

```csharp
[HttpPut("{id}")]
[ValidateAuthorExists]
public async Task<IActionResult> Put(int id, [FromBody]Author author)
{
    await _authorRepository.UpdateAsync(author);
    return Ok();
}
```

<span data-ttu-id="7ad9c-334">Weitere Informationen zum Implementieren von Filtern und ein Arbeitsbeispiel zum Herunterladen finden Sie im MSDN Magazine-Artikel [ASP.NET Core – ASP.NET Core MVC-Filter in der Praxis](/archive/msdn-magazine/2016/august/asp-net-core-real-world-asp-net-core-mvc-filters).</span><span class="sxs-lookup"><span data-stu-id="7ad9c-334">You can read more about implementing filters and download a working sample from the MSDN Magazine article, [Real-World ASP.NET Core MVC Filters](/archive/msdn-magazine/2016/august/asp-net-core-real-world-asp-net-core-mvc-filters).</span></span>

> ### <a name="references--structuring-applications"></a><span data-ttu-id="7ad9c-335">Ressourcen: Strukturieren von Anwendungen</span><span class="sxs-lookup"><span data-stu-id="7ad9c-335">References – Structuring applications</span></span>
>
> - <span data-ttu-id="7ad9c-336">**Bereiche**</span><span class="sxs-lookup"><span data-stu-id="7ad9c-336">**Areas**</span></span>  
>   <https://docs.microsoft.com/aspnet/core/mvc/controllers/areas>
> - <span data-ttu-id="7ad9c-337">**ASP.NET Core: Feature-Slices für ASP.NET Core MVC**</span><span class="sxs-lookup"><span data-stu-id="7ad9c-337">**MSDN Magazine – Feature Slices for ASP.NET Core MVC**</span></span>  
>   <https://docs.microsoft.com/archive/msdn-magazine/2016/september/asp-net-core-feature-slices-for-asp-net-core-mvc>
> - <span data-ttu-id="7ad9c-338">**Filter**</span><span class="sxs-lookup"><span data-stu-id="7ad9c-338">**Filters**</span></span>  
>   <https://docs.microsoft.com/aspnet/core/mvc/controllers/filters>
> - <span data-ttu-id="7ad9c-339">**MSDN Magazine: ASP.NET Core MVC-Filter in der Praxis**</span><span class="sxs-lookup"><span data-stu-id="7ad9c-339">**MSDN Magazine – Real World ASP.NET Core MVC Filters**</span></span>  
>   <https://docs.microsoft.com/archive/msdn-magazine/2016/august/asp-net-core-real-world-asp-net-core-mvc-filters>

## <a name="security"></a><span data-ttu-id="7ad9c-340">Sicherheit</span><span class="sxs-lookup"><span data-stu-id="7ad9c-340">Security</span></span>

<span data-ttu-id="7ad9c-341">Das Sichern von Webanwendungen stellt ein umfangreiches und komplexes Thema dar.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-341">Securing web applications is a large topic, with many considerations.</span></span> <span data-ttu-id="7ad9c-342">Im Grunde genommen müssen Sie beim Thema Sicherheit sicherstellen, dass Sie wissen, wer eine Anforderung sendet. Dann müssen Sie sicherstellen, dass die Anforderung nur Zugriff auf die Ressourcen hat, auf die sie Zugriff haben sollte.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-342">At its most basic level, security involves ensuring you know who a given request is coming from, and then ensuring that the request only has access to resources it should.</span></span> <span data-ttu-id="7ad9c-343">Im Rahmen der Authentifizierung werden Anmeldeinformationen miteinander verglichen, die zusammen mit einer Anforderung an die Anmeldeinformationen in einem vertrauenswürdigen Datenspeicher bereitgestellt werden, um zu überprüfen, ob die Anforderung behandelt werden soll, als würde sie von einer bekannten Entität gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-343">Authentication is the process of comparing credentials provided with a request to those in a trusted data store, to see if the request should be treated as coming from a known entity.</span></span> <span data-ttu-id="7ad9c-344">Bei der Autorisierung wird auf der Grundlage der Benutzeridentität der Zugriff auf bestimmte Ressourcen eingeschränkt.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-344">Authorization is the process of restricting access to certain resources based on user identity.</span></span> <span data-ttu-id="7ad9c-345">Ein weiterer Punkt im Hinblick auf die Sicherheit ist das Schützen von Anforderungen vor Lauschangriffen durch Drittanbieter. Dafür sollten Sie sicherstellen, dass [Ihre Anwendung zumindest SSL verwendet](/aspnet/core/security/enforcing-ssl).</span><span class="sxs-lookup"><span data-stu-id="7ad9c-345">A third security concern is protecting requests from eavesdropping by third parties, for which you should at least [ensure that SSL is used by your application](/aspnet/core/security/enforcing-ssl).</span></span>

### <a name="identity"></a><span data-ttu-id="7ad9c-346">Identity</span><span class="sxs-lookup"><span data-stu-id="7ad9c-346">Identity</span></span>

<span data-ttu-id="7ad9c-347">Bei ASP.NET Core Identity handelt es sich um ein Mitgliedschaftssystem, das Sie verwenden können, um die Anmeldefunktionen für Ihre Anwendung zu unterstützen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-347">ASP.NET Core Identity is a membership system you can use to support login functionality for your application.</span></span> <span data-ttu-id="7ad9c-348">Dieses System unterstützt sowohl lokale Benutzerkonten als auch die Unterstützung von externen Protokollanbietern wie Microsoft Account, Twitter, Facebook und Google.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-348">It has support for local user accounts as well as external login provider support from providers like Microsoft Account, Twitter, Facebook, Google, and more.</span></span> <span data-ttu-id="7ad9c-349">Neben ASP.NET Core Identity kann Ihre Anwendung auch die Windows-Authentifizierung oder einen Identitätsanbieter eines Drittanbieters wie [Identity Server](https://github.com/IdentityServer/IdentityServer4) verwenden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-349">In addition to ASP.NET Core Identity, your application can use windows authentication, or a third-party identity provider like [Identity Server](https://github.com/IdentityServer/IdentityServer4).</span></span>

<span data-ttu-id="7ad9c-350">ASP.NET Core Identity ist in neuen Projektvorlagen enthalten, wenn die Option „Einzelne Benutzerkonten“ aktiviert ist.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-350">ASP.NET Core Identity is included in new project templates if the Individual User Accounts option is selected.</span></span> <span data-ttu-id="7ad9c-351">Diese Vorlage umfasst die Unterstützung der Registrierung, Anmeldung, von externen Anmeldungen, vergessenen Kennwörtern und von zusätzlichen Funktionen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-351">This template includes support for registration, login, external logins, forgotten passwords, and additional functionality.</span></span>

![Auswählen einzelner Benutzerkonten zur Vorabkonfiguration von Identity](./media/image7-3.png)

<span data-ttu-id="7ad9c-353">**Abbildung 7-3**.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-353">**Figure 7-3**.</span></span> <span data-ttu-id="7ad9c-354">Auswählen einzelner Benutzerkonten zur Vorabkonfiguration von Identity.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-354">Select Individual User Accounts to have Identity preconfigured.</span></span>

<span data-ttu-id="7ad9c-355">Die Unterstützung von Identity wird unter „Startup“ und sowohl in der Methode ConfigureServices als auch in Configure konfiguriert:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-355">Identity support is configured in Startup, both in ConfigureServices and Configure:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    // Add framework services.
    services.AddDbContext<ApplicationDbContext>(options =>
    options.UseSqlServer(Configuration.GetConnectionString("DefaultConnection")));
    services.AddIdentity<ApplicationUser, IdentityRole>()
        .AddEntityFrameworkStores<ApplicationDbContext>()
        .AddDefaultTokenProviders();
    services.AddMvc();
}

public void Configure(IApplicationBuilder app)
{
    app.UseStaticFiles();
    app.UseIdentity();
    app.UseEndpoints(endpoints =>
    {
        endpoints.MapControllerRoute(name: "default", pattern: "{controller=Home}/{action=Index}/{id?}");
    });
}
```

<span data-ttu-id="7ad9c-356">Es ist wichtig, dass UseIdentity vor UseMvc in der Methode Configure angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-356">It's important that UseIdentity appear before UseMvc in the Configure method.</span></span> <span data-ttu-id="7ad9c-357">Wenn Sie Identity in ConfigureServices konfigurieren, sollte AddDefaultTokenProviders aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-357">When configuring Identity in ConfigureServices, you'll notice a call to AddDefaultTokenProviders.</span></span> <span data-ttu-id="7ad9c-358">Dies hat nichts mit Token zu tun, die möglicherweise verwendet werden, um die Webkommunikation zu sichern. Stattdessen bezieht es sich auf Anbieter, die Aufforderungen erstellen, die per SMS oder E-Mail an Benutzer gesendet werden können, damit diese ihre Identität bestätigen können.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-358">This has nothing to do with tokens that may be used to secure web communications, but instead refers to providers that create prompts that can be sent to users via SMS or email in order for them to confirm their identity.</span></span>

<span data-ttu-id="7ad9c-359">Weitere Informationen zum [Konfigurieren der zweistufigen Authentifizierung](/aspnet/core/security/authentication/2fa) und zum [Zulassen von externen Anmeldungsanbietern](/aspnet/core/security/authentication/social/) finden Sie in der offiziellen ASP.NET Core-Dokumentation.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-359">You can learn more about [configuring two-factor authentication](/aspnet/core/security/authentication/2fa) and [enabling external login providers](/aspnet/core/security/authentication/social/) from the official ASP.NET Core docs.</span></span>

### <a name="authentication"></a><span data-ttu-id="7ad9c-360">Authentifizierung</span><span class="sxs-lookup"><span data-stu-id="7ad9c-360">Authentication</span></span>

<span data-ttu-id="7ad9c-361">Als Authentifizierung wird der Prozess bezeichnet, mit dem bestimmt wird, wer auf das System zugreift.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-361">Authentication is the process of determining who is accessing the system.</span></span> <span data-ttu-id="7ad9c-362">Wenn Sie ASP.NET Core Identity und die im vorherigen Abschnitt gezeigten Konfigurationsmethoden verwenden, werden in der Anwendung automatisch einige Standardeinstellungen für die Authentifizierung konfiguriert.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-362">If you're using ASP.NET Core Identity and the configuration methods shown in the previous section, it will automatically configure some authentication defaults in the application.</span></span> <span data-ttu-id="7ad9c-363">Sie können diese Standardeinstellungen jedoch auch manuell konfigurieren oder diejenigen überschreiben, die von AddIdentity festgelegt wurden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-363">However, you can also configure these defaults manually, or override the ones set by AddIdentity.</span></span> <span data-ttu-id="7ad9c-364">Wenn Sie Identity verwenden, wird die cookiebasierte Authentifizierung als *Standardschema* konfiguriert.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-364">If you're using Identity, it configure cookie-based authentication as the default *scheme*.</span></span>

<span data-ttu-id="7ad9c-365">Bei der webbasierten Authentifizierung gibt es in der Regel bis zu fünf Aktionen, die möglicherweise im Verlauf der Authentifizierung eines Systemclients ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-365">In web-based authentication, there are typically up to 5 actions that may be performed in the course of authenticating a client of a system.</span></span> <span data-ttu-id="7ad9c-366">Dies sind:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-366">These are:</span></span>

- <span data-ttu-id="7ad9c-367">Authentifizieren:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-367">Authenticate.</span></span> <span data-ttu-id="7ad9c-368">Verwenden Sie die vom Client bereitgestellten Informationen, um eine Identität zu erstellen, die in der Anwendung verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-368">Use information provided by the client to create an identity for them to use within the application.</span></span>
- <span data-ttu-id="7ad9c-369">Abfragen:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-369">Challenge.</span></span> <span data-ttu-id="7ad9c-370">Diese Aktion wird verwendet, um die Clients zu identifizieren.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-370">This action is used to require the client to identify themselves.</span></span>
- <span data-ttu-id="7ad9c-371">Unterbinden:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-371">Forbid.</span></span> <span data-ttu-id="7ad9c-372">Informieren Sie den Client, dass die Ausführung einer Aktion untersagt ist.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-372">Inform the client they are forbidden from performing an action.</span></span>
- <span data-ttu-id="7ad9c-373">Anmelden:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-373">Sign-in.</span></span> <span data-ttu-id="7ad9c-374">Behalten Sie den vorhandenen Client auf irgendeine Weise bei.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-374">Persist the existing client in some way.</span></span>
- <span data-ttu-id="7ad9c-375">Abmelden: Entfernen Sie den Client aus dem Persistenzspeicher.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-375">Sign-out. Remove the client from persistence.</span></span>

<span data-ttu-id="7ad9c-376">Es gibt eine Reihe allgemeiner Techniken zum Durchführen der Authentifizierung in Webanwendungen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-376">There are a number of common techniques for performing authentication in web applications.</span></span> <span data-ttu-id="7ad9c-377">Diese werden als Schemas bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-377">These are referred to as schemes.</span></span> <span data-ttu-id="7ad9c-378">Ein bestimmtes Schema definiert Aktionen für einige oder alle der oben aufgeführten Optionen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-378">A given scheme will define actions for some or all of the above options.</span></span> <span data-ttu-id="7ad9c-379">Einige Schemas unterstützen nur manche Aktionen und erfordern ggf. ein separates Schema, um nicht unterstützte Schemas auszuführen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-379">Some schemes only support a subset of actions, and may require a separate scheme to perform those it does not support.</span></span> <span data-ttu-id="7ad9c-380">Das OIDC-Schema (OpenId-Connect) unterstützt beispielsweise weder die Anmeldung noch die Abmeldung, wird allerdings häufig für die Verwendung der Cookieauthentifizierung für diese Persistenz konfiguriert.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-380">For example, the OpenId-Connect (OIDC) scheme doesn't support Sign-in or Sign-out, but is commonly configured to use Cookie authentication for this persistence.</span></span>

<span data-ttu-id="7ad9c-381">In Ihrer ASP.NET Core-Anwendung können Sie für jede der oben beschriebenen Aktionen eine `DefaultAuthenticateScheme`-Eigenschaft und optionale spezifische Schemas konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-381">In your ASP.NET Core application, you can configure a `DefaultAuthenticateScheme` as well as optional specific schemes for each of the actions described above.</span></span> <span data-ttu-id="7ad9c-382">Beispiele sind unter anderem `DefaultChallengeScheme` und `DefaultForbidScheme`. Durch Aufrufen von [`AddIdentity<TUser,TRole>`](https://github.com/dotnet/aspnetcore/blob/release/3.1/src/Identity/Core/src/IdentityServiceCollectionExtensions.cs#L38-L102) wird eine Reihe von Anwendungsaspekten konfiguriert, und es werden viele erforderliche Dienste hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-382">For example, `DefaultChallengeScheme`, `DefaultForbidScheme`, etc. Calling [`AddIdentity<TUser,TRole>`](https://github.com/dotnet/aspnetcore/blob/release/3.1/src/Identity/Core/src/IdentityServiceCollectionExtensions.cs#L38-L102) configures a number of aspects of the application and adds many required services.</span></span> <span data-ttu-id="7ad9c-383">Außerdem ist dieser Aufruf zum Konfigurieren des Authentifizierungsschemas enthalten:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-383">It also includes this call to configure the authentication scheme:</span></span>

```csharp
services.AddAuthentication(options =>
{
    options.DefaultAuthenticateScheme = IdentityConstants.ApplicationScheme;
    options.DefaultChallengeScheme = IdentityConstants.ApplicationScheme;
    options.DefaultSignInScheme = IdentityConstants.ExternalScheme;
});
```

<span data-ttu-id="7ad9c-384">Diese Schemas verwenden Cookies für Persistenz und die Umleitung an Anmeldeseiten, die standardmäßig für die Authentifizierung verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-384">These schemes use cookies for persistence and redirection to login pages for authentication by default.</span></span> <span data-ttu-id="7ad9c-385">Diese Schemas sind für Webanwendungen geeignet, die über Webbrowser mit Benutzern interagieren, aber nicht für APIs empfohlen werden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-385">These schemes are appropriate for web applications that interact with users via web browsers, but not recommended for APIs.</span></span> <span data-ttu-id="7ad9c-386">Stattdessen verwenden APIs in der Regel eine andere Form der Authentifizierung (z. B. JWT-Bearertoken).</span><span class="sxs-lookup"><span data-stu-id="7ad9c-386">Instead, APIs will typically use another form of authentication, such as JWT bearer tokens.</span></span>

<span data-ttu-id="7ad9c-387">Web-APIs werden von Code wie beispielsweise `HttpClient` in .NET-Anwendungen und äquivalenten Typen in anderen Frameworks genutzt.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-387">Web APIs are consumed by code, such as `HttpClient` in .NET applications and equivalent types in other frameworks.</span></span> <span data-ttu-id="7ad9c-388">Diese Clients erwarten eine verwendbare Antwort von einem API-Aufruf oder einen Statuscode, der ggf. angibt, welches Problem aufgetreten ist.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-388">These clients expect a usable response from an API call, or a status code indicating what, if any, problem has occurred.</span></span> <span data-ttu-id="7ad9c-389">Diese Clients interagieren nicht über einen Browser und können keinen von einer API zurückgegebenen HTML-Code rendern oder mit diesem interagieren.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-389">These clients are not interacting through a browser and do not render or interact with any HTML that an API might return.</span></span> <span data-ttu-id="7ad9c-390">Daher eignet es sich im Zusammenhang mit API-Endpunkten nicht, deren Clients an Anmeldeseiten umzuleiten, wenn sie nicht authentifiziert sind.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-390">Thus, it is not appropriate for API endpoints to redirect their clients to login pages if they are not authenticated.</span></span> <span data-ttu-id="7ad9c-391">Ein anderes Schema ist besser geeignet.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-391">Another scheme is more appropriate.</span></span>

<span data-ttu-id="7ad9c-392">Sie können eine Authentifizierung wie folgt einrichten, um die Authentifizierung für APIs zu konfigurieren, die vom `PublicApi`-Projekt in der eShopOnWeb-Referenzanwendung verwendet wird:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-392">To configure authentication for APIs, you might set up authentication like the following, used by the `PublicApi` project in the eShopOnWeb reference application:</span></span>

```csharp
services.AddAuthentication(config =>
{
    config.DefaultScheme = JwtBearerDefaults.AuthenticationScheme;
})
    .AddJwtBearer(config =>
    {
        config.RequireHttpsMetadata = false;
        config.SaveToken = true;
        config.TokenValidationParameters = new TokenValidationParameters
        {
            ValidateIssuerSigningKey = true,
            IssuerSigningKey = new SymmetricSecurityKey(key),
            ValidateIssuer = false,
            ValidateAudience = false
        };
    });
```

<span data-ttu-id="7ad9c-393">Obwohl es möglich ist, mehrere verschiedene Authentifizierungsschemas innerhalb eines einzelnen Projekts zu konfigurieren, ist es viel einfacher, ein einzelnes Standardschema zu konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-393">While it is possible to configure multiple different authentication schemes within a single project, it is much simpler to configure a single default scheme.</span></span> <span data-ttu-id="7ad9c-394">Aus diesem Grund trennt die eShopOnWeb-Referenzanwendung ihre APIs unter anderem in ihr eigenes Projekt `PublicApi`, das vom Hauptprojekt `Web` getrennt ist und die Ansichten und Razor Pages der Anwendung enthält.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-394">For this reason, among others, the eShopOnWeb reference application separates its APIs into their own project, `PublicApi`, separate from the main `Web` project that includes the application's views and Razor Pages.</span></span>

#### <a name="authentication-in-no-locblazor-apps"></a><span data-ttu-id="7ad9c-395">Authentifizierung in :::no-loc(Blazor):::-Apps</span><span class="sxs-lookup"><span data-stu-id="7ad9c-395">Authentication in :::no-loc(Blazor)::: apps</span></span>

<span data-ttu-id="7ad9c-396">:::no-loc(Blazor)::: Server-Anwendungen können dieselben Authentifizierungsfeatures wie jede andere ASP.NET Core-Anwendung nutzen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-396">:::no-loc(Blazor)::: Server applications can leverage the same authentication features as any other ASP.NET Core application.</span></span> <span data-ttu-id="7ad9c-397">:::no-loc(Blazor)::: :::no-loc(WebAssembly):::-Anwendungen können die integrierten Identitäts- und Authentifizierungsanbieter nicht verwenden, da diese im Browser ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-397">:::no-loc(Blazor)::: :::no-loc(WebAssembly)::: applications cannot use the built-in Identity and Authentication providers, however, since they run in the browser.</span></span> <span data-ttu-id="7ad9c-398">:::no-loc(Blazor)::: :::no-loc(WebAssembly):::-Anwendungen können den Benutzerauthentifizierungsstatus lokal speichern und auf Ansprüche zugreifen, um zu bestimmen, welche Aktionen von Benutzern ausgeführt werden können.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-398">:::no-loc(Blazor)::: :::no-loc(WebAssembly)::: applications can store user authentication status locally and can access claims to determine what actions users should be able to perform.</span></span> <span data-ttu-id="7ad9c-399">Allerdings sollten alle Authentifizierungs- und Autorisierungsprüfungen unabhängig von der in der :::no-loc(Blazor)::: :::no-loc(WebAssembly):::-App implementierten Logik auf dem Server ausgeführt werden, da Benutzer die App problemlos umgehen und direkt mit den APIs interagieren können.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-399">However, all authentication and authorization checks should be performed on the server regardless of any logic implemented inside the :::no-loc(Blazor)::: :::no-loc(WebAssembly)::: app, since users can easily bypass the app and interact with the APIs directly.</span></span>

> ### <a name="references--authentication"></a><span data-ttu-id="7ad9c-400">Verweise: Authentifizierung</span><span class="sxs-lookup"><span data-stu-id="7ad9c-400">References – Authentication</span></span>
>
> - <span data-ttu-id="7ad9c-401">**Aktionen und Standardeinstellungen der Authentifizierung**</span><span class="sxs-lookup"><span data-stu-id="7ad9c-401">**Authentication Actions and Defaults**</span></span>  
>   <https://stackoverflow.com/a/52493428>
> - <span data-ttu-id="7ad9c-402">**Authentifizierung und Autorisierung für Single-Page-Webanwendungen**
>   <https://docs.microsoft.com/aspnet/core/security/authentication/identity-api-authorization></span><span class="sxs-lookup"><span data-stu-id="7ad9c-402">**Authentication and Authorization for SPAs**
<https://docs.microsoft.com/aspnet/core/security/authentication/identity-api-authorization></span></span>
> - <span data-ttu-id="7ad9c-403">**ASP.NET Core :::no-loc(Blazor):::-Authentifizierung und -Autorisierung**
>   <https://docs.microsoft.com/aspnet/core/blazor/security/></span><span class="sxs-lookup"><span data-stu-id="7ad9c-403">**ASP.NET Core :::no-loc(Blazor)::: Authentication and Authorization**
<https://docs.microsoft.com/aspnet/core/blazor/security/></span></span>
> - <span data-ttu-id="7ad9c-404">**Sicherheit: Authentifizierung und Autorisierung in ASP.NET Web Forms und :::no-loc(Blazor):::** 
>   <https://docs.microsoft.com/dotnet/architecture/blazor-for-web-forms-developers/security-authentication-authorization></span><span class="sxs-lookup"><span data-stu-id="7ad9c-404">**Security: Authentication and Authorization in ASP.NET Web Forms and :::no-loc(Blazor):::**
<https://docs.microsoft.com/dotnet/architecture/blazor-for-web-forms-developers/security-authentication-authorization></span></span>

### <a name="authorization"></a><span data-ttu-id="7ad9c-405">Autorisierung</span><span class="sxs-lookup"><span data-stu-id="7ad9c-405">Authorization</span></span>

<span data-ttu-id="7ad9c-406">Die einfachste Art der Authentifizierung umfasst die Einschränkung des Zugriffs auf anonyme Benutzer.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-406">The simplest form of authorization involves restricting access to anonymous users.</span></span> <span data-ttu-id="7ad9c-407">Wenn Sie diese Art der Authentifizierung durchführen möchten, müssen Sie nur das Attribut \[Authorize\] auf bestimmte Controller oder Aktionen anwenden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-407">This can be achieved by simply applying the \[Authorize\] attribute to certain controllers or actions.</span></span> <span data-ttu-id="7ad9c-408">Wenn Rollen verwendet werden, kann das Attribut wie im Folgenden dargestellt erweitert werden, um den Zugriff auf Benutzer zu beschränken, denen bestimmte Rollen zugewiesen sind:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-408">If roles are being used, the attribute can be further extended to restrict access to users who belong to certain roles, as shown:</span></span>

```csharp
[Authorize(Roles = "HRManager,Finance")]
public class SalaryController : Controller
{

}
```

<span data-ttu-id="7ad9c-409">In diesem Fall hätten Benutzer, die den Rollen HRManager und/oder Finance zugewiesen sind, Zugriff auf den SalaryController.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-409">In this case, users belonging to either the HRManager or Finance roles (or both) would have access to the SalaryController.</span></span> <span data-ttu-id="7ad9c-410">Wenn Sie erfordern möchten, dass ein Benutzer mehreren Rollen statt nur einer von mehrern Rollen angehört, können Sie das Attribut mehrmals anwenden und dabei jeweils eine erforderliche Rolle angeben.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-410">To require that a user belong to multiple roles (not just one of several), you can apply the attribute multiple times, specifying a required role each time.</span></span>

<span data-ttu-id="7ad9c-411">Wenn Sie in vielen verschiedenen Controllern und Aktionen bestimmte Rollen als Zeichenfolgen festlegen, kann dies zu ungewollten Wiederholungen führen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-411">Specifying certain sets of roles as strings in many different controllers and actions can lead to undesirable repetition.</span></span> <span data-ttu-id="7ad9c-412">Definieren Sie mindestens Konstanten für diese Zeichenfolgenliterale, und verwenden Sie die benötigten Konstanten, um die Zeichenfolge anzugeben.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-412">At a minimum, define constants for these string literals and use the constants anywhere you need to specify the string.</span></span> <span data-ttu-id="7ad9c-413">Sie können auch Autorisierungsrichtlinien konfigurieren, die Autorisierungsregeln kapseln, und anschließend die Richtlinie anstelle von individuellen Rollen angeben, wenn Sie das Attribut \[Authorize\] anwenden:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-413">You can also configure authorization policies, which encapsulate authorization rules, and then specify the policy instead of individual roles when applying the \[Authorize\] attribute:</span></span>

```csharp
[Authorize(Policy = "CanViewPrivateReport")]
public IActionResult ExecutiveSalaryReport()
{
    return View();
}
```

<span data-ttu-id="7ad9c-414">Wenn Sie auf diese Weise Richtlinien verwenden, können Sie die Arten von Aktionen unterteilen, die auf bestimmte Rollen und Regeln beschränkt sind, die für diese gelten.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-414">Using policies in this way, you can separate the kinds of actions being restricted from the specific roles or rules that apply to it.</span></span> <span data-ttu-id="7ad9c-415">Wenn Sie später eine neue Rolle erstellen, die Zugriff auf bestimmte Ressourcen benötigt, können Sie einfach eine Richtlinie aktualisieren und müssen nicht mehr jede Liste mit Rollen für jedes \[Authorize\]-Attribut aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-415">Later, if you create a new role that needs to have access to certain resources, you can just update a policy, rather than updating every list of roles on every \[Authorize\] attribute.</span></span>

#### <a name="claims"></a><span data-ttu-id="7ad9c-416">Ansprüche</span><span class="sxs-lookup"><span data-stu-id="7ad9c-416">Claims</span></span>

<span data-ttu-id="7ad9c-417">Ansprüche sind Name-Wert-Paare, die Eigenschaften eines authentifizierten Benutzers darstellen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-417">Claims are name value pairs that represent properties of an authenticated user.</span></span> <span data-ttu-id="7ad9c-418">Möglicherweise möchten Sie die Personalnummer eines Benutzers als Anspruch speichern.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-418">For example, you might store users' employee number as a claim.</span></span> <span data-ttu-id="7ad9c-419">Ansprüche können als Bestandteil von Autorisierungsrichtlinien verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-419">Claims can then be used as part of authorization policies.</span></span> <span data-ttu-id="7ad9c-420">Daher können Sie eine Richtlinie mit dem Namen „EmployeeOnly“ erstellen, die, wie im folgenden Beispiel dargestellt, einen Anspruch mit dem Namen „EmployeeNumber“ erfordert:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-420">You could create a policy called "EmployeeOnly" that requires the existence of a claim called "EmployeeNumber", as shown in this example:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    services.AddMvc();
    services.AddAuthorization(options =>
    {
        options.AddPolicy("EmployeeOnly", policy => policy.RequireClaim("EmployeeNumber"));
    });
}
```

<span data-ttu-id="7ad9c-421">Diese Richtlinie kann dann mit dem Attribut \[Authorize\] verwendet werden, um wie obenstehend beschrieben einen Controller und/oder eine Aktion zu schützen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-421">This policy could then be used with the \[Authorize\] attribute to protect any controller and/or action, as described above.</span></span>

#### <a name="securing-web-apis"></a><span data-ttu-id="7ad9c-422">Sichern von Web-APIs</span><span class="sxs-lookup"><span data-stu-id="7ad9c-422">Securing web APIs</span></span>

<span data-ttu-id="7ad9c-423">Die meisten Web-APIs sollten ein tokenbasiertes Authentifizierungssystem implementieren.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-423">Most web APIs should implement a token-based authentication system.</span></span> <span data-ttu-id="7ad9c-424">Die Tokenauthentifizierung ist zustandslos und skalierbar.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-424">Token authentication is stateless and designed to be scalable.</span></span> <span data-ttu-id="7ad9c-425">In einem tokenbasierten Authentifizierungssystem muss sich der Client zuerst mit dem Authentifizierungsanbieter authentifizieren.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-425">In a token-based authentication system, the client must first authenticate with the authentication provider.</span></span> <span data-ttu-id="7ad9c-426">Wenn dies erfolgreich ist, wird für den Client ein Token ausgestellt, bei dem es sich um eine kryptografische, sinnvolle Zeichenfolge handelt.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-426">If successful, the client is issued a token, which is simply a cryptographically meaningful string of characters.</span></span> <span data-ttu-id="7ad9c-427">Das gängigste Format für Token ist JSON Web Token oder JWT (häufig „Jot“ ausgesprochen).</span><span class="sxs-lookup"><span data-stu-id="7ad9c-427">The most common format for tokens is JSON Web Token, or JWT (often pronounced "jot").</span></span> <span data-ttu-id="7ad9c-428">Wenn der Client dann eine Anforderung an eine API durchführen muss, fügt er dieses Token als Header der Anforderung hinzu.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-428">When the client then needs to issue a request to an API, it adds this token as a header on the request.</span></span> <span data-ttu-id="7ad9c-429">Der Server überprüft dann das im Anforderungsheader gefundene Token, bevor er die Anforderung abschließt.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-429">The server then validates the token found in the request header before completing the request.</span></span> <span data-ttu-id="7ad9c-430">Abbildung 7-4 zeigt diesen Vorgang.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-430">Figure 7-4 demonstrates this process.</span></span>

![TokenAuth](./media/image7-4.png)

<span data-ttu-id="7ad9c-432">**Abbildung 7-4.**</span><span class="sxs-lookup"><span data-stu-id="7ad9c-432">**Figure 7-4.**</span></span> <span data-ttu-id="7ad9c-433">Tokenbasierte Authentifizierung für Web-APIs.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-433">Token-based authentication for Web APIs.</span></span>

<span data-ttu-id="7ad9c-434">Sie können einen eigenen Authentifizierungsdienst erstellen, Ihre API in Azure AD und OAuth integrieren oder einen Dienst über ein Open-Source-Tool wie z. B. [IdentityServer](https://github.com/IdentityServer) implementieren.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-434">You can create your own authentication service, integrate with Azure AD and OAuth, or implement a service using an open-source tool like [IdentityServer](https://github.com/IdentityServer).</span></span>

<span data-ttu-id="7ad9c-435">JWT-Token können mit dem Benutzer verbundene Ansprüche einbetten, die auf dem Client oder Server gelesen werden können.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-435">JWT tokens can embed claims about the user, which can be read on the client or server.</span></span> <span data-ttu-id="7ad9c-436">Sie können ein Tool wie [jwt.io](https://jwt.io/) verwenden, um den Inhalt eines JWT-Tokens anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-436">You can use a tool like [jwt.io](https://jwt.io/) to view the contents of a JWT token.</span></span> <span data-ttu-id="7ad9c-437">Speichern Sie keine vertraulichen Daten wie Kennwörter oder Schlüssel in einem JTW-Token, da dessen Inhalte leicht lesbar sind.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-437">Do not store sensitive data like passwords or keys in JTW tokens, since their contents are easily read.</span></span>

<span data-ttu-id="7ad9c-438">Wenn Sie JWT-Token mit Single-Page-Webanwendung oder :::no-loc(Blazor)::: :::no-loc(WebAssembly):::-Anwendungen verwenden, müssen Sie das Token an einer beliebigen Stelle auf dem Client speichern und dann jedem API-Aufruf hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-438">When using JWT tokens with SPA or :::no-loc(Blazor)::: :::no-loc(WebAssembly)::: applications, you must store the token somewhere on the client and then add it to every API call.</span></span> <span data-ttu-id="7ad9c-439">Dies erfolgt in der Regel als Header, wie im folgenden Code veranschaulicht:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-439">This is typically done as a header, as the following code demonstrates:</span></span>

```csharp
// AuthService.cs in :::no-loc(Blazor):::Admin project of eShopOnWeb
private async Task SetAuthorizationHeader()
{
    var token = await GetToken();
    _httpClient.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", token);
}
```

<span data-ttu-id="7ad9c-440">Nach dem Aufrufen der obigen Methode wird das Token bei mit `_httpClient` ausgeführten Anforderungen in den Headern der Anforderung eingebettet, sodass die serverseitige API die Anforderung authentifizieren und autorisieren kann.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-440">After calling the above method, requests made with the `_httpClient` will have the token embedded in the request's headers, allowing the server-side API to authenticate and authorize the request.</span></span>

#### <a name="custom-security"></a><span data-ttu-id="7ad9c-441">Benutzerdefinierte Sicherheit</span><span class="sxs-lookup"><span data-stu-id="7ad9c-441">Custom Security</span></span>

<span data-ttu-id="7ad9c-442">Gehen Sie insbesondere mit Bedacht vor, wenn Sie eigene Kryptografien, Benutzermitgliedschaften oder Systeme zur Tokengenerierung implementieren.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-442">Be especially careful about "rolling your own" implementation of cryptography, user membership, or token generation system.</span></span> <span data-ttu-id="7ad9c-443">Es gibt viele im Handel erwerbliche oder Open Source-Alternativen, deren Sicherheit die einer benutzerdefinierten Implementierung in den meisten Fällen übertrifft.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-443">There are many commercial and open-source alternatives available, which will almost certainly have better security than a custom implementation.</span></span>

> ### <a name="references--security"></a><span data-ttu-id="7ad9c-444">Ressourcen: Sicherheit</span><span class="sxs-lookup"><span data-stu-id="7ad9c-444">References – Security</span></span>
>
> - <span data-ttu-id="7ad9c-445">**Übersicht über die Dokumentation zur Sicherheit**</span><span class="sxs-lookup"><span data-stu-id="7ad9c-445">**Security Docs Overview**</span></span>  
>   <https://docs.microsoft.com/aspnet/core/security/>
> - <span data-ttu-id="7ad9c-446">**Enforcing SSL in an ASP.NET Core App (Erzwingen von SSL in einer ASP.NET Core-App)**</span><span class="sxs-lookup"><span data-stu-id="7ad9c-446">**Enforcing SSL in an ASP.NET Core App**</span></span>  
>   <https://docs.microsoft.com/aspnet/core/security/enforcing-ssl>
> - <span data-ttu-id="7ad9c-447">**Einführung in Identity**</span><span class="sxs-lookup"><span data-stu-id="7ad9c-447">**Introduction to Identity**</span></span>  
>   <https://docs.microsoft.com/aspnet/core/security/authentication/identity>
> - <span data-ttu-id="7ad9c-448">**Introduction to Authorization (Einführung in die Authentifizierung)**</span><span class="sxs-lookup"><span data-stu-id="7ad9c-448">**Introduction to Authorization**</span></span>  
>   <https://docs.microsoft.com/aspnet/core/security/authorization/introduction>
> - <span data-ttu-id="7ad9c-449">**Authentifizierung und Autorisierung in Azure App Service**</span><span class="sxs-lookup"><span data-stu-id="7ad9c-449">**Authentication and Authorization for API Apps in Azure App Service**</span></span>  
>   <https://docs.microsoft.com/azure/app-service-api/app-service-api-authentication>
> - <span data-ttu-id="7ad9c-450">**IdentityServer**</span><span class="sxs-lookup"><span data-stu-id="7ad9c-450">**Identity Server**</span></span>  
>   <https://github.com/IdentityServer>

## <a name="client-communication"></a><span data-ttu-id="7ad9c-451">Clientkommunikation</span><span class="sxs-lookup"><span data-stu-id="7ad9c-451">Client communication</span></span>

<span data-ttu-id="7ad9c-452">ASP.NET Core-Apps können nicht nur Seiten bereitstellen und über Web-APIs auf Anforderungen für Daten antworten, sondern auch direkt mit verbundenen Clients kommunizieren.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-452">In addition to serving pages and responding to requests for data via web APIs, ASP.NET Core apps can communicate directly with connected clients.</span></span> <span data-ttu-id="7ad9c-453">Für diese ausgehende Kommunikation können verschiedene Transporttechnologien verwendet werden, wobei am häufigsten die Technologie WebSockets verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-453">This outbound communication can use a variety of transport technologies, the most common being WebSockets.</span></span> <span data-ttu-id="7ad9c-454">ASP.NET Core SignalR ist eine Bibliothek, mit der Sie Ihren Anwendungen leicht Funktionen für die Echtzeitkommunikation zwischen Server und Client hinzufügen können.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-454">ASP.NET Core SignalR is a library that makes it simple to add real-time server-to-client communication functionality to your applications.</span></span> <span data-ttu-id="7ad9c-455">SignalR unterstützt verschiedene Transporttechnologien, einschließlich WebSockets, und nimmt dem Entwickler einen Großteil der Implementierungsdetails ab.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-455">SignalR supports a variety of transport technologies, including WebSockets, and abstracts away many of the implementation details from the developer.</span></span>

<span data-ttu-id="7ad9c-456">Die Clientkommunikation in Echtzeit erweist sich in vielen Anwendungsszenarios als nützlich. Dabei macht es keinen Unterschied, ob Sie WebSockets oder andere Methoden verwenden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-456">Real-time client communication, whether using WebSockets directly or other techniques, are useful in a variety of application scenarios.</span></span> <span data-ttu-id="7ad9c-457">Beispiele:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-457">Some examples include:</span></span>

- <span data-ttu-id="7ad9c-458">Anwendungen für Livechats</span><span class="sxs-lookup"><span data-stu-id="7ad9c-458">Live chat room applications</span></span>

- <span data-ttu-id="7ad9c-459">Überwachen von Anwendungen</span><span class="sxs-lookup"><span data-stu-id="7ad9c-459">Monitoring applications</span></span>

- <span data-ttu-id="7ad9c-460">Updates zum Auftragsstatus</span><span class="sxs-lookup"><span data-stu-id="7ad9c-460">Job progress updates</span></span>

- <span data-ttu-id="7ad9c-461">Benachrichtigungen</span><span class="sxs-lookup"><span data-stu-id="7ad9c-461">Notifications</span></span>

- <span data-ttu-id="7ad9c-462">Interaktive Forms-Anwendungen</span><span class="sxs-lookup"><span data-stu-id="7ad9c-462">Interactive forms applications</span></span>

<span data-ttu-id="7ad9c-463">Wenn Sie die Clientkommunikation in Ihre Anwendungen integrieren, gibt es in der Regel zwei Komponenten:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-463">When building client communication into your applications, there are typically two components:</span></span>

- <span data-ttu-id="7ad9c-464">Einen serverseitigen Verbindungs-Manager (SignalR-Hub, WebSocketManager und WebSocketHandler)</span><span class="sxs-lookup"><span data-stu-id="7ad9c-464">Server-side connection manager (SignalR Hub, WebSocketManager WebSocketHandler)</span></span>

- <span data-ttu-id="7ad9c-465">Eine clientseitige Bibliothek</span><span class="sxs-lookup"><span data-stu-id="7ad9c-465">Client-side library</span></span>

<span data-ttu-id="7ad9c-466">Clients sind nicht auf Browser beschränkt, denn auch mobile Apps, Konsolen-Apps und andere native Apps können mithilfe von SignalR/WebSockets kommunizieren.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-466">Clients aren't limited to browsers – mobile apps, console apps, and other native apps can also communicate using SignalR/WebSockets.</span></span> <span data-ttu-id="7ad9c-467">Das folgende einfache Programm ist Bestandteil einer WebSocketManager-Beispielanwendung und gibt jeglichen Inhalt, der an eine Chat-Anwendung gesendet wird, an die Konsole weiter:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-467">The following simple program echoes all content sent to a chat application to the console, as part of a WebSocketManager sample application:</span></span>

```csharp
public class Program
{
    private static Connection _connection;
    public static void Main(string[] args)
    {
        StartConnectionAsync();
        _connection.On("receiveMessage", (arguments) =>
        {
            Console.WriteLine($"{arguments[0]} said: {arguments[1]}");
        });
        Console.ReadLine();
        StopConnectionAsync();
    }

    public static async Task StartConnectionAsync()
    {
        _connection = new Connection();
        await _connection.StartConnectionAsync("ws://localhost:65110/chat");
    }

    public static async Task StopConnectionAsync()
    {
        await _connection.StopConnectionAsync();
    }
}
```

<span data-ttu-id="7ad9c-468">Ziehen Sie Möglichkeiten in Betracht, über die Anwendungen direkt mit Clientanwendungen kommunizieren können, und prüfen Sie, ob die Kommunikation in Echtzeit die Benutzerfreundlichkeit der App verbessern würde.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-468">Consider ways in which your applications communicate directly with client applications, and consider whether real-time communication would improve your app's user experience.</span></span>

> ### <a name="references--client-communication"></a><span data-ttu-id="7ad9c-469">Ressourcen: Clientkommunikation</span><span class="sxs-lookup"><span data-stu-id="7ad9c-469">References – Client Communication</span></span>
>
> - <span data-ttu-id="7ad9c-470">**ASP.NET Core SignalR**</span><span class="sxs-lookup"><span data-stu-id="7ad9c-470">**ASP.NET Core SignalR**</span></span>  
>   <https://github.com/dotnet/aspnetcore/tree/master/src/SignalR>
> - <span data-ttu-id="7ad9c-471">**WebSocket-Manager**</span><span class="sxs-lookup"><span data-stu-id="7ad9c-471">**WebSocket Manager**</span></span>  
>   <https://github.com/radu-matei/websocket-manager>

## <a name="domain-driven-design--should-you-apply-it"></a><span data-ttu-id="7ad9c-472">Sollten Sie die Methode „Domain-Driven Design“ verwenden?</span><span class="sxs-lookup"><span data-stu-id="7ad9c-472">Domain-driven design – Should you apply it?</span></span>

<span data-ttu-id="7ad9c-473">Bei der Methode Domain-Driven Design (DDD) handelt es sich um einen nützlichen Ansatz zum Erstellen von Software, bei dem sich der Entwickler auf die _Geschäftsdomäne_ konzentriert.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-473">Domain-Driven Design (DDD) is an agile approach to building software that emphasizes focusing on the _business domain_.</span></span> <span data-ttu-id="7ad9c-474">Außerdem wird der Fokus auf Kommunikation und Interaktion mit Experten für Geschäftsdomänen gelegt, die den Entwicklern im Zusammenhang erläutern können, wie das System in der Praxis funktionieren soll.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-474">It places a heavy emphasis on communication and interaction with business domain expert(s) who can relate to the developers how the real-world system works.</span></span> <span data-ttu-id="7ad9c-475">Wenn Sie z.B. ein System für den Aktienhandel erstellen, sollten Sie sich an einen erfahrenen Börsenmakler als Experten für die Geschäftsdomäne wenden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-475">For example, if you're building a system that handles stock trades, your domain expert might be an experienced stock broker.</span></span> <span data-ttu-id="7ad9c-476">DDD soll dazu dienen, große, komplexe Geschäftsprobleme anzugehen und eignet sich häufig nicht für kleinere, einfachere Anwendungen, da es sich für diese nicht lohnt, viel Zeit darein zu investieren, die Domäne zu verstehen und zu modellieren.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-476">DDD is designed to address large, complex business problems, and is often not appropriate for smaller, simpler applications, as the investment in understanding and modeling the domain is not worth it.</span></span>

<span data-ttu-id="7ad9c-477">Wenn Sie Software anhand der DDD-Technik erstellen, sollte Ihr Team (das auch Projektbeteiligte und Mitwirkende außerhalb des technischen Bereichs umfasst) eine _ubiquitäre Sprache_ für den Problembereich entwickeln.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-477">When building software following a DDD approach, your team (including non-technical stakeholders and contributors) should develop a _ubiquitous language_ for the problem space.</span></span> <span data-ttu-id="7ad9c-478">Das bedeutet, das für das praxisorientierte Konzept, das modelliert wird, dessen Softwareäquivalent und jegliche andere Strukturen, die möglicherweise zu dem Konzept beitragen (z.B. Datentabellen), dieselbe Terminologie verwendet werden soll.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-478">That is, the same terminology should be used for the real-world concept being modeled, the software equivalent, and any structures that might exist to persist the concept (for example, database tables).</span></span> <span data-ttu-id="7ad9c-479">Die in der ubiquitären Sprache beschriebenen Konzepte sollen die Grundlage für Ihr _Domänenmodell_ darstellen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-479">Thus, the concepts described in the ubiquitous language should form the basis for your _domain model_.</span></span>

<span data-ttu-id="7ad9c-480">Ihr Domänenmodell besteht aus Objekten, die miteinander interagieren, um das Verhalten des Systems darzustellen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-480">Your domain model comprises objects that interact with one another to represent the behavior of the system.</span></span> <span data-ttu-id="7ad9c-481">Diese Objekte können in die folgenden Kategorien eingeteilt werden:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-481">These objects may fall into the following categories:</span></span>

- <span data-ttu-id="7ad9c-482">[Entitäten](https://deviq.com/entity/), die Objekte mit Identitätsthreads darstellen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-482">[Entities](https://deviq.com/entity/), which represent objects with a thread of identity.</span></span> <span data-ttu-id="7ad9c-483">Entitäten werden in der Regel dauerhaft mit einem Schlüssel gespeichert, über den sie zu einem späteren Zeitpunkt wieder abgerufen werden können.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-483">Entities are typically stored in persistence with a key by which they can later be retrieved.</span></span>

- <span data-ttu-id="7ad9c-484">[Aggregate](https://deviq.com/aggregate-pattern/), die Objektgruppen darstellen, die als eine Einheit beibehalten werden sollten.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-484">[Aggregates](https://deviq.com/aggregate-pattern/), which represent groups of objects that should be persisted as a unit.</span></span>

- <span data-ttu-id="7ad9c-485">[Wertobjekte](https://deviq.com/value-object/), die Konzepte darstellen, die auf der Grundlage der Summe ihrer Eigenschaftswerte miteinander verglichen werden können.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-485">[Value objects](https://deviq.com/value-object/), which represent concepts that can be compared on the basis of the sum of their property values.</span></span> <span data-ttu-id="7ad9c-486">Beispielsweise das DateRange-Objekt, das aus einem Start- und einem Enddatum besteht.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-486">For example, DateRange consisting of a start and end date.</span></span>

- <span data-ttu-id="7ad9c-487">[Domänenereignisse](https://martinfowler.com/eaaDev/DomainEvent.html), die Vorgänge darstellen, die innerhalb des System ausgeführt werden und für andere Bestandteile des Systems von Bedeutung sind.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-487">[Domain events](https://martinfowler.com/eaaDev/DomainEvent.html), which represent things happening within the system that are of interest to other parts of the system.</span></span>

<span data-ttu-id="7ad9c-488">Ein DDD-Domänenmodell muss komplexes Verhalten innerhalb des Modells kapseln.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-488">A DDD domain model should encapsulate complex behavior within the model.</span></span> <span data-ttu-id="7ad9c-489">Insbesondere Entitäten sollten nicht nur Auflistungen von Eigenschaften sein.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-489">Entities, in particular, should not merely be collections of properties.</span></span> <span data-ttu-id="7ad9c-490">Wenn das Domänenmodell kein Verhalten aufweist und nur den Status des Systems darstellt, wird es als [anämisches Modell](https://deviq.com/anemic-model/) bezeichnet. Diese Art von Modellen sollten in Verbindung mit DDD nicht auftreten.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-490">When the domain model lacks behavior and merely represents the state of the system, it is said to be an [anemic model](https://deviq.com/anemic-model/), which is undesirable in DDD.</span></span>

<span data-ttu-id="7ad9c-491">Neben diesen Modelltypen verwendet DDD in der Regel verschiedene Muster:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-491">In addition to these model types, DDD typically employs a variety of patterns:</span></span>

- <span data-ttu-id="7ad9c-492">[Repository](https://deviq.com/repository-pattern/) zum Zusammenfassen von Informationen zur Persistenz.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-492">[Repository](https://deviq.com/repository-pattern/), for abstracting persistence details.</span></span>

- <span data-ttu-id="7ad9c-493">[Factory](https://en.wikipedia.org/wiki/Factory_method_pattern) zum Kapseln der Erstellung von komplexen Objekten.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-493">[Factory](https://en.wikipedia.org/wiki/Factory_method_pattern), for encapsulating complex object creation.</span></span>

- <span data-ttu-id="7ad9c-494">[Dienste](http://gorodinski.com/blog/2012/04/14/services-in-domain-driven-design-ddd/) zum Kapseln von komplexem Verhalten und/oder Informationen zur Implementierung der Infrastruktur.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-494">[Services](http://gorodinski.com/blog/2012/04/14/services-in-domain-driven-design-ddd/), for encapsulating complex behavior and/or infrastructure implementation details.</span></span>

- <span data-ttu-id="7ad9c-495">[Kommando](https://en.wikipedia.org/wiki/Command_pattern) zum Entkoppeln von ausgebenden Befehlen und Ausführen des Befehls selbst.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-495">[Command](https://en.wikipedia.org/wiki/Command_pattern), for decoupling issuing commands and executing the command itself.</span></span>

- <span data-ttu-id="7ad9c-496">[Spezifikation](https://deviq.com/specification-pattern/) zum Entkoppeln von Abfragedetails.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-496">[Specification](https://deviq.com/specification-pattern/), for encapsulating query details.</span></span>

<span data-ttu-id="7ad9c-497">Für DDD wird auch die Verwendung der bereits erwähnten Clean Architecture empfohlen, die die lose Kopplung, die Entkopplung und Code umfasst, der problemlos mithilfe von Komponententests überprüft werden kann.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-497">DDD also recommends the use of the Clean Architecture discussed previously, allowing for loose coupling, encapsulation, and code that can easily be verified using unit tests.</span></span>

### <a name="when-should-you-apply-ddd"></a><span data-ttu-id="7ad9c-498">Empfohlene Anwendung von DDD</span><span class="sxs-lookup"><span data-stu-id="7ad9c-498">When should you apply DDD</span></span>

<span data-ttu-id="7ad9c-499">DDD eignet sich besonders für große Anwendungen mit erheblicher Komplexität im geschäftlichen Bereich (nicht nur im technischen Bereich).</span><span class="sxs-lookup"><span data-stu-id="7ad9c-499">DDD is well suited to large applications with significant business (not just technical) complexity.</span></span> <span data-ttu-id="7ad9c-500">Zum Erstellen der Anwendung wird dann das Fachwissen von Domänenexperten benötigt.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-500">The application should require the knowledge of domain experts.</span></span> <span data-ttu-id="7ad9c-501">Das Domänenmodell selbst sollte ein bedeutungsvolles Verhalten aufweisen, indem es Geschäftsregeln und Interaktionen darstellt und nicht nur den aktuellen Status verschiedener Datensätze aus Datenspeichern speichert und abfragt.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-501">There should be significant behavior in the domain model itself, representing business rules and interactions beyond simply storing and retrieving the current state of various records from data stores.</span></span>

### <a name="when-shouldnt-you-apply-ddd"></a><span data-ttu-id="7ad9c-502">Nicht empfohlene Anwendung von DDD</span><span class="sxs-lookup"><span data-stu-id="7ad9c-502">When shouldn't you apply DDD</span></span>

<span data-ttu-id="7ad9c-503">Wenn Sie die DDD-Methode anwenden möchten, müssen Sie viel Zeit in die Modellierung, die Architektur und die Kommunikation investieren. Dies lohnt sich für kleinere Anwendungen oder CRUD-Anwendungen nicht (create/read/update/delete = Erstellen/Lesen/Aktualisieren/Löschen).</span><span class="sxs-lookup"><span data-stu-id="7ad9c-503">DDD involves investments in modeling, architecture, and communication that may not be warranted for smaller applications or applications that are essentially just CRUD (create/read/update/delete).</span></span> <span data-ttu-id="7ad9c-504">Wenn Sie sich für diesen Ansatz entscheiden, dann aber feststellen, dass es sich bei Ihrem Domänenmodell um ein anämisches Modell handelt, das kein Verhalten aufweist, sollten Sie Ihre Wahl noch einmal überdenken.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-504">If you choose to approach your application following DDD, but find that your domain has an anemic model with no behavior, you may need to rethink your approach.</span></span> <span data-ttu-id="7ad9c-505">Entweder ist die DDD-Methode für diese Anwendung nicht notwendig, oder Sie benötigen möglicherweise Unterstützung beim Refactoring Ihrer Anwendung, um die Geschäftslogik anstatt in Ihrer Datenbank oder Benutzeroberfläche in das Domänenmodell zu kapseln.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-505">Either your application may not need DDD, or you may need assistance refactoring your application to encapsulate business logic in the domain model, rather than in your database or user interface.</span></span>

<span data-ttu-id="7ad9c-506">Sie können auch einen hybriden Ansatz auswählen und DDD nur für Transaktionsbereiche bzw. komplexere Bereiche der Anwendung verwenden und für die CRUD-Bestandteile oder die schreibgeschützten Bestandteile der Anwendung eine andere Methode verwenden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-506">A hybrid approach would be to only use DDD for the transactional or more complex areas of the application, but not for simpler CRUD or read-only portions of the application.</span></span> <span data-ttu-id="7ad9c-507">Beispielsweise benötigen Sie nicht die Einschränkungen eines Aggregats, wenn Sie Daten abfragen, um einen Bericht abzufragen oder Daten für ein Dashboard zu visualisieren.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-507">For instance, you don't need the constraints of an Aggregate if you're querying data to display a report or to visualize data for a dashboard.</span></span> <span data-ttu-id="7ad9c-508">Dann ist es vollkommen akzeptabel, ein separates, einfaches Lesemodell für solche Anforderungen zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-508">It's perfectly acceptable to have a separate, simpler read model for such requirements.</span></span>

> ### <a name="references--domain-driven-design"></a><span data-ttu-id="7ad9c-509">Ressourcen: Domain-Driven Design</span><span class="sxs-lookup"><span data-stu-id="7ad9c-509">References – Domain-Driven Design</span></span>
>
> - <span data-ttu-id="7ad9c-510">**DDD in Plain English (StackOverflow Answer) (Einfache Beschreibung von DDD (StackOverflow-Antwort))**</span><span class="sxs-lookup"><span data-stu-id="7ad9c-510">**DDD in Plain English (StackOverflow Answer)**</span></span>  
>   <https://stackoverflow.com/questions/1222392/can-someone-explain-domain-driven-design-ddd-in-plain-english-please/1222488#1222488>

## <a name="deployment"></a><span data-ttu-id="7ad9c-511">Bereitstellung</span><span class="sxs-lookup"><span data-stu-id="7ad9c-511">Deployment</span></span>

<span data-ttu-id="7ad9c-512">Unabhängig davon, wo die ASP.NET Core-Anwendung gehostet wird, besteht deren Bereitstellung aus einigen Schritten.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-512">There are a few steps involved in the process of deploying your ASP.NET Core application, regardless of where it will be hosted.</span></span> <span data-ttu-id="7ad9c-513">Als Erstes muss die Anwendung veröffentlicht werden. Dafür können Sie den CLI-Befehl `dotnet publish` verwenden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-513">The first step is to publish the application, which can be done using the `dotnet publish` CLI command.</span></span> <span data-ttu-id="7ad9c-514">Dadurch wird die Anwendung kompiliert und alle Dateien, die benötigt werden, um die Anwendung auszuführen, werden in einem festgelegten Ordner platziert.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-514">This will compile the application and place all of the files needed to run the application into a designated folder.</span></span> <span data-ttu-id="7ad9c-515">Wenn Sie die Bereitstellung über Visual Studio ausführen, wird dieser Schritt automatisch für Sie ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-515">When you deploy from Visual Studio, this step is performed for you automatically.</span></span> <span data-ttu-id="7ad9c-516">Der Ordner „publish“ enthält EXE- und DLL-Dateien für die Anwendung und ihre Abhängigkeiten.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-516">The publish folder contains .exe and .dll files for the application and its dependencies.</span></span> <span data-ttu-id="7ad9c-517">Unabhängige Anwendungen umfassen außerdem eine Version der .NET-Runtime.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-517">A self-contained application will also include a version of the .NET runtime.</span></span> <span data-ttu-id="7ad9c-518">Außerdem enthalten ASP.NET Core-Anwendungen Konfigurationsdateien, statische Clientobjekte und MVC-Ansichten.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-518">ASP.NET Core applications will also include configuration files, static client assets, and MVC views.</span></span>

<span data-ttu-id="7ad9c-519">Bei ASP.NET Core-Anwendungen handelt es sich um Konsolenanwendungen, die gestartet werden müssen, wenn der Server startet, und die neugestartet werden müssen, wenn die Anwendung bzw. der Server abstürzt.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-519">ASP.NET Core applications are console applications that must be started when the server boots and restarted if the application (or server) crashes.</span></span> <span data-ttu-id="7ad9c-520">Wenn Sie diesen Vorgang automatisieren möchten, können Sie einen Prozess-Manager verwenden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-520">A process manager can be used to automate this process.</span></span> <span data-ttu-id="7ad9c-521">Die am häufigsten verwendeten Prozess-Manager für ASP.NET Core sind Nginx und Apache unter Linux und IIS oder Windows Service unter Windows.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-521">The most common process managers for ASP.NET Core are Nginx and Apache on Linux and IIS or Windows Service on Windows.</span></span>

<span data-ttu-id="7ad9c-522">Zusätzlich zu einem Prozess-Manager können ASP.NET Core-Anwendungen einen Reverseproxyserver verwenden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-522">In addition to a process manager, ASP.NET Core applications may use a reverse proxy server.</span></span> <span data-ttu-id="7ad9c-523">Ein Reverseproxyserver empfängt HTTP-Anforderungen aus dem Internet und leitet diese nach einer vorbereitenden Verarbeitung an Kestrel weiter.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-523">A reverse proxy server receives HTTP requests from the Internet and forwards them to Kestrel after some preliminary handling.</span></span> <span data-ttu-id="7ad9c-524">Reverseproxyserver stellen eine Sicherheitsebene für die Anwendung bereit.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-524">Reverse proxy servers provide a layer of security for the application.</span></span> <span data-ttu-id="7ad9c-525">Kestrel unterstützt das Hosten von mehreren Anwendungen auf einem Port nicht. Daher können Techniken wie Hostheader nicht verwendet werden, um das Hosten von mehreren Anwendungen auf einem Port und einer IP-Adresse zu ermöglichen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-525">Kestrel also doesn't support hosting multiple applications on the same port, so techniques like host headers cannot be used with it to enable hosting multiple applications on the same port and IP address.</span></span>

![Von Kestrel zum Internet](./media/image7-5.png)

<span data-ttu-id="7ad9c-527">**Abbildung 7-5**.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-527">**Figure 7-5**.</span></span> <span data-ttu-id="7ad9c-528">ASP.NET in Kestrel hinter einem Reverseproxyserver gehostet</span><span class="sxs-lookup"><span data-stu-id="7ad9c-528">ASP.NET hosted in Kestrel behind a reverse proxy server</span></span>

<span data-ttu-id="7ad9c-529">Ein Reverseproxyserver kann sich außerdem als nützlich erweisen, um mehrere Anwendungen unter Verwendung von SSL/HTTPS zu sichern.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-529">Another scenario in which a reverse proxy can be helpful is to secure multiple applications using SSL/HTTPS.</span></span> <span data-ttu-id="7ad9c-530">In diesem Zusammenhang muss SSL nur für den Reverseproxy konfiguriert sein.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-530">In this case, only the reverse proxy would need to have SSL configured.</span></span> <span data-ttu-id="7ad9c-531">Wie in Abbildung 7-6 dargestellt kann die Kommunikation zwischen dem Reverseproxyserver und Kestrel über HTTP hergestellt werden.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-531">Communication between the reverse proxy server and Kestrel could take place over HTTP, as shown in Figure 7-6.</span></span>

![ASP.NET hinter einem über HTTPS gesicherten Reverseproxyserver gehostet](./media/image7-6.png)

<span data-ttu-id="7ad9c-533">**Abbildung 7-6**.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-533">**Figure 7-6**.</span></span> <span data-ttu-id="7ad9c-534">ASP.NET hinter einem über HTTPS gesicherten Reverseproxyserver gehostet</span><span class="sxs-lookup"><span data-stu-id="7ad9c-534">ASP.NET hosted behind an HTTPS-secured reverse proxy server</span></span>

<span data-ttu-id="7ad9c-535">Ein immer häufiger verwendeter Ansatz ist das Hosten Ihrer ASP.NET Core-Anwendung in einem Docker-Container, der anschließend lokal gehostet oder in Azure für cloudbasiertes Hosting bereitgestellt werden kann.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-535">An increasingly popular approach is to host your ASP.NET Core application in a Docker container, which then can be hosted locally or deployed to Azure for cloud-based hosting.</span></span> <span data-ttu-id="7ad9c-536">Dann kann der Docker-Container wie oben dargestellt Ihren Anwendungscode enthalten, der auf Kestrel ausgeführt und hinter einem Reverseproxyserver bereitgestellt wird.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-536">The Docker container could contain your application code, running on Kestrel, and would be deployed behind a reverse proxy server, as shown above.</span></span>

<span data-ttu-id="7ad9c-537">Wenn Sie Ihre Anwendung auf Azure hosten, können Sie Microsoft Azure Application Gateway als reservierte virtuelle Anwendung verwenden, um verschiedene Dienste bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="7ad9c-537">If you're hosting your application on Azure, you can use Microsoft Azure Application Gateway as a dedicated virtual appliance to provide several services.</span></span> <span data-ttu-id="7ad9c-538">Application Gateway dient nicht nur als Reverseproxy für einzelne Anwendungen, sondern bietet auch die folgenden Features:</span><span class="sxs-lookup"><span data-stu-id="7ad9c-538">In addition to acting as a reverse proxy for individual applications, Application Gateway can also offer the following features:</span></span>

- <span data-ttu-id="7ad9c-539">HTTP-Lastenausgleich</span><span class="sxs-lookup"><span data-stu-id="7ad9c-539">HTTP load balancing</span></span>

- <span data-ttu-id="7ad9c-540">SSL-Offload (SSL nur für Internet)</span><span class="sxs-lookup"><span data-stu-id="7ad9c-540">SSL offload (SSL only to Internet)</span></span>

- <span data-ttu-id="7ad9c-541">End-to-End-SSL</span><span class="sxs-lookup"><span data-stu-id="7ad9c-541">End to End SSL</span></span>

- <span data-ttu-id="7ad9c-542">Routing über mehrere Websites (Konsolidieren von bis zu 20 Websites für eine Application Gateway-Version)</span><span class="sxs-lookup"><span data-stu-id="7ad9c-542">Multi-site routing (consolidate up to 20 sites on a single Application Gateway)</span></span>

- <span data-ttu-id="7ad9c-543">Firewall der Webanwendung</span><span class="sxs-lookup"><span data-stu-id="7ad9c-543">Web application firewall</span></span>

- <span data-ttu-id="7ad9c-544">WebSocket-Unterstützung</span><span class="sxs-lookup"><span data-stu-id="7ad9c-544">Websocket support</span></span>

- <span data-ttu-id="7ad9c-545">Erweiterte Diagnose</span><span class="sxs-lookup"><span data-stu-id="7ad9c-545">Advanced diagnostics</span></span>

<span data-ttu-id="7ad9c-546">_Weitere Informationen zu den Bereitstellungsoptionen für Azure finden Sie in [Kapitel 10](development-process-for-azure.md)._</span><span class="sxs-lookup"><span data-stu-id="7ad9c-546">_Learn more about Azure deployment options in [Chapter 10](development-process-for-azure.md)._</span></span>

> ### <a name="references--deployment"></a><span data-ttu-id="7ad9c-547">Ressourcen: Bereitstellung</span><span class="sxs-lookup"><span data-stu-id="7ad9c-547">References – Deployment</span></span>
>
> - <span data-ttu-id="7ad9c-548">**Hosten und Bereitstellen von ASP.NET Core**</span><span class="sxs-lookup"><span data-stu-id="7ad9c-548">**Hosting and Deployment Overview**</span></span>  
>   <https://docs.microsoft.com/aspnet/core/publishing/>
> - <span data-ttu-id="7ad9c-549">**Verwenden von Kestrel mit einem Reverseproxy**</span><span class="sxs-lookup"><span data-stu-id="7ad9c-549">**When to use Kestrel with a reverse proxy**</span></span>  
>   <https://docs.microsoft.com/aspnet/core/fundamentals/servers/kestrel#when-to-use-kestrel-with-a-reverse-proxy>
> - <span data-ttu-id="7ad9c-550">**Hosten von ASP.NET Core in Docker-Containern**</span><span class="sxs-lookup"><span data-stu-id="7ad9c-550">**Host ASP.NET Core apps in Docker**</span></span>  
>   <https://docs.microsoft.com/aspnet/core/publishing/docker>
> - <span data-ttu-id="7ad9c-551">**Übersicht über Application Gateway**</span><span class="sxs-lookup"><span data-stu-id="7ad9c-551">**Introducing Azure Application Gateway**</span></span>  
>   <https://docs.microsoft.com/azure/application-gateway/application-gateway-introduction>

>[!div class="step-by-step"]
><span data-ttu-id="7ad9c-552">[Zurück](common-client-side-web-technologies.md)
>[Weiter](work-with-data-in-asp-net-core-apps.md)</span><span class="sxs-lookup"><span data-stu-id="7ad9c-552">[Previous](common-client-side-web-technologies.md)
[Next](work-with-data-in-asp-net-core-apps.md)</span></span>
