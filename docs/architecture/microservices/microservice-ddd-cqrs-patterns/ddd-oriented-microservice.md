---
title: Entwerfen eines DDD-orientierten Microservices
description: .NET-Microservicearchitektur für .NET-Containeranwendungen | Übersicht über das Design DDD-orientierter Microservices für Bestellungen und die entsprechenden Anwendungsschichten
ms.date: 10/08/2018
ms.openlocfilehash: c5ac55978ca979a3ae055d9b0cd2d3c6b3187b4e
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 03/14/2020
ms.locfileid: "79401532"
---
# <a name="design-a-ddd-oriented-microservice"></a><span data-ttu-id="cd3d1-103">Erstellen eines DDD-orientierten Microservices</span><span class="sxs-lookup"><span data-stu-id="cd3d1-103">Design a DDD-oriented microservice</span></span>

<span data-ttu-id="cd3d1-104">Durch domänengesteuertes Design (Domain-Driven Design, DDD) wird die Modellierung von den wirtschaftlichen Gegebenheiten beeinflusst, die für Ihre Anwendungsfälle relevant sind.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-104">Domain-driven design (DDD) advocates modeling based on the reality of business as relevant to your use cases.</span></span> <span data-ttu-id="cd3d1-105">Im Zusammenhang mit der Erstellung von Anwendungen bezeichnet DDD Domänen als Probleme.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-105">In the context of building applications, DDD talks about problems as domains.</span></span> <span data-ttu-id="cd3d1-106">Unabhängige Problembereiche werden als Kontextgrenzen beschrieben (jede Kontextgrenze korreliert mit einem Microservice). Zudem wird die Verwendung einer gemeinsamen Sprache zur Erörterung dieser Probleme hervorgehoben.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-106">It describes independent problem areas as Bounded Contexts (each Bounded Context correlates to a microservice), and emphasizes a common language to talk about these problems.</span></span> <span data-ttu-id="cd3d1-107">DDD schlägt auch viele technische Konzepte und Muster vor, z.B. Domänenentitäten mit umfangreichen Modellen (kein [anämisches Domänenmodell](https://martinfowler.com/bliki/AnemicDomainModel.html)), Wertobjekte, Aggregate und Regeln für Aggregatstämme (bzw. Stammentitäten) zur Unterstützung der internen Implementierung.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-107">It also suggests many technical concepts and patterns, like domain entities with rich models (no [anemic-domain model](https://martinfowler.com/bliki/AnemicDomainModel.html)), value objects, aggregates and aggregate root (or root entity) rules to support the internal implementation.</span></span> <span data-ttu-id="cd3d1-108">Dieser Abschnitt bietet eine Einführung in den Entwurf und die Implementierung dieser internen Muster.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-108">This section introduces the design and implementation of those internal patterns.</span></span>

<span data-ttu-id="cd3d1-109">Manchmal werden diese technischen Konzepte und Muster von DDD als Hindernisse empfunden, die eine steile Lernkurve für die Implementierung von DDD-Ansätzen aufweisen.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-109">Sometimes these DDD technical rules and patterns are perceived as obstacles that have a steep learning curve for implementing DDD approaches.</span></span> <span data-ttu-id="cd3d1-110">Wichtig sind jedoch nicht die Muster selbst, sondern die Organisation des Codes zur Ausrichtung auf die geschäftlichen Probleme und die Verwendung der gleichen Geschäftsbedingungen (ubiquitäre Sprache).</span><span class="sxs-lookup"><span data-stu-id="cd3d1-110">But the important part is not the patterns themselves, but organizing the code so it is aligned to the business problems, and using the same business terms (ubiquitous language).</span></span> <span data-ttu-id="cd3d1-111">Darüber hinaus sollten DDD-Ansätze nur angewendet werden, wenn Sie komplexe Microservices mit signifikanten Geschäftsregeln implementieren.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-111">In addition, DDD approaches should be applied only if you are implementing complex microservices with significant business rules.</span></span> <span data-ttu-id="cd3d1-112">Einfachere Aufgaben, wie z.B. ein CRUD-Dienst, können mit einfacheren Ansätzen verwaltet werden.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-112">Simpler responsibilities, like a CRUD service, can be managed with simpler approaches.</span></span>

<span data-ttu-id="cd3d1-113">Die wichtigste Aufgabe beim Entwerfen und Definieren eines Microservices besteht darin, herauszufinden, wo die Grenzen gezogen werden sollen.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-113">Where to draw the boundaries is the key task when designing and defining a microservice.</span></span> <span data-ttu-id="cd3d1-114">Mithilfe von DDD-Mustern können Sie die Komplexität in der Domäne besser verstehen.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-114">DDD patterns help you understand the complexity in the domain.</span></span> <span data-ttu-id="cd3d1-115">Für das Domänenmodell der einzelnen Kontextgrenzen identifizieren und definieren Sie die Entitäten, Wertobjekte und Aggregate, mit denen Ihre Domäne modelliert wird.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-115">For the domain model for each Bounded Context, you identify and define the entities, value objects, and aggregates that model your domain.</span></span> <span data-ttu-id="cd3d1-116">Sie erstellen und verfeinern ein Domänenmodell innerhalb einer Grenze, die Ihren Kontext definiert.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-116">You build and refine a domain model that is contained within a boundary that defines your context.</span></span> <span data-ttu-id="cd3d1-117">Das wird bei der Form eines Microservice sehr deutlich.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-117">And that is very explicit in the form of a microservice.</span></span> <span data-ttu-id="cd3d1-118">Die Komponenten innerhalb dieser Grenzen sind schließlich Ihre Microservices, auch wenn sich eine Kontextgrenze oder Unternehmensmicroservices in einigen Fällen ebenfalls aus mehreren physischen Diensten zusammensetzen können.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-118">The components within those boundaries end up being your microservices, although in some cases a BC or business microservices can be composed of several physical services.</span></span> <span data-ttu-id="cd3d1-119">Bei DDD geht es wie bei Microservices um Grenzen.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-119">DDD is about boundaries and so are microservices.</span></span>

## <a name="keep-the-microservice-context-boundaries-relatively-small"></a><span data-ttu-id="cd3d1-120">Kleinhalten der Kontextgrenzen für Microservices</span><span class="sxs-lookup"><span data-stu-id="cd3d1-120">Keep the microservice context boundaries relatively small</span></span>

<span data-ttu-id="cd3d1-121">Bei der Bestimmung, wo Grenzen zwischen Kontextgrenzen gesetzt werden sollen, werden zwei konkurrierende Ziele ausbalanciert.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-121">Determining where to place boundaries between Bounded Contexts balances two competing goals.</span></span> <span data-ttu-id="cd3d1-122">Erstellen Sie zunächst die kleinstmöglichen Microservices, auch wenn dies nicht der Haupttreiber sein sollte. Sie sollten eine Grenze um Komponenten erstellen, für die eine Kohäsion erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-122">First, you want to initially create the smallest possible microservices, although that should not be the main driver; you should create a boundary around things that need cohesion.</span></span> <span data-ttu-id="cd3d1-123">Zudem sollten umfangreiche Kommunikationen zwischen Microservices vermieden werden.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-123">Second, you want to avoid chatty communications between microservices.</span></span> <span data-ttu-id="cd3d1-124">Diese Ziele können im Widerspruch zueinander stehen.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-124">These goals can contradict one another.</span></span> <span data-ttu-id="cd3d1-125">Sie sollten diese ausbalancieren, indem Sie sie so lange in möglichst viele kleine Microservices zerlegen, bis Sie sehen können, dass Kommunikationsgrenzen mit jedem zusätzlichen Versuch, eine neue Kontextgrenze zu trennen, schnell wachsen.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-125">You should balance them by decomposing the system into as many small microservices as you can until you see communication boundaries growing quickly with each additional attempt to separate a new Bounded Context.</span></span> <span data-ttu-id="cd3d1-126">Kohäsion ist der Schlüssel innerhalb einer einzelnen Kontextgrenze.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-126">Cohesion is key within a single bounded context.</span></span>

<span data-ttu-id="cd3d1-127">Dies ist vergleichbar mit dem [unangemessenen Code-Smell „Intimacy“](https://sourcemaking.com/refactoring/smells/inappropriate-intimacy) bei der Implementierung von Klassen.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-127">It is similar to the [Inappropriate Intimacy code smell](https://sourcemaking.com/refactoring/smells/inappropriate-intimacy) when implementing classes.</span></span> <span data-ttu-id="cd3d1-128">Wenn zwei Microservices viel zusammenarbeiten müssen, sollten sie möglicherweise derselbe Microservice sein.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-128">If two microservices need to collaborate a lot with each other, they should probably be the same microservice.</span></span>

<span data-ttu-id="cd3d1-129">Eine andere Betrachtungsweise ist die Autonomie.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-129">Another way to look at this is autonomy.</span></span> <span data-ttu-id="cd3d1-130">Wenn ein Microservice für eine direkte Serviceanfrage auf einen anderen Dienst angewiesen ist, ist er nicht wirklich autonom.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-130">If a microservice must rely on another service to directly service a request, it is not truly autonomous.</span></span>

## <a name="layers-in-ddd-microservices"></a><span data-ttu-id="cd3d1-131">Ebenen in DDD-Microservices</span><span class="sxs-lookup"><span data-stu-id="cd3d1-131">Layers in DDD microservices</span></span>

<span data-ttu-id="cd3d1-132">Die meisten Unternehmensanwendungen mit erheblicher geschäftlicher und technischer Komplexität werden durch mehrere Ebenen definiert.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-132">Most enterprise applications with significant business and technical complexity are defined by multiple layers.</span></span> <span data-ttu-id="cd3d1-133">Die Ebenen stellen ein logisches Artefakt dar und beziehen sich nicht auf die Bereitstellung des Diensts.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-133">The layers are a logical artifact, and are not related to the deployment of the service.</span></span> <span data-ttu-id="cd3d1-134">Sie sollen Entwickler bei der Verwaltung der Komplexität im Code unterstützen.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-134">They exist to help developers manage the complexity in the code.</span></span> <span data-ttu-id="cd3d1-135">Unterschiedliche Ebenen (z.B. die Domänenmodellebene im Vergleich zur Darstellungsebene usw.) weisen möglicherweise unterschiedliche Typen auf, wodurch Übersetzungen zwischen diesen Typen erforderlich werden.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-135">Different layers (like the domain model layer versus the presentation layer, etc.) might have different types, which mandates translations between those types.</span></span>

<span data-ttu-id="cd3d1-136">Beispielsweise könnte eine Entität aus der Datenbank geladen werden.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-136">For example, an entity could be loaded from the database.</span></span> <span data-ttu-id="cd3d1-137">Ein Teil dieser Informationen, oder eine Aggregation von Informationen einschließlich zusätzlicher Daten aus anderen Entitäten, kann dann über eine REST-Web-API an die Clientbenutzeroberfläche gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-137">Then part of that information, or an aggregation of information including additional data from other entities, can be sent to the client UI through a REST Web API.</span></span> <span data-ttu-id="cd3d1-138">Der entscheidende Punkt hierbei ist, dass die Entität in der Domänenmodellebene enthalten ist und nicht an andere Bereiche weitergegeben werden sollte, zu denen sie nicht gehört, wie z.B. die Darstellungsebene.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-138">The point here is that the domain entity is contained within the domain model layer and should not be propagated to other areas that it does not belong to, like to the presentation layer.</span></span>

<span data-ttu-id="cd3d1-139">Darüber hinaus müssen Sie über Entitäten verfügen, die immer gültig sind (siehe Abschnitt [Designing validations in the domain model layer (Entwerfen von Validierungen in der Domänenmodellebene)](domain-model-layer-validations.md)) und von Aggregatstämmen (Stammentitäten) gesteuert werden.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-139">Additionally, you need to have always-valid entities (see the [Designing validations in the domain model layer](domain-model-layer-validations.md) section) controlled by aggregate roots (root entities).</span></span> <span data-ttu-id="cd3d1-140">Daher sollten Entitäten nicht an Clientansichten gebunden werden, da auf der Benutzeroberflächenebene einige Daten möglicherweise noch nicht überprüft wurden.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-140">Therefore, entities should not be bound to client views, because at the UI level some data might still not be validated.</span></span> <span data-ttu-id="cd3d1-141">Dies ist Aufgabe von ViewModel.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-141">This is what the ViewModel is for.</span></span> <span data-ttu-id="cd3d1-142">Bei ViewModel handelt es sich um ein Datenmodell, das sich ausschließlich mit den Anforderungen auf der Darstellungsebene befasst.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-142">The ViewModel is a data model exclusively for presentation layer needs.</span></span> <span data-ttu-id="cd3d1-143">Die Domänenentitäten gehören nicht direkt zu ViewModel.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-143">The domain entities do not belong directly to the ViewModel.</span></span> <span data-ttu-id="cd3d1-144">Stattdessen müssen Sie zwischen ViewModel-Modellen und Domänenentitäten und umgekehrt übersetzen.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-144">Instead, you need to translate between ViewModels and domain entities and vice versa.</span></span>

<span data-ttu-id="cd3d1-145">Bei der Komplexität ist es wichtig, über ein Domänenmodell zu verfügen, das von Aggregatstämmen gesteuert wird, durch die sichergestellt wird, dass alle Invarianten und Regeln, die sich auf diese Gruppe von Entitäten (Aggregat) beziehen, über einen einzigen Einstiegspunkt bzw. ein einziges Gate durchgeführt werden: den Aggregatstamm.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-145">When tackling complexity, it is important to have a domain model controlled by aggregate roots that make sure that all the invariants and rules related to that group of entities (aggregate) are performed through a single entry-point or gate, the aggregate root.</span></span>

<span data-ttu-id="cd3d1-146">In Abbildung 7-5 wird gezeigt, wie ein Entwurf mit mehreren Ebenen in die eShopOnContainers-Anwendung implementiert wird.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-146">Figure 7-5 shows how a layered design is implemented in the eShopOnContainers application.</span></span>

![Diagramm, das die Ebenen in einem Microservice mit domänengesteuertem Design zeigt.](./media/ddd-oriented-microservice/domain-driven-design-microservice.png)

<span data-ttu-id="cd3d1-148">**Abbildung 7-5**.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-148">**Figure 7-5**.</span></span> <span data-ttu-id="cd3d1-149">DDD-Ebenen für den Microservice für Bestellungen in eShopOnContainers</span><span class="sxs-lookup"><span data-stu-id="cd3d1-149">DDD layers in the ordering microservice in eShopOnContainers</span></span>

<span data-ttu-id="cd3d1-150">Die drei Ebenen in einem DDD-Microservice wie dem für Bestellungen</span><span class="sxs-lookup"><span data-stu-id="cd3d1-150">The three layers in a DDD microservice like Ordering.</span></span> <span data-ttu-id="cd3d1-151">Jede Ebene stellt ein VS-Projekt dar: Die Anwendungsebene ist „Ordering.API“, die Domänenebene „Ordering.Domain“ und die Infrastrukturebene „Ordering.Infrastructure“.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-151">Each layer is a VS project: Application layer is Ordering.API, Domain layer is Ordering.Domain and the Infrastructure layer is Ordering.Infrastructure.</span></span> <span data-ttu-id="cd3d1-152">Das System soll so entworfen werden, dass die einzelnen Ebenen nur mit bestimmten anderen Ebenen kommunizieren.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-152">You want to design the system so that each layer communicates only with certain other layers.</span></span> <span data-ttu-id="cd3d1-153">Dies kann möglicherweise leichter durchgesetzt werden, wenn Ebenen als unterschiedliche Klassenbibliotheken implementiert werden, da Sie deutlich erkennen können, welche Abhängigkeiten zwischen Bibliotheken festgelegt wurden.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-153">That may be easier to enforce if layers are implemented as different class libraries, because you can clearly identify what dependencies are set between libraries.</span></span> <span data-ttu-id="cd3d1-154">Auf der Domänenmodellebene sollte beispielsweise keine Abhängigkeit für eine andere Ebene ausgewählt werden (bei den Domänenmodellklassen sollte es sich um Plain Old CLR Objects- bzw. um [POCO](https://en.wikipedia.org/wiki/Plain_Old_CLR_Object)-Klassen handeln).</span><span class="sxs-lookup"><span data-stu-id="cd3d1-154">For instance, the domain model layer should not take a dependency on any other layer (the domain model classes should be Plain Old CLR Objects, or [POCO](https://en.wikipedia.org/wiki/Plain_Old_CLR_Object), classes).</span></span> <span data-ttu-id="cd3d1-155">Wie in Abbildung 7-6 dargestellt, weist die Bibliothek der Ebene **Ordering.Domain** nur Abhängigkeiten für die .NET Core-Bibliotheken oder NuGet-Pakete auf – jedoch keine Abhängigkeiten zu anderen benutzerdefinierten Bibliothek, z.B. zu einer Daten- oder Persistenzbibliothek.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-155">As shown in Figure 7-6, the **Ordering.Domain** layer library has dependencies only on the .NET Core libraries or NuGet packages, but not on any other custom library, such as data library or persistence library.</span></span>

![Screenshot der Ordering.Domain-Abhängigkeiten.](./media/ddd-oriented-microservice/ordering-domain-dependencies.png)

<span data-ttu-id="cd3d1-157">**Abbildung 7-6**.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-157">**Figure 7-6**.</span></span> <span data-ttu-id="cd3d1-158">Als Bibliotheken implementierte Ebenen lassen eine bessere Kontrolle der Abhängigkeiten zwischen Ebenen zu</span><span class="sxs-lookup"><span data-stu-id="cd3d1-158">Layers implemented as libraries allow better control of dependencies between layers</span></span>

### <a name="the-domain-model-layer"></a><span data-ttu-id="cd3d1-159">Die Domänenmodellebene</span><span class="sxs-lookup"><span data-stu-id="cd3d1-159">The domain model layer</span></span>

<span data-ttu-id="cd3d1-160">Im Buch [Domain-Driven Design](https://domainlanguage.com/ddd/) von Eric Evan steht Folgendes über die Domänenmodellebene und die Anwendungsebene.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-160">Eric Evans's excellent book [Domain Driven Design](https://domainlanguage.com/ddd/) says the following about the domain model layer and the application layer.</span></span>

<span data-ttu-id="cd3d1-161">**Domänenmodellebene**: Ist für die Darstellung von Konzepten des Geschäfts, Informationen zur Geschäftslage und Geschäftsregeln verantwortlich.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-161">**Domain Model Layer**: Responsible for representing concepts of the business, information about the business situation, and business rules.</span></span> <span data-ttu-id="cd3d1-162">Der Zustand, der die Geschäftslage widerspiegelt, wird hier gesteuert und verwendet, auch wenn die technischen Details zur Speicherung an die Infrastruktur delegiert werden.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-162">State that reflects the business situation is controlled and used here, even though the technical details of storing it are delegated to the infrastructure.</span></span> <span data-ttu-id="cd3d1-163">Diese Ebene stellt das Kernstück von Geschäftssoftware dar.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-163">This layer is the heart of business software.</span></span>

<span data-ttu-id="cd3d1-164">Auf der Domänenmodellebene wird das Geschäft zum Ausdruck gebracht.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-164">The domain model layer is where the business is expressed.</span></span> <span data-ttu-id="cd3d1-165">Wenn Sie die Domänenmodellebene eines Microservices in .NET implementieren, wird diese Ebene als Klassenbibliothek mit den Domänenentitäten codiert, die Daten und Verhalten (Methoden mit Logik) erfassen.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-165">When you implement a microservice domain model layer in .NET, that layer is coded as a class library with the domain entities that capture data plus behavior (methods with logic).</span></span>

<span data-ttu-id="cd3d1-166">Nach den Grundsätzen [Ignorieren der Persistenz](https://deviq.com/persistence-ignorance/) und [Ignorieren der Infrastruktur](https://ayende.com/blog/3137/infrastructure-ignorance) muss diese Ebene Details zur Datenpersistenz komplett ignorieren.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-166">Following the [Persistence Ignorance](https://deviq.com/persistence-ignorance/) and the [Infrastructure Ignorance](https://ayende.com/blog/3137/infrastructure-ignorance) principles, this layer must completely ignore data persistence details.</span></span> <span data-ttu-id="cd3d1-167">Diese Persistenzaufgaben sollten auf der Infrastrukturebene durchgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-167">These persistence tasks should be performed by the infrastructure layer.</span></span> <span data-ttu-id="cd3d1-168">Daher sollte diese Ebene keine direkten Abhängigkeiten für die Infrastruktur berücksichtigen. Dies bedeutet, dass eine wichtige Regel vorsieht, dass es sich bei den Entitätsklassen Ihres Domänenmodells um [POCO](https://en.wikipedia.org/wiki/Plain_Old_CLR_Object)-Klassen handeln sollte.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-168">Therefore, this layer should not take direct dependencies on the infrastructure, which means that an important rule is that your domain model entity classes should be [POCO](https://en.wikipedia.org/wiki/Plain_Old_CLR_Object)s.</span></span>

<span data-ttu-id="cd3d1-169">Domänenentitäten sollten in keiner direkten Abhängigkeit (z.B. durch Ableitung von einer Basisklasse) zu einem Infrastrukturframework für den Datenzugriff wie Entity Framework oder NHibernate stehen.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-169">Domain entities should not have any direct dependency (like deriving from a base class) on any data access infrastructure framework like Entity Framework or NHibernate.</span></span> <span data-ttu-id="cd3d1-170">Im Idealfall sollten Ihre Domänenentitäten von keinem Typ abgeleitet werden bzw. keinen Typen implementieren, der in einem Infrastrukturframework definiert ist.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-170">Ideally, your domain entities should not derive from or implement any type defined in any infrastructure framework.</span></span>

<span data-ttu-id="cd3d1-171">Die meisten modernen ORM-Frameworks wie Entity Framework Core lassen diesen Ansatz zu, damit Ihre Domänenmodellklassen nicht an die Infrastruktur gekoppelt sind.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-171">Most modern ORM frameworks like Entity Framework Core allow this approach, so that your domain model classes are not coupled to the infrastructure.</span></span> <span data-ttu-id="cd3d1-172">Allerdings ist es nicht immer möglich, über POCO-Entitäten zu verfügen, wenn bestimmte NoSQL-Datenbanken und Frameworks wie Actors und Reliable Collections in Azure Fabric Service verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-172">However, having POCO entities is not always possible when using certain NoSQL databases and frameworks, like Actors and Reliable Collections in Azure Service Fabric.</span></span>

<span data-ttu-id="cd3d1-173">Auch wenn es wichtig ist, bei Ihrem Domänenmodell dem Grundsatz „Ignorieren der Persistenz“ zu folgen, sollten Sie Persistenzprobleme nicht ignorieren.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-173">Even when it is important to follow the Persistence Ignorance principle for your Domain model, you should not ignore persistence concerns.</span></span> <span data-ttu-id="cd3d1-174">Es ist nach wie vor sehr wichtig, das physische Datenmodell und seine Zuordnung zu Ihrem Entitätsobjektmodell zu verstehen.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-174">It is still very important to understand the physical data model and how it maps to your entity object model.</span></span> <span data-ttu-id="cd3d1-175">Andernfalls erstellen Sie möglicherweise ungültige Entwürfe.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-175">Otherwise you can create impossible designs.</span></span>

<span data-ttu-id="cd3d1-176">Dies bedeutet aber auch nicht, dass Sie ein Modell auswählen können, das für eine relationale Datenbank entworfen wurde, und es direkt in eine NoSQL- oder eine dokumentorientierte Datenbank verschieben können.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-176">Also, this does not mean you can take a model designed for a relational database and directly move it to a NoSQL or document-oriented database.</span></span> <span data-ttu-id="cd3d1-177">Bei einigen Entitätsmodellen ist das Modell möglicherweise geeignet, in der Regel ist dies jedoch nicht der Fall.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-177">In some entity models, the model might fit, but usually it does not.</span></span> <span data-ttu-id="cd3d1-178">Es gibt nach wie vor Einschränkungen, denen Ihr Entitätsmodell unterworfen ist. Diese beziehen sich sowohl auf die Speichertechnologie als auch auf die ORM-Technologie.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-178">There are still constraints that your entity model must adhere to, based both on the storage technology and ORM technology.</span></span>

### <a name="the-application-layer"></a><span data-ttu-id="cd3d1-179">Die Anwendungsebene</span><span class="sxs-lookup"><span data-stu-id="cd3d1-179">The application layer</span></span>

<span data-ttu-id="cd3d1-180">Wir fahren nun mit der Anwendungsebene fort und können erneut aus dem Buch [Domain-Driven Design](https://domainlanguage.com/ddd/) von Eric Evan zitieren:</span><span class="sxs-lookup"><span data-stu-id="cd3d1-180">Moving on to the application layer, we can again cite Eric Evans's book [Domain Driven Design](https://domainlanguage.com/ddd/):</span></span>

<span data-ttu-id="cd3d1-181">**Anwendungsebene**: Definiert die Aufträge, die von der Software ausgeführt werden sollen, und leitet die ausdrucksstarken Domänenobjekte zur Behebung von Problemen weiter.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-181">**Application Layer:** Defines the jobs the software is supposed to do and directs the expressive domain objects to work out problems.</span></span> <span data-ttu-id="cd3d1-182">Die Aufgaben, für die diese Ebene verantwortlich ist, sind für das Geschäft von Bedeutung bzw. für die Interaktion mit den Anwendungsebenen anderer Systeme erforderlich.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-182">The tasks this layer is responsible for are meaningful to the business or necessary for interaction with the application layers of other systems.</span></span> <span data-ttu-id="cd3d1-183">Diese Ebene wird dünn gehalten.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-183">This layer is kept thin.</span></span> <span data-ttu-id="cd3d1-184">Sie enthält keine Geschäftsregeln oder Wissen, sondern koordiniert nur Aufgaben und delegiert Arbeit an Kollaborationen von Domänenobjekten auf der darunterliegenden Ebene.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-184">It does not contain business rules or knowledge, but only coordinates tasks and delegates work to collaborations of domain objects in the next layer down.</span></span> <span data-ttu-id="cd3d1-185">Sie enthält keinen Zustand, der die Geschäftslage widerspiegelt, kann aber einen Zustand aufweisen, der dem Benutzer oder dem Programm den Fortschritt einer Aufgabe anzeigt.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-185">It does not have state reflecting the business situation, but it can have state that reflects the progress of a task for the user or the program.</span></span>

<span data-ttu-id="cd3d1-186">Die Anwendungsebene eines Microservices in .NET wird häufig als ASP.NET Core-Web-API-Projekt codiert.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-186">A microservice’s application layer in .NET is commonly coded as an ASP.NET Core Web API project.</span></span> <span data-ttu-id="cd3d1-187">Das Projekt implementiert die Interaktion des Microservices, den Remotenetzwerkzugriff und die externen Web-APIs, die über die Benutzeroberfläche oder Client-Apps verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-187">The project implements the microservice’s interaction, remote network access, and the external Web APIs used from the UI or client apps.</span></span> <span data-ttu-id="cd3d1-188">Es enthält Abfragen, wenn ein CQRS-Ansatz verwendet wird, vom Microservice akzeptierte Befehle und sogar die ereignisgesteuerte Kommunikation zwischen Microservices (Integrationsereignisse).</span><span class="sxs-lookup"><span data-stu-id="cd3d1-188">It includes queries if using a CQRS approach, commands accepted by the microservice, and even the event-driven communication between microservices (integration events).</span></span> <span data-ttu-id="cd3d1-189">Die ASP.NET Core-Web-API, die die Anwendungsebene darstellt, darf keine Geschäftsregeln oder Domänenwissen enthalten (insbesondere Domänenregeln für Transaktionen oder Updates). Diese sollten der Bibliothek der Domänenmodellklassen zugeordnet sein.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-189">The ASP.NET Core Web API that represents the application layer must not contain business rules or domain knowledge (especially domain rules for transactions or updates); these should be owned by the domain model class library.</span></span> <span data-ttu-id="cd3d1-190">Die Anwendungsebene darf nur Aufgaben koordinieren und keinen Domänenstatus enthalten oder definieren (Domänenmodell).</span><span class="sxs-lookup"><span data-stu-id="cd3d1-190">The application layer must only coordinate tasks and must not hold or define any domain state (domain model).</span></span> <span data-ttu-id="cd3d1-191">Sie delegiert die Ausführung von Geschäftsregeln für die Domänenmodellklassen (Aggregatstämme und Domänenentitäten), wodurch die Daten schließlich innerhalb dieser Domänenentitäten aktualisiert werden.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-191">It delegates the execution of business rules to the domain model classes themselves (aggregate roots and domain entities), which will ultimately update the data within those domain entities.</span></span>

<span data-ttu-id="cd3d1-192">In der Anwendungslogik werden im Wesentlichen alle Fälle implementiert, die von einem bestimmten Front-End abhängen,</span><span class="sxs-lookup"><span data-stu-id="cd3d1-192">Basically, the application logic is where you implement all use cases that depend on a given front end.</span></span> <span data-ttu-id="cd3d1-193">zum Beispiel die mit einem Web-API-Dienst verbundene Implementierung.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-193">For example, the implementation related to a Web API service.</span></span>

<span data-ttu-id="cd3d1-194">Ziel ist, dass die Domänenlogik auf der Domänenmodellebene sowie die zugehörigen Invarianten, das Datenmodell und verwandte Geschäftsregeln komplett unabhängig von der Darstellungs- und der Anwendungsebene sind.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-194">The goal is that the domain logic in the domain model layer, its invariants, the data model, and related business rules must be completely independent from the presentation and application layers.</span></span> <span data-ttu-id="cd3d1-195">Vor allem darf die Domänenmodellebene nicht direkt von einem Infrastrukturframework abhängig sein.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-195">Most of all, the domain model layer must not directly depend on any infrastructure framework.</span></span>

### <a name="the-infrastructure-layer"></a><span data-ttu-id="cd3d1-196">Die Infrastrukturebene</span><span class="sxs-lookup"><span data-stu-id="cd3d1-196">The infrastructure layer</span></span>

<span data-ttu-id="cd3d1-197">Auf der Infrastrukturebene wird dargestellt, wie die Daten, die anfangs in Domänenentitäten (im Arbeitsspeicher) enthalten waren, dauerhaft in Datenbanken oder einem anderen permanenten Speicher gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-197">The infrastructure layer is how the data that is initially held in domain entities (in memory) is persisted in databases or another persistent store.</span></span> <span data-ttu-id="cd3d1-198">Ein Beispiel ist die Verwendung von Entity Framework Core-Code für die Implementierung der Repository-Musterklassen, in denen DBContext für die Speicherung von Daten in einer relationalen Datenbank verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-198">An example is using Entity Framework Core code to implement the Repository pattern classes that use a DBContext to persist data in a relational database.</span></span>

<span data-ttu-id="cd3d1-199">Gemäß den oben genannten Grundsätzen [Ignorieren der Persistenz](https://deviq.com/persistence-ignorance/) und [Ignorieren der Infrastruktur](https://ayende.com/blog/3137/infrastructure-ignorance) darf die Infrastrukturebene die Domänenmodellebene nicht „kontaminieren“.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-199">In accordance with the previously mentioned [Persistence Ignorance](https://deviq.com/persistence-ignorance/) and [Infrastructure Ignorance](https://ayende.com/blog/3137/infrastructure-ignorance) principles, the infrastructure layer must not “contaminate” the domain model layer.</span></span> <span data-ttu-id="cd3d1-200">Die Entitätsklassen des Domänenmodells müssen von der Infrastruktur unabhängig sein, in der Sie Daten speichern (EF oder ein anderes Framework), indem keine harten Abhängigkeiten für Frameworks berücksichtigt werden.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-200">You must keep the domain model entity classes agnostic from the infrastructure that you use to persist data (EF or any other framework) by not taking hard dependencies on frameworks.</span></span> <span data-ttu-id="cd3d1-201">Ihre Klassenbibliothek auf der Domänenmodellebene sollte nur Ihren Domänencode enthalten und nur [POCO](https://en.wikipedia.org/wiki/Plain_Old_CLR_Object)-Entitätsklassen, die das Kernstück Ihrer Software implementieren und komplett entkoppelt von Infrastrukturtechnologien sind.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-201">Your domain model layer class library should have only your domain code, just [POCO](https://en.wikipedia.org/wiki/Plain_Old_CLR_Object) entity classes implementing the heart of your software and completely decoupled from infrastructure technologies.</span></span>

<span data-ttu-id="cd3d1-202">Deswegen sollten Ihre Ebenen bzw. Klassenbibliotheken und Projekte wie in Abbildung 7-7 dargestellt von Ihrer Domänenmodellebene (Bibliothek) abhängen, nicht umgekehrt.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-202">Thus, your layers or class libraries and projects should ultimately depend on your domain model layer (library), not vice versa, as shown in Figure 7-7.</span></span>

![Diagramm, das Abhängigkeiten zeigt, die zwischen DDD-Dienstebenen bestehen.](./media/ddd-oriented-microservice/ddd-service-layer-dependencies.png)

<span data-ttu-id="cd3d1-204">**Abbildung 7-7**.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-204">**Figure 7-7**.</span></span> <span data-ttu-id="cd3d1-205">Abhängigkeiten zwischen Ebenen in DDD</span><span class="sxs-lookup"><span data-stu-id="cd3d1-205">Dependencies between layers in DDD</span></span>

<span data-ttu-id="cd3d1-206">Abhängigkeiten in einem DDD-Dienst: Die Anwendungsschicht hängt von der Domäne und der Infrastruktur ab, die Infrastruktur von der Domäne – doch die Domäne hängt von keiner Ebene ab.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-206">Dependencies in a DDD Service, the Application layer depends on Domain and Infrastructure, and Infrastructure depends on Domain, but Domain doesn't depend on any layer.</span></span> <span data-ttu-id="cd3d1-207">Dieser Ebenenentwurf sollte bei jedem Microservice unabhängig erfolgen.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-207">This layer design should be independent for each microservice.</span></span> <span data-ttu-id="cd3d1-208">Wie bereits erwähnt wurde, können Sie die komplexesten Microservices nach den DDD-Mustern implementieren, während einfachere datengesteuerte Microservices (einfacher CRUD-Vorgang auf einer einzelnen Ebene) auf einfachere Weise implementiert werden können.</span><span class="sxs-lookup"><span data-stu-id="cd3d1-208">As noted earlier, you can implement the most complex microservices following DDD patterns, while implementing simpler data-driven microservices (simple CRUD in a single layer) in a simpler way.</span></span>

#### <a name="additional-resources"></a><span data-ttu-id="cd3d1-209">Zusätzliche Ressourcen</span><span class="sxs-lookup"><span data-stu-id="cd3d1-209">Additional resources</span></span>

- <span data-ttu-id="cd3d1-210">**DevIQ. Persistence Ignorance principle (Prinzip „Ignorieren der Persistenz“)**  </span><span class="sxs-lookup"><span data-stu-id="cd3d1-210">**DevIQ. Persistence Ignorance principle** </span></span>\
  <https://deviq.com/persistence-ignorance/>

- <span data-ttu-id="cd3d1-211">**Oren Eini. Infrastructure Ignorance (Ignorieren der Infrastruktur)**  </span><span class="sxs-lookup"><span data-stu-id="cd3d1-211">**Oren Eini. Infrastructure Ignorance** </span></span>\
  <https://ayende.com/blog/3137/infrastructure-ignorance>

- <span data-ttu-id="cd3d1-212">**Angel Lopez. Layered Architecture In Domain-Driven Design (Architektur mit Ebenen im domänengesteuerten Design)**  </span><span class="sxs-lookup"><span data-stu-id="cd3d1-212">**Angel Lopez. Layered Architecture In Domain-Driven Design** </span></span>\
  <https://ajlopez.wordpress.com/2008/09/12/layered-architecture-in-domain-driven-design/>

>[!div class="step-by-step"]
><span data-ttu-id="cd3d1-213">[Zurück](cqrs-microservice-reads.md)
>[Weiter](microservice-domain-model.md)</span><span class="sxs-lookup"><span data-stu-id="cd3d1-213">[Previous](cqrs-microservice-reads.md)
[Next](microservice-domain-model.md)</span></span>
