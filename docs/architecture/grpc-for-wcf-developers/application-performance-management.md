---
title: 'Anwendungs Leistungsverwaltung: GrpC für WCF-Entwickler'
description: Protokollierung, Metriken und Ablauf Verfolgung für ASP.net Core GrpC-Anwendungen.
ms.date: 12/15/2020
ms.openlocfilehash: 8a2a89e268e3b2dffdcc945ac71b2de85b4d4964
ms.sourcegitcommit: 655f8a16c488567dfa696fc0b293b34d3c81e3df
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/06/2021
ms.locfileid: "97938454"
---
# <a name="application-performance-management"></a><span data-ttu-id="c345f-103">Application Performance Management</span><span class="sxs-lookup"><span data-stu-id="c345f-103">Application Performance Management</span></span>

<span data-ttu-id="c345f-104">In Produktionsumgebungen wie Kubernetes ist es wichtig, Anwendungen zu überwachen, um sicherzustellen, dass Sie optimal ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="c345f-104">In production environments like Kubernetes, it's important to monitor applications to ensure they're running optimally.</span></span> <span data-ttu-id="c345f-105">Die Protokollierung und Metriken sind besonders wichtig.</span><span class="sxs-lookup"><span data-stu-id="c345f-105">Logging and metrics are important in particular.</span></span> <span data-ttu-id="c345f-106">ASP.net Core, einschließlich GrpC, bietet integrierte Unterstützung für das Erstellen und Verwalten von Protokollnachrichten und Metrikdaten sowie die Ablauf *Verfolgung* von Daten.</span><span class="sxs-lookup"><span data-stu-id="c345f-106">ASP.NET Core, including gRPC, provides built-in support for producing and managing log messages and metrics data, as well as *tracing* data.</span></span>

## <a name="the-difference-between-logging-and-metrics"></a><span data-ttu-id="c345f-107">Der Unterschied zwischen Protokollierung und Metriken</span><span class="sxs-lookup"><span data-stu-id="c345f-107">The difference between logging and metrics</span></span>

<span data-ttu-id="c345f-108">Bei der *Protokollierung* werden Textnachrichten behandelt, in denen ausführliche Informationen zu den Vorgängen im System aufgezeichnet werden.</span><span class="sxs-lookup"><span data-stu-id="c345f-108">*Logging* is concerned with text messages that record detailed information about things that have happened in the system.</span></span> <span data-ttu-id="c345f-109">Protokollmeldungen können Ausnahme Daten wie Stapel Überwachungen oder strukturierte Daten enthalten, die den Kontext der Nachricht bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="c345f-109">Log messages might include exception data, like stack traces, or structured data that provide context about the message.</span></span> <span data-ttu-id="c345f-110">Die Protokollierungs Ausgabe wird häufig in einen durchsuchbaren Text Speicher geschrieben.</span><span class="sxs-lookup"><span data-stu-id="c345f-110">Logging output is commonly written to a searchable text store.</span></span>

<span data-ttu-id="c345f-111">*Metriken* beziehen sich auf numerische Daten, die mithilfe von Diagrammen und Diagrammen in einem Dashboard aggregiert und präsentiert werden sollen.</span><span class="sxs-lookup"><span data-stu-id="c345f-111">*Metrics* refers to numeric data designed to be aggregated and presented by using charts and graphs in a dashboard.</span></span> <span data-ttu-id="c345f-112">Das Dashboard bietet eine Übersicht über die Gesamt Integrität und Leistung einer Anwendung.</span><span class="sxs-lookup"><span data-stu-id="c345f-112">The dashboard provides a view of the overall health and performance of an application.</span></span> <span data-ttu-id="c345f-113">Metrikdaten können auch verwendet werden, um automatisierte Warnungen zu initiieren, wenn ein Schwellenwert überschritten wird.</span><span class="sxs-lookup"><span data-stu-id="c345f-113">Metrics data can also be used to trigger automated alerts when a threshold is exceeded.</span></span> <span data-ttu-id="c345f-114">Im folgenden finden Sie einige Beispiele für Metrikdaten:</span><span class="sxs-lookup"><span data-stu-id="c345f-114">Here are some examples of metrics data:</span></span>

- <span data-ttu-id="c345f-115">Benötigte Zeit für die Verarbeitung von Anforderungen.</span><span class="sxs-lookup"><span data-stu-id="c345f-115">Time taken to process requests.</span></span>
- <span data-ttu-id="c345f-116">Die Anzahl der Anforderungen pro Sekunde, die von einer Instanz eines Dienstanbieter verarbeitet werden.</span><span class="sxs-lookup"><span data-stu-id="c345f-116">The number of requests per second being handled by an instance of a service.</span></span>
- <span data-ttu-id="c345f-117">Die Anzahl der fehlerhaften Anforderungen auf einer-Instanz.</span><span class="sxs-lookup"><span data-stu-id="c345f-117">The number of failed requests on an instance.</span></span>

## <a name="logging-in-aspnet-core-grpc"></a><span data-ttu-id="c345f-118">Anmelden ASP.net Core GrpC</span><span class="sxs-lookup"><span data-stu-id="c345f-118">Logging in ASP.NET Core gRPC</span></span>

<span data-ttu-id="c345f-119">ASP.net Core bietet integrierte Unterstützung für die Protokollierung in Form des [Microsoft. Extensions. Logging](https://www.nuget.org/packages/Microsoft.Extensions.Logging) nuget-Pakets.</span><span class="sxs-lookup"><span data-stu-id="c345f-119">ASP.NET Core provides built-in support for logging, in the form of [Microsoft.Extensions.Logging](https://www.nuget.org/packages/Microsoft.Extensions.Logging) NuGet package.</span></span> <span data-ttu-id="c345f-120">Die Kernteile dieser Bibliothek sind im Web-SDK enthalten, sodass es nicht erforderlich ist, es manuell zu installieren.</span><span class="sxs-lookup"><span data-stu-id="c345f-120">The core parts of this library are included with the Web SDK, so there's no need to install it manually.</span></span> <span data-ttu-id="c345f-121">Standardmäßig werden Protokollmeldungen in die Standardausgabe ("Console") und in einen beliebigen angefügten Debugger geschrieben.</span><span class="sxs-lookup"><span data-stu-id="c345f-121">By default, log messages are written to the standard output (the "console") and to any attached debugger.</span></span> <span data-ttu-id="c345f-122">Wenn Sie Protokolle in persistente externe Datenspeicher schreiben möchten, müssen Sie möglicherweise [optionale Protokollierungs-senkenpakete](/aspnet/core/fundamentals/logging/?view=aspnetcore-3.0#third-party-logging-providers)importieren.</span><span class="sxs-lookup"><span data-stu-id="c345f-122">To write logs to persistent external data stores, you might need to import [optional logging sink packages](/aspnet/core/fundamentals/logging/?view=aspnetcore-3.0#third-party-logging-providers).</span></span>

<span data-ttu-id="c345f-123">Das ASP.net Core GrpC-Framework schreibt ausführliche Diagnose Protokollierungs Meldungen in dieses Protokollierungs Framework, sodass Sie zusammen mit den eigenen Nachrichten Ihrer Anwendung verarbeitet und gespeichert werden können.</span><span class="sxs-lookup"><span data-stu-id="c345f-123">The ASP.NET Core gRPC framework writes detailed diagnostic logging messages to this logging framework, so they can be processed and stored along with your application's own messages.</span></span>

### <a name="produce-log-messages"></a><span data-ttu-id="c345f-124">Protokollmeldungen werden erzeugt.</span><span class="sxs-lookup"><span data-stu-id="c345f-124">Produce log messages</span></span>

<span data-ttu-id="c345f-125">Die Protokollierungs Erweiterung wird automatisch im Abhängigkeits Injektionssystem von ASP.net Core registriert, sodass Sie Protokollierungen als Konstruktorparameter für GrpC-Dienst Typen angeben können.</span><span class="sxs-lookup"><span data-stu-id="c345f-125">The logging extension is automatically registered with ASP.NET Core's dependency injection system, so you can specify loggers as a constructor parameter on gRPC service types.</span></span>

```csharp
public class StockData : Stocks.StocksBase
{
    private readonly ILogger<StockData> _logger;

    public StockData(ILogger<StockData> logger)
    {
        _logger = logger;
    }
}
```

<span data-ttu-id="c345f-126">Viele Protokollmeldungen, wie z. b. Anforderungen und Ausnahmen, werden von den ASP.net Core-und GrpC-Framework-Komponenten bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="c345f-126">Many log messages, such as requests and exceptions, are provided by the ASP.NET Core and gRPC framework components.</span></span> <span data-ttu-id="c345f-127">Fügen Sie eigene Protokollnachrichten hinzu, um Details und Kontext zur Anwendungslogik bereitzustellen, anstatt Probleme auf niedrigerer Ebene zu bieten.</span><span class="sxs-lookup"><span data-stu-id="c345f-127">Add your own log messages to provide detail and context about application logic, rather than lower-level concerns.</span></span>

<span data-ttu-id="c345f-128">Weitere Informationen zum Schreiben von Protokollmeldungen und verfügbaren Protokollierungs senken und-Zielen finden Sie unter  [Protokollierung in .net Core und ASP.net Core](/aspnet/core/fundamentals/logging/).</span><span class="sxs-lookup"><span data-stu-id="c345f-128">For more information about writing log messages and available logging sinks and targets, see  [Logging in .NET Core and ASP.NET Core](/aspnet/core/fundamentals/logging/).</span></span>

## <a name="metrics-in-aspnet-core-grpc"></a><span data-ttu-id="c345f-129">Metriken in ASP.net Core GrpC</span><span class="sxs-lookup"><span data-stu-id="c345f-129">Metrics in ASP.NET Core gRPC</span></span>

<span data-ttu-id="c345f-130">Die .net Core-Laufzeit stellt eine Reihe von Komponenten zum ausgeben und beobachten von Metriken bereit.</span><span class="sxs-lookup"><span data-stu-id="c345f-130">The .NET Core runtime provides a set of components for emitting and observing metrics.</span></span> <span data-ttu-id="c345f-131">Hierzu gehören APIs wie die <xref:System.Diagnostics.Tracing.EventSource> -Klasse und die- <xref:System.Diagnostics.Tracing.EventCounter> Klasse.</span><span class="sxs-lookup"><span data-stu-id="c345f-131">These include APIs such as the <xref:System.Diagnostics.Tracing.EventSource> and <xref:System.Diagnostics.Tracing.EventCounter> classes.</span></span> <span data-ttu-id="c345f-132">Diese APIs können grundlegende numerische Daten ausgeben, die von externen Prozessen wie dem [globalen dotnet-Counters-Tool](../../core/diagnostics/dotnet-counters.md)oder der Ereignis Ablauf Verfolgung für Windows genutzt werden können.</span><span class="sxs-lookup"><span data-stu-id="c345f-132">These APIs can emit basic numeric data that can be consumed by external processes, like the [dotnet-counters global tool](../../core/diagnostics/dotnet-counters.md), or Event Tracing for Windows.</span></span> <span data-ttu-id="c345f-133">Weitere Informationen zur Verwendung von `EventCounter` in Ihrem eigenen Code finden Sie unter [Einführung in eventcounter](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.Tracing/documentation/EventCounterTutorial.md).</span><span class="sxs-lookup"><span data-stu-id="c345f-133">For more information about using `EventCounter` in your own code, see [EventCounter introduction](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.Tracing/documentation/EventCounterTutorial.md).</span></span>

<span data-ttu-id="c345f-134">Für erweiterte Metriken und zum Schreiben von Metrikdaten in eine größere Anzahl von Daten speichern können Sie ein Open Source-Projekt mit dem Namen " [App-Metriken](https://www.app-metrics.io)" ausprobieren.</span><span class="sxs-lookup"><span data-stu-id="c345f-134">For more advanced metrics and for writing metric data to a wider range of data stores, you might try an open-source project called [App Metrics](https://www.app-metrics.io).</span></span> <span data-ttu-id="c345f-135">Diese Sammlung von Bibliotheken bietet einen umfangreichen Satz von Typen, um Ihren Code zu instrumentieren.</span><span class="sxs-lookup"><span data-stu-id="c345f-135">This suite of libraries provides an extensive set of types to instrument your code.</span></span> <span data-ttu-id="c345f-136">Außerdem werden Pakete zum Schreiben von Metriken in verschiedene Arten von Zielen angeboten, die Zeitreihen Datenbanken, wie z. b. Prometheus und Einfluss xdb, und [Application Insights](/azure/azure-monitor/app/app-insights-overview)enthalten.</span><span class="sxs-lookup"><span data-stu-id="c345f-136">It also offers packages to write metrics to different kinds of targets that include time-series databases, such as Prometheus and InfluxDB, and [Application Insights](/azure/azure-monitor/app/app-insights-overview).</span></span> <span data-ttu-id="c345f-137">Das nuget-Paket [app. Metrics. aspnetcore. MVC](https://www.nuget.org/packages/App.Metrics.AspNetCore.Mvc/) fügt sogar einen umfassenden Satz grundlegender Metriken hinzu, die automatisch über die Integration in das ASP.net Core Framework generiert werden.</span><span class="sxs-lookup"><span data-stu-id="c345f-137">The [App.Metrics.AspNetCore.Mvc](https://www.nuget.org/packages/App.Metrics.AspNetCore.Mvc/) NuGet package even adds a comprehensive set of basic metrics that are automatically generated via integration with the ASP.NET Core framework.</span></span> <span data-ttu-id="c345f-138">Die Projektwebsite stellt [Vorlagen](https://www.app-metrics.io/samples/grafana/) zum Anzeigen dieser Metriken mit der [grafana](https://grafana.com/) -Visualisierungsplattform bereit.</span><span class="sxs-lookup"><span data-stu-id="c345f-138">The project website provides [templates](https://www.app-metrics.io/samples/grafana/) for displaying those metrics with the [Grafana](https://grafana.com/) visualization platform.</span></span>

### <a name="produce-metrics"></a><span data-ttu-id="c345f-139">Metriken</span><span class="sxs-lookup"><span data-stu-id="c345f-139">Produce metrics</span></span>

<span data-ttu-id="c345f-140">Die meisten metrikplattformen unterstützen die folgenden Typen:</span><span class="sxs-lookup"><span data-stu-id="c345f-140">Most metrics platforms support the following types:</span></span>

| <span data-ttu-id="c345f-141">Metriktyp</span><span class="sxs-lookup"><span data-stu-id="c345f-141">Metric type</span></span> | <span data-ttu-id="c345f-142">BESCHREIBUNG</span><span class="sxs-lookup"><span data-stu-id="c345f-142">Description</span></span> |
| ----------- | ----------- |
| <span data-ttu-id="c345f-143">Zähler</span><span class="sxs-lookup"><span data-stu-id="c345f-143">Counter</span></span>     | <span data-ttu-id="c345f-144">Verfolgt, wie oft etwas passiert, z. b. Anforderungen und Fehler.</span><span class="sxs-lookup"><span data-stu-id="c345f-144">Tracks how often something happens, such as requests and errors.</span></span> |
| <span data-ttu-id="c345f-145">Maßstab</span><span class="sxs-lookup"><span data-stu-id="c345f-145">Gauge</span></span>       | <span data-ttu-id="c345f-146">Zeichnet einen einzelnen Wert auf, der sich im Laufe der Zeit ändert, beispielsweise aktive Verbindungen.</span><span class="sxs-lookup"><span data-stu-id="c345f-146">Records a single value that changes over time, such as active connections.</span></span> |
| <span data-ttu-id="c345f-147">Histogramm</span><span class="sxs-lookup"><span data-stu-id="c345f-147">Histogram</span></span>   | <span data-ttu-id="c345f-148">Misst eine Verteilung von Werten über beliebige Grenzen hinweg.</span><span class="sxs-lookup"><span data-stu-id="c345f-148">Measures a distribution of values across arbitrary limits.</span></span> <span data-ttu-id="c345f-149">Ein Histogramm kann z. b. die Größe des Datasets verfolgen und zählen, wie viele <10 Datensätze enthalten sind, wie viele enthaltene 11-100-Einträge, wie viele enthaltene 101-1000-Einträge und wie viele >1000-Einträge enthalten sind.</span><span class="sxs-lookup"><span data-stu-id="c345f-149">For example, a histogram can track dataset size, counting how many contained <10 records, how many contained 11-100 records, how many contained 101-1000 records, and how many contained >1000 records.</span></span> |
| <span data-ttu-id="c345f-150">Zähler</span><span class="sxs-lookup"><span data-stu-id="c345f-150">Meter</span></span>       | <span data-ttu-id="c345f-151">Misst die Rate, mit der ein Ereignis in verschiedenen Zeitspannen auftritt.</span><span class="sxs-lookup"><span data-stu-id="c345f-151">Measures the rate at which an event occurs in various time spans.</span></span> |
| <span data-ttu-id="c345f-152">Timer</span><span class="sxs-lookup"><span data-stu-id="c345f-152">Timer</span></span>       | <span data-ttu-id="c345f-153">Verfolgt die Dauer der Ereignisse und die Rate, mit der es eintritt, als Histogramm gespeichert.</span><span class="sxs-lookup"><span data-stu-id="c345f-153">Tracks the duration of events and the rate at which it occurs, stored as a histogram.</span></span> |

<span data-ttu-id="c345f-154">Mithilfe von *App-Metriken* `IMetrics` kann eine Schnittstelle über eine Abhängigkeitsinjektion abgerufen und zum Aufzeichnen dieser Metriken für einen GrpC-Dienst verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="c345f-154">By using *App Metrics*, an `IMetrics` interface can be obtained via dependency injection, and used to record any of these metrics for a gRPC service.</span></span> <span data-ttu-id="c345f-155">Im folgenden Beispiel wird gezeigt, wie die Anzahl der `Get` im Laufe der Zeit erfolgten Anforderungen gezählt wird:</span><span class="sxs-lookup"><span data-stu-id="c345f-155">The following example shows how to count the number of `Get` requests made over time:</span></span>

```csharp
public class StockData : Stocks.StocksBase
{
    private static readonly CounterOptions GetRequestCounter = new CounterOptions
    {
        Name = "StockData_Get_Requests",
        MeasurementUnit = Unit.Calls
    };

    private readonly IStockRepository _repository;
    private readonly IMetrics _metrics;

    public StockData(IStockRepository repository, IMetrics metrics)
    {
        _repository = repository;
        _metrics = metrics;
    }

    public override async Task<GetResponse> Get(GetRequest request, ServerCallContext context)
    {
        _metrics.Measure.Counter.Increment(GetRequestCounter);

        // Serve request...
    }
}
```

### <a name="store-and-visualize-metrics-data"></a><span data-ttu-id="c345f-156">Speichern und Visualisieren von Metrikdaten</span><span class="sxs-lookup"><span data-stu-id="c345f-156">Store and visualize metrics data</span></span>

<span data-ttu-id="c345f-157">Die beste Möglichkeit zum Speichern von Metrikdaten befindet sich in einer *Zeitreihen Datenbank*, einem speziellen Datenspeicher, der für die Aufzeichnung numerischer Datenreihen konzipiert ist, die mit Zeitstempeln markiert sind.</span><span class="sxs-lookup"><span data-stu-id="c345f-157">The best way to store metrics data is in a *time-series database*, a specialized data store designed to record numerical data series marked with timestamps.</span></span> <span data-ttu-id="c345f-158">Die beliebtesten dieser Datenbanken sind [Prometheus](https://prometheus.io/) und [Einfluss xdb](https://www.influxdata.com/products/influxdb-overview/).</span><span class="sxs-lookup"><span data-stu-id="c345f-158">The most popular of these databases are [Prometheus](https://prometheus.io/) and [InfluxDB](https://www.influxdata.com/products/influxdb-overview/).</span></span> <span data-ttu-id="c345f-159">Microsoft Azure bietet auch dedizierten metrikspeicher über den [Azure Monitor](/azure/azure-monitor/overview) -Dienst.</span><span class="sxs-lookup"><span data-stu-id="c345f-159">Microsoft Azure also provides dedicated metrics storage through the [Azure Monitor](/azure/azure-monitor/overview) service.</span></span>

<span data-ttu-id="c345f-160">Die aktuelle Lösung für die Visualisierung von Metrikdaten ist [grafana](https://grafana.com), die mit einer Vielzahl von Speicheranbietern funktioniert.</span><span class="sxs-lookup"><span data-stu-id="c345f-160">The current go-to solution for visualizing metrics data is [Grafana](https://grafana.com), which works with a wide range of storage providers.</span></span> <span data-ttu-id="c345f-161">Die folgende Abbildung zeigt ein Beispiel für ein grafana-Dashboard, das Metriken aus dem linkerd-dienstmesh anzeigt, das das StockData-Beispiel enthält:</span><span class="sxs-lookup"><span data-stu-id="c345f-161">The following image shows an example Grafana dashboard that displays metrics from the Linkerd service mesh running the StockData sample:</span></span>

![Screenshot des grafana-Dashboards](media/application-performance-management/grafana-screenshot.png)

### <a name="metrics-based-alerting"></a><span data-ttu-id="c345f-163">Metrikbasierte Warnungen</span><span class="sxs-lookup"><span data-stu-id="c345f-163">Metrics-based alerting</span></span>

<span data-ttu-id="c345f-164">Die numerische Natur von Metrikdaten bedeutet, dass Sie idealerweise für Warnsysteme geeignet ist, die Entwickler oder Support Techniker Benachrichtigen, wenn ein Wert außerhalb der definierten Toleranz liegt.</span><span class="sxs-lookup"><span data-stu-id="c345f-164">The numerical nature of metrics data means that it's ideally suited to drive alerting systems, notifying developers or support engineers when a value falls outside of some defined tolerance.</span></span> <span data-ttu-id="c345f-165">Die bereits erwähnten Plattformen bieten Unterstützung für Warnungen über eine Reihe von Optionen, einschließlich e-Mails, Textnachrichten oder Dashboards in Dashboards.</span><span class="sxs-lookup"><span data-stu-id="c345f-165">The platforms already mentioned all provide support for alerting via a range of options, including emails, text messages, or in-dashboard visualizations.</span></span>

## <a name="distributed-tracing"></a><span data-ttu-id="c345f-166">Verteilte Ablaufverfolgung</span><span class="sxs-lookup"><span data-stu-id="c345f-166">Distributed tracing</span></span>

<span data-ttu-id="c345f-167">Die verteilte Ablauf Verfolgung ist eine relativ aktuelle Entwicklung in der Überwachung, die aus der zunehmenden Verwendung von microservices und verteilten Architekturen entstanden ist.</span><span class="sxs-lookup"><span data-stu-id="c345f-167">Distributed tracing is a relatively recent development in monitoring, which has arisen from the increasing use of microservices and distributed architectures.</span></span> <span data-ttu-id="c345f-168">Eine einzelne Anforderung von einem Client Browser, einer Anwendung oder einem Gerät kann in viele Schritte und untergeordnete Anforderungen aufgeteilt werden und umfasst die Verwendung vieler Dienste in einem Netzwerk.</span><span class="sxs-lookup"><span data-stu-id="c345f-168">A single request from a client browser, application, or device can be broken down into many steps and sub-requests, and involve the use of many services across a network.</span></span> <span data-ttu-id="c345f-169">Durch diese Aktivität ist es schwierig, Protokollmeldungen und Metriken mit der jeweiligen Anforderung zu korrelieren, durch die Sie ausgelöst wurden.</span><span class="sxs-lookup"><span data-stu-id="c345f-169">This activity makes it difficult to correlate log messages and metrics with the specific request that triggered them.</span></span> <span data-ttu-id="c345f-170">Die verteilte Ablauf Verfolgung wendet Bezeichner auf Anforderungen an und ermöglicht das korrelieren von Protokollen und Metriken mit einem bestimmten Vorgang.</span><span class="sxs-lookup"><span data-stu-id="c345f-170">Distributed tracing applies identifiers to requests, and allows logs and metrics to be correlated with a particular operation.</span></span> <span data-ttu-id="c345f-171">Diese Ablauf Verfolgung ähnelt [der End-to-End-Ablauf Verfolgung von WCF](../../framework/wcf/diagnostics/tracing/end-to-end-tracing.md), wird jedoch auf mehrere Plattformen angewendet.</span><span class="sxs-lookup"><span data-stu-id="c345f-171">This tracing is similar to [WCF's end-to-end tracing](../../framework/wcf/diagnostics/tracing/end-to-end-tracing.md), but it's applied across multiple platforms.</span></span>

<span data-ttu-id="c345f-172">Die verteilte Ablauf Verfolgung hat sich sehr schnell vergrößert und beginnt mit der Standardisierung.</span><span class="sxs-lookup"><span data-stu-id="c345f-172">Distributed tracing has grown quickly in popularity and is beginning to standardize.</span></span> <span data-ttu-id="c345f-173">Die Cloud Native Computing Foundation erstellte den [offenen Ablauf Verfolgungs Standard](https://opentracing.io)und versuchte, herstellerneutrale Bibliotheken für das Arbeiten mit Back-Ends wie z. b. [Jaeger](https://www.jaegertracing.io/) und [elastisches apm](https://www.elastic.co/products/apm)bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="c345f-173">The Cloud Native Computing Foundation created the [Open Tracing standard](https://opentracing.io), attempting to provide vendor-neutral libraries for working with back ends like [Jaeger](https://www.jaegertracing.io/) and [Elastic APM](https://www.elastic.co/products/apm).</span></span> <span data-ttu-id="c345f-174">Gleichzeitig hat Google das [opencensus-Projekt](https://opencensus.io/) erstellt, um die gleichen Probleme zu beheben.</span><span class="sxs-lookup"><span data-stu-id="c345f-174">At the same time, Google created the [OpenCensus project](https://opencensus.io/) to address the same set of problems.</span></span> <span data-ttu-id="c345f-175">Diese beiden Projekte werden in einem neuen Projekt ( [opentelemetry](https://opentelemetry.io)) zusammengeführt, das als Branchenstandard für die Zukunft dienen soll.</span><span class="sxs-lookup"><span data-stu-id="c345f-175">These two projects are merging into a new project, [OpenTelemetry](https://opentelemetry.io), which aims to be the industry standard of the future.</span></span>

### <a name="how-distributed-tracing-works"></a><span data-ttu-id="c345f-176">Funktionsweise der verteilten Ablauf Verfolgung</span><span class="sxs-lookup"><span data-stu-id="c345f-176">How distributed tracing works</span></span>

<span data-ttu-id="c345f-177">Die verteilte Ablauf Verfolgung basiert auf dem Konzept der *Spannen*: benannte, zeitgesteuerte *Vorgänge, die Teil einer einzelnen Ablauf* Verfolgung sind und die Verarbeitung auf mehreren Knoten eines Systems einschließen können.</span><span class="sxs-lookup"><span data-stu-id="c345f-177">Distributed tracing is based on the concept of *spans*: named, timed operations that are part of a single *trace*, which can involve processing on multiple nodes of a system.</span></span> <span data-ttu-id="c345f-178">Wenn ein neuer Vorgang initiiert wird, wird eine Ablauf Verfolgung mit einem eindeutigen Bezeichner erstellt.</span><span class="sxs-lookup"><span data-stu-id="c345f-178">When a new operation is initiated, a trace is created with a unique identifier.</span></span> <span data-ttu-id="c345f-179">Für jeden unter Vorgang wird eine Spanne mit eigenem Bezeichner und Ablauf Verfolgungs Bezeichner erstellt.</span><span class="sxs-lookup"><span data-stu-id="c345f-179">For each sub-operation, a span is created with its own identifier and trace identifier.</span></span> <span data-ttu-id="c345f-180">Wenn die Anforderung das System durchläuft, können verschiedene Komponenten untergeordnete *Spannen erstellen* , die den Bezeichner des über *geordneten* Elements enthalten.</span><span class="sxs-lookup"><span data-stu-id="c345f-180">As the request passes around the system, various components can create *child* spans that include the identifier of their *parent*.</span></span> <span data-ttu-id="c345f-181">Eine Spanne verfügt über einen *Kontext*, der die Ablaufverfolgungs-und Span-IDs sowie nützliche Daten in Form von Schlüssel-Wert-Paaren (als *Gepäck* bezeichnet) enthält.</span><span class="sxs-lookup"><span data-stu-id="c345f-181">A span has a *context*, which contains the trace and span identifiers, as well as useful data in the form of key and value pairs (called *baggage*).</span></span>

### <a name="distributed-tracing-with-diagnosticsource"></a><span data-ttu-id="c345f-182">Verteilte Ablauf Verfolgung mit `DiagnosticSource`</span><span class="sxs-lookup"><span data-stu-id="c345f-182">Distributed tracing with `DiagnosticSource`</span></span>

<span data-ttu-id="c345f-183">.Net verfügt über ein internes Modul, das sich gut für verteilte Ablauf Verfolgungen und spannen erstreckt: [diagnosticsource](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#diagnosticsource-users-guide).</span><span class="sxs-lookup"><span data-stu-id="c345f-183">.NET has an internal module that maps well to distributed traces and spans: [DiagnosticSource](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#diagnosticsource-users-guide).</span></span> <span data-ttu-id="c345f-184">Das `DiagnosticSource` Modul verfügt über das Konzept einer *Aktivität* und bietet eine einfache Möglichkeit, die Diagnose in einem Prozess zu erzeugen und zu nutzen.</span><span class="sxs-lookup"><span data-stu-id="c345f-184">As well as providing a simple way to produce and consume diagnostics within a process, the `DiagnosticSource` module has the concept of an *activity*.</span></span> <span data-ttu-id="c345f-185">Bei einer Aktivität handelt es sich tatsächlich um eine Implementierung einer verteilten Ablauf Verfolgung oder um eine Spanne innerhalb einer Ablauf Verfolgung.</span><span class="sxs-lookup"><span data-stu-id="c345f-185">An activity is effectively an implementation of a distributed trace, or a span within a trace.</span></span> <span data-ttu-id="c345f-186">Die internale des Moduls kümmern sich um über-und untergeordnete Aktivitäten, einschließlich der Zuordnung von bezeichtern.</span><span class="sxs-lookup"><span data-stu-id="c345f-186">The internals of the module take care of parent/child activities, including allocating identifiers.</span></span> <span data-ttu-id="c345f-187">Weitere Informationen zur Verwendung des- `Activity` Typs finden Sie im [Benutzerhandbuch für Aktivitäten auf GitHub](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-user-guide).</span><span class="sxs-lookup"><span data-stu-id="c345f-187">For more information about using the `Activity` type, see the [Activity User Guide on GitHub](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-user-guide).</span></span>

<span data-ttu-id="c345f-188">Da `DiagnosticSource` ein Teil des Core-Frameworks und später ist, wird es von mehreren Kernkomponenten unterstützt.</span><span class="sxs-lookup"><span data-stu-id="c345f-188">Because `DiagnosticSource` is a part of the core framework and later, it's supported by several core components.</span></span> <span data-ttu-id="c345f-189">Hierzu gehören <xref:System.Net.Http.HttpClient> , Entity Framework Core und ASP.net Core, einschließlich expliziter Unterstützung im GrpC-Framework.</span><span class="sxs-lookup"><span data-stu-id="c345f-189">These include <xref:System.Net.Http.HttpClient>, Entity Framework Core, and ASP.NET Core, including explicit support in the gRPC framework.</span></span> <span data-ttu-id="c345f-190">Wenn ASP.net Core eine Anforderung empfängt, überprüft er, ob ein paar von HTTP-Headern mit dem W3C-Ablauf [Verfolgungs Kontext](https://www.w3.org/TR/trace-context) Standard übereinstimmt.</span><span class="sxs-lookup"><span data-stu-id="c345f-190">When ASP.NET Core receives a request, it checks for a pair of HTTP headers matching the [W3C Trace Context](https://www.w3.org/TR/trace-context) standard.</span></span> <span data-ttu-id="c345f-191">Wenn die Header gefunden werden, wird eine Aktivität mithilfe der Identitäts Werte und des Kontexts aus den Headern gestartet.</span><span class="sxs-lookup"><span data-stu-id="c345f-191">If the headers are found, an activity is started by using the identity values and context from the headers.</span></span> <span data-ttu-id="c345f-192">Wenn keine Header gefunden werden, wird eine Aktivität mit generierten Identitäts Werten gestartet, die dem Standardformat entsprechen.</span><span class="sxs-lookup"><span data-stu-id="c345f-192">If no headers are found, an activity is started with generated identity values that match the standard format.</span></span> <span data-ttu-id="c345f-193">Alle Diagnosen, die während der Lebensdauer dieser Aktivität vom Framework oder Anwendungscode generiert werden, können mit der Ablauf Verfolgung und den spannen Bezeichner gekennzeichnet werden.</span><span class="sxs-lookup"><span data-stu-id="c345f-193">Any diagnostics generated by the framework or by application code during the lifetime of this activity can be tagged with the trace and span identifiers.</span></span> <span data-ttu-id="c345f-194">`HttpClient`Diese Funktionalität wird durch die Unterstützung erweitert, indem bei jeder Anforderung eine aktuelle Aktivität überprüft und der ausgehenden Anforderung automatisch die Ablauf Verfolgungs Header hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="c345f-194">The `HttpClient` support extends this functionality further by checking for a current activity on every request, and automatically adding the trace headers to the outgoing request.</span></span>

<span data-ttu-id="c345f-195">Die ASP.net Core GrpC-Client und-Server Bibliotheken umfassen explizite Unterstützung für `DiagnosticSource` und `Activity` und erstellen Aktivitäten und übernehmen und verwenden Header Informationen automatisch.</span><span class="sxs-lookup"><span data-stu-id="c345f-195">The ASP.NET Core gRPC client and server libraries include explicit support for `DiagnosticSource` and `Activity`, and create activities and apply and use header information automatically.</span></span>

> [!NOTE]
> <span data-ttu-id="c345f-196">All dies geschieht nur, wenn ein Listener die Diagnoseinformationen nutzt.</span><span class="sxs-lookup"><span data-stu-id="c345f-196">All of this happens only if a listener is consuming the diagnostic information.</span></span> <span data-ttu-id="c345f-197">Wenn kein Listener vorhanden ist, werden keine Diagnosen geschrieben, und es werden keine Aktivitäten erstellt.</span><span class="sxs-lookup"><span data-stu-id="c345f-197">If there's no listener, no diagnostics are written and no activities are created.</span></span>

### <a name="add-your-own-diagnosticsource-and-activity"></a><span data-ttu-id="c345f-198">Fügen Sie eigene `DiagnosticSource` und `Activity`</span><span class="sxs-lookup"><span data-stu-id="c345f-198">Add your own `DiagnosticSource` and `Activity`</span></span>

<span data-ttu-id="c345f-199">Informationen zum Hinzufügen Ihrer eigenen Diagnose oder zum Erstellen von expliziten Spannen innerhalb des Anwendungs Codes finden Sie im Benutzerhandbuch zu [diagnosticsource](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#instrumenting-with-diagnosticsourcediagnosticlistener) und [Aktivitäts Benutzerhandbuch](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-usage).</span><span class="sxs-lookup"><span data-stu-id="c345f-199">To add your own diagnostics or create explicit spans within your application code, see the [DiagnosticSource User Guide](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#instrumenting-with-diagnosticsourcediagnosticlistener) and [Activity User Guide](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-usage).</span></span>

### <a name="store-distributed-trace-data"></a><span data-ttu-id="c345f-200">Speichern verteilter Ablauf Verfolgungs Daten</span><span class="sxs-lookup"><span data-stu-id="c345f-200">Store distributed trace data</span></span>

<span data-ttu-id="c345f-201">Zum Zeitpunkt des Schreibens ist das opentelemetry-Projekt noch in den frühen Phasen, und für .NET-Anwendungen sind nur Alpha-Qualitäts Pakete verfügbar.</span><span class="sxs-lookup"><span data-stu-id="c345f-201">At the time of writing, the OpenTelemetry project is still in the early stages, and only alpha-quality packages are available for .NET applications.</span></span> <span data-ttu-id="c345f-202">Das opentracing-Projekt bietet zurzeit ausgereifte Bibliotheken.</span><span class="sxs-lookup"><span data-stu-id="c345f-202">The OpenTracing project currently offers more mature libraries.</span></span>

<span data-ttu-id="c345f-203">Die opentrace-API wird im folgenden Abschnitt beschrieben.</span><span class="sxs-lookup"><span data-stu-id="c345f-203">The OpenTracing API is described in the following section.</span></span> <span data-ttu-id="c345f-204">Wenn Sie stattdessen die opentelemetry-API in Ihrer Anwendung verwenden möchten, finden Sie weitere Informationen im [opentelemetry .NET SDK-Repository](https://github.com/open-telemetry/opentelemetry-dotnet) auf GitHub.</span><span class="sxs-lookup"><span data-stu-id="c345f-204">If you want to use the OpenTelemetry API in your application instead, refer to the [OpenTelemetry .NET SDK repository](https://github.com/open-telemetry/opentelemetry-dotnet) on GitHub.</span></span>

#### <a name="use-the-opentracing-package-to-store-distributed-trace-data"></a><span data-ttu-id="c345f-205">Verwenden des opentracing-Pakets zum Speichern verteilter Ablauf Verfolgungs Daten</span><span class="sxs-lookup"><span data-stu-id="c345f-205">Use the OpenTracing package to store distributed trace data</span></span>

<span data-ttu-id="c345f-206">Das [opentrace-nuget-Paket](https://www.nuget.org/packages/OpenTracing/) unterstützt alle opentrace-kompatiblen Back-Ends (die unabhängig von verwendet werden können `DiagnosticSource` ).</span><span class="sxs-lookup"><span data-stu-id="c345f-206">The [OpenTracing NuGet package](https://www.nuget.org/packages/OpenTracing/) supports all OpenTracing-compliant back ends (which can be used independently of `DiagnosticSource`).</span></span> <span data-ttu-id="c345f-207">Es gibt ein zusätzliches Paket aus dem opentrace-API-Beitrags Projekt, [opentracing. contrib. Netcore](https://www.nuget.org/packages/OpenTracing.Contrib.NetCore/).</span><span class="sxs-lookup"><span data-stu-id="c345f-207">There's an additional package from the OpenTracing API Contributions project, [OpenTracing.Contrib.NetCore](https://www.nuget.org/packages/OpenTracing.Contrib.NetCore/).</span></span> <span data-ttu-id="c345f-208">Mit diesem Paket wird ein Listener hinzugefügt `DiagnosticSource` und Ereignisse und Aktivitäten automatisch in ein Back-End geschrieben.</span><span class="sxs-lookup"><span data-stu-id="c345f-208">This package adds a `DiagnosticSource` listener, and writes events and activities to a back end automatically.</span></span> <span data-ttu-id="c345f-209">Das Aktivieren dieses Pakets ist so einfach wie das Installieren von nuget und das Hinzufügen als Dienst in Ihrer `Startup` Klasse.</span><span class="sxs-lookup"><span data-stu-id="c345f-209">Enabling this package is as simple as installing it from NuGet and adding it as a service in your `Startup` class.</span></span>

```csharp
public class Startup
{
    public void ConfigureServices(IServiceCollection services)
    {
        services.AddOpenTracing();
    }
}
```

<span data-ttu-id="c345f-210">Das opentracing-Paket ist eine Abstraktionsschicht und erfordert daher eine spezifische Implementierung für das Back-End.</span><span class="sxs-lookup"><span data-stu-id="c345f-210">The OpenTracing package is an abstraction layer, and as such it requires implementation specific to the back end.</span></span> <span data-ttu-id="c345f-211">Opentrace-API-Implementierungen sind für die folgenden Open Source-Back-Ends verfügbar.</span><span class="sxs-lookup"><span data-stu-id="c345f-211">OpenTracing API implementations are available for the following open source back ends.</span></span>

| <span data-ttu-id="c345f-212">Name</span><span class="sxs-lookup"><span data-stu-id="c345f-212">Name</span></span> | <span data-ttu-id="c345f-213">Paket</span><span class="sxs-lookup"><span data-stu-id="c345f-213">Package</span></span> | <span data-ttu-id="c345f-214">Website</span><span class="sxs-lookup"><span data-stu-id="c345f-214">Website</span></span> |
| ---- | ------- | -------- |
| <span data-ttu-id="c345f-215">Jaeger</span><span class="sxs-lookup"><span data-stu-id="c345f-215">Jaeger</span></span> | [<span data-ttu-id="c345f-216">Jaeger</span><span class="sxs-lookup"><span data-stu-id="c345f-216">Jaeger</span></span>](https://www.nuget.org/packages/Jaeger/) | [<span data-ttu-id="c345f-217">jaegertracing.io</span><span class="sxs-lookup"><span data-stu-id="c345f-217">jaegertracing.io</span></span>](https://jaegertracing.io) |
| <span data-ttu-id="c345f-218">Elastisches apm</span><span class="sxs-lookup"><span data-stu-id="c345f-218">Elastic APM</span></span> | [<span data-ttu-id="c345f-219">Elastisches apm. netcoreall</span><span class="sxs-lookup"><span data-stu-id="c345f-219">Elastic.Apm.NetCoreAll</span></span>](https://www.nuget.org/packages/Elastic.Apm.NetCoreAll/) | [<span data-ttu-id="c345f-220">elastic.co/products/apm</span><span class="sxs-lookup"><span data-stu-id="c345f-220">elastic.co/products/apm</span></span>](https://www.elastic.co/products/apm) |

<span data-ttu-id="c345f-221">Weitere Informationen zur opentrace-API für .net finden Sie unter [opentracing für c#](https://github.com/opentracing/opentracing-csharp) und [opentrace contrib c#/.net kernrepository](https://github.com/opentracing-contrib/csharp-netcore) auf GitHub.</span><span class="sxs-lookup"><span data-stu-id="c345f-221">For more information on the OpenTracing API for .NET, see the [OpenTracing for C#](https://github.com/opentracing/opentracing-csharp) and the [OpenTracing Contrib C#/.NET Core](https://github.com/opentracing-contrib/csharp-netcore) repositories on GitHub.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="c345f-222">[Zurück](load-balancing.md)
>[Weiter](appendix.md)</span><span class="sxs-lookup"><span data-stu-id="c345f-222">[Previous](load-balancing.md)
[Next](appendix.md)</span></span>
