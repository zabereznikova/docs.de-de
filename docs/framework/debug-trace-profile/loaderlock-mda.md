---
title: loaderLock-MDA
description: Überprüfen Sie den loaderLock-MDA (Managed Debugging Assistant) in .net, der versucht, verwalteten Code in einem Thread auszuführen, der die Windows-Betriebssystem Lade Sperre enthält.
ms.date: 03/30/2017
helpviewer_keywords:
- deadlocks [.NET Framework]
- LoaderLock MDA
- MDAs (managed debugging assistants), loader locks
- managed debugging assistants (MDAs), loader locks
- operating system loader locks
- loader locks
- locks, threads
ms.assetid: 8c10fa02-1b9c-4be5-ab03-451d943ac1ee
ms.openlocfilehash: 055b07a805c5f0b613519d6019950a9b249a4b38
ms.sourcegitcommit: 0edbeb66d71b8df10fcb374cfca4d731b58ccdb2
ms.contentlocale: de-DE
ms.lasthandoff: 07/07/2020
ms.locfileid: "86051621"
---
# <a name="loaderlock-mda"></a><span data-ttu-id="eb659-103">loaderLock-MDA</span><span class="sxs-lookup"><span data-stu-id="eb659-103">loaderLock MDA</span></span>
<span data-ttu-id="eb659-104">Der `loaderLock`-MDA (Assistent für verwaltetes Debuggen) erkennt Versuche zur Ausführung von verwaltetem Code in einem Thread, der die Loadersperre für das Microsoft Windows-Betriebssystem enthält.</span><span class="sxs-lookup"><span data-stu-id="eb659-104">The `loaderLock` managed debugging assistant (MDA) detects attempts to execute managed code on a thread that holds the Microsoft Windows operating system loader lock.</span></span>  <span data-ttu-id="eb659-105">Eine solche Ausführung ist ungültig, da sie zu Deadlocks führen und DLLs verwenden kann, bevor sie vom Ladeprogramm des Betriebssystems initialisiert wird.</span><span class="sxs-lookup"><span data-stu-id="eb659-105">Any such execution is illegal because it can lead to deadlocks and to use of DLLs before they have been initialized by the operating system's loader.</span></span>  
  
## <a name="symptoms"></a><span data-ttu-id="eb659-106">Symptome</span><span class="sxs-lookup"><span data-stu-id="eb659-106">Symptoms</span></span>  
 <span data-ttu-id="eb659-107">Der häufigste Fehler beim Ausführen von Code innerhalb der Loadersperre des Betriebssystems ist, dass Threads beim Versuch, andere Win32-Funktionen aufzurufen, die ebenfalls die Loadersperre erfordern, einen Deadlock auslösen.</span><span class="sxs-lookup"><span data-stu-id="eb659-107">The most common failure when executing code inside the operating system's loader lock is that threads will deadlock when attempting to call other Win32 functions that also require the loader lock.</span></span>  <span data-ttu-id="eb659-108">Beispiele für solche Funktionen sind `LoadLibrary`, `GetProcAddress`, `FreeLibrary` und `GetModuleHandle`.</span><span class="sxs-lookup"><span data-stu-id="eb659-108">Examples of such functions are `LoadLibrary`, `GetProcAddress`, `FreeLibrary`, and `GetModuleHandle`.</span></span>  <span data-ttu-id="eb659-109">Die Anwendung ruft diese Funktionen möglicherweise nicht direkt auf. Die Common Language Runtime (CLR) ruft diese Funktionen möglicherweise als Ergebnis eines Aufrufs der höheren Ebene wie <xref:System.Reflection.Assembly.Load%2A> oder als ersten Aufruf an eine Plattformaufrufmethode auf.</span><span class="sxs-lookup"><span data-stu-id="eb659-109">The application might not directly call these functions; the common language runtime (CLR) might call these functions as the result of a higher level call like <xref:System.Reflection.Assembly.Load%2A> or the first call to a platform invoke method.</span></span>  
  
 <span data-ttu-id="eb659-110">Deadlocks können auch auftreten, wenn ein Thread wartet, dass ein anderer Thread startet oder endet.</span><span class="sxs-lookup"><span data-stu-id="eb659-110">Deadlocks can also occur if a thread is waiting for another thread to start or finish.</span></span>  <span data-ttu-id="eb659-111">Wenn ein Thread gestartet oder abgeschlossen wurde, muss die Loadersperre des Betriebssystems Ereignisse an betroffene DLLs übertragen.</span><span class="sxs-lookup"><span data-stu-id="eb659-111">When a thread starts or finishes executing, it must acquire the operating system's loader lock to deliver events to affected DLLs.</span></span>  
  
 <span data-ttu-id="eb659-112">Schließlich gibt es Fälle, in denen Aufrufe in DLLs auftreten können, bevor diese DLLs ordnungsgemäß vom Ladeprogramm des Betriebssystems initialisiert wurden.</span><span class="sxs-lookup"><span data-stu-id="eb659-112">Finally, there are cases where calls into DLLs can occur before those DLLs have been properly initialized by the operating system's loader.</span></span>  <span data-ttu-id="eb659-113">Im Gegensatz zu den Deadlock-Fehlern, die durch Untersuchen der Stapel aller am Deadlock beteiligten Threads diagnostiziert werden können, ist es sehr schwierig, die Verwendung von nicht initialisierten DLLs ohne diesen MDA zu diagnostizieren.</span><span class="sxs-lookup"><span data-stu-id="eb659-113">Unlike the deadlock failures, which can be diagnosed by examining the stacks of all the threads involved in the deadlock, it is very difficult to diagnose the use of uninitialized DLLs without using this MDA.</span></span>  
  
## <a name="cause"></a><span data-ttu-id="eb659-114">Ursache</span><span class="sxs-lookup"><span data-stu-id="eb659-114">Cause</span></span>  
 <span data-ttu-id="eb659-115">Eine Mischung aus verwalteten und nicht verwalteten C++-Assemblys für die .NET Framework-Versionen 1.0 oder 1.1 versucht in der Regel, verwalteten Code innerhalb der Loadersperre auszuführen, es sei denn, es wurde besondere Sorgfalt angewendet und z.B. eine Verknüpfung mit **/NOENTRY** erstellt.</span><span class="sxs-lookup"><span data-stu-id="eb659-115">Mixed managed/unmanaged C++ assemblies built for .NET Framework versions 1.0 or 1.1 generally attempt to execute managed code inside the loader lock unless special care has been taken, for example, linking with **/NOENTRY**.</span></span>
  
 <span data-ttu-id="eb659-116">Eine Mischung aus verwalteten und nicht verwalteten C++-Assemblys für die .NET Framework-Versionen 2.0 ist weniger anfällig für diese Probleme und hat dasselbe verringerte Risiko wie Anwendungen, die nicht verwaltete DLLs verwenden, die gegen die Regeln des Betriebssystems verstoßen.</span><span class="sxs-lookup"><span data-stu-id="eb659-116">Mixed managed/unmanaged C++ assemblies built for .NET Framework version 2.0 are less susceptible to these problems, having the same reduced risk as applications using unmanaged DLLs that violate the operating system's rules.</span></span>  <span data-ttu-id="eb659-117">Wenn beispielsweise der `DllMain`-Einstiegspunkt einer nicht verwalteten DLL `CoCreateInstance` aufruft, um ein verwaltetes Objekt zu erhalten, das für COM verfügbar gemacht wurde, erhält man einen Versuch, verwalteten Code innerhalb der Loadersperre auszuführen.</span><span class="sxs-lookup"><span data-stu-id="eb659-117">For example, if an unmanaged DLL's `DllMain` entry point calls `CoCreateInstance` to obtain a managed object that has been exposed to COM, the result is an attempt to execute managed code inside the loader lock.</span></span> <span data-ttu-id="eb659-118">Weitere Informationen zu Problemen mit Loadersperren in .NET Framework Version 2.0 oder höher finden Sie unter [Initialization of Mixed Assemblies (Initialisierung gemischter Assemblys)](/cpp/dotnet/initialization-of-mixed-assemblies).</span><span class="sxs-lookup"><span data-stu-id="eb659-118">For more information about loader lock issues in the .NET Framework version 2.0 and later, see [Initialization of Mixed Assemblies](/cpp/dotnet/initialization-of-mixed-assemblies).</span></span>  
  
## <a name="resolution"></a><span data-ttu-id="eb659-119">Lösung</span><span class="sxs-lookup"><span data-stu-id="eb659-119">Resolution</span></span>  
 <span data-ttu-id="eb659-120">In Visual C++ .NET 2002 und Visual C++ .NET 2003 konnten mit der Compileroption `/clr` kompilierte DLLs beim Laden nicht deterministische Deadlocks laden. Dies wurde als Problem beim Laden gemischter DLLs bzw. Loadersperrenproblem bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="eb659-120">In Visual C++ .NET 2002 and Visual C++ .NET 2003, DLLs compiled with the `/clr` compiler option could non-deterministically deadlock when loaded; this issue was called the mixed DLL loading or loader lock issue.</span></span> <span data-ttu-id="eb659-121">In Visual C++ 2005 und höher wurde fast der gesamte Nichtdeterminismus aus dem Prozess des Ladens gemischter DLLs entfernt.</span><span class="sxs-lookup"><span data-stu-id="eb659-121">In Visual C++ 2005 and later, almost all non-determinism has been removed from the mixed DLL loading process.</span></span> <span data-ttu-id="eb659-122">Es verbleiben jedoch weiterhin ein paar Szenarien, bei denen die Loadersperre (deterministisch) auftreten kann.</span><span class="sxs-lookup"><span data-stu-id="eb659-122">However, there are a few remaining scenarios for which loader lock can (deterministically) occur.</span></span> <span data-ttu-id="eb659-123">Eine ausführliche Beschreibung der Ursachen und Lösungen für die verbleibenden Loadersperrenprobleme finden Sie unter [Initialization of Mixed Assemblies (Initialisierung gemischter Assemblys)](/cpp/dotnet/initialization-of-mixed-assemblies).</span><span class="sxs-lookup"><span data-stu-id="eb659-123">For a detailed account of the causes and resolutions for the remaining loader lock issues, see [Initialization of Mixed Assemblies](/cpp/dotnet/initialization-of-mixed-assemblies).</span></span> <span data-ttu-id="eb659-124">Wenn dieses Thema Ihr Loadersperrenproblem nicht abdeckt, dann überprüfen Sie die Threadstapel, um zu bestimmen, warum die Loadersperre geschieht und wie Sie das Problem beheben können.</span><span class="sxs-lookup"><span data-stu-id="eb659-124">If that topic does not identify your loader lock problem, you have to examine the thread's stack to determine why the loader lock is occurring and how to correct the problem.</span></span> <span data-ttu-id="eb659-125">Überprüfen Sie die Stapelüberwachung für den Thread, der diesen MDA aktiviert hat.</span><span class="sxs-lookup"><span data-stu-id="eb659-125">Look at the stack trace for the thread that has activated this MDA.</span></span>  <span data-ttu-id="eb659-126">Der Thread versucht, verwalteten Code auf illegale Weise aufzurufen, während die Loadersperre des Betriebssystems gehalten wird.</span><span class="sxs-lookup"><span data-stu-id="eb659-126">The thread is attempting to illegally call into managed code while holding the operating system's loader lock.</span></span>  <span data-ttu-id="eb659-127">Sie werden wahrscheinlich ein `DllMain` einer DLL oder den entsprechenden Einstiegspunkt auf dem Stapel sehen.</span><span class="sxs-lookup"><span data-stu-id="eb659-127">You will probably see a DLL's `DllMain` or equivalent entry point on the stack.</span></span>  <span data-ttu-id="eb659-128">Die Regeln des Betriebssystems für innerhalb dieses Einstiegspunkts legale Verwendungsmöglichkeiten sind recht eingeschränkt.</span><span class="sxs-lookup"><span data-stu-id="eb659-128">The operating system's rules for what you can legally do from inside such an entry point are quite limited.</span></span>  <span data-ttu-id="eb659-129">Diese Regeln schließen eine nicht verwaltete Ausführung aus.</span><span class="sxs-lookup"><span data-stu-id="eb659-129">These rules preclude any managed execution.</span></span>  
  
## <a name="effect-on-the-runtime"></a><span data-ttu-id="eb659-130">Auswirkungen auf die Laufzeit</span><span class="sxs-lookup"><span data-stu-id="eb659-130">Effect on the Runtime</span></span>  
 <span data-ttu-id="eb659-131">In der Regel wird für mehrere Threads innerhalb des Prozesses ein Deadlock auftreten.</span><span class="sxs-lookup"><span data-stu-id="eb659-131">Typically, several threads inside the process will deadlock.</span></span>  <span data-ttu-id="eb659-132">Einer dieser Threads ist wahrscheinlich der Thread, der für die Ausführung einer Garbage Collection verantwortlich ist, sodass dieser Deadlock erhebliche Auswirkungen auf den gesamten Prozess haben kann.</span><span class="sxs-lookup"><span data-stu-id="eb659-132">One of those threads is likely to be a thread responsible for performing a garbage collection, so this deadlock can have a major impact on the entire process.</span></span>  <span data-ttu-id="eb659-133">Darüber hinaus werden weitere Vorgänge verhindert, die die Loadersperre des Betriebssystems erfordern, wie das Laden und Entladen von Assemblys oder DLLs und das Starten oder Beenden von Threads.</span><span class="sxs-lookup"><span data-stu-id="eb659-133">Furthermore, it will prevent any additional operations that require the operating system's loader lock, like loading and unloading assemblies or DLLs and starting or stopping threads.</span></span>  
  
 <span data-ttu-id="eb659-134">In einigen seltenen Fällen ist es auch möglich, dass Zugriffsverletzungen oder ähnlichen Probleme in DLLs ausgelöst werden, die vor ihrer Initialisierung aufgerufen wurden.</span><span class="sxs-lookup"><span data-stu-id="eb659-134">In some unusual cases, it is also possible for access violations or similar problems to be triggered in DLLs which are called before they have been initialized.</span></span>  
  
## <a name="output"></a><span data-ttu-id="eb659-135">Ausgabe</span><span class="sxs-lookup"><span data-stu-id="eb659-135">Output</span></span>  
 <span data-ttu-id="eb659-136">Dieser MDA meldet, dass eine ungültige verwaltete Ausführung versucht wird.</span><span class="sxs-lookup"><span data-stu-id="eb659-136">This MDA reports that an illegal managed execution is being attempted.</span></span>  <span data-ttu-id="eb659-137">Überprüfen Sie die Threadstapel, um zu bestimmen, warum die Loadersperre geschieht und wie Sie das Problem beheben können.</span><span class="sxs-lookup"><span data-stu-id="eb659-137">You need to examine the thread's stack to determine why the loader lock is occurring and how to correct the problem.</span></span>  
  
## <a name="configuration"></a><span data-ttu-id="eb659-138">Konfiguration</span><span class="sxs-lookup"><span data-stu-id="eb659-138">Configuration</span></span>  
  
```xml  
<mdaConfig>  
  <assistants>  
    <loaderLock/>  
  </assistants>  
</mdaConfig>  
```  
  
## <a name="see-also"></a><span data-ttu-id="eb659-139">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="eb659-139">See also</span></span>

- [<span data-ttu-id="eb659-140">Diagnostizieren von Fehlern mit Assistenten für verwaltetes Debuggen</span><span class="sxs-lookup"><span data-stu-id="eb659-140">Diagnosing Errors with Managed Debugging Assistants</span></span>](diagnosing-errors-with-managed-debugging-assistants.md)
