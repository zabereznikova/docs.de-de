---
title: Änderungen an der NTLM-Authentifizierung für „HttpWebRequest“ in Version 3.5 SP1
ms.date: 03/30/2017
ms.assetid: 8bf0b428-5a21-4299-8d6e-bf8251fd978a
ms.openlocfilehash: 388e6dc648e1fd68e24a852cb08de107f09f9c9f
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 03/15/2020
ms.locfileid: "64754877"
---
# <a name="changes-to-ntlm-authentication-for-httpwebrequest-in-version-35-sp1"></a><span data-ttu-id="1ffa4-102">Änderungen an der NTLM-Authentifizierung für „HttpWebRequest“ in Version 3.5 SP1</span><span class="sxs-lookup"><span data-stu-id="1ffa4-102">Changes to NTLM authentication for HttpWebRequest in Version 3.5 SP1</span></span>

<span data-ttu-id="1ffa4-103">Es wurden Sicherheitsänderungen in .NET Framework Version 3.5 SP1 und höher vorgenommen, die beeinflussen, wie die integrierte Windows-Authentifizierung durch <xref:System.Net.HttpWebRequest>, <xref:System.Net.HttpListener>, <xref:System.Net.Security.NegotiateStream> und verwandte Klassen im System.Net-Namespace behandelt wird.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-103">Security changes were made in .NET Framework version 3.5 SP1 and later that affect how integrated Windows authentication is handled by the <xref:System.Net.HttpWebRequest>, <xref:System.Net.HttpListener>, <xref:System.Net.Security.NegotiateStream>, and related classes in the System.Net namespace.</span></span> <span data-ttu-id="1ffa4-104">Diese Änderungen können sich auf Anwendungen auswirken, die diese Klassen für Webanforderungen und den Empfang der Antworten verwenden, in denen die integrierte Windows-Authentifizierung auf NTLM-Basis verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-104">These changes can affect applications that use these classes to make web requests and receive responses where integrated Windows authentication based on NTLM is used.</span></span> <span data-ttu-id="1ffa4-105">Die Änderung kann sich auf Webserver und Clientanwendungen auswirken, die für die Verwendung der integrierten Windows-Authentifizierung konfiguriert sind.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-105">This change can impact web servers and client applications that are configured to use integrated Windows authentication.</span></span>

## <a name="overview"></a><span data-ttu-id="1ffa4-106">Übersicht</span><span class="sxs-lookup"><span data-stu-id="1ffa4-106">Overview</span></span>

<span data-ttu-id="1ffa4-107">Durch die Gestaltung der integrierten Windows-Authentifizierung sind einige Abfragerückmeldungen zu Anmeldeinformationen universell, d.h., sie können wiederverwendet oder weitergeleitet werden.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-107">The design of integrated Windows authentication allows for some credential responses to be universal, meaning they can be re-used or forwarded.</span></span> <span data-ttu-id="1ffa4-108">Wenn diese bestimmte Entwurfsfunktion nicht erforderlich ist, müssen die Authentifizierungsprotokolle zielspezifische Informationen sowie bestimmte Kanalinformationen enthalten.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-108">If this particular design feature is not needed, then the authentication protocols should carry target specific information as well as channel specific information.</span></span> <span data-ttu-id="1ffa4-109">Der erweiterte Schutz kann dann von Diensten bereitgestellt werden, damit Abfragerückmeldungen zu Anmeldeinformationen auch sicher dienstspezifische Informationen, wie z.B. einen Dienstprinzipalnamen (SPN), enthalten.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-109">Services can then provide extended protection to ensure that credential responses contain service specific information such as a Service Principal Name (SPN).</span></span> <span data-ttu-id="1ffa4-110">Enthält der Austausch von Anmeldedaten diese Informationen, können die Dienste besser vor einer böswilligen Verwendung von Abfragerückmeldungen geschützt werden, die möglicherweise nicht ordnungsgemäß verwendet wurden.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-110">With this information in the credential exchanges, services are able to better protect against malicious use of credential responses that might have been improperly obtained.</span></span>

<span data-ttu-id="1ffa4-111">Mehrere Komponenten der Namespaces <xref:System.Net> und <xref:System.Net.Security> führen die integrierte Windows-Authentifizierung für eine aufrufende Anwendung aus.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-111">Multiple components in the <xref:System.Net> and <xref:System.Net.Security> namespaces perform integrated Windows authentication on behalf of a calling application.</span></span> <span data-ttu-id="1ffa4-112">In diesem Abschnitt werden die erforderlichen Änderungen an System.Net-Komponenten beschrieben, um den erweiterten Schutz ihrer Verwendung der integrierten Windows-Authentifizierung hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-112">This section describes changes to System.Net components to add extended protection in their use of integrated Windows authentication.</span></span>

## <a name="changes"></a><span data-ttu-id="1ffa4-113">Änderungen</span><span class="sxs-lookup"><span data-stu-id="1ffa4-113">Changes</span></span>

<span data-ttu-id="1ffa4-114">Der bei der integrierten Windows-Authentifizierung verwendete NTLM-Authentifizierungsvorgang enthält eine Abfrage, die vom Zielcomputer ausgegeben und an den Clientcomputer zurückgesendet wird.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-114">The NTLM authentication process used with integrated Windows authentication includes a challenge issued by the destination computer and sent back to the client computer.</span></span> <span data-ttu-id="1ffa4-115">Wenn ein Computer eine Abfrage erhält, die er selbst generiert hat, schlägt die Authentifizierung fehl, es sei denn, es handelt sich um eine Schleife (z.B. IPv4-Adresse 127.0.0.1).</span><span class="sxs-lookup"><span data-stu-id="1ffa4-115">When a computer receives a challenge it generated itself, the authentication will fail unless the connection is a loop back connection (IPv4 address 127.0.0.1, for example).</span></span>

<span data-ttu-id="1ffa4-116">Beim Zugriff auf einen Dienst, der auf einem internen Webserver ausgeführt wird, ist es üblich, mithilfe einer URL ähnlich wie `http://contoso/service` oder `https://contoso/service` auf den Dienst zuzugreifen.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-116">When accessing a service running on an internal Web server, it is common to access the service using a URL similar to `http://contoso/service` or `https://contoso/service`.</span></span> <span data-ttu-id="1ffa4-117">Der Name „Contoso“ ist häufig nicht der Computername des Computers, auf dem der Dienst bereitgestellt wird.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-117">The name "contoso" is often not the computer name of the computer on which the service is deployed.</span></span> <span data-ttu-id="1ffa4-118">Die <xref:System.Net> und zugehörigen Namespaces unterstützen, mithilfe von Active Directory, DNS, NetBIOS, die Hostdatei des lokalen Computers (in der Regel beispielsweise WINDOWS\system32\drivers\etc\hosts) oder die die LmHostdatei des lokalen Computers (in der Regel beispielsweise WINDOWS\system32\drivers\etc\lmhosts) zum Auflösen von Namen zu Adressen.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-118">The <xref:System.Net> and related namespaces support using Active Directory, DNS, NetBIOS, the local computer's hosts file (typically WINDOWS\system32\drivers\etc\hosts, for example), or the local computer's lmhosts file (typically WINDOWS\system32\drivers\etc\lmhosts, for example) to resolve names to addresses.</span></span> <span data-ttu-id="1ffa4-119">Der Name „Contoso“ wird aufgelöst, sodass an „Contoso“ gesendete Anforderungen an den entsprechenden Servercomputer gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-119">The name "contoso" is resolved so that requests sent to "contoso" are sent to the appropriate server computer.</span></span>

<span data-ttu-id="1ffa4-120">Bei der Konfiguration für große Bereitstellungen erhält die Bereitstellung mit dem zugrunde liegenden Computernamen, die nie von Clientanwendungen und Endbenutzern verwendet werden, in der Regel einen einzelnen virtuellen Servernamen.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-120">When configured for large deployments, it is also common for a single virtual server name to be given to the deployment with the underlying machine names never used by client applications and end users.</span></span> <span data-ttu-id="1ffa4-121">Sie können den Server z.B. `www.contoso.com` nennen, jedoch in einem internen Netzwerk einfach „Contoso“ verwenden.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-121">For example, you might call the server `www.contoso.com`, but on an internal network simply use "contoso".</span></span> <span data-ttu-id="1ffa4-122">Dieser Name ist der Hostheader in der Clientwebanforderung.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-122">This name is called the Host header in the client web request.</span></span> <span data-ttu-id="1ffa4-123">Das Feld „Host-Anforderungsheader“ gibt gemäß dem HTTP-Protokoll den Internet-Host und die Portanzahl der angeforderten Ressource an.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-123">As specified by the HTTP protocol, the Host request-header field specifies the Internet host and port number of the resource being requested.</span></span> <span data-ttu-id="1ffa4-124">Diese Information wird aus dem ursprünglichen URI abgerufen, der vom Benutzer oder der Referenzressource (in der Regel eine HTTP-URL) angegeben wird.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-124">This information is obtained from the original URI given by the user or referring resource (generally an HTTP URL).</span></span> <span data-ttu-id="1ffa4-125">Auf .NET Framework, Version 4, können diese Informationen auch vom Client mit der neuen <xref:System.Net.HttpWebRequest.Host%2A>-Eigenschaft festgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-125">On .NET Framework version 4, this information can also be set by the client using the new <xref:System.Net.HttpWebRequest.Host%2A> property.</span></span>

<span data-ttu-id="1ffa4-126">Die <xref:System.Net.AuthenticationManager>-Klasse steuert die verwalteten Authentifizierungskomponenten („Module“), die von abgeleiteten <xref:System.Net.WebRequest>-und den <xref:System.Net.WebClient>-Klassen verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-126">The <xref:System.Net.AuthenticationManager> class controls the managed authentication components ("modules") that are used by <xref:System.Net.WebRequest> derivative classes and the <xref:System.Net.WebClient> class.</span></span> <span data-ttu-id="1ffa4-127">Die <xref:System.Net.AuthenticationManager>-Klasse enthält eine Eigenschaft, die ein <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A?displayProperty=nameWithType>-Objekt verfügbar macht, das von einer URI-Zeichenfolge indiziert ist, damit Anwendungen eine benutzerdefinierte SPN-Zeichenfolge bereitstellen können, die während der Authentifizierung verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-127">The <xref:System.Net.AuthenticationManager> class provides a property that exposes a <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A?displayProperty=nameWithType> object, indexed by URI string, for applications to supply a custom SPN string to be used during authentication.</span></span>

<span data-ttu-id="1ffa4-128">Version 3.5 SP1 gibt jetzt standardmäßig den Hostnamen in der Anforderungs-URL in der SPN im NTLM-Authentifizierungsaustausch (NT LAN Manager) an, wenn die <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A>-Eigenschaft nicht festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-128">Version 3.5 SP1 now defaults to specifying the host name used in the request URL in the SPN in the NTLM (NT LAN Manager) authentication exchange when the <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A> property is not set.</span></span> <span data-ttu-id="1ffa4-129">Der Hostname in der Anforderungs-URL kann vom in <xref:System.Net.HttpRequestHeader?displayProperty=nameWithType> in der Clientanforderung angegebenen Hostheader abweichen.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-129">The host name used in the request URL may be different from the Host header specified in the <xref:System.Net.HttpRequestHeader?displayProperty=nameWithType> in the client request.</span></span> <span data-ttu-id="1ffa4-130">Der Hostname in der Anforderungs-URL kann vom tatsächlichen Hostnamen des Servers, dem Computernamen des Servers, der IP-Adresse des Computers oder der Loopbackadresse abweichen.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-130">The host name used in the request URL may be different from the actual host name of the server, the machine name of the server, the computer's IP address, or the loopback address.</span></span> <span data-ttu-id="1ffa4-131">In diesen Fällen schlägt die Authentifizierungsanforderung in Windows fehl.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-131">In these cases, Windows will fail the authentication request.</span></span> <span data-ttu-id="1ffa4-132">Um das Problem zu beheben, müssen wir Windows benachrichtigen, dass der Hostname in der Anforderungs-URL in der Client-Anforderung (z.B. „Contoso“) tatsächlich ein alternativer Name für den lokalen Computer ist.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-132">To address the issue, we need to notify Windows that the host name used in the request URL in the client request ("contoso", for example) is actually an alternate name for the local computer.</span></span>

<span data-ttu-id="1ffa4-133">Es gibt mehrere Methoden, mit denen eine Serveranwendung diese Änderung umgehen kann.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-133">There are several possible methods for a server application to work around this change.</span></span> <span data-ttu-id="1ffa4-134">Die empfohlene Vorgehensweise ist, den Hostnamen in der Anforderungs-URL zum `BackConnectionHostNames`-Schlüssel in der Registrierung auf dem Server zuzuordnen.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-134">The recommended approach is to map the host name used in the request URL to the `BackConnectionHostNames` key in the registry on the server.</span></span> <span data-ttu-id="1ffa4-135">Der `BackConnectionHostNames`-Registrierungsschlüssel wird normalerweise verwendet, um einen Hostnamen einer Loopbackadresse zuzuordnen.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-135">The `BackConnectionHostNames` registry key is normally used to map a host name to a loopback address.</span></span> <span data-ttu-id="1ffa4-136">Die Schritte sind unten aufgeführt.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-136">The steps are listed below.</span></span>

<span data-ttu-id="1ffa4-137">Um die Hostnamen anzugeben, die der Loopbackadresse zugeordnet sind, und die mit Websites auf einem lokalen Computer verbunden werden können, gehen Sie folgendermaßen vor:</span><span class="sxs-lookup"><span data-stu-id="1ffa4-137">To specify the host names that are mapped to the loopback address and can connect to Web sites on a local computer, follow these steps:</span></span>

1. <span data-ttu-id="1ffa4-138">Klicken Sie auf „Start“ und auf „Ausführen“, geben Sie „regedit“ ein, und klicken Sie anschließend auf „OK“.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-138">Click Start, click Run, type regedit, and then click OK.</span></span>

2. <span data-ttu-id="1ffa4-139">Suchen Sie im Registrierungs-Editor den folgenden Registrierungsschlüssel, und klicken Sie darauf:</span><span class="sxs-lookup"><span data-stu-id="1ffa4-139">In Registry Editor, locate and then click the following registry key:</span></span>

    `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\MSV1_0`

3. <span data-ttu-id="1ffa4-140">Klicken Sie mit der rechten Maustaste auf „MSV1_0“, zeigen Sie auf „Neu“, und klicken Sie dann auf „Mehrteilige Zeichenfolge“.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-140">Right-click MSV1_0, point to New, and then click Multi-String Value.</span></span>

4. <span data-ttu-id="1ffa4-141">Geben Sie `BackConnectionHostNames` ein, und drücken Sie dann die EINGABETASTE.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-141">Type `BackConnectionHostNames`, and then press ENTER.</span></span>

5. <span data-ttu-id="1ffa4-142">Klicken Sie mit der rechten Maustaste auf `BackConnectionHostNames`, und klicken Sie dann auf „Bearbeiten“.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-142">Right-click `BackConnectionHostNames`, and then click Modify.</span></span>

6. <span data-ttu-id="1ffa4-143">Geben Sie im Feld „Wertdaten“ den Hostnamen oder die Hostnamen für die Standorte an (Hostname, der im Anforderungs-URL verwendet wird), die sich auf dem lokalen Computer befinden, und klicken Sie dann auf „OK“.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-143">In the Value data box, type the host name or the host names for the sites (the host name used in the request URL) that are on the local computer, and then click OK.</span></span>

7. <span data-ttu-id="1ffa4-144">Beenden Sie den Registrierungs-Editor, starten Sie den IISAdmin-Dienst neu, und führen Sie IISReset aus.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-144">Quit Registry Editor, and then restart the IISAdmin service and run IISReset.</span></span>

<span data-ttu-id="1ffa4-145">Eine unsicherere Lösung ist die Deaktivierung der Loopbacküberprüfung, die in <https://support.microsoft.com/kb/896861> beschrieben ist.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-145">A less secure work around is to disable the loop back check, as described in <https://support.microsoft.com/kb/896861>.</span></span> <span data-ttu-id="1ffa4-146">Der Schutz vor Reflektionsangriffen wird somit deaktiviert.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-146">This disables the protection against reflection attacks.</span></span> <span data-ttu-id="1ffa4-147">Daher ist es besser, den Satz von alternativen Namen auf jene einzuschränken, von denen Sie erwarten, dass sie tatsächlich vom Computer verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="1ffa4-147">So it is better to constrain the set of alternate names to only those you expect the machine to actually use.</span></span>

## <a name="see-also"></a><span data-ttu-id="1ffa4-148">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="1ffa4-148">See also</span></span>

- <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A?displayProperty=nameWithType>
- <xref:System.Net.HttpRequestHeader?displayProperty=nameWithType>
- <xref:System.Net.HttpWebRequest.Host%2A?displayProperty=nameWithType>
