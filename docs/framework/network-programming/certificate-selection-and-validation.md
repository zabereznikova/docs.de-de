---
title: Zertifikatauswahl und -überprüfung
description: Informieren Sie sich über verschiedene Möglichkeiten der System.Net-Klassen zum Auswählen und Überprüfen von Zertifikaten für SSL/TLS-Verbindungen.
ms.date: 03/30/2017
ms.assetid: c933aca2-4cd0-4ff1-9df9-267143f25a6f
ms.openlocfilehash: a85b6947c20f7dbced1fb6ad6e79f3134ce1f57b
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 11/26/2020
ms.locfileid: "96287513"
---
# <a name="certificate-selection-and-validation"></a><span data-ttu-id="28e53-103">Zertifikatauswahl und -überprüfung</span><span class="sxs-lookup"><span data-stu-id="28e53-103">Certificate Selection and Validation</span></span>

<span data-ttu-id="28e53-104">Die <xref:System.Net>-Klassen unterstützen mehrere Möglichkeiten zur Auswahl und Überprüfung von <xref:System.Security.Cryptography.X509Certificates> für SSL-Verbindungen (Secure Socket Layer).</span><span class="sxs-lookup"><span data-stu-id="28e53-104">The <xref:System.Net> classes support several ways to select and validate <xref:System.Security.Cryptography.X509Certificates> for Secure Socket Layer (SSL) connections.</span></span> <span data-ttu-id="28e53-105">Ein Client kann ein oder mehrere Zertifikate zur Authentifizierung gegenüber eines Servers wählen.</span><span class="sxs-lookup"><span data-stu-id="28e53-105">A client can select one or more certificates to authenticate itself to a server.</span></span> <span data-ttu-id="28e53-106">Ein Server kann fordern, dass ein Clientzertifikat ein oder mehrere bestimmte Attribute für die Authentifizierung aufweist.</span><span class="sxs-lookup"><span data-stu-id="28e53-106">A server can require that a client certificate have one or more specific attributes for authentication.</span></span>  
  
## <a name="definition"></a><span data-ttu-id="28e53-107">Definition</span><span class="sxs-lookup"><span data-stu-id="28e53-107">Definition</span></span>  

 <span data-ttu-id="28e53-108">Ein Zertifikat ist ein ASCII-Datenstrom, der einen öffentlichen Schlüssel, Attribute (z.B. Versionsnummer, Seriennummer und Ablaufdatum) und eine digitale Signatur von einer Zertifizierungsstelle enthält.</span><span class="sxs-lookup"><span data-stu-id="28e53-108">A certificate is an ASCII byte stream that contains a public key, attributes (such as version number, serial number, and expiration date) and a digital signature from a Certificate Authority.</span></span> <span data-ttu-id="28e53-109">Zertifikate werden zum Herstellen einer verschlüsselten Verbindung oder zum Authentifizieren eines Clients mit einem Server verwendet.</span><span class="sxs-lookup"><span data-stu-id="28e53-109">Certificates are used to establish an encrypted connection or to authenticate a client to a server.</span></span>  
  
## <a name="client-certificate-selection-and-validation"></a><span data-ttu-id="28e53-110">Zertifikatauswahl und -überprüfung</span><span class="sxs-lookup"><span data-stu-id="28e53-110">Client Certificate Selection and Validation</span></span>  

 <span data-ttu-id="28e53-111">Ein Client kann ein oder mehrere Zertifikate für eine bestimmte SSL-Verbindung auswählen.</span><span class="sxs-lookup"><span data-stu-id="28e53-111">A client can select one or more certificates for a specific SSL connection.</span></span> <span data-ttu-id="28e53-112">Clientzertifikate können mit der SSL-Verbindung einem Webserver oder einen SMTP-Mailserver zugeordnet werden.</span><span class="sxs-lookup"><span data-stu-id="28e53-112">Client certificates can be associated with the SSL connection to a web server or an SMTP mail server.</span></span> <span data-ttu-id="28e53-113">Ein Client fügt Zertifikate zu einer Sammlung von <xref:System.Security.Cryptography.X509Certificates.X509Certificate>- oder <xref:System.Security.Cryptography.X509Certificates.X509Certificate2>-Klassenobjekten hinzu.</span><span class="sxs-lookup"><span data-stu-id="28e53-113">A client adds certificates to a collection of <xref:System.Security.Cryptography.X509Certificates.X509Certificate> or <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> class objects.</span></span> <span data-ttu-id="28e53-114">Nehmen wir E-Mails als Beispiel. Die Zertifikatauflistung ist eine Instanz von <xref:System.Security.Cryptography.X509Certificates.X509CertificateCollection>, die der <xref:System.Net.Mail.SmtpClient.ClientCertificates%2A>-Eigenschaft der <xref:System.Net.Mail.SmtpClient>-Klasse zugeordnet ist.</span><span class="sxs-lookup"><span data-stu-id="28e53-114">Using email as an example, the certificate collection is an instance of a <xref:System.Security.Cryptography.X509Certificates.X509CertificateCollection>) associated with the <xref:System.Net.Mail.SmtpClient.ClientCertificates%2A> property of the <xref:System.Net.Mail.SmtpClient> class.</span></span> <span data-ttu-id="28e53-115">Die <xref:System.Net.HttpWebRequest>-Klasse verfügt über eine ähnliche <xref:System.Net.HttpWebRequest.ClientCertificates%2A>-Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="28e53-115">The <xref:System.Net.HttpWebRequest> class has a similar <xref:System.Net.HttpWebRequest.ClientCertificates%2A> property.</span></span>  
  
 <span data-ttu-id="28e53-116">Der Hauptunterschied zwischen der <xref:System.Security.Cryptography.X509Certificates.X509Certificate>- und der <xref:System.Security.Cryptography.X509Certificates.X509Certificate2>-Klasse ist, dass sich der private Schlüssel für die <xref:System.Security.Cryptography.X509Certificates.X509Certificate>-Klasse im Zertifikatspeicher befinden muss.</span><span class="sxs-lookup"><span data-stu-id="28e53-116">The primary difference between the <xref:System.Security.Cryptography.X509Certificates.X509Certificate> and the <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> class is that the private key must reside in the certificate store for the <xref:System.Security.Cryptography.X509Certificates.X509Certificate> class.</span></span>  
  
 <span data-ttu-id="28e53-117">Auch wenn Zertifikate zu einer Auflistung hinzugefügt und einer bestimmten SSL-Verbindung zugeordnet werden, werden keine Zertifikate an den Server gesendet, außer der Server fordert dies an.</span><span class="sxs-lookup"><span data-stu-id="28e53-117">Even if certificates are added to a collection and associated with a specific SSL connection, no certificates will be sent to the server unless the server requests them.</span></span> <span data-ttu-id="28e53-118">Wenn mehrere Clientzertifikate für eine Verbindung festgelegt werden, wird das beste verwendet werden. Diese Entscheidung basiert auf einem Algorithmus, der die Übereinstimmung zwischen der durch den Server bereitgestellten Liste der Zertifikataussteller und den Ausstellernamen für Clientzertifikate berücksichtigt.</span><span class="sxs-lookup"><span data-stu-id="28e53-118">If multiple client certificates are set on a connection, the best one will be used based on an algorithm that considers the match between the list of certificate issuers provided by the server and the client certificate issuer name.</span></span>  
  
 <span data-ttu-id="28e53-119">Die <xref:System.Net.Security.SslStream>-Klasse stellt noch mehr Kontrolle über den SSL-Handshake bereit.</span><span class="sxs-lookup"><span data-stu-id="28e53-119">The <xref:System.Net.Security.SslStream> class provides even more control over the SSL handshake.</span></span> <span data-ttu-id="28e53-120">Ein Client kann einen Delegaten zum Auswählen des zu verwendenden Clientzertifikats angeben.</span><span class="sxs-lookup"><span data-stu-id="28e53-120">A client can specify a delegate to pick which client certificate to use.</span></span>  
  
 <span data-ttu-id="28e53-121">Ein Remoteserver kann überprüfen, ob ein Clientzertifikat gültig, aktuell und von der entsprechenden Zertifizierungsstelle unterzeichnet ist.</span><span class="sxs-lookup"><span data-stu-id="28e53-121">A remote server can verify that a client certificate is valid, current, and signed by the appropriate Certificate Authority.</span></span> <span data-ttu-id="28e53-122">Ein Delegat kann zu <xref:System.Net.ServicePointManager.ServerCertificateValidationCallback%2A> hinzugefügt werden, um die Überprüfung des Zertifikats zu erzwingen.</span><span class="sxs-lookup"><span data-stu-id="28e53-122">A delegate can be added to the <xref:System.Net.ServicePointManager.ServerCertificateValidationCallback%2A> to enforce certificate validation.</span></span>  
  
## <a name="client-certificate-selection"></a><span data-ttu-id="28e53-123">Clientzertifikatauswahl</span><span class="sxs-lookup"><span data-stu-id="28e53-123">Client Certificate Selection</span></span>  

 <span data-ttu-id="28e53-124">.NET Framework wählt das Clientzertifikat aus, das dem Server auf folgende Weise präsentiert wird:</span><span class="sxs-lookup"><span data-stu-id="28e53-124">The .NET Framework selects the client certificate to present to the server in the following manner:</span></span>  
  
1. <span data-ttu-id="28e53-125">Wenn ein Clientzertifikat dem Server bereits gezeigt wurde, wird das Zertifikat beim ersten Mal zwischengespeichert und für nachfolgende Clientzertifikatanforderungen wiederverwendet.</span><span class="sxs-lookup"><span data-stu-id="28e53-125">If a client certificate was presented previously to the server, the certificate is cached when first presented and is reused for subsequent client certificate requests.</span></span>  
  
2. <span data-ttu-id="28e53-126">Wenn ein Delegat vorhanden ist, verwenden Sie immer das Ergebnis aus dem Delegaten als auszuwählendes Clientzertifikat.</span><span class="sxs-lookup"><span data-stu-id="28e53-126">If a delegate is present, always use the result from the delegate as the client certificate to select.</span></span> <span data-ttu-id="28e53-127">Versuchen Sie nach Möglichkeit ein zwischengespeichertes Zertifikat zu verwenden, aber verwenden Sie keine zwischengespeicherten anonymen Anmeldeinformationen, wenn der Delegat NULL zurückgegeben hat und die Zertifikatauflistung nicht leer ist.</span><span class="sxs-lookup"><span data-stu-id="28e53-127">Try to use a cached certificate when possible, but do not use cached anonymous credentials if the delegate has returned null and the certificate collection is not empty.</span></span>  
  
3. <span data-ttu-id="28e53-128">Ist dies die erste Abfrage für ein Clientzertifikat, listet das Framework die Zertifikate in <xref:System.Security.Cryptography.X509Certificates.X509Certificate>- oder <xref:System.Security.Cryptography.X509Certificates.X509Certificate2>-Klassenobjekten auf, die der Verbindung zugeordnet sind. Sie suchen nach einer Übereinstimmung zwischen der vom Server bereitgestellten Liste der Zertifikataussteller und dem Ausstellernamen für Clientzertifikate.</span><span class="sxs-lookup"><span data-stu-id="28e53-128">If this is the first challenge for a client certificate, the Framework enumerates the certificates in <xref:System.Security.Cryptography.X509Certificates.X509Certificate> or the <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> class objects associated with the connection, looking for a match between the list of certificate issuers provided by the server and the client certificate issuer name.</span></span> <span data-ttu-id="28e53-129">Das erste übereinstimmende Zertifikat wird an den Server gesendet.</span><span class="sxs-lookup"><span data-stu-id="28e53-129">The first certificate that matches is sent to the server.</span></span> <span data-ttu-id="28e53-130">Wenn kein Zertifikat übereinstimmt oder die Zertifikatauflistung leer ist, wird eine anonyme Anmeldeinformation an den Server gesendet.</span><span class="sxs-lookup"><span data-stu-id="28e53-130">If no certificate matches or the certificate collection is empty, then an anonymous credential is sent to the server.</span></span>  
  
## <a name="tools-for-certificate-configuration"></a><span data-ttu-id="28e53-131">Tools für die Zertifikatkonfiguration</span><span class="sxs-lookup"><span data-stu-id="28e53-131">Tools for Certificate Configuration</span></span>  

 <span data-ttu-id="28e53-132">Eine Reihe von Tools stehen für die Zertifikatkonfiguration für Client und Server zur Verfügung.</span><span class="sxs-lookup"><span data-stu-id="28e53-132">A number of tools are available for client and server certificate configuration.</span></span>  
  
 <span data-ttu-id="28e53-133">Das *Winhttpcertcfg.exe*-Tool kann zur Konfiguration von Clientzertifikaten verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="28e53-133">The *Winhttpcertcfg.exe* tool can be used to configure client certificates.</span></span> <span data-ttu-id="28e53-134">Das *Winhttpcertcfg.exe*-Tool wird als eines der Tools im Windows Server 2003 Resource Kit bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="28e53-134">The *Winhttpcertcfg.exe* tool is provided as one of the tools with the Windows Server 2003 Resource Kit.</span></span> <span data-ttu-id="28e53-135">Dieses Tool steht auch als Teil der Windows Server 2003 Ressource Kit-Tools unter [www.microsoft.com](https://www.microsoft.com) zum Download zur Verfügung.</span><span class="sxs-lookup"><span data-stu-id="28e53-135">This tool is also available as a download as part of the Windows Server 2003 Resource Kit Tools at [www.microsoft.com](https://www.microsoft.com).</span></span>  
  
<span data-ttu-id="28e53-136">Das *HttpCfg.exe*-Tool kann verwendet werden, um Serverzertifikate für die <xref:System.Net.HttpListener>-Klasse zu konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="28e53-136">The *HttpCfg.exe* tool can be used to configure server certificates for the <xref:System.Net.HttpListener> class.</span></span> <span data-ttu-id="28e53-137">Das *HttpCfg.exe*-Tool dient als eines der Supporttools für Windows Server 2003 und Windows XP Service Pack 2.</span><span class="sxs-lookup"><span data-stu-id="28e53-137">The *HttpCfg.exe* tool is provided as one of the support tools for Windows Server 2003 and Windows XP Service Pack 2.</span></span> <span data-ttu-id="28e53-138">*HttpCfg.exe* und die anderen Supporttools werden standardmäßig unter Windows Server 2003 oder Windows XP installiert.</span><span class="sxs-lookup"><span data-stu-id="28e53-138">*HttpCfg.exe* and the other support tools are not installed by default on either Windows Server 2003 or Windows XP.</span></span> <span data-ttu-id="28e53-139">Unter Windows Server 2003</span><span class="sxs-lookup"><span data-stu-id="28e53-139">On Windows Server 2003.</span></span> <span data-ttu-id="28e53-140">werden die Supporttools separat vom folgenden Ordner und der Datei auf der Windows Server 2003-CD-ROM installiert:</span><span class="sxs-lookup"><span data-stu-id="28e53-140">the support tools are installed separately from the following folder and file on the Windows Server 2003 CD-ROM:</span></span>  
  
 <span data-ttu-id="28e53-141">\Support\Tools\Suptools.msi</span><span class="sxs-lookup"><span data-stu-id="28e53-141">\Support\Tools\Suptools.msi</span></span>  
  
 <span data-ttu-id="28e53-142">Für die Verwendung mit Windows XP Service Pack 2 stehen Windows XP-Supporttools unter [www.microsoft.com](https://www.microsoft.com) zum Download zur Verfügung.</span><span class="sxs-lookup"><span data-stu-id="28e53-142">For use with Windows XP Service Pack 2, the Windows XP Support Tools are available as a download from [www.microsoft.com](https://www.microsoft.com).</span></span>  
  
 <span data-ttu-id="28e53-143">Der Quellcode für eine Version des *HttpCfg.exe*-Tools wird auch als ein Beispiel mit dem Windows Server SDK bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="28e53-143">The source code to a version of the *HttpCfg.exe* tool is also provided as a sample with the Windows Server SDK.</span></span> <span data-ttu-id="28e53-144">Der Quellcode des *HttpCfg.exe*-Beispiels wird standardmäßig mit den Netzwerkbeispielen als Teil der Windows SDK unter folgendem Ordner installiert:</span><span class="sxs-lookup"><span data-stu-id="28e53-144">The source code to the *HttpCfg.exe* sample is installed by default with the networking samples as part of the Windows SDK under the following folder:</span></span>  
  
 <span data-ttu-id="28e53-145">*C:\Programme\Microsoft SDKs\Windows\v1.0\Samples\NetDS\http\serviceconfig*</span><span class="sxs-lookup"><span data-stu-id="28e53-145">*C:\Program Files\Microsoft SDKs\Windows\v1.0\Samples\NetDS\http\serviceconfig*</span></span>  
  
 <span data-ttu-id="28e53-146">Zusätzlich zu diesen Tools stellen die <xref:System.Security.Cryptography.X509Certificates.X509Certificate>- und <xref:System.Security.Cryptography.X509Certificates.X509Certificate2>-Klassen Methoden zum Laden eines Zertifikats aus dem Dateisystem bereit.</span><span class="sxs-lookup"><span data-stu-id="28e53-146">In addition to these tools, the <xref:System.Security.Cryptography.X509Certificates.X509Certificate> and <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> classes provides methods for loading a certificate from the file system.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="28e53-147">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="28e53-147">See also</span></span>

- [<span data-ttu-id="28e53-148">Security in Network Programming (Sicherheit in der Netzwerkprogrammierung)</span><span class="sxs-lookup"><span data-stu-id="28e53-148">Security in Network Programming</span></span>](security-in-network-programming.md)
- [<span data-ttu-id="28e53-149">Netzwerkprogrammierung in .NET Framework</span><span class="sxs-lookup"><span data-stu-id="28e53-149">Network Programming in the .NET Framework</span></span>](index.md)
