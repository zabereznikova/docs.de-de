---
title: Verwenden der Windows-Verwaltungsinstrumentierung für die Diagnose
ms.date: 03/30/2017
ms.assetid: fe48738d-e31b-454d-b5ec-24c85c6bf79a
ms.openlocfilehash: a5dae1479c9be7954b9eec1eed197f358eb48e4f
ms.sourcegitcommit: bdd930b5df20a45c29483d905526a2a3e4d17c5b
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 12/11/2018
ms.locfileid: "53239513"
---
# <a name="using-windows-management-instrumentation-for-diagnostics"></a><span data-ttu-id="d130e-102">Verwenden der Windows-Verwaltungsinstrumentierung für die Diagnose</span><span class="sxs-lookup"><span data-stu-id="d130e-102">Using Windows Management Instrumentation for Diagnostics</span></span>
<span data-ttu-id="d130e-103">Windows Communication Foundation (WCF) macht inspektionsdaten eines Diensts zur Laufzeit über einen WCF (Windows Management Instrumentation, WMI) Anbieter verfügbar.</span><span class="sxs-lookup"><span data-stu-id="d130e-103">Windows Communication Foundation (WCF) exposes inspection data of a service at runtime through a WCF Windows Management Instrumentation (WMI) provider.</span></span>  
  
## <a name="enabling-wmi"></a><span data-ttu-id="d130e-104">Aktivieren von WMI</span><span class="sxs-lookup"><span data-stu-id="d130e-104">Enabling WMI</span></span>  
 <span data-ttu-id="d130e-105">Bei WMI handelt es sich um die Implementierung des Web-Based Enterprise Management (WBEM)-Standards von Microsoft.</span><span class="sxs-lookup"><span data-stu-id="d130e-105">WMI is Microsoft's implementation of the Web-Based Enterprise Management (WBEM) standard.</span></span> <span data-ttu-id="d130e-106">Weitere Informationen zum WMI-SDK finden Sie unter [Windows-Verwaltungsinstrumentation](/windows/desktop/WmiSdk/wmi-start-page).</span><span class="sxs-lookup"><span data-stu-id="d130e-106">For more information about the WMI SDK, see [Windows Management Instrumentation](/windows/desktop/WmiSdk/wmi-start-page).</span></span> <span data-ttu-id="d130e-107">Bei WBEM handelt es sich um einen Industriestandard für das Verhalten von Anwendungen beim Verfügbarmachen der Verwaltungsinstrumentierung für externe Verwaltungstools.</span><span class="sxs-lookup"><span data-stu-id="d130e-107">WBEM is an industry standard for how applications expose management instrumentation to external management tools.</span></span>  
  
 <span data-ttu-id="d130e-108">Ein WMI-Anbieter ist eine Komponente zum Verfügbarmachen der Instrumentation zur Laufzeit über eine WBEM-kompatible Schnittstelle.</span><span class="sxs-lookup"><span data-stu-id="d130e-108">A WMI provider is a component that exposes instrumentation at runtime through a WBEM-compatible interface.</span></span> <span data-ttu-id="d130e-109">Sie besteht aus einer Gruppe von WMI-Objekten mit Attribut/Wert-Paaren.</span><span class="sxs-lookup"><span data-stu-id="d130e-109">It consists of a set of WMI objects that have attribute/value pairs.</span></span> <span data-ttu-id="d130e-110">Bei den Paaren kann es sich um eine Reihe einfacher Typen handeln.</span><span class="sxs-lookup"><span data-stu-id="d130e-110">Pairs can be of a number of simple types.</span></span> <span data-ttu-id="d130e-111">Über die Schnittstelle können Verwaltungstools zur Laufzeit Verbindungen mit den Diensten herstellen.</span><span class="sxs-lookup"><span data-stu-id="d130e-111">Management tools can connect to the services through the interface at runtime.</span></span> <span data-ttu-id="d130e-112">WCF macht Attribute von Diensten wie z. B. Adressen, Bindungen, Verhaltensweisen und Listener.</span><span class="sxs-lookup"><span data-stu-id="d130e-112">WCF exposes attributes of services such as addresses, bindings, behaviors, and listeners.</span></span>  
  
 <span data-ttu-id="d130e-113">Der integrierte WMI-Anbieter kann in der Konfigurationsdatei der Anwendung aktiviert werden.</span><span class="sxs-lookup"><span data-stu-id="d130e-113">The built-in WMI provider can be activated in the configuration file of the application.</span></span> <span data-ttu-id="d130e-114">Dies erfolgt mithilfe der `wmiProviderEnabled` Attribut des der [ \<Diagnose >](../../../../../docs/framework/configure-apps/file-schema/wcf/diagnostics.md) in die [ \<system.serviceModel >](../../../../../docs/framework/configure-apps/file-schema/wcf/system-servicemodel.md) Abschnitt, wie im folgenden Beispiel gezeigt. die Konfiguration.</span><span class="sxs-lookup"><span data-stu-id="d130e-114">This is done through the `wmiProviderEnabled` attribute of the [\<diagnostics>](../../../../../docs/framework/configure-apps/file-schema/wcf/diagnostics.md) in the [\<system.serviceModel>](../../../../../docs/framework/configure-apps/file-schema/wcf/system-servicemodel.md) section, as shown in the following sample configuration.</span></span>  
  
```xml  
<system.serviceModel>  
    …  
    <diagnostics wmiProviderEnabled="true" />  
    …  
</system.serviceModel>  
```  
  
 <span data-ttu-id="d130e-115">Mit diesem Konfigurationseintrag wird eine WMI-Schnittstelle verfügbar gemacht.</span><span class="sxs-lookup"><span data-stu-id="d130e-115">This configuration entry exposes a WMI interface.</span></span> <span data-ttu-id="d130e-116">Über diese Schnittstelle kann nun von Verwaltungsanwendungen eine Verbindung hergestellt und auf die Verwaltungsinstrumentation der Anwendung zugegriffen werden.</span><span class="sxs-lookup"><span data-stu-id="d130e-116">Management applications can now connect through this interface and access the management instrumentation of the application.</span></span>  
  
## <a name="accessing-wmi-data"></a><span data-ttu-id="d130e-117">Zugreifen auf WMI-Daten</span><span class="sxs-lookup"><span data-stu-id="d130e-117">Accessing WMI Data</span></span>  
 <span data-ttu-id="d130e-118">Der Zugriff auf WMI-Daten kann auf mehrere Arten erfolgen.</span><span class="sxs-lookup"><span data-stu-id="d130e-118">WMI data can be accessed in many different ways.</span></span> <span data-ttu-id="d130e-119">Microsoft stellt WMI-APIs für Skripts, die Visual Basic-Anwendungen, die C++-Anwendungen und die [!INCLUDE[dnprdnshort](../../../../../includes/dnprdnshort-md.md)].</span><span class="sxs-lookup"><span data-stu-id="d130e-119">Microsoft provides WMI APIs for scripts, Visual Basic applications, C++ applications, and the [!INCLUDE[dnprdnshort](../../../../../includes/dnprdnshort-md.md)].</span></span> <span data-ttu-id="d130e-120">Weitere Informationen finden Sie unter [mit WMI](https://go.microsoft.com/fwlink/?LinkId=95183).</span><span class="sxs-lookup"><span data-stu-id="d130e-120">For more information, see [Using WMI](https://go.microsoft.com/fwlink/?LinkId=95183).</span></span>  
  
> [!CAUTION]
>  <span data-ttu-id="d130e-121">Bei Verwendung der von .NET Framework bereitgestellten Methoden zum programmgesteuerten Zugreifen auf WMI-Daten ist darauf zu achten, dass von solchen Methoden bei hergestellter Verbindung möglicherweise Ausnahmen ausgelöst werden.</span><span class="sxs-lookup"><span data-stu-id="d130e-121">If you use the .NET Framework provided methods to programmatically access WMI data, you should be aware that such methods may throw exceptions when the connection is established.</span></span> <span data-ttu-id="d130e-122">Die Verbindung ist zwar beim Erstellen der <xref:System.Management.ManagementObject>-Instanz nicht hergestellt, dies ändert sich jedoch bei der ersten Anforderung, die einen tatsächlichen Austausch von Daten erfordert.</span><span class="sxs-lookup"><span data-stu-id="d130e-122">The connection is not established during the construction of the <xref:System.Management.ManagementObject> instance, but on the first request involving actual data exchange.</span></span> <span data-ttu-id="d130e-123">Verwenden Sie deshalb zum Abfangen möglicher Ausnahmen einen `try..catch`-Block.</span><span class="sxs-lookup"><span data-stu-id="d130e-123">Therefore, you should use a `try..catch` block to catch the possible exceptions.</span></span>  
  
 <span data-ttu-id="d130e-124">Sie können die Ablaufverfolgungs- und Nachrichtenprotokollierungsebene sowie die Nachrichtenprotokollierungsoptionen für die `System.ServiceModel`-Ablaufverfolgungsquelle in WMI ändern.</span><span class="sxs-lookup"><span data-stu-id="d130e-124">You can change the trace and message logging level, as well as message logging options for the `System.ServiceModel` trace source in WMI.</span></span> <span data-ttu-id="d130e-125">Dies ist möglich durch den Zugriff auf die [AppDomainInfo](../../../../../docs/framework/wcf/diagnostics/wmi/appdomaininfo.md) -Instanz, die folgende booleschen Eigenschaften verfügbar macht: `LogMessagesAtServiceLevel`, `LogMessagesAtTransportLevel`, `LogMalformedMessages`, und `TraceLevel`.</span><span class="sxs-lookup"><span data-stu-id="d130e-125">This can be done by accessing the [AppDomainInfo](../../../../../docs/framework/wcf/diagnostics/wmi/appdomaininfo.md) instance, which exposes these Boolean properties: `LogMessagesAtServiceLevel`, `LogMessagesAtTransportLevel`, `LogMalformedMessages`, and `TraceLevel`.</span></span> <span data-ttu-id="d130e-126">Wenn Sie einen Ablaufverfolgungslistener für die Nachrichtenprotokollierung konfigurieren, diese Optionen in der Konfiguration jedoch auf `false` festlegen, können Sie sie später, wenn die Anwendung ausgeführt wird, zu `true` ändern.</span><span class="sxs-lookup"><span data-stu-id="d130e-126">Therefore, if you configure a trace listener for message logging, but set these options to `false` in configuration, you can later change them to `true` when the application is running.</span></span> <span data-ttu-id="d130e-127">Dadurch wird die Nachrichtenprotokollierung zur Laufzeit aktiviert.</span><span class="sxs-lookup"><span data-stu-id="d130e-127">This will effectively enable message logging at runtime.</span></span> <span data-ttu-id="d130e-128">Entsprechend können Sie die Nachrichtenprotokollierung zur Laufzeit mit WMI deaktivieren, wenn Sie sie in der Konfigurationsdatei aktivieren.</span><span class="sxs-lookup"><span data-stu-id="d130e-128">Similarly, if you enable message logging in your configuration file, you can disable it at runtime using WMI.</span></span>  
  
 <span data-ttu-id="d130e-129">Sind in der Konfigurationsdatei keine Ablaufverfolgungslistener für die Nachrichtenprotokollierung oder keine `System.ServiceModel`-Ablaufverfolgungslistener angegeben, haben die vorgenommenen Änderungen keinerlei Auswirkungen, obgleich sie von WMI akzeptiert werden.</span><span class="sxs-lookup"><span data-stu-id="d130e-129">You should be aware that if no message logging trace listeners for message logging, or no `System.ServiceModel` trace listeners for tracing are specified in the configuration file, none of your changes are taken into effect, even though the changes are accepted by WMI.</span></span> <span data-ttu-id="d130e-130">Weitere Informationen zum ordnungsgemäßen Einrichten der jeweiligen Listener finden Sie unter [Konfigurieren der Nachrichtenprotokollierung](../../../../../docs/framework/wcf/diagnostics/configuring-message-logging.md) und [Konfigurieren der Ablaufverfolgung](../../../../../docs/framework/wcf/diagnostics/tracing/configuring-tracing.md).</span><span class="sxs-lookup"><span data-stu-id="d130e-130">For more information on properly setting up the respective listeners, see [Configuring Message Logging](../../../../../docs/framework/wcf/diagnostics/configuring-message-logging.md) and [Configuring Tracing](../../../../../docs/framework/wcf/diagnostics/tracing/configuring-tracing.md).</span></span> <span data-ttu-id="d130e-131">Die Ablaufverfolgungsebene aller anderen in der Konfiguration angegebenen Ablaufverfolgungsquellen wird beim Start der Anwendung wirksam und kann nicht geändert werden.</span><span class="sxs-lookup"><span data-stu-id="d130e-131">The trace level of all other trace sources specified by configuration is effective when the application starts, and cannot be changed.</span></span>  
  
 <span data-ttu-id="d130e-132">WCF macht einen `GetOperationCounterInstanceName` Methode für die Skripterstellung.</span><span class="sxs-lookup"><span data-stu-id="d130e-132">WCF exposes a `GetOperationCounterInstanceName` method for scripting.</span></span> <span data-ttu-id="d130e-133">Wird die Methode mit einem Vorgangsnamen angegeben, wird der Name einer Leistungsindikatorinstanz zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="d130e-133">This method returns a performance counter instance name if you provide it with an operation name.</span></span> <span data-ttu-id="d130e-134">Die Eingabe wird jedoch nicht überprüft.</span><span class="sxs-lookup"><span data-stu-id="d130e-134">However, it does not validate your input.</span></span> <span data-ttu-id="d130e-135">Aus diesem Grund wird bei Angabe eines falschen Vorgangsnamens auch ein falscher Indikatorname zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="d130e-135">Therefore, if you provide an incorrect operation name, an incorrect counter name is returned.</span></span>  
  
 <span data-ttu-id="d130e-136">Die `OutgoingChannel` Eigenschaft der `Service` Instanz werden keine Channels, die von einem Dienst für die Verbindung zu einem anderen Dienst geöffnet wird, wenn der WCF-Client an den Zieldienst nicht innerhalb erstellt wird gezählt. die `Service` Methode.</span><span class="sxs-lookup"><span data-stu-id="d130e-136">The `OutgoingChannel` property of the `Service` instance does not count channels opened by a service to connect to another service, if the WCF client to the destination service is not created within the `Service` method.</span></span>  
  
 <span data-ttu-id="d130e-137">**Vorsicht** WMI unterstützt nur eine <xref:System.TimeSpan> Wert bis zu 3 Dezimalstellen.</span><span class="sxs-lookup"><span data-stu-id="d130e-137">**Caution** WMI only supports a <xref:System.TimeSpan> value up to 3 decimal points.</span></span> <span data-ttu-id="d130e-138">Beispiel: Wird eine der Eigenschaften des Diensts auf <xref:System.TimeSpan.MaxValue> festgelegt, wird der Wert beim Anzeigen in WMI nach 3Dezimalstellen abgeschnitten.</span><span class="sxs-lookup"><span data-stu-id="d130e-138">For example, if your service sets one of its properties to <xref:System.TimeSpan.MaxValue>, its value is truncated after 3 decimal points when viewed through WMI.</span></span>  
  
## <a name="security"></a><span data-ttu-id="d130e-139">Sicherheit</span><span class="sxs-lookup"><span data-stu-id="d130e-139">Security</span></span>  
 <span data-ttu-id="d130e-140">Da der WCF WMI-Anbieter das Erkennen von Diensten in einer Umgebung ermöglicht wird, sollten Sie vorsichtig, zum Gewähren des Zugriffs darauf ausführen.</span><span class="sxs-lookup"><span data-stu-id="d130e-140">Because the WCF WMI provider allows the discovery of services in an environment, you should exercise extreme caution for granting access to it.</span></span> <span data-ttu-id="d130e-141">Durch Lockern des standardmäßig auf Administratoren beschränkten Zugriffs erhalten möglicherweise weniger vertrauenswürdige Parteien Zugriff auf sensible Daten der Umgebung.</span><span class="sxs-lookup"><span data-stu-id="d130e-141">If you relax the default administrator-only access, you may allow less-trusted parties access to sensitive data in your environment.</span></span> <span data-ttu-id="d130e-142">Genauer gesagt: Durch eine Lockerung der Berechtigungen für den Remote-WMI-Zugriff erhöht sich das Risiko für Überlastungsangriffe.</span><span class="sxs-lookup"><span data-stu-id="d130e-142">Specifically, if you loosen permissions on remote WMI access, flooding attacks can occur.</span></span> <span data-ttu-id="d130e-143">Wird ein Prozess von einer Vielzahl von WMI-Anforderungen regelrecht überschwemmt, hat dies eine Beeinträchtigung der Leistung zur Folge.</span><span class="sxs-lookup"><span data-stu-id="d130e-143">If a process is flooded by excessive WMI requests, its performance can be degraded.</span></span>  
  
 <span data-ttu-id="d130e-144">Werden die Zugriffsberechtigungen für die MOF-Datei gelockert, haben weniger vertrauenswürdige Parteien die Möglichkeit zum Manipulieren des WMI-Verhaltens sowie zum Ändern der im WMI-Schema geladenen Objekte.</span><span class="sxs-lookup"><span data-stu-id="d130e-144">In addition, if you relax access permissions for the MOF file, less-trusted parties can manipulate the behavior of WMI and alter the objects that are loaded in the WMI schema.</span></span> <span data-ttu-id="d130e-145">So können beispielsweise Felder entfernt werden, was dazu führen kann, dass dem Administrator wichtige Daten nicht mehr zur Verfügung stehen oder der Datei Felder hinzugefügt werden, die nicht ausgefüllt werden oder Ausnahmen auslösen.</span><span class="sxs-lookup"><span data-stu-id="d130e-145">For example, fields can be removed such that critical data is concealed from the administrator or that fields that do not populate or cause exceptions are added to the file.</span></span>  
  
 <span data-ttu-id="d130e-146">Standardmäßig der WCF WMI-Anbieter gewährt "execute Method", "Provider Write" und "Konto aktivieren" die Berechtigung für den Administrator und Berechtigungen für ASP.NET "," Lokaler Dienst "und" Netzwerkdienst "Konto aktivieren".</span><span class="sxs-lookup"><span data-stu-id="d130e-146">By default, the WCF WMI provider grants "execute method", "provider write", and "enable account" permission for Administrator, and "enable account" permission for ASP.NET, Local Service and Network Service.</span></span> <span data-ttu-id="d130e-147">Auf Nicht-[!INCLUDE[wv](../../../../../includes/wv-md.md)]-Plattformen besitzt das ASP.NET-Konto Lesezugriff auf den WMI-ServiceModel-Namespace.</span><span class="sxs-lookup"><span data-stu-id="d130e-147">In particular, on non-[!INCLUDE[wv](../../../../../includes/wv-md.md)] platforms, the ASP.NET account has read access to the WMI ServiceModel namespace.</span></span> <span data-ttu-id="d130e-148">Sollen diese Rechte einer bestimmten Benutzergruppe vorenthalten werden, deaktivieren Sie entweder den WMI-Anbieter (ist standardmäßig deaktiviert), oder deaktivieren Sie den Zugriff für die gewünschte Benutzergruppe.</span><span class="sxs-lookup"><span data-stu-id="d130e-148">If you do not want to grant these privileges to a particular user group, you should either deactivate the WMI provider (it is disabled by default), or disable access for the specific user group.</span></span>  
  
 <span data-ttu-id="d130e-149">Darüber hinaus kann WMI beim Versuch, WMI mithilfe der Konfiguration zu aktivieren, möglicherweise aufgrund unzureichender Benutzerberechtigungen nicht aktiviert werden.</span><span class="sxs-lookup"><span data-stu-id="d130e-149">In addition, when you attempt to enable WMI through configuration, WMI may not be enabled due to insufficient user privilege.</span></span> <span data-ttu-id="d130e-150">Es wird jedoch kein Ereignis in das Ereignisprotokoll aufgenommen, um diesen Fehler zu protokollieren.</span><span class="sxs-lookup"><span data-stu-id="d130e-150">However, no event is written to the event log to record this failure.</span></span>  
  
 <span data-ttu-id="d130e-151">Gehen Sie zum Ändern der Benutzerberechtigungsebenen folgendermaßen vor:</span><span class="sxs-lookup"><span data-stu-id="d130e-151">To modify user privilege levels, use the following steps.</span></span>  
  
1.  <span data-ttu-id="d130e-152">Klicken Sie auf Start, und klicken Sie dann ausführen, und geben Sie **compmgmt.msc**.</span><span class="sxs-lookup"><span data-stu-id="d130e-152">Click Start and then Run and type **compmgmt.msc**.</span></span>  
  
2.  <span data-ttu-id="d130e-153">Mit der rechten Maustaste **Dienste und Anwendungen/WMI-Steuerelemente** auszuwählenden **Eigenschaften**.</span><span class="sxs-lookup"><span data-stu-id="d130e-153">Right-click **Services and Application/WMI Controls** to select **Properties**.</span></span>  
  
3.  <span data-ttu-id="d130e-154">Wählen Sie die **Sicherheit** Registerkarte, und navigieren Sie zu der **Root/ServiceModel** Namespace.</span><span class="sxs-lookup"><span data-stu-id="d130e-154">Select the **Security** Tab, and navigate to the **Root/ServiceModel** namespace.</span></span> <span data-ttu-id="d130e-155">Klicken Sie auf die **Sicherheit** Schaltfläche.</span><span class="sxs-lookup"><span data-stu-id="d130e-155">Click the **Security** button.</span></span>  
  
4.  <span data-ttu-id="d130e-156">Wählen Sie die spezifischen Gruppe oder Benutzer, die Sie verwenden möchten, den Zugriff steuern und verwenden Sie die **zulassen** oder **Verweigern** Kontrollkästchen, um Berechtigungen zu konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="d130e-156">Select the specific group or user that you want to control access and use the **Allow** or **Deny** checkbox to configure permissions.</span></span>  
  
## <a name="granting-wcf-wmi-registration-permissions-to-additional-users"></a><span data-ttu-id="d130e-157">Gewähren von WCF WMI-Registrierungsberechtigungen für zusätzliche Benutzer</span><span class="sxs-lookup"><span data-stu-id="d130e-157">Granting WCF WMI Registration Permissions to Additional Users</span></span>  
 <span data-ttu-id="d130e-158">WCF macht Verwaltungsdaten für WMI verfügbar.</span><span class="sxs-lookup"><span data-stu-id="d130e-158">WCF exposes management data to WMI.</span></span> <span data-ttu-id="d130e-159">Dies erfolgt durch das Hosten eines in-Process-WMI-Anbieters, manchmal als "entkoppelten Anbieter" bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="d130e-159">It does so by hosting an in-process WMI provider, sometimes called a "decoupled provider".</span></span> <span data-ttu-id="d130e-160">Damit die Verwaltungsdaten verfügbar gemacht werden können, muss das Konto, das diesen Anbieter registriert, über die erforderlichen Berechtigungen verfügen.</span><span class="sxs-lookup"><span data-stu-id="d130e-160">For the management data to be exposed, the account that registers this provider must have the appropriate permissions.</span></span> <span data-ttu-id="d130e-161">Unter Windows kann standardmäßig nur eine kleine Gruppe von berechtigten Konten entkoppelte Anbieter registrieren.</span><span class="sxs-lookup"><span data-stu-id="d130e-161">In Windows, only a small set of privileged accounts can register decoupled providers by default.</span></span> <span data-ttu-id="d130e-162">Dies ist ein Problem, da Benutzer im Allgemeinen die WMI-Daten von einem WCF-Dienst verfügbar machen möchten, der unter einem Konto ausgeführt wird, das nicht im Standardsatz enthalten ist.</span><span class="sxs-lookup"><span data-stu-id="d130e-162">This is a problem because users commonly want to expose WMI data from a WCF service running under an account that is not in the default set.</span></span>  
  
 <span data-ttu-id="d130e-163">Um diesen Zugriff bereitzustellen, muss ein Administrator den zusätzlichen Konten die folgenden Berechtigungen in der angegebenen Reihenfolge erteilen:</span><span class="sxs-lookup"><span data-stu-id="d130e-163">To provide this access, an administrator must grant the following permissions to the additional account in the following order:</span></span>  
  
1.  <span data-ttu-id="d130e-164">Berechtigung für den Zugriff auf den WCF WMI-Namespace.</span><span class="sxs-lookup"><span data-stu-id="d130e-164">Permission to access to the WCF WMI Namespace.</span></span>  
  
2.  <span data-ttu-id="d130e-165">Berechtigung zum Registrieren des entkoppelten WCF WMI-Anbieters.</span><span class="sxs-lookup"><span data-stu-id="d130e-165">Permission to register the WCF Decoupled WMI Provider.</span></span>  
  
#### <a name="to-grant-wmi-namespace-access-permission"></a><span data-ttu-id="d130e-166">So gewähren Sie eine Zugriffsberechtigung für den WMI-Namespace</span><span class="sxs-lookup"><span data-stu-id="d130e-166">To grant WMI namespace access permission</span></span>  
  
1.  <span data-ttu-id="d130e-167">Führen Sie das folgende PowerShell-Skript aus.</span><span class="sxs-lookup"><span data-stu-id="d130e-167">Run the following PowerShell script.</span></span>  
  
    ```powershell  
    write-host ""  
    write-host "Granting Access to root/servicemodel WMI namespace to built in users group"  
    write-host ""  
  
    # Create the binary representation of the permissions to grant in SDDL  
    $newPermissions = "O:BAG:BAD:P(A;CI;CCDCLCSWRPWPRCWD;;;BA)(A;CI;CC;;;NS)(A;CI;CC;;;LS)(A;CI;CC;;;BU)"  
    $converter = new-object system.management.ManagementClass Win32_SecurityDescriptorHelper  
    $binarySD = $converter.SDDLToBinarySD($newPermissions)  
    $convertedPermissions = ,$binarySD.BinarySD  
  
    # Get the object used to set the permissions  
    $security = gwmi -namespace root/servicemodel -class __SystemSecurity  
  
    # Get and output the current settings  
    $binarySD = @($null)  
    $result = $security.PsBase.InvokeMethod("GetSD",$binarySD)  
  
    $outsddl = $converter.BinarySDToSDDL($binarySD[0])  
    write-host "Previous ACL: "$outsddl.SDDL  
  
    # Change the Access Control List (ACL) using SDDL  
    $result = $security.PsBase.InvokeMethod("SetSD",$convertedPermissions)   
  
    # Get and output the current settings  
    $binarySD = @($null)  
    $result = $security.PsBase.InvokeMethod("GetSD",$binarySD)  
  
    $outsddl = $converter.BinarySDToSDDL($binarySD[0])  
    write-host "New ACL:      "$outsddl.SDDL  
    write-host ""  
    ```  
  
     <span data-ttu-id="d130e-168">Dieses PowerShell-Skript verwendet die Security Descriptor Definition Language (SDDL) um den integrierten Benutzergruppe Zugriff auf den WMI-Namespace "Root/Servicemodel" zu gewähren.</span><span class="sxs-lookup"><span data-stu-id="d130e-168">This PowerShell script uses Security Descriptor Definition Language (SDDL) to grant the Built-In Users group access to the "root/servicemodel" WMI namespace.</span></span> <span data-ttu-id="d130e-169">Folgende ACLs werden angegeben:</span><span class="sxs-lookup"><span data-stu-id="d130e-169">It specifies the following ACLs:</span></span>  
  
    -   <span data-ttu-id="d130e-170">Integriertes Administratorkonto (Built-In Administrator, BA) - Hatte bereits Zugriff.</span><span class="sxs-lookup"><span data-stu-id="d130e-170">Built-In Administrator (BA) - Already Had Access.</span></span>  
  
    -   <span data-ttu-id="d130e-171">Netzwerkdienst (Network Service, NS) - Hatte bereits Zugriff.</span><span class="sxs-lookup"><span data-stu-id="d130e-171">Network Service (NS) - Already Had Access.</span></span>  
  
    -   <span data-ttu-id="d130e-172">Lokales Systemkonto (Local System, LS) - Hatte bereits Zugriff.</span><span class="sxs-lookup"><span data-stu-id="d130e-172">Local System (LS) - Already Had Access.</span></span>  
  
    -   <span data-ttu-id="d130e-173">Integrierte Gruppe "Benutzer" - Die Gruppe, für die der Zugriff erteilt wird.</span><span class="sxs-lookup"><span data-stu-id="d130e-173">Built-In Users - The group to grant access to.</span></span>  
  
#### <a name="to-grant-provider-registration-access"></a><span data-ttu-id="d130e-174">So gewähren Sie Zugriff für die Anbieterregistrierung</span><span class="sxs-lookup"><span data-stu-id="d130e-174">To grant provider registration access</span></span>  
  
1.  <span data-ttu-id="d130e-175">Führen Sie das folgende PowerShell-Skript aus.</span><span class="sxs-lookup"><span data-stu-id="d130e-175">Run the following PowerShell script.</span></span>  
  
    ```powershell  
    write-host ""  
    write-host "Granting WCF provider registration access to built in users group"  
    write-host ""  
    # Set security on ServiceModel provider  
    $provider = get-WmiObject -namespace "root\servicemodel" __Win32Provider  
  
    write-host "Previous ACL: "$provider.SecurityDescriptor  
    $result = $provider.SecurityDescriptor = "O:BUG:BUD:(A;;0x1;;;BA)(A;;0x1;;;NS)(A;;0x1;;;LS)(A;;0x1;;;BU)"  
  
    # Commit the changes and display it to the console  
    $result = $provider.Put()  
    write-host "New ACL:      "$provider.SecurityDescriptor  
    write-host ""  
    ```  
  
### <a name="granting-access-to-arbitrary-users-or-groups"></a><span data-ttu-id="d130e-176">Gewähren von Zugriff für beliebige Benutzer oder Gruppen</span><span class="sxs-lookup"><span data-stu-id="d130e-176">Granting Access to Arbitrary Users or Groups</span></span>  
 <span data-ttu-id="d130e-177">Mit dem Beispiel in diesem Abschnitt werden allen lokalen Benutzern Berechtigungen für die WMI-Anbieterregistrierung gewährt.</span><span class="sxs-lookup"><span data-stu-id="d130e-177">The example in this section grants WMI Provider registration privileges to all local users.</span></span> <span data-ttu-id="d130e-178">Wenn Sie nicht integrierten Benutzern oder Gruppen Zugriff gewähren möchten, müssen Sie die Sicherheits-ID (SID) des Benutzers oder der Gruppe abrufen.</span><span class="sxs-lookup"><span data-stu-id="d130e-178">If you want to grant access to a user or group that is not built in, then you must obtain that user or group’s Security Identifier (SID).</span></span> <span data-ttu-id="d130e-179">Es gibt keine einfache Möglichkeit, die SID für einen beliebigen Benutzer abzurufen.</span><span class="sxs-lookup"><span data-stu-id="d130e-179">There is no simple way to get the SID for an arbitrary user.</span></span> <span data-ttu-id="d130e-180">Eine Methode besteht darin, sich als der gewünschte Benutzer anzumelden und dann den folgenden Shellbefehl auszuführen.</span><span class="sxs-lookup"><span data-stu-id="d130e-180">One method is to log on as the desired user and then issue the following shell command.</span></span>  
  
```  
Whoami /user  
```  
  
 <span data-ttu-id="d130e-181">Dieser Befehl stellt die SID des aktuellen Benutzers bereit, aber diese Methode kann nicht verwendet werden, um die SID für einen beliebigen Benutzer abzurufen.</span><span class="sxs-lookup"><span data-stu-id="d130e-181">This provides the SID of the current user, but this method cannot be used to get the SID on any arbitrary user.</span></span> <span data-ttu-id="d130e-182">Eine andere Methode zum Abrufen der SID ist die Verwendung der [getsid.exe](https://go.microsoft.com/fwlink/?LinkId=186467) tool die [Windows 2000 Resource Kit-Tools für administrative Aufgaben](https://go.microsoft.com/fwlink/?LinkId=178660).</span><span class="sxs-lookup"><span data-stu-id="d130e-182">Another method to get the SID is to use the [getsid.exe](https://go.microsoft.com/fwlink/?LinkId=186467) tool from the [Windows 2000 Resource Kit Tools for administrative tasks](https://go.microsoft.com/fwlink/?LinkId=178660).</span></span> <span data-ttu-id="d130e-183">Dieses Tool vergleicht die SID von zwei Benutzern (lokal oder Domäne) und gibt als Nebeneffekt die beiden SIDs in der Befehlszeile aus.</span><span class="sxs-lookup"><span data-stu-id="d130e-183">This tool compares the SID of two users (local or domain), and as a side effect prints the two SIDs to the command line.</span></span> <span data-ttu-id="d130e-184">Weitere Informationen finden Sie unter [Well-Known-SIDs](https://go.microsoft.com/fwlink/?LinkId=186468).</span><span class="sxs-lookup"><span data-stu-id="d130e-184">For more information, see [Well Known SIDs](https://go.microsoft.com/fwlink/?LinkId=186468).</span></span>  
  
## <a name="accessing-remote-wmi-object-instances"></a><span data-ttu-id="d130e-185">Zugreifen auf Remote-WMI-Objektinstanzen</span><span class="sxs-lookup"><span data-stu-id="d130e-185">Accessing Remote WMI Object Instances</span></span>  
 <span data-ttu-id="d130e-186">Bei Bedarf den Zugriff auf WCF WMI-Instanzen auf einem Remotecomputer, müssen Sie die paketsicherheit zu den Tools aktivieren, die Sie für den Zugriff verwenden.</span><span class="sxs-lookup"><span data-stu-id="d130e-186">If you need to access WCF WMI instances on a remote machine, you must enable packet privacy on the tools that you use for access.</span></span> <span data-ttu-id="d130e-187">Im folgenden Abschnitt wird die hierzu erforderliche Vorgehensweise für WMI CIM Studio, das Testprogramm für Windows-Verwaltungsinstrumentierung und .NET SDK 2.0 beschrieben.</span><span class="sxs-lookup"><span data-stu-id="d130e-187">The following section describes how to achieve these using the WMI CIM Studio, Windows Management Instrumentation Tester, as well as .NET SDK 2.0.</span></span>  
  
### <a name="wmi-cim-studio"></a><span data-ttu-id="d130e-188">WMI CIM Studio</span><span class="sxs-lookup"><span data-stu-id="d130e-188">WMI CIM Studio</span></span>  
 <span data-ttu-id="d130e-189">Wenn Sie installiert haben [WMI-Verwaltung](https://go.microsoft.com/fwlink/?LinkId=95185), können Sie die WMI CIM Studio Zugriff auf WMI-Instanzen.</span><span class="sxs-lookup"><span data-stu-id="d130e-189">If you have installed [WMI Administrative Tools](https://go.microsoft.com/fwlink/?LinkId=95185), you can use the WMI CIM Studio to access WMI instances.</span></span> <span data-ttu-id="d130e-190">Die Tools befinden sich im folgenden Ordner:</span><span class="sxs-lookup"><span data-stu-id="d130e-190">The tools are in the following folder</span></span>  
  
 <span data-ttu-id="d130e-191">**%WINDIR%\Programme\Microsoft %windir%\programme\wmi Tools\\**</span><span class="sxs-lookup"><span data-stu-id="d130e-191">**%windir%\Program Files\WMI Tools\\**</span></span>  
  
1.  <span data-ttu-id="d130e-192">In der **Herstellen einer Verbindung mit dem Namespace:** geben **Root\ServiceModel** , und klicken Sie auf **OK.**</span><span class="sxs-lookup"><span data-stu-id="d130e-192">In the **Connect to namespace:** window, type **root\ServiceModel** and click **OK.**</span></span>  
  
2.  <span data-ttu-id="d130e-193">In der **WMI CIM Studio Anmeldung** Fenster, klicken Sie auf die **Optionen >>** Schaltfläche, um das Fenster zu erweitern.</span><span class="sxs-lookup"><span data-stu-id="d130e-193">In the **WMI CIM Studio Login** window, click the **Options >>** button to expand the window.</span></span> <span data-ttu-id="d130e-194">Wählen Sie **paketsicherheit** für **Authentifizierungsebene**, und klicken Sie auf **OK**.</span><span class="sxs-lookup"><span data-stu-id="d130e-194">Select **Packet privacy** for **Authentication level**, and click **OK**.</span></span>  
  
### <a name="windows-management-instrumentation-tester"></a><span data-ttu-id="d130e-195">Testprogramm für Windows-Verwaltungsinstrumentierung</span><span class="sxs-lookup"><span data-stu-id="d130e-195">Windows Management Instrumentation Tester</span></span>  
 <span data-ttu-id="d130e-196">Dieses Tool wird von Windows installiert.</span><span class="sxs-lookup"><span data-stu-id="d130e-196">This tool is installed by Windows.</span></span> <span data-ttu-id="d130e-197">Um es auszuführen, starten Sie eine Befehlskonsole durch Eingabe **cmd.exe** in die **starten/ausführen** Dialogfeld und klicken Sie auf **OK**.</span><span class="sxs-lookup"><span data-stu-id="d130e-197">To run it, launch a command console by typing **cmd.exe** in the **Start/Run** dialog box and click **OK**.</span></span> <span data-ttu-id="d130e-198">Geben Sie dann **wbemtest.exe** im Befehlsfenster angezeigt.</span><span class="sxs-lookup"><span data-stu-id="d130e-198">Then, type **wbemtest.exe** in the command window.</span></span> <span data-ttu-id="d130e-199">Das Testprogramm für Windows-Verwaltungsinstrumentierung wird gestartet.</span><span class="sxs-lookup"><span data-stu-id="d130e-199">The Windows Management Instrumentation Tester tool is then launched.</span></span>  
  
1.  <span data-ttu-id="d130e-200">Klicken Sie auf die **Connect** auf der oberen rechten Ecke des Fensters auf die Schaltfläche.</span><span class="sxs-lookup"><span data-stu-id="d130e-200">Click the **Connect** button on the top right corner of the window.</span></span>  
  
2.  <span data-ttu-id="d130e-201">Geben Sie im neuen Fenster **Root\ServiceModel** für die **Namespace** Feld, und wählen **paketsicherheit** für **Authentifizierungsebene**.</span><span class="sxs-lookup"><span data-stu-id="d130e-201">In the new window, enter **root\ServiceModel** for the **Namespace** field, and select **Packet privacy** for **Authentication level**.</span></span> <span data-ttu-id="d130e-202">Klicken Sie auf **Verbinden**.</span><span class="sxs-lookup"><span data-stu-id="d130e-202">Click **Connect**.</span></span>  
  
### <a name="using-managed-code"></a><span data-ttu-id="d130e-203">Verwenden von verwaltetem Code</span><span class="sxs-lookup"><span data-stu-id="d130e-203">Using Managed Code</span></span>  
 <span data-ttu-id="d130e-204">Der Zugriff auf Remote-WMI-Instanzen kann auch programmgesteuert erfolgen. Verwenden Sie hierzu die vom <xref:System.Management>-Namespace bereitgestellten Klassen.</span><span class="sxs-lookup"><span data-stu-id="d130e-204">You can also access remote WMI instances programmatically by using classes provided by the <xref:System.Management> namespace.</span></span> <span data-ttu-id="d130e-205">Die erforderliche Vorgehensweise wird im folgenden Codebeispiel veranschaulicht:</span><span class="sxs-lookup"><span data-stu-id="d130e-205">The following code sample demonstrates how to do this.</span></span>  
  
```csharp
String wcfNamespace = $@"\\{this.serviceMachineName}\Root\ServiceModel");
  
ConnectionOptions connection = new ConnectionOptions();  
connection.Authentication = AuthenticationLevel.PacketPrivacy;  
ManagementScope scope = new ManagementScope(this.wcfNamespace, connection);  
```
