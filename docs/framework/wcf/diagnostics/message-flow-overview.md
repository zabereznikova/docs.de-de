---
title: Übersicht über den Nachrichtenfluss
ms.date: 03/30/2017
ms.assetid: fb0899e1-84cc-4d90-b45b-dc5a50063943
ms.openlocfilehash: cb2924b62fce62620b664efa34208deb12dd34b7
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 11/26/2020
ms.locfileid: "96285537"
---
# <a name="message-flow-overview"></a><span data-ttu-id="f5c27-102">Übersicht über den Nachrichtenfluss</span><span class="sxs-lookup"><span data-stu-id="f5c27-102">Message Flow Overview</span></span>

<span data-ttu-id="f5c27-103">In einem verteilten System mit untereinander verbundenen Diensten müssen kausale Beziehungen zwischen den Diensten bestimmt werden.</span><span class="sxs-lookup"><span data-stu-id="f5c27-103">In a distributed system containing interconnected services, it is necessary to determine causal relationships between the services.</span></span> <span data-ttu-id="f5c27-104">Es ist unerlässlich, die verschiedenen Komponenten eines Anforderungsflusses zu verstehen, wenn kritische Szenarien wie Systemüberwachung, Fehlerbehebung und Fehlerursachenanalyse unterstützt werden sollen.</span><span class="sxs-lookup"><span data-stu-id="f5c27-104">It is important to understand the various components that were part of a request flow to support critical scenarios such as health monitoring, troubleshooting, and root cause analysis.</span></span> <span data-ttu-id="f5c27-105">Um eine Korrelation der Ablaufverfolgungen verschiedener Dienste zu ermöglichen, wurde in .NET Framework 4 eine entsprechende Unterstützung über folgende Funktionen hinzugefügt:</span><span class="sxs-lookup"><span data-stu-id="f5c27-105">To enable the correlation of traces between various services, in the .NET Framework 4 we added support through the following features:</span></span>

- <span data-ttu-id="f5c27-106">Analytische Ablaufverfolgung: Hierbei handelt es sich um eine Ablaufverfolgungsfunktion mit hoher Leistung und geringer Ausführlichkeit, die auf der Ereignisablaufverfolgung für Windows (Event Tracing for Windows, ETW) aufbaut.</span><span class="sxs-lookup"><span data-stu-id="f5c27-106">Analytic tracing: A high performance and low verbosity tracing feature using Event Tracing for Windows (ETW).</span></span>

- <span data-ttu-id="f5c27-107">End-to-End-Aktivitätsmodell für WCF/WF-Dienste: Diese Funktion unterstützt die Korrelation von Ablaufverfolgungen, die vom <xref:System.ServiceModel>-Namespace und vom <xref:System.Workflow.ComponentModel>-Namespace generiert wurden.</span><span class="sxs-lookup"><span data-stu-id="f5c27-107">End-to-end activity model for WCF/WF services: This feature supports correlation of traces generated by the <xref:System.ServiceModel> and <xref:System.Workflow.ComponentModel> namespaces.</span></span>

- <span data-ttu-id="f5c27-108">ETW-Nachverfolgung für WF: Diese Funktion verwendet Überwachungsdatensätze, die von WF-Diensten generiert wurden, um einen Überblick über den aktuellen Status und Fortschritt eines bestimmten Workflows zu geben.</span><span class="sxs-lookup"><span data-stu-id="f5c27-108">ETW tracking for WF: This feature uses tracking records generated by WF services to provide visibility into the workflow’s current state and progress.</span></span>

 <span data-ttu-id="f5c27-109">Anhand der in einem Überwachungs- oder Ablaufverfolgungsdatensatz protokollierten Fehler können Codefehler oder fehlerhaft formatierte Nachrichten aufgefunden werden.</span><span class="sxs-lookup"><span data-stu-id="f5c27-109">Errors logged in a tracking or tracing record can be used to find code defects or incorrectly formed messages.</span></span> <span data-ttu-id="f5c27-110">Mit der ActivityId-Eigenschaft des Knotens Korrelation im Nachrichtenheader des Ereignisses kann die Aktivität ermittelt werden, die den Fehler verursacht hat.</span><span class="sxs-lookup"><span data-stu-id="f5c27-110">The ActivityId property of the Correlation node in the event’s message header can be used to determine the faulting activity.</span></span> <span data-ttu-id="f5c27-111">Informationen zum Aktivieren der Ablauf Verfolgung für den Nachrichtenfluss nach der Aktivitäts-ID finden Sie unter [Konfigurieren der Ablauf Verfolgung](./etw/configuring-message-flow-tracing.md)</span><span class="sxs-lookup"><span data-stu-id="f5c27-111">To enable message flow tracing by activity ID, see [Configuring Message Flow Tracing](./etw/configuring-message-flow-tracing.md).</span></span> <span data-ttu-id="f5c27-112">In diesem Thema wird veranschaulicht, wie die Ablaufverfolgung des Nachrichtenflusses im Projekt aktiviert wird, das im Lernprogramm "Erste Schritte" erstellt wurde.</span><span class="sxs-lookup"><span data-stu-id="f5c27-112">This topic demonstrates how to enable message flow tracing in the project created in the Getting Started tutorial.</span></span>

### <a name="to-enable-message-flow-tracing-in-the-getting-started-tutorial"></a><span data-ttu-id="f5c27-113">So aktivieren Sie die Ablaufverfolgung des Nachrichtenflusses im Lernprogramm "Erste Schritte"</span><span class="sxs-lookup"><span data-stu-id="f5c27-113">To enable message flow tracing in the Getting Started tutorial</span></span>

1. <span data-ttu-id="f5c27-114">Öffnen Sie Ereignisanzeige, indem Sie auf **Start** und **Ausführen** klicken und dann eingeben `eventvwr.exe` .</span><span class="sxs-lookup"><span data-stu-id="f5c27-114">Open Event Viewer by clicking **Start**, **Run**, and entering `eventvwr.exe`.</span></span>

2. <span data-ttu-id="f5c27-115">Wenn Sie die analytische Ablauf Verfolgung nicht aktiviert haben, erweitern Sie **Anwendungs-und Dienst Protokolle**, **Microsoft**, **Windows**, **Anwendungs Server-Anwendungen**.</span><span class="sxs-lookup"><span data-stu-id="f5c27-115">If you haven’t enabled analytic tracing, expand **Applications and Services Logs**, **Microsoft**, **Windows**, **Application Server-Applications**.</span></span> <span data-ttu-id="f5c27-116">Wählen Sie **Ansicht**, **analytische und Debugprotokolle anzeigen** aus.</span><span class="sxs-lookup"><span data-stu-id="f5c27-116">Select **View**, **Show Analytic and Debug Logs**.</span></span> <span data-ttu-id="f5c27-117">Klicken Sie mit der rechten Maustaste auf **Analyse** , und wählen Sie **Protokoll aktivieren**</span><span class="sxs-lookup"><span data-stu-id="f5c27-117">Right-click **Analytic** and select **Enable Log**.</span></span> <span data-ttu-id="f5c27-118">Lassen Sie die Ereignisanzeige geöffnet, damit die Ablaufverfolgungen eingesehen werden können.</span><span class="sxs-lookup"><span data-stu-id="f5c27-118">Leave Event Viewer open so that traces can be viewed.</span></span>

3. <span data-ttu-id="f5c27-119">Öffnen Sie das Beispiel, das im [Tutorial "Getting Started](../getting-started-tutorial.md) " in Visual Studio 2012 erstellt wurde.</span><span class="sxs-lookup"><span data-stu-id="f5c27-119">Open the sample created in the [Getting Started Tutorial](../getting-started-tutorial.md) in Visual Studio 2012.</span></span> <span data-ttu-id="f5c27-120">Beachten Sie, dass Sie Visual Studio 2012 als Administrator ausführen müssen, damit der Dienst erstellt werden kann.</span><span class="sxs-lookup"><span data-stu-id="f5c27-120">Note that you must run Visual Studio 2012 as an administrator so that the service can be created.</span></span> <span data-ttu-id="f5c27-121">Wenn Sie die WCF-Beispiele installiert [haben, können Sie die ersten](../samples/getting-started-sample.md)Schritte öffnen, die das abgeschlossene Projekt enthalten, das Sie im Tutorial erstellt haben.</span><span class="sxs-lookup"><span data-stu-id="f5c27-121">If you have the WCF samples installed, you can open the [Getting Started](../samples/getting-started-sample.md), which contains the completed project created in the tutorial.</span></span>

4. <span data-ttu-id="f5c27-122">Klicken Sie mit der rechten Maustaste auf das **Dienst** Projekt, und wählen Sie **Hinzufügen**, **Neues Element**</span><span class="sxs-lookup"><span data-stu-id="f5c27-122">Right-click the **Service** project and select **Add**, **New Item**.</span></span> <span data-ttu-id="f5c27-123">Wählen Sie **Anwendungs Konfigurationsdatei** , und klicken Sie auf **OK**</span><span class="sxs-lookup"><span data-stu-id="f5c27-123">Select **Application Configuration File** and click **OK**.</span></span>

5. <span data-ttu-id="f5c27-124">Fügen Sie der im vorherigen Schritt erstellten Datei App.Config den folgenden Code hinzu.</span><span class="sxs-lookup"><span data-stu-id="f5c27-124">Add the following code to the App.Config file created in the previous step.</span></span>

    ```xml
    <system.serviceModel>
      <diagnostics>
        <endToEndTracing propagateActivity="true" messageFlowTracing="true"/>
      </diagnostics>
    </system.serviceModel>
    ```

6. <span data-ttu-id="f5c27-125">Führen Sie die Serveranwendung ohne Debuggen aus, indem Sie STRG+F5 drücken.</span><span class="sxs-lookup"><span data-stu-id="f5c27-125">Execute the server application without debugging by pressing CTRL+F5.</span></span> <span data-ttu-id="f5c27-126">Führen Sie das Client Projekt aus, indem Sie mit der rechten Maustaste auf das **Client** Projekt klicken und **Debuggen**, **neue Instanz starten** auswählen</span><span class="sxs-lookup"><span data-stu-id="f5c27-126">Execute the client project by right-clicking the **Client** project and selecting **Debug**, **Start New Instance**.</span></span>

7. <span data-ttu-id="f5c27-127">Um die Ereignisse vom Client zum Server zu verfolgen, fügen Sie der Anwendungskonfigurationsdatei im Projekt Client Folgendes hinzu.</span><span class="sxs-lookup"><span data-stu-id="f5c27-127">To trace the events from the client to the server, add the following to the application configuration file in the Client project.</span></span>

    ```xml
    <diagnostics>
      <endToEndTracing propagateActivity="true" messageFlowTracing="true"/>
    </diagnostics>
    ```

8. <span data-ttu-id="f5c27-128">Fügen Sie in Program.cs auf dem Client die folgende Using-Anweisung hinzu.</span><span class="sxs-lookup"><span data-stu-id="f5c27-128">In Program.cs in the client, add the following Using statement.</span></span>

    ```csharp
    using System.Diagnostics;
    ```

9. <span data-ttu-id="f5c27-129">Legen Sie in der Main-Methode in der Datei program.cs im Clientprojekt die Ablaufverfolgungs-GUID fest, die im Ereignisprotokoll weitergegeben werden soll.</span><span class="sxs-lookup"><span data-stu-id="f5c27-129">In the Main method in the program.cs file in the client project, set the Trace GUID to be propagated in the event log.</span></span>

    ```csharp
    Guid guid = Guid.NewGuid();
    Trace.CorrelationManager.ActivityId = guid;
    ```

10. <span data-ttu-id="f5c27-130">Aktualisieren Sie das **analytische**  Protokoll, und untersuchen Sie es.</span><span class="sxs-lookup"><span data-stu-id="f5c27-130">Refresh and examine the **Analytic**  log.</span></span>  <span data-ttu-id="f5c27-131">Suchen Sie nach einem Ereignis mit der Ereignis-ID 220.</span><span class="sxs-lookup"><span data-stu-id="f5c27-131">Look for an event with Event ID 220.</span></span>  <span data-ttu-id="f5c27-132">Wählen Sie das Ereignis aus, und klicken Sie im Vorschaufenster auf die Registerkarte **Details** .</span><span class="sxs-lookup"><span data-stu-id="f5c27-132">Select the event, and click the **Details** tab in the preview pane.</span></span> <span data-ttu-id="f5c27-133">Dieses Ereignis enthält die Korrelations-ID für die aufrufende Aktivität.</span><span class="sxs-lookup"><span data-stu-id="f5c27-133">This event will contain the correlation ID for the calling activity.</span></span>

    ```xml
    <Correlation ActivityID="{A066CCF1-8AB3-459B-B62F-F79F957A5036}" />
    ```

    > [!NOTE]
    > <span data-ttu-id="f5c27-134">Alle Ereignisse mit derselben GUID in der ActivityID beziehen sich auf eine Anforderung.</span><span class="sxs-lookup"><span data-stu-id="f5c27-134">All events with the same GUID in the ActivityID are related to one request.</span></span> <span data-ttu-id="f5c27-135">Damit können Nachrichten von einem bestimmten Client mit einem bestimmten Dienst korreliert werden.</span><span class="sxs-lookup"><span data-stu-id="f5c27-135">This can be used to correlate messages from a specific client to a specific service.</span></span> <span data-ttu-id="f5c27-136">Wenn der Client einen anderen Dienst aufgerufen hat, kann der Client anhand der ActivityID identifiziert werden.</span><span class="sxs-lookup"><span data-stu-id="f5c27-136">If the client called another service, then the same client could be identified by ActivityID.</span></span>

11. <span data-ttu-id="f5c27-137">Gelegentlich kann die ActivityID von der ursprünglichen GUID in eine neue ActivityID geändert werden.</span><span class="sxs-lookup"><span data-stu-id="f5c27-137">In some cases, the ActivityID can change from the original GUID to a new ActivityID.</span></span> <span data-ttu-id="f5c27-138">In diesem Fall wird ein Übertragungsereignis ausgegeben.</span><span class="sxs-lookup"><span data-stu-id="f5c27-138">In that case, a transfer event is emitted.</span></span> <span data-ttu-id="f5c27-139">Diese Ereignis-ID lautet 499, und das Ereignis enthält die folgenden Daten im Header.</span><span class="sxs-lookup"><span data-stu-id="f5c27-139">This event ID is 499, and the event will contain the following data in the header.</span></span>

    ```xml
    <Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
        <System>
            <Provider Name="Microsoft-Windows-Application Server-Applications" Guid="{c651f5f6-1c0d-492e-8ae1-b4efd7c9d503}" />
            <EventID>499</EventID>
            ...
            <Correlation ActivityID="{A066CCF1-8AB3-459B-B62F-F79F957A5036}" RelatedActivityID="{85FC0930-9C49-42DA-804B-A7368104BD1B}" />
            ...
       </System>
    </Event>
    ```

    > [!NOTE]
    > <span data-ttu-id="f5c27-140">Im Übertragungsereignis wird die Änderung der aktiven ActivityID von der als ActivityID angegebenen GUID in die GUID aufgezeichnet, die als RelatedActivityID angegeben ist.</span><span class="sxs-lookup"><span data-stu-id="f5c27-140">The transfer event records the change of the active ActivityID from the GUID specified as the ActivityID to the GUID specified as RelatedActivityID.</span></span> <span data-ttu-id="f5c27-141">Nach Ausgabe des Übertragungsereignisses enthalten sämtliche Ereignisse die neue GUID als ActivityID.</span><span class="sxs-lookup"><span data-stu-id="f5c27-141">After the transfer event is emitted, all events will contain the new GUID as the ActivityID.</span></span>
