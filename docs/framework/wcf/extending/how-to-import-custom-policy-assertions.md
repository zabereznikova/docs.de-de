---
title: 'Vorgehensweise: Importieren von benutzerdefinierten Richtlinienassertionen'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 1f41d787-accb-4a10-bfc6-a807671d1581
ms.openlocfilehash: fb5e3ba5faca1b32eef63ac174bcd7731ee50771
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 11/26/2020
ms.locfileid: "96249149"
---
# <a name="how-to-import-custom-policy-assertions"></a><span data-ttu-id="c4e1e-102">Vorgehensweise: Importieren von benutzerdefinierten Richtlinienassertionen</span><span class="sxs-lookup"><span data-stu-id="c4e1e-102">How to: Import Custom Policy Assertions</span></span>

<span data-ttu-id="c4e1e-103">Richtlinienassertionen beschreiben die Funktionen und Anforderungen eines Dienstendpunkts.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-103">Policy assertions describe the capabilities and requirements of a service endpoint.</span></span>  <span data-ttu-id="c4e1e-104">Clientanwendungen können Richtlinienassertionen in Dienstmetadaten nutzen, um die Clientbindung zu konfigurieren oder den Dienstvertrag für einen Dienstendpunkt anzupassen.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-104">Client applications can use policy assertions in service metadata to configure the client binding or to customize the service contract for a service endpoint.</span></span>  
  
 <span data-ttu-id="c4e1e-105">Benutzerdefinierte Richtlinienassertionen werden importiert, indem die <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType>-Schnittstelle implementiert und das Objekt in das Metadatensystem übergeben wird oder durch die Registrierung des Implementierungstyps in Ihrer Anwendungskonfigurationsdatei.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-105">Custom policy assertions are imported by implementing the <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> interface and passing that object to the metadata system or by registering the implementation type in your application configuration file.</span></span>  <span data-ttu-id="c4e1e-106">Implementierungen der- <xref:System.ServiceModel.Description.IPolicyImportExtension> Schnittstelle müssen einen Parameter losen Konstruktor bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-106">Implementations of the <xref:System.ServiceModel.Description.IPolicyImportExtension> interface must provide a parameterless constructor.</span></span>  
  
### <a name="to-import-custom-policy-assertions"></a><span data-ttu-id="c4e1e-107">So importieren Sie benutzerdefinierte Richtlinienassertionen</span><span class="sxs-lookup"><span data-stu-id="c4e1e-107">To import custom policy assertions</span></span>  
  
1. <span data-ttu-id="c4e1e-108">Implementieren Sie die <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType>-Schnittstelle auf einer Klasse.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-108">Implement the <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> interface on a class.</span></span> <span data-ttu-id="c4e1e-109">Anweisungen hierzu finden Sie in den folgenden Verfahren.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-109">See the following procedures.</span></span>  
  
2. <span data-ttu-id="c4e1e-110">Fügen Sie das benutzerdefinierte Richtlinienimportprogramm durch eines der folgenden Verfahren ein:</span><span class="sxs-lookup"><span data-stu-id="c4e1e-110">Insert the custom policy importer either by:</span></span>  
  
3. <span data-ttu-id="c4e1e-111">Verwenden einer Konfigurationsdatei.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-111">Using a configuration file.</span></span> <span data-ttu-id="c4e1e-112">Anweisungen hierzu finden Sie in den folgenden Verfahren.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-112">See the following procedures.</span></span>  
  
4. <span data-ttu-id="c4e1e-113">Verwenden einer Konfigurationsdatei mit dem [Service Model Metadata Utility-Tool (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md).</span><span class="sxs-lookup"><span data-stu-id="c4e1e-113">Using a configuration file with [ServiceModel Metadata Utility Tool (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md).</span></span> <span data-ttu-id="c4e1e-114">Anweisungen hierzu finden Sie in den folgenden Verfahren.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-114">See the following procedures.</span></span>  
  
5. <span data-ttu-id="c4e1e-115">Programmgesteuertes Einfügen des Richtlinienimportprogramms.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-115">Programmatically inserting the policy importer.</span></span> <span data-ttu-id="c4e1e-116">Anweisungen hierzu finden Sie in den folgenden Verfahren.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-116">See the following procedures.</span></span>  
  
### <a name="to-implement-the-systemservicemodeldescriptionipolicyimportextension-interface-on-any-class"></a><span data-ttu-id="c4e1e-117">So implementieren Sie die System.ServiceModel.Description.IPolicyImportExtension-Schnittstelle auf einer beliebigen Klasse</span><span class="sxs-lookup"><span data-stu-id="c4e1e-117">To implement the System.ServiceModel.Description.IPolicyImportExtension interface on any class</span></span>  
  
1. <span data-ttu-id="c4e1e-118">Suchen Sie für jedes Richtliniensubjekt, an dem Sie interessiert sind, in der <xref:System.ServiceModel.Description.IPolicyImportExtension.ImportPolicy%2A?displayProperty=nameWithType>-Methode die Richtlinienassertionen, die Sie importieren möchten, indem Sie die entsprechende Methode auf dem zur Methode übergebenen <xref:System.ServiceModel.Description.PolicyConversionContext?displayProperty=nameWithType>-Objekt aufrufen (abhängig vom Umfang der gewünschten Assertion).</span><span class="sxs-lookup"><span data-stu-id="c4e1e-118">In the <xref:System.ServiceModel.Description.IPolicyImportExtension.ImportPolicy%2A?displayProperty=nameWithType> method, for each policy subject that you are interested in, find the policy assertions that you want to import by calling the appropriate method (depending upon the scope of the assertion that you want) on the <xref:System.ServiceModel.Description.PolicyConversionContext?displayProperty=nameWithType> object passed to the method.</span></span> <span data-ttu-id="c4e1e-119">Im folgenden Codebeispiel wird veranschaulicht, wie die <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType>-Methode verwendet wird, um die benutzerdefinierte Richtlinienassertion ausfindig zu machen und diese in einem Schritt aus der Sammlung zu entfernen.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-119">The following code example shows how to use the <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> method to locate the custom policy assertion and remove it from the collection in one step.</span></span> <span data-ttu-id="c4e1e-120">Wenn Sie die Entfernen-Methode verwenden, um die Assertion ausfindig zu machen und zu entfernen, müssen Sie Schritt 4 nicht durchführen.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-120">If you use the remove method to locate and remove the assertion, you do not have to perform step 4.</span></span>  
  
     [!code-csharp[CustomPolicySample#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/custompolicysample/cs/policyimporter.cs#9)]
     [!code-vb[CustomPolicySample#9](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/custompolicysample/vb/policyimporter.vb#9)]  
  
2. <span data-ttu-id="c4e1e-121">Verarbeiten Sie die Richtlinienassertionen.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-121">Process the policy assertions.</span></span> <span data-ttu-id="c4e1e-122">Beachten Sie, dass das Richtliniensystem keine geschachtelten Richtlinien und `wsp:optional` normalisiert.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-122">Note that the policy system does not normalize nested policies and `wsp:optional`.</span></span> <span data-ttu-id="c4e1e-123">Sie müssen diese Konstrukte in der Richtlinienimport-Erweiterungsimplementierung verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-123">You must process these constructs in your policy import extension implementation.</span></span>  
  
3. <span data-ttu-id="c4e1e-124">Nehmen Sie die Anpassung an der Bindung oder am Vertrag vor, die bzw. der die von der Richtlinienassertion festgelegte Funktion oder Anforderung erfüllt.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-124">Perform the customization to the binding or contract that supports the capability or requirement specified by the policy assertion.</span></span> <span data-ttu-id="c4e1e-125">In der Regel geben Assertionen an, dass eine Bindung eine besondere Konfiguration oder ein bestimmtes Bindungselement erfordert.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-125">Typically assertions indicate that a binding requires a particular configuration or a specific binding element.</span></span> <span data-ttu-id="c4e1e-126">Nehmen Sie diese Änderungen vor, indem Sie auf die <xref:System.ServiceModel.Description.PolicyConversionContext.BindingElements%2A?displayProperty=nameWithType>-Eigenschaft zugreifen.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-126">Make these modifications by accessing the <xref:System.ServiceModel.Description.PolicyConversionContext.BindingElements%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="c4e1e-127">Andere Assertionen erfordern, dass Sie den Vertrag ändern.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-127">Other assertions require that you modify the contract.</span></span>  <span data-ttu-id="c4e1e-128">Sie können über die <xref:System.ServiceModel.Description.PolicyConversionContext.Contract%2A?displayProperty=nameWithType>-Eigenschaft auf den Vertrag zugreifen und diesen ändern.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-128">You can access and modify the contract using the <xref:System.ServiceModel.Description.PolicyConversionContext.Contract%2A?displayProperty=nameWithType> property.</span></span>  <span data-ttu-id="c4e1e-129">Beachten Sie, dass Ihr Richtlinienimportprogramm möglicherweise mehrere Male für dieselbe Bindung und für denselben Vertrag, aber für unterschiedliche Richtlinienalternativen aufgerufen wird, wenn der Import einer Richtlinienalternative fehlschlägt.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-129">Note that your policy importer may get called multiple times for the same binding and contract, but different policy alternatives if importing a policy alternative fails.</span></span> <span data-ttu-id="c4e1e-130">Der Code sollte diesem Verhalten gegenüber flexibel sein.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-130">Your code should be resilient to this behavior.</span></span>  
  
4. <span data-ttu-id="c4e1e-131">Entfernen Sie die die benutzerdefinierte Richtlinienassertion aus der Assertionsauflistung.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-131">Remove the custom policy assertion from the assertion collection.</span></span> <span data-ttu-id="c4e1e-132">Wenn Sie die Assertionen nicht entfernen Windows Communication Foundation (WCF) geht davon aus, dass der Richtlinien Import nicht erfolgreich war und die zugeordnete Bindung nicht importiert.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-132">If you do not remove the assertion Windows Communication Foundation (WCF) assumes that the policy import was unsuccessful and does not import the associated binding.</span></span> <span data-ttu-id="c4e1e-133">Wenn Sie die <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType>-Methode verwendet haben, um die benutzerdefinierte Assertion ausfindig zu machen und diese in einem Schritt aus der Auflistung zu entfernen, müssen Sie diesen Schritt nicht durchführen.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-133">If you used the <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> method to locate the custom policy assertion and remove it from the collection in one step you do not have to perform this step.</span></span>  
  
### <a name="to-insert-the-custom-policy-importer-into-the-metadata-system-using-a-configuration-file"></a><span data-ttu-id="c4e1e-134">So fügen Sie das benutzerdefinierte Richtlinienimportprogramm mit einer Konfigurationsdatei ins Metadatensystem ein</span><span class="sxs-lookup"><span data-stu-id="c4e1e-134">To insert the custom policy importer into the metadata System using a configuration file</span></span>  
  
1. <span data-ttu-id="c4e1e-135">Fügen Sie dem- `<extensions>` Element [\<policyImporters>](../../configure-apps/file-schema/wcf/policyimporters.md) im-Element in der Client Konfigurationsdatei den Importertyp hinzu.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-135">Add the importer type to the `<extensions>` element inside the [\<policyImporters>](../../configure-apps/file-schema/wcf/policyimporters.md) element in the client configuration file.</span></span>  
  
     [!code-xml[CustomPolicySample#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/custompolicysample/cs/client.exe.config#7)]
  
2. <span data-ttu-id="c4e1e-136">Verwenden Sie in der Clientanwendung <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType> oder <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType> zur Auflösung der Metadaten. Das Importprogramm wird daraufhin automatisch ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-136">In the client application, use the <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType> to resolve the metadata and the importer is invoked automatically.</span></span>  
  
     [!code-csharp[CustomPolicySample#10](../../../../samples/snippets/csharp/VS_Snippets_CFX/custompolicysample/cs/client.cs#10)]
     [!code-vb[CustomPolicySample#10](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/custompolicysample/vb/client.vb#10)]  
  
### <a name="to-insert-the-custom-policy-importer-into-the-metadata-system-using-svcutilexe"></a><span data-ttu-id="c4e1e-137">So fügen Sie das benutzerdefinierte Richtlinienimportprogramm mithilfe der Datei Svcutil.exe ins Metadatensystem ein</span><span class="sxs-lookup"><span data-stu-id="c4e1e-137">To insert the custom policy importer into the metadata system using Svcutil.exe</span></span>  
  
1. <span data-ttu-id="c4e1e-138">Fügen Sie den Importertyp zum- `<extensions>` Element innerhalb des- [\<policyImporters>](../../configure-apps/file-schema/wcf/policyimporters.md) Elements in der Svcutil.exe.config Konfigurationsdatei hinzu.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-138">Add the importer type to the `<extensions>` element inside the [\<policyImporters>](../../configure-apps/file-schema/wcf/policyimporters.md) element in the Svcutil.exe.config configuration file.</span></span> <span data-ttu-id="c4e1e-139">Über die Option `/svcutilConfig` können Sie Svcutil.exe darüber hinaus dazu bringen, Typen von Richtlinienprogrammen zu laden, die in einer anderen Konfigurationsdatei gespeichert sind.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-139">You can also point Svcutil.exe to load policy importer types registered in a different configuration file by using the `/svcutilConfig` option.</span></span>  
  
2. <span data-ttu-id="c4e1e-140">Verwenden Sie das [Service Model Metadata Utility-Tool (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md) , um die Metadaten zu importieren, und das Import Programm wird automatisch aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="c4e1e-140">Use [ServiceModel Metadata Utility Tool (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md) to import the metadata and the importer is invoked automatically.</span></span>  
  
### <a name="to-insert-the-custom-policy-importer-into-the-metadata-system-programmatically"></a><span data-ttu-id="c4e1e-141">So fügen Sie das benutzerdefinierte Richtlinienimportprogramm programmgesteuert ins Metadatensystem ein</span><span class="sxs-lookup"><span data-stu-id="c4e1e-141">To insert the custom policy importer into the metadata system programmatically</span></span>  
  
1. <span data-ttu-id="c4e1e-142">Fügen Sie vor dem Import der Metadaten das Importprogramm zur <xref:System.ServiceModel.Description.MetadataImporter.PolicyImportExtensions%2A?displayProperty=nameWithType>-Eigenschaft hinzu (beispielsweise, wenn Sie <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType> verwenden).</span><span class="sxs-lookup"><span data-stu-id="c4e1e-142">Add the importer to the <xref:System.ServiceModel.Description.MetadataImporter.PolicyImportExtensions%2A?displayProperty=nameWithType> property (for example, if you are using the <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType>) prior to importing the metadata.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="c4e1e-143">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="c4e1e-143">See also</span></span>

- <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType>
- <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType>
- <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType>
- [<span data-ttu-id="c4e1e-144">Erweitern des Metadatensystems</span><span class="sxs-lookup"><span data-stu-id="c4e1e-144">Extending the Metadata System</span></span>](extending-the-metadata-system.md)
