---
title: 'Exemplarische Vorgehensweise: Erstellen von benutzerdefinierten Client- und Dienstanmeldeinformationen'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 2b5ba5c3-0c6c-48e9-9e46-54acaec443ba
ms.openlocfilehash: ddd9f03e26f7a8345f1070715e4877c533c361fb
ms.sourcegitcommit: 59e36e65ac81cdd094a5a84617625b2a0ff3506e
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/27/2020
ms.locfileid: "80345265"
---
# <a name="walkthrough-creating-custom-client-and-service-credentials"></a><span data-ttu-id="d2d96-102">Exemplarische Vorgehensweise: Erstellen von benutzerdefinierten Client- und Dienstanmeldeinformationen</span><span class="sxs-lookup"><span data-stu-id="d2d96-102">Walkthrough: Creating Custom Client and Service Credentials</span></span>

<span data-ttu-id="d2d96-103">In diesem Thema wird gezeigt, wie benutzerdefinierte Client- und Dienstanmeldeinformationen implementiert und benutzerdefinierte Anmeldeinformationen aus Anwendungscode genutzt werden.</span><span class="sxs-lookup"><span data-stu-id="d2d96-103">This topic shows how to implement custom client and service credentials and how to use custom credentials from application code.</span></span>

## <a name="credentials-extensibility-classes"></a><span data-ttu-id="d2d96-104">Erweiterbarkeitsklassen für Anmeldeinformationen</span><span class="sxs-lookup"><span data-stu-id="d2d96-104">Credentials Extensibility Classes</span></span>

<span data-ttu-id="d2d96-105">Die <xref:System.ServiceModel.Description.ClientCredentials> <xref:System.ServiceModel.Description.ServiceCredentials> und-Klassen sind die wichtigsten Einstiegspunkte für die Windows Communication Foundation (WCF)-Sicherheitserweiterbarkeit.</span><span class="sxs-lookup"><span data-stu-id="d2d96-105">The <xref:System.ServiceModel.Description.ClientCredentials> and <xref:System.ServiceModel.Description.ServiceCredentials> classes are the main entry points to the Windows Communication Foundation (WCF) security extensibility.</span></span> <span data-ttu-id="d2d96-106">Diese Anmeldeinformationsklassen stellen die APIs bereit, die es dem Anmeldecode ermöglichen, Anmeldeinformationen einzurichten und Anmeldeinformationstypen in Sicherheitstoken zu konvertieren.</span><span class="sxs-lookup"><span data-stu-id="d2d96-106">These credentials classes provide the APIs that enable application code to set credentials information and to convert credential types into security tokens.</span></span> <span data-ttu-id="d2d96-107">(*Sicherheitstoken* sind das Formular, das zum Übertragen von Anmeldeinformationen in SOAP-Nachrichten verwendet wird.) Die Verantwortlichkeiten dieser Anmeldeinformationsklassen können in zwei Bereiche unterteilt werden:</span><span class="sxs-lookup"><span data-stu-id="d2d96-107">(*Security tokens* are the form used to transmit credential information inside SOAP messages.) The responsibilities of these credentials classes can be divided into two areas:</span></span>

- <span data-ttu-id="d2d96-108">Bereitstellung der APIs für Anwendungen zur Einrichtung von Anmeldeinformationen.</span><span class="sxs-lookup"><span data-stu-id="d2d96-108">Provide the APIs for applications to set credentials information.</span></span>

- <span data-ttu-id="d2d96-109">Funktion als Factory für <xref:System.IdentityModel.Selectors.SecurityTokenManager>-Implementierungen.</span><span class="sxs-lookup"><span data-stu-id="d2d96-109">Perform as a factory for <xref:System.IdentityModel.Selectors.SecurityTokenManager> implementations.</span></span>

<span data-ttu-id="d2d96-110">Die in WCF bereitgestellten Standardimplementierungen unterstützen die vom System bereitgestellten Anmeldeinformationstypen und erstellen einen Sicherheitstoken-Manager, der in der Lage ist, diese Anmeldeinformationstypen zu verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="d2d96-110">The default implementations provided in WCF support the system-provided credential types and create a security token manager that is capable of handling those credentials types.</span></span>

## <a name="reasons-to-customize"></a><span data-ttu-id="d2d96-111">Gründe für eine Anpassung</span><span class="sxs-lookup"><span data-stu-id="d2d96-111">Reasons to Customize</span></span>

<span data-ttu-id="d2d96-112">Es gibt mehrere Gründe für die Anpassung von Client- oder Dienstanmeldeinformationsklassen.</span><span class="sxs-lookup"><span data-stu-id="d2d96-112">There are multiple reasons for customizing either client or service credential classes.</span></span> <span data-ttu-id="d2d96-113">An erster Stelle steht die Anforderung, das standardmäßige WCF-Sicherheitsverhalten in Bezug auf die Verarbeitung vom System bereitgestellter Anmeldeinformationstypen zu ändern, insbesondere aus den folgenden Gründen:</span><span class="sxs-lookup"><span data-stu-id="d2d96-113">Foremost is the requirement to change the default WCF security behavior with regard to handling system-provided credential types, especially for the following reasons:</span></span>

- <span data-ttu-id="d2d96-114">Änderungen, die mit anderen Erweiterbarkeitspunkten nicht möglich sind.</span><span class="sxs-lookup"><span data-stu-id="d2d96-114">Changes that are not possible using other extensibility points.</span></span>

- <span data-ttu-id="d2d96-115">Hinzufügen neuer Anmeldeinformationstypen.</span><span class="sxs-lookup"><span data-stu-id="d2d96-115">Adding new credential types.</span></span>

- <span data-ttu-id="d2d96-116">Hinzufügen neuer benutzerdefinierter Typen von Sicherheitstoken.</span><span class="sxs-lookup"><span data-stu-id="d2d96-116">Adding new custom security token types.</span></span>

<span data-ttu-id="d2d96-117">Dieses Thema beschreibt, wie benutzerdefinierte Client- und Dienstanmeldeinformationen implementiert und aus Anwendungscode genutzt werden.</span><span class="sxs-lookup"><span data-stu-id="d2d96-117">This topic describes how to implement custom client and service credentials and how to use them from application code.</span></span>

## <a name="first-in-a-series"></a><span data-ttu-id="d2d96-118">Zuerst</span><span class="sxs-lookup"><span data-stu-id="d2d96-118">First in a Series</span></span>

<span data-ttu-id="d2d96-119">Das Erstellen einer benutzerdefinierten Anmeldeinformationsklasse ist nur der erste Schritt, da der Grund für das Anpassen von Anmeldeinformationen darin besteht, das WCF-Verhalten in Bezug auf die Bereitstellung von Anmeldeinformationen, die Serialisierung von Sicherheitstoken oder die Authentifizierung zu ändern.</span><span class="sxs-lookup"><span data-stu-id="d2d96-119">Creating a custom credentials class is only the first step, because the reason for customizing credentials is to change WCF behavior regarding credentials provisioning, security token serialization, or authentication.</span></span> <span data-ttu-id="d2d96-120">Andere Themen in diesem Abschnitt beschreiben, wie benutzerdefinierte Serialisierungsprogramme und Authentifizierer erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="d2d96-120">Other topics in this section describe how to create custom serializers and authenticators.</span></span> <span data-ttu-id="d2d96-121">In diesem Zusammenhang ist die Erstellung benutzerdefinierter Anmeldeinformationsklassen das erste Thema in der Reihe.</span><span class="sxs-lookup"><span data-stu-id="d2d96-121">In this regard, creating custom credential class is the first topic in the series.</span></span> <span data-ttu-id="d2d96-122">Nachfolgende Aktionen (Erstellung von benutzerdefinierten Serialisierungsprogrammen und Authentifizierern) können nur durchgeführt werden, nachdem benutzerdefinierte Anmeldeinformationen erstellt wurden.</span><span class="sxs-lookup"><span data-stu-id="d2d96-122">Subsequent actions (creating custom serializers and authenticators) can be done only after creating custom credentials.</span></span> <span data-ttu-id="d2d96-123">Weitere Themen, die auf diesem Thema aufbauen:</span><span class="sxs-lookup"><span data-stu-id="d2d96-123">Additional topics that build upon this topic include:</span></span>

- [<span data-ttu-id="d2d96-124">Vorgehensweise: Erstellen eines benutzerdefinierten Sicherheitstokenanbieters</span><span class="sxs-lookup"><span data-stu-id="d2d96-124">How to: Create a Custom Security Token Provider</span></span>](how-to-create-a-custom-security-token-provider.md)

- [<span data-ttu-id="d2d96-125">Vorgehensweise: Erstellen eines benutzerdefinierten Sicherheitstokenauthentifizierers</span><span class="sxs-lookup"><span data-stu-id="d2d96-125">How to: Create a Custom Security Token Authenticator</span></span>](how-to-create-a-custom-security-token-authenticator.md)

- <span data-ttu-id="d2d96-126">[Gewusst wie: Erstellen eines benutzerdefinierten Tokens](how-to-create-a-custom-token.md).</span><span class="sxs-lookup"><span data-stu-id="d2d96-126">[How to: Create a Custom Token](how-to-create-a-custom-token.md).</span></span>

## <a name="procedures"></a><span data-ttu-id="d2d96-127">Verfahren</span><span class="sxs-lookup"><span data-stu-id="d2d96-127">Procedures</span></span>

#### <a name="to-implement-custom-client-credentials"></a><span data-ttu-id="d2d96-128">So implementieren Sie benutzerdefinierte Clientanmeldeinformationen</span><span class="sxs-lookup"><span data-stu-id="d2d96-128">To implement custom client credentials</span></span>

1. <span data-ttu-id="d2d96-129">Definieren Sie eine neue von der <xref:System.ServiceModel.Description.ClientCredentials>-Klasse abgeleitete Klasse.</span><span class="sxs-lookup"><span data-stu-id="d2d96-129">Define a new class derived from the <xref:System.ServiceModel.Description.ClientCredentials> class.</span></span>

2. <span data-ttu-id="d2d96-130">Optional.</span><span class="sxs-lookup"><span data-stu-id="d2d96-130">Optional.</span></span> <span data-ttu-id="d2d96-131">Fügen Sie Methoden oder Eigenschaften für neue Anmeldeinformationstypen hinzu.</span><span class="sxs-lookup"><span data-stu-id="d2d96-131">Add new methods or properties for new credential types.</span></span> <span data-ttu-id="d2d96-132">Wenn Sie keine neuen Anmeldeinformationstypen hinzufügen, können Sie diesen Schritt überspringen.</span><span class="sxs-lookup"><span data-stu-id="d2d96-132">If you do not add new credential types, skip this step.</span></span> <span data-ttu-id="d2d96-133">Im folgenden Beispiel wird eine `CreditCardNumber`-Eigenschaft hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="d2d96-133">The following example adds a `CreditCardNumber` property.</span></span>

3. <span data-ttu-id="d2d96-134">Überschreiben Sie die <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A> -Methode.</span><span class="sxs-lookup"><span data-stu-id="d2d96-134">Override the <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A> method.</span></span> <span data-ttu-id="d2d96-135">Diese Methode wird automatisch von der WCF-Sicherheitsinfrastruktur aufgerufen, wenn die benutzerdefinierten Clientanmeldeinformationen verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="d2d96-135">This method is automatically called by WCF security infrastructure when the custom client credential is used.</span></span> <span data-ttu-id="d2d96-136">Diese Methode ist für die Erstellung und die Rückgabe einer Implementierungsinstanz der <xref:System.IdentityModel.Selectors.SecurityTokenManager>-Klasse verantwortlich.</span><span class="sxs-lookup"><span data-stu-id="d2d96-136">This method is responsible for creating and returning an instance of an implementation of the <xref:System.IdentityModel.Selectors.SecurityTokenManager> class.</span></span>

    > [!IMPORTANT]
    > <span data-ttu-id="d2d96-137">Wichtig: Beachten Sie, dass die <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A>-Methode überschrieben wird, um einen benutzerdefinierten Sicherheitstokenmanager zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="d2d96-137">It is important to note that the <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A> method is overridden to create a custom security token manager.</span></span> <span data-ttu-id="d2d96-138">Der vom <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager> abgeleitete Sicherheitstokenmanager muss einen benutzerdefinierten Sicherheitstokenanbieter zurückgeben, der vom <xref:System.IdentityModel.Selectors.SecurityTokenProvider> abgeleitet wurde, um das eigentliche Sicherheitstoken zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="d2d96-138">The security token manager, derived from <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>, must return a custom security token provider, derived from <xref:System.IdentityModel.Selectors.SecurityTokenProvider>, to create the actual security token.</span></span> <span data-ttu-id="d2d96-139">Befolgen Sie nicht diese Vorgehensweise zur Erstellung von Sicherheitstokens, funktioniert die Anwendung möglicherweise nicht korrekt, wenn <xref:System.ServiceModel.ChannelFactory>-Objekte zwischengespeichert werden, was das standardmäßige Verhalten von WCF-Clientproxys ist. Dies kann ggf. einen Angriff durch Rechteerweiterung zur Folge haben.</span><span class="sxs-lookup"><span data-stu-id="d2d96-139">If you do not follow this pattern for creating security tokens, your application may function incorrectly when <xref:System.ServiceModel.ChannelFactory> objects are cached (which is the default behavior for WCF client proxies), potentially resulting in an elevation of privilege attack.</span></span> <span data-ttu-id="d2d96-140">Das benutzerdefinierte Anmeldedatenobjekt wird als Teil des <xref:System.ServiceModel.ChannelFactory>-Objekts zwischengespeichert.</span><span class="sxs-lookup"><span data-stu-id="d2d96-140">The custom credential object is cached as part of the <xref:System.ServiceModel.ChannelFactory>.</span></span> <span data-ttu-id="d2d96-141">Der benutzerdefinierte <xref:System.IdentityModel.Selectors.SecurityTokenManager> wird jedoch bei jedem Aufruf erstellt. So lange die Tokenerstellungslogik also im <xref:System.IdentityModel.Selectors.SecurityTokenManager> platziert wird, wird die Sicherheitsbedrohung abgewehrt.</span><span class="sxs-lookup"><span data-stu-id="d2d96-141">However, the custom <xref:System.IdentityModel.Selectors.SecurityTokenManager> is created on every invocation, which mitigates the security threat as long as the token creation logic is placed in the <xref:System.IdentityModel.Selectors.SecurityTokenManager>.</span></span>

4. <span data-ttu-id="d2d96-142">Überschreiben Sie die <xref:System.ServiceModel.Description.ClientCredentials.CloneCore%2A> -Methode.</span><span class="sxs-lookup"><span data-stu-id="d2d96-142">Override the <xref:System.ServiceModel.Description.ClientCredentials.CloneCore%2A> method.</span></span>

    [!code-csharp[c_CustomCredentials#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#1)]
    [!code-vb[c_CustomCredentials#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/client/client.vb#1)]

#### <a name="to-implement-a-custom-client-security-token-manager"></a><span data-ttu-id="d2d96-143">So implementieren Sie einen benutzerdefinierten Clientsicherheitstoken-Manager</span><span class="sxs-lookup"><span data-stu-id="d2d96-143">To implement a custom client security token manager</span></span>

1. <span data-ttu-id="d2d96-144">Definieren Sie eine neue Klasse, die von <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager> abgeleitet ist.</span><span class="sxs-lookup"><span data-stu-id="d2d96-144">Define a new class derived from <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>.</span></span>

2. <span data-ttu-id="d2d96-145">Optional.</span><span class="sxs-lookup"><span data-stu-id="d2d96-145">Optional.</span></span> <span data-ttu-id="d2d96-146">Überschreiben Sie die <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenProvider%28System.IdentityModel.Selectors.SecurityTokenRequirement%29>-Methode, wenn eine benutzerdefinierte <xref:System.IdentityModel.Selectors.SecurityTokenProvider>-Implementierung erstellt werden muss.</span><span class="sxs-lookup"><span data-stu-id="d2d96-146">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenProvider%28System.IdentityModel.Selectors.SecurityTokenRequirement%29> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenProvider> implementation must be created.</span></span> <span data-ttu-id="d2d96-147">Weitere Informationen zu benutzerdefinierten Sicherheitstokenanbietern finden Sie unter [Gewusst wie: Erstellen eines benutzerdefinierten Sicherheitstokenanbieters](how-to-create-a-custom-security-token-provider.md).</span><span class="sxs-lookup"><span data-stu-id="d2d96-147">For more information about custom security token providers, see [How to: Create a Custom Security Token Provider](how-to-create-a-custom-security-token-provider.md).</span></span>

3. <span data-ttu-id="d2d96-148">Optional.</span><span class="sxs-lookup"><span data-stu-id="d2d96-148">Optional.</span></span> <span data-ttu-id="d2d96-149">Überschreiben Sie die <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%28System.IdentityModel.Selectors.SecurityTokenRequirement%2CSystem.IdentityModel.Selectors.SecurityTokenResolver%40%29>-Methode, wenn eine benutzerdefinierte <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator>-Implementierung erstellt werden muss.</span><span class="sxs-lookup"><span data-stu-id="d2d96-149">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%28System.IdentityModel.Selectors.SecurityTokenRequirement%2CSystem.IdentityModel.Selectors.SecurityTokenResolver%40%29> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> implementation must be created.</span></span> <span data-ttu-id="d2d96-150">Weitere Informationen zu benutzerdefinierten Sicherheitstokenauthentifikatoren finden Sie unter [Gewusst wie: Erstellen eines benutzerdefinierten Sicherheitstokenauthentifikators](how-to-create-a-custom-security-token-authenticator.md).</span><span class="sxs-lookup"><span data-stu-id="d2d96-150">For more information about custom security token authenticators, see [How to: Create a Custom Security Token Authenticator](how-to-create-a-custom-security-token-authenticator.md).</span></span>

4. <span data-ttu-id="d2d96-151">Optional.</span><span class="sxs-lookup"><span data-stu-id="d2d96-151">Optional.</span></span> <span data-ttu-id="d2d96-152">Überschreiben Sie die <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenSerializer%2A>-Methode, wenn ein benutzerdefinierter <xref:System.IdentityModel.Selectors.SecurityTokenSerializer> erstellt werden muss.</span><span class="sxs-lookup"><span data-stu-id="d2d96-152">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenSerializer%2A> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenSerializer> must be created.</span></span> <span data-ttu-id="d2d96-153">Weitere Informationen zu benutzerdefinierten Sicherheitstoken und benutzerdefinierten Sicherheitstokenserialisierern finden Sie unter [Gewusst wie: Erstellen eines benutzerdefinierten Tokens](how-to-create-a-custom-token.md).</span><span class="sxs-lookup"><span data-stu-id="d2d96-153">For more information about custom security tokens and custom security token serializers, see [How to: Create a Custom Token](how-to-create-a-custom-token.md).</span></span>

    [!code-csharp[c_CustomCredentials#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#2)]
    [!code-vb[c_CustomCredentials#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/client/client.vb#2)]

#### <a name="to-use-a-custom-client-credentials-from-application-code"></a><span data-ttu-id="d2d96-154">So verwenden Sie benutzerdefinierte Clientanmeldeinformationen aus Anwendungscode</span><span class="sxs-lookup"><span data-stu-id="d2d96-154">To use a custom client credentials from application code</span></span>

1. <span data-ttu-id="d2d96-155">Erstellen Sie entweder eine Instanz des generierten Clients, die die Dienstschnittstelle darstellt, oder erstellen Sie eine Instanz der <xref:System.ServiceModel.ChannelFactory>, die auf den Dienst verweist, mit dem Sie kommunizieren möchten.</span><span class="sxs-lookup"><span data-stu-id="d2d96-155">Either create an instance of the generated client that represents the service interface, or create an instance of the <xref:System.ServiceModel.ChannelFactory> pointing to a service you want to communicate with.</span></span>

2. <span data-ttu-id="d2d96-156">Entfernen Sie das vom System bereitgestellte Clientanmeldeinformationsverhalten aus der <xref:System.ServiceModel.Description.ServiceEndpoint.Behaviors%2A>-Sammlung, auf die von der <xref:System.ServiceModel.ChannelFactory.Endpoint%2A>-Eigenschaft aus zugegriffen werden kann.</span><span class="sxs-lookup"><span data-stu-id="d2d96-156">Remove the system-provided client credentials behavior from the <xref:System.ServiceModel.Description.ServiceEndpoint.Behaviors%2A> collection, which can be accessed through the <xref:System.ServiceModel.ChannelFactory.Endpoint%2A> property.</span></span>

3. <span data-ttu-id="d2d96-157">Erstellen Sie eine neue Instanz einer benutzerdefinierten Clientanmeldeinformationsklasse, und fügen Sie diese zur <xref:System.ServiceModel.Description.ServiceEndpoint.Behaviors%2A>-Sammlung hinzu, auf die über die <xref:System.ServiceModel.ChannelFactory.Endpoint%2A>-Eigenschaft zugegriffen werden kann.</span><span class="sxs-lookup"><span data-stu-id="d2d96-157">Create a new instance of a custom client credentials class and add it to the <xref:System.ServiceModel.Description.ServiceEndpoint.Behaviors%2A> collection, which can be accessed through the <xref:System.ServiceModel.ChannelFactory.Endpoint%2A> property.</span></span>

    [!code-csharp[c_CustomCredentials#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#3)]
    [!code-vb[c_CustomCredentials#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/client/client.vb#3)]

<span data-ttu-id="d2d96-158">Die oben beschriebene Prozedur zeigt, wie Clientanmeldeinformationen aus dem Anwendungscode genutzt werden können.</span><span class="sxs-lookup"><span data-stu-id="d2d96-158">The previous procedure shows how to use client credentials from application code.</span></span> <span data-ttu-id="d2d96-159">WCF-Anmeldeinformationen können auch mithilfe der Anwendungskonfigurationsdatei konfiguriert werden.</span><span class="sxs-lookup"><span data-stu-id="d2d96-159">WCF credentials can also be configured using the application configuration file.</span></span> <span data-ttu-id="d2d96-160">Die Nutzung der Anwendungskonfiguration ist in vielen Fällen einer harten Codierung vorzuziehen, da hier eine Änderung der Anwendungsparameter ermöglicht wird, ohne dass ein Ändern der Quelle oder eine Neukompilierung und Neubereitstellung erforderlich sind.</span><span class="sxs-lookup"><span data-stu-id="d2d96-160">Using application configuration is often preferable to hard-coding because it enables modification of application parameters without having to modify the source, recompiling, and redeployment.</span></span>

<span data-ttu-id="d2d96-161">Die nächste Prozedur beschreibt, wie eine Unterstützung für die Konfiguration von benutzerdefinierten Anmeldeinformationen erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="d2d96-161">The next procedure describes how to provide support for configuration of custom credentials.</span></span>

#### <a name="creating-a-configuration-handler-for-custom-client-credentials"></a><span data-ttu-id="d2d96-162">Erstellen eines Konfigurationshandlers für benutzerdefinierte Clientanmeldeinformationen</span><span class="sxs-lookup"><span data-stu-id="d2d96-162">Creating a configuration handler for custom client credentials</span></span>

1. <span data-ttu-id="d2d96-163">Definieren Sie eine neue Klasse, die von <xref:System.ServiceModel.Configuration.ClientCredentialsElement> abgeleitet ist.</span><span class="sxs-lookup"><span data-stu-id="d2d96-163">Define a new class derived from <xref:System.ServiceModel.Configuration.ClientCredentialsElement>.</span></span>

2. <span data-ttu-id="d2d96-164">Optional.</span><span class="sxs-lookup"><span data-stu-id="d2d96-164">Optional.</span></span> <span data-ttu-id="d2d96-165">Fügen Sie Eigenschaften für alle zusätzlichen Konfigurationsparameter hinzu, die Sie durch Anwendungskonfiguration verfügbar machen möchten.</span><span class="sxs-lookup"><span data-stu-id="d2d96-165">Add properties for all additional configuration parameters that you want to expose through application configuration.</span></span> <span data-ttu-id="d2d96-166">Im unten angegebenen Beispiel wird eine Eigenschaft mit dem Namen `CreditCardNumber` hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="d2d96-166">The example below adds one property named `CreditCardNumber`.</span></span>

3. <span data-ttu-id="d2d96-167">Überschreiben Sie die <xref:System.ServiceModel.Configuration.BehaviorExtensionElement.BehaviorType%2A>-Eigenschaft, um den Typ der benutzerdefinierten Clienanmeldeinformationsklasse zurückzugeben, der mithilfe des Konfigurationselements erstellt wurde.</span><span class="sxs-lookup"><span data-stu-id="d2d96-167">Override the <xref:System.ServiceModel.Configuration.BehaviorExtensionElement.BehaviorType%2A> property to return the type of the custom client credentials class created with the configuration element.</span></span>

4. <span data-ttu-id="d2d96-168">Überschreiben Sie die <xref:System.ServiceModel.Configuration.BehaviorExtensionElement.CreateBehavior%2A> -Methode.</span><span class="sxs-lookup"><span data-stu-id="d2d96-168">Override the <xref:System.ServiceModel.Configuration.BehaviorExtensionElement.CreateBehavior%2A> method.</span></span> <span data-ttu-id="d2d96-169">Die Methode ist basierend auf den von der Konfigurationsdatei geladenen Einstellungen für die Erstellung und Rückgabe einer Instanz der benutzerdefinierten Anmeldeinformationsklasse verantwortlich.</span><span class="sxs-lookup"><span data-stu-id="d2d96-169">The method is responsible for creating and returning an instance of the custom credential class based on the settings loaded from the configuration file.</span></span> <span data-ttu-id="d2d96-170">Rufen Sie die grundlegende <xref:System.ServiceModel.Configuration.ClientCredentialsElement.ApplyConfiguration%28System.ServiceModel.Description.ClientCredentials%29>-Methode von dieser Methode auf, um die vom System bereitgestellten Anmeldeinformationseinstellungen abzurufen, die in Ihre benutzerdefinierte Clientanmeldeinformationsinstanz geladen sind.</span><span class="sxs-lookup"><span data-stu-id="d2d96-170">Call the base <xref:System.ServiceModel.Configuration.ClientCredentialsElement.ApplyConfiguration%28System.ServiceModel.Description.ClientCredentials%29> method from this method to retrieve the system-provided credentials settings loaded into your custom client credentials instance.</span></span>

5. <span data-ttu-id="d2d96-171">Optional.</span><span class="sxs-lookup"><span data-stu-id="d2d96-171">Optional.</span></span> <span data-ttu-id="d2d96-172">Wenn Sie in Schritt 2 zusätzliche Eigenschaften hinzugefügt haben, müssen Sie die <xref:System.Configuration.ConfigurationElement.Properties%2A>-Eigenschaft zum Registrieren Ihrer zusätzlichen Konfigurationseinstellungen überschreiben, damit der Konfigurationsframework diese erkennt.</span><span class="sxs-lookup"><span data-stu-id="d2d96-172">If you added additional properties in step 2, you need to override the <xref:System.Configuration.ConfigurationElement.Properties%2A> property in order to register your additional configuration settings for the configuration framework to recognize them.</span></span> <span data-ttu-id="d2d96-173">Kombinieren Sie Ihre Eigenschaften mit den grundlegenden Klasseneigenschaften, um zu ermöglichen, dass die vom System bereitgestellten Einstellungen über das Konfigurationselement dieser benutzerdefinierten Clientanmeldeinformationen konfiguriert werden können.</span><span class="sxs-lookup"><span data-stu-id="d2d96-173">Combine your properties with the base class properties to allow the system-provided settings to be configured through this custom client credentials configuration element.</span></span>

    [!code-csharp[c_CustomCredentials#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#7)]
    [!code-vb[c_CustomCredentials#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/service/service.vb#7)]

<span data-ttu-id="d2d96-174">Sobald Sie über die Konfigurationshandlerklasse verfügen, kann sie in das WCF-Konfigurationsframework integriert werden.</span><span class="sxs-lookup"><span data-stu-id="d2d96-174">Once you have the configuration handler class, it can be integrated into the WCF configuration framework.</span></span> <span data-ttu-id="d2d96-175">Dies ermöglicht die Verwendung benutzerdefinierter Clientanmeldeinformationen in den Clientendpunktverhaltenselementen, wie in der nächsten Prozedur gezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="d2d96-175">That enables the custom client credentials to be used in the client endpoint behavior elements, as shown in the next procedure.</span></span>

#### <a name="to-register-and-use-a-custom-client-credentials-configuration-handler-in-the-application-configuration"></a><span data-ttu-id="d2d96-176">Registrieren und Verwenden eines benutzerdefinierten Clientanmeldeinformationen-Konfigurationshandlers in der Anwendungskonfiguration</span><span class="sxs-lookup"><span data-stu-id="d2d96-176">To register and use a custom client credentials configuration handler in the application configuration</span></span>

1. <span data-ttu-id="d2d96-177">Fügen Sie `extensions` der Konfigurationsdatei `behaviorExtensions` ein <>-Element und ein <>-Element hinzu.</span><span class="sxs-lookup"><span data-stu-id="d2d96-177">Add an <`extensions`> element and a <`behaviorExtensions`> element to the configuration file.</span></span>

2. <span data-ttu-id="d2d96-178">Fügen Sie `add` dem <`behaviorExtensions`>-Element ein `name` <>-Element hinzu, und legen Sie das Attribut auf einen geeigneten Wert fest.</span><span class="sxs-lookup"><span data-stu-id="d2d96-178">Add an <`add`> element to the <`behaviorExtensions`> element and set the `name` attribute to an appropriate value.</span></span>

3. <span data-ttu-id="d2d96-179">Legen Sie das `type`-Attribut auf den vollqualifizierten Typnamen fest.</span><span class="sxs-lookup"><span data-stu-id="d2d96-179">Set the `type` attribute to the fully-qualified type name.</span></span> <span data-ttu-id="d2d96-180">Binden Sie ebenfalls den Assemblynamen und andere Assemblyattribute ein.</span><span class="sxs-lookup"><span data-stu-id="d2d96-180">Also include the assembly name and other assembly attributes.</span></span>

    ```xml
    <system.serviceModel>
      <extensions>
        <behaviorExtensions>
          <add name="myClientCredentials" type="Microsoft.ServiceModel.Samples.MyClientCredentialsConfigHandler, CustomCredentials, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
        </behaviorExtensions>
      </extensions>
    </system.serviceModel>
    ```

4. <span data-ttu-id="d2d96-181">Nach der Registrierung des Konfigurationshandlers kann das benutzerdefinierte Anmeldeinformationselement in derselben `clientCredentials` Konfigurationsdatei anstelle der vom System bereitgestellten <> Element verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="d2d96-181">After registering your configuration handler, the custom credentials element can be used inside the same configuration file instead of the system-provided <`clientCredentials`> element.</span></span> <span data-ttu-id="d2d96-182">Sie können sowohl die vom System bereitgestellten Eigenschaften als auch neue Eigenschaften verwenden, die Sie in Ihre Konfigurationshandlerimplementierung eingefügt haben.</span><span class="sxs-lookup"><span data-stu-id="d2d96-182">You can use both the system-provided properties and any new properties that you have added to your configuration handler implementation.</span></span> <span data-ttu-id="d2d96-183">Im folgenden Beispiel wird der Wert einer benutzerdefinierten Eigenschaft mithilfe des `creditCardNumber`-Attributs eingerichtet.</span><span class="sxs-lookup"><span data-stu-id="d2d96-183">The following example sets the value of a custom property using the `creditCardNumber` attribute.</span></span>

    ```xml
    <behaviors>
      <endpointBehaviors>
        <behavior name="myClientCredentialsBehavior">
          <myClientCredentials creditCardNumber="123-123-123"/>
        </behavior>
      </endpointBehaviors>
    </behaviors>
    ```

#### <a name="to-implement-custom-service-credentials"></a><span data-ttu-id="d2d96-184">So implementieren Sie benutzerdefinierte Dienstanmeldeinformationen</span><span class="sxs-lookup"><span data-stu-id="d2d96-184">To implement custom service credentials</span></span>

1. <span data-ttu-id="d2d96-185">Definieren Sie eine neue Klasse, die von <xref:System.ServiceModel.Description.ServiceCredentials> abgeleitet ist.</span><span class="sxs-lookup"><span data-stu-id="d2d96-185">Define a new class derived from <xref:System.ServiceModel.Description.ServiceCredentials>.</span></span>

2. <span data-ttu-id="d2d96-186">Optional.</span><span class="sxs-lookup"><span data-stu-id="d2d96-186">Optional.</span></span> <span data-ttu-id="d2d96-187">Fügen Sie neue Eigenschaften hinzu, um APIs für neue Werte für die Anmeldeinformationen bereitzustellen, die hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="d2d96-187">Add new properties to provide APIs for new credential values that are being added.</span></span> <span data-ttu-id="d2d96-188">Wenn Sie keine neuen Anmeldeinformationswerte hinzufügen, können Sie diesen Schritt überspringen.</span><span class="sxs-lookup"><span data-stu-id="d2d96-188">If you do not add new credential values, skip this step.</span></span> <span data-ttu-id="d2d96-189">Im folgenden Beispiel wird die `AdditionalCertificate`-Eigenschaft hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="d2d96-189">The following example adds an `AdditionalCertificate` property.</span></span>

3. <span data-ttu-id="d2d96-190">Überschreiben Sie die <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A> -Methode.</span><span class="sxs-lookup"><span data-stu-id="d2d96-190">Override the <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A> method.</span></span> <span data-ttu-id="d2d96-191">Diese Methode wird automatisch von der WCF-Infrastruktur aufgerufen, wenn die benutzerdefinierten Clientanmeldeinformationen verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="d2d96-191">This method is automatically called by the WCF infrastructure when the custom client credential is used.</span></span> <span data-ttu-id="d2d96-192">Die Methode ist für die Erstellung und die Rückgabe einer Implementierungsinstanz der <xref:System.IdentityModel.Selectors.SecurityTokenManager>-Klasse verantwortlich (wie in der nächsten Prozedur beschrieben).</span><span class="sxs-lookup"><span data-stu-id="d2d96-192">The method is responsible for creating and returning an instance of an implementation of the <xref:System.IdentityModel.Selectors.SecurityTokenManager> class (described in the next procedure).</span></span>

4. <span data-ttu-id="d2d96-193">Optional.</span><span class="sxs-lookup"><span data-stu-id="d2d96-193">Optional.</span></span> <span data-ttu-id="d2d96-194">Überschreiben Sie die <xref:System.ServiceModel.Description.ServiceCredentials.CloneCore%2A> -Methode.</span><span class="sxs-lookup"><span data-stu-id="d2d96-194">Override the <xref:System.ServiceModel.Description.ServiceCredentials.CloneCore%2A> method.</span></span> <span data-ttu-id="d2d96-195">Dies ist nur erforderlich, wenn neue Eigenschaften oder interne Felder zur benutzerdefinierten Clientanmeldeinformationsimplementierung hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="d2d96-195">This is required only if adding new properties or internal fields to the custom client credentials implementation.</span></span>

    [!code-csharp[c_CustomCredentials#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#4)]
    [!code-vb[c_CustomCredentials#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/service/service.vb#4)]

#### <a name="to-implement-a-custom-service-security-token-manager"></a><span data-ttu-id="d2d96-196">So implementieren Sie einen benutzerdefinierten Dienstsicherheitstoken-Manager</span><span class="sxs-lookup"><span data-stu-id="d2d96-196">To implement a custom service security token manager</span></span>

1. <span data-ttu-id="d2d96-197">Definieren Sie eine neue von der <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager>-Klasse abgeleitete Klasse.</span><span class="sxs-lookup"><span data-stu-id="d2d96-197">Define a new class derived from the <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager> class.</span></span>

2. <span data-ttu-id="d2d96-198">Optional.</span><span class="sxs-lookup"><span data-stu-id="d2d96-198">Optional.</span></span> <span data-ttu-id="d2d96-199">Überschreiben Sie die <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenProvider%2A>-Methode, wenn eine benutzerdefinierte <xref:System.IdentityModel.Selectors.SecurityTokenProvider>-Implementierung erstellt werden muss.</span><span class="sxs-lookup"><span data-stu-id="d2d96-199">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenProvider%2A> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenProvider> implementation must be created.</span></span> <span data-ttu-id="d2d96-200">Weitere Informationen zu benutzerdefinierten Sicherheitstokenanbietern finden Sie unter [Gewusst wie: Erstellen eines benutzerdefinierten Sicherheitstokenanbieters](how-to-create-a-custom-security-token-provider.md).</span><span class="sxs-lookup"><span data-stu-id="d2d96-200">For more information about custom security token providers, see [How to: Create a Custom Security Token Provider](how-to-create-a-custom-security-token-provider.md).</span></span>

3. <span data-ttu-id="d2d96-201">Optional.</span><span class="sxs-lookup"><span data-stu-id="d2d96-201">Optional.</span></span> <span data-ttu-id="d2d96-202">Überschreiben Sie die <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A>-Methode, wenn eine benutzerdefinierte <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator>-Implementierung erstellt werden muss.</span><span class="sxs-lookup"><span data-stu-id="d2d96-202">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> implementation must be created.</span></span> <span data-ttu-id="d2d96-203">Weitere Informationen zu benutzerdefinierten Sicherheitstokenauthentifikatoren finden Sie unter Gewusst wie: Erstellen eines Themas für [benutzerdefinierte Sicherheitstokenauthentifikatoren.](how-to-create-a-custom-security-token-authenticator.md)</span><span class="sxs-lookup"><span data-stu-id="d2d96-203">For more information about custom security token authenticators, see [How to: Create a Custom Security Token Authenticator](how-to-create-a-custom-security-token-authenticator.md) topic.</span></span>

4. <span data-ttu-id="d2d96-204">Optional.</span><span class="sxs-lookup"><span data-stu-id="d2d96-204">Optional.</span></span> <span data-ttu-id="d2d96-205">Überschreiben Sie die <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenSerializer%28System.IdentityModel.Selectors.SecurityTokenVersion%29>-Methode, wenn ein benutzerdefinierter <xref:System.IdentityModel.Selectors.SecurityTokenSerializer> erstellt werden muss.</span><span class="sxs-lookup"><span data-stu-id="d2d96-205">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenSerializer%28System.IdentityModel.Selectors.SecurityTokenVersion%29> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenSerializer> must be created.</span></span> <span data-ttu-id="d2d96-206">Weitere Informationen zu benutzerdefinierten Sicherheitstoken und benutzerdefinierten Sicherheitstokenserialisierern finden Sie unter [Gewusst wie: Erstellen eines benutzerdefinierten Tokens](how-to-create-a-custom-token.md).</span><span class="sxs-lookup"><span data-stu-id="d2d96-206">For more information about custom security tokens and custom security token serializers, see [How to: Create a Custom Token](how-to-create-a-custom-token.md).</span></span>

    [!code-csharp[c_CustomCredentials#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#5)]
    [!code-vb[c_CustomCredentials#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/service/service.vb#5)]

#### <a name="to-use-custom-service-credentials-from-application-code"></a><span data-ttu-id="d2d96-207">So verwenden Sie benutzerdefinierte Dienstanmeldeinformationen aus Anwendungscode</span><span class="sxs-lookup"><span data-stu-id="d2d96-207">To use custom service credentials from application code</span></span>

1. <span data-ttu-id="d2d96-208">Erstellen Sie eine Instanz der <xref:System.ServiceModel.ServiceHost>.</span><span class="sxs-lookup"><span data-stu-id="d2d96-208">Create an instance of the <xref:System.ServiceModel.ServiceHost>.</span></span>

2. <span data-ttu-id="d2d96-209">Entfernen Sie das vom System bereitgestellte Dienstanmeldeinformationsverhalten aus der <xref:System.ServiceModel.Description.ServiceDescription.Behaviors%2A>-Sammlung.</span><span class="sxs-lookup"><span data-stu-id="d2d96-209">Remove the system-provided service credentials behavior from the <xref:System.ServiceModel.Description.ServiceDescription.Behaviors%2A> collection.</span></span>

3. <span data-ttu-id="d2d96-210">Erstellen Sie eine neue Instanz der benutzerdefinierten Dienstanmeldeinformationsklasse, und fügen Sie diese der <xref:System.ServiceModel.Description.ServiceDescription.Behaviors%2A>-Sammlung hinzu.</span><span class="sxs-lookup"><span data-stu-id="d2d96-210">Create a new instance of the custom service credentials class and add it to the <xref:System.ServiceModel.Description.ServiceDescription.Behaviors%2A> collection.</span></span>

    [!code-csharp[c_CustomCredentials#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#6)]
    [!code-vb[c_CustomCredentials#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/service/service.vb#6)]

<span data-ttu-id="d2d96-211">Fügen Sie Unterstützung für die Konfiguration mithilfe`To create a configuration handler for custom client credentials`der`To register and use a custom client credentials configuration handler in the application configuration`zuvor beschriebenen Schritte in den Prozeduren " und " hinzu. Der einzige Unterschied besteht <xref:System.ServiceModel.Configuration.ServiceCredentialsElement> darin, <xref:System.ServiceModel.Configuration.ClientCredentialsElement> die Klasse anstelle der Klasse als Basisklasse für den Konfigurationshandler zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="d2d96-211">Add support for configuration using the steps described previously in the procedures "`To create a configuration handler for custom client credentials`" and "`To register and use a custom client credentials configuration handler in the application configuration`." The only difference is to use the <xref:System.ServiceModel.Configuration.ServiceCredentialsElement> class instead of the <xref:System.ServiceModel.Configuration.ClientCredentialsElement> class as a base class for the configuration handler.</span></span> <span data-ttu-id="d2d96-212">Das benutzerdefinierte Dienstanmeldeinformationselement kann immer verwendet werden, wenn das vom System bereitgestellte `<serviceCredentials>`-Element genutzt wird.</span><span class="sxs-lookup"><span data-stu-id="d2d96-212">The custom service credential element can then be used wherever the system-provided `<serviceCredentials>` element is used.</span></span>

## <a name="see-also"></a><span data-ttu-id="d2d96-213">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="d2d96-213">See also</span></span>

- <xref:System.ServiceModel.Description.ClientCredentials>
- <xref:System.ServiceModel.Description.ServiceCredentials>
- <xref:System.ServiceModel.Security.SecurityCredentialsManager>
- <xref:System.IdentityModel.Selectors.SecurityTokenManager>
- <xref:System.ServiceModel.Configuration.ClientCredentialsElement>
- <xref:System.ServiceModel.Configuration.ServiceCredentialsElement>
- [<span data-ttu-id="d2d96-214">Vorgehensweise: Erstellen eines benutzerdefinierten Sicherheitstokenanbieters</span><span class="sxs-lookup"><span data-stu-id="d2d96-214">How to: Create a Custom Security Token Provider</span></span>](how-to-create-a-custom-security-token-provider.md)
- [<span data-ttu-id="d2d96-215">Vorgehensweise: Erstellen eines benutzerdefinierten Sicherheitstokenauthentifizierers</span><span class="sxs-lookup"><span data-stu-id="d2d96-215">How to: Create a Custom Security Token Authenticator</span></span>](how-to-create-a-custom-security-token-authenticator.md)
- [<span data-ttu-id="d2d96-216">Vorgehensweise: Erstellen eines benutzerdefinierten Tokens</span><span class="sxs-lookup"><span data-stu-id="d2d96-216">How to: Create a Custom Token</span></span>](how-to-create-a-custom-token.md)
