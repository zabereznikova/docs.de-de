---
title: Benutzerdefinierte Encoder
ms.date: 03/30/2017
ms.assetid: fa0e1d7f-af36-4bf4-aac9-cd4eab95bc4f
ms.openlocfilehash: c2ad0c947afd293d0923faa3e9d914b6911ce941
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 11/26/2020
ms.locfileid: "96254778"
---
# <a name="custom-encoders"></a><span data-ttu-id="ccb0e-102">Benutzerdefinierte Encoder</span><span class="sxs-lookup"><span data-stu-id="ccb0e-102">Custom Encoders</span></span>

<span data-ttu-id="ccb0e-103">In diesem Thema wird das Erstellen benutzerdefinierter Encoder behandelt.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-103">This topic discusses how to create custom encoders.</span></span>  
  
 <span data-ttu-id="ccb0e-104">In Windows Communication Foundation (WCF) verwenden Sie eine *Bindung* , um anzugeben, wie Daten über ein Netzwerk zwischen Endpunkten übertragen werden sollen.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-104">In Windows Communication Foundation (WCF), you use a *binding* to specify how to transfer data across a network between endpoints.</span></span> <span data-ttu-id="ccb0e-105">Eine Bindung besteht aus einer Sequenz von *Bindungs Elementen*.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-105">A binding is made up of a sequence of *binding elements*.</span></span> <span data-ttu-id="ccb0e-106">Eine Bindung enthält optionale Protokoll Bindungs Elemente, wie z. b. Sicherheit, ein erforderliches *Nachrichten Encoder* -Bindungs Element und ein erforderliches Transport Bindungs Element.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-106">A binding includes optional protocol binding elements such as security, a required *Message Encoder* binding element, and a required transport binding element.</span></span> <span data-ttu-id="ccb0e-107">Ein Nachrichtenencoder wird von einem Nachrichtencodierungs-Bindungselement dargestellt.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-107">A message encoder is represented by a message encoding binding element.</span></span> <span data-ttu-id="ccb0e-108">In WCF sind drei Nachrichten Encoder enthalten: Binary, Message Transmission Optimization Mechanism (MTOM) und Text.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-108">Three message encoders are included in WCF: Binary, Message Transmission Optimization Mechanism (MTOM), and Text.</span></span>  
  
 <span data-ttu-id="ccb0e-109">Ein Bindungselement für die Nachrichtencodierung dient zum Serialisieren einer ausgehenden <xref:System.ServiceModel.Channels.Message>. Anschließend wird die Nachricht an den Transport übergeben, oder die serialisierte Form einer Nachricht wird vom Transport empfangen und an die Protokollebene übergeben. Ist die Protokollebene nicht vorhanden, erfolgt die Übergabe an die Anwendung.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-109">A message encoding binding element serializes an outgoing <xref:System.ServiceModel.Channels.Message> and passes it to the transport, or receives the serialized form of a message from the transport and passes it to the protocol layer if present, or to the application, if not present.</span></span>  
  
 <span data-ttu-id="ccb0e-110"><xref:System.ServiceModel.Channels.Message>-Instanzen werden von Nachrichtenencodern in und aus Übertragungsdarstellungen transformiert.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-110">Message encoders transform <xref:System.ServiceModel.Channels.Message> instances to and from a wire representation.</span></span> <span data-ttu-id="ccb0e-111">Obgleich Encoder als Elemente beschrieben werden, die der Transportebene des Kanalstapels übergeordnet sind, befinden sie sich eigentlich auf der Transportebene.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-111">Although encoders are described as sitting above the transport layer in the channel stack, they reside inside the transport layer.</span></span> <span data-ttu-id="ccb0e-112">Von Transporten (beispielsweise HTTP) wird die Nachricht gemäß den Anforderungen des Transportstandards formatiert.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-112">Transports (for example HTTP) format the message according to the requirements of the transport standard.</span></span> <span data-ttu-id="ccb0e-113">Die Encoder (beispielsweise Text-XML) dienen lediglich zum Codieren der Nachricht.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-113">Encoders (for example Text Xml) just encode the message.</span></span>  
  
 <span data-ttu-id="ccb0e-114">Beim Herstellen einer Verbindung mit einem vorhandenen Client oder Server muss möglicherweise eine bestimmte Nachrichtencodierung verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-114">When connecting to a preexisting client or server, you may not have a choice about using a particular message encoding.</span></span> <span data-ttu-id="ccb0e-115">Allerdings können WCF-Dienste über mehrere Endpunkte zugänglich gemacht werden, von denen jeder über einen anderen Nachrichten Encoder verfügt.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-115">However, WCF services can be made accessible through multiple endpoints, each with a different message encoder.</span></span> <span data-ttu-id="ccb0e-116">Wenn ein einzelner Encoder nicht für alle Zielbenutzer des Diensts ausreicht, können Sie den Dienst über mehrere Endpunkte hinweg verfügbar machen.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-116">When a single encoder does not cover the entire audience for your service, consider exposing your service over multiple endpoints.</span></span> <span data-ttu-id="ccb0e-117">Somit kann von Clientanwendungen der optimale Endpunkt gewählt werden.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-117">Client applications can then choose the endpoint that is best for them.</span></span> <span data-ttu-id="ccb0e-118">Die Verwendung mehrerer Endpunkte ermöglicht es Ihnen, die Vorteile anderer Nachrichtencodierungen mit anderen Bindungselementen zu kombinieren.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-118">Using multiple endpoints allows you to combine the advantages of different message encoders with other binding elements.</span></span>  
  
## <a name="system-provided-encoders"></a><span data-ttu-id="ccb0e-119">Vom System bereitgestellte Encoder</span><span class="sxs-lookup"><span data-stu-id="ccb0e-119">System-Provided Encoders</span></span>  

 <span data-ttu-id="ccb0e-120">WCF bietet mehrere vom System bereitgestellte Bindungen, die für die gängigsten Anwendungsszenarien konzipiert sind.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-120">WCF provides several system-provided bindings that are designed to cover the most common application scenarios.</span></span> <span data-ttu-id="ccb0e-121">In jeder dieser Bindungen wird ein Transport mit einem Nachrichtenencoder und anderen Optionen (beispielsweise Sicherheit) kombiniert.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-121">Each of these bindings combine a transport, message encoder, and other options (security, for example).</span></span> <span data-ttu-id="ccb0e-122">In diesem Thema wird beschrieben, wie `Text` `Binary` `MTOM` Sie die in WCF enthaltenen Nachrichten Encoder, und erweitern oder einen eigenen benutzerdefinierten Encoder erstellen.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-122">This topic describes how to extend the `Text`, `Binary`, and `MTOM` message encoders that are included in WCF, or create your own custom encoder.</span></span> <span data-ttu-id="ccb0e-123">Der Textnachrichtenencoder unterstützt sowohl reine XML-Codierung als auch SOAP-Codierungen.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-123">The text message encoder supports both a plain XML encoding as well as SOAP encodings.</span></span> <span data-ttu-id="ccb0e-124">Der reine XML-Codierungsmodus des Textnachrichtenencoders wird als POX-Encoder ("Plain Old XML") bezeichnet, um ihn von der textbasierten SOAP-Codierung zu unterscheiden.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-124">The plain XML encoding mode of the text message encoder is called the POX ("Plain Old XML") encoder to distinguish it from the text-based SOAP encoding.</span></span>  
  
 <span data-ttu-id="ccb0e-125">Weitere Informationen zu den Kombinationen von Bindungs Elementen, die von den vom System bereitgestellten Bindungen bereitgestellt werden, finden Sie im entsprechenden Abschnitt unter [Auswählen eines Transports](../feature-details/choosing-a-transport.md).</span><span class="sxs-lookup"><span data-stu-id="ccb0e-125">For more information about the combinations of binding elements provided by the system-provided bindings, see the corresponding section in [Choosing a Transport](../feature-details/choosing-a-transport.md).</span></span>  
  
## <a name="how-to-work-with-system-provided-encoders"></a><span data-ttu-id="ccb0e-126">Arbeiten mit vom System bereitgestellten Encodern</span><span class="sxs-lookup"><span data-stu-id="ccb0e-126">How to Work with System-Provided Encoders</span></span>  

 <span data-ttu-id="ccb0e-127">Das Hinzufügen einer Codierung zu einem Bindungselement erfolgt mithilfe einer von <xref:System.ServiceModel.Channels.MessageEncodingBindingElement> abgeleiteten Klasse.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-127">An encoding is added to a binding using a class derived from <xref:System.ServiceModel.Channels.MessageEncodingBindingElement>.</span></span>  
  
 <span data-ttu-id="ccb0e-128">WCF stellt die folgenden Typen von Bindungs Elementen bereit, die von der- <xref:System.ServiceModel.Channels.MessageEncodingBindingElement> Klasse abgeleitet werden, die Text-, Binär-und MTOM-Codierung (Message Transmission Optimization Mechanism) bereitstellen kann:</span><span class="sxs-lookup"><span data-stu-id="ccb0e-128">WCF provides the following types of binding elements derived from the <xref:System.ServiceModel.Channels.MessageEncodingBindingElement> class that can provide for text, binary and Message Transmission Optimization Mechanism (MTOM) encoding:</span></span>  
  
- <span data-ttu-id="ccb0e-129"><xref:System.ServiceModel.Channels.TextMessageEncodingBindingElement>: Der am wenigsten effiziente Encoder für XML-Nachrichten, der jedoch das höchste Maß an Interoperabilität bietet.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-129"><xref:System.ServiceModel.Channels.TextMessageEncodingBindingElement>: The most interoperable, but the least efficient encoder for XML messages.</span></span> <span data-ttu-id="ccb0e-130">Text-XML kann in der Regel von Webdiensten oder Webdienstclients interpretiert werden.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-130">A Web service or Web service client can generally understand textual XML.</span></span> <span data-ttu-id="ccb0e-131">Das Übermitteln umfangreicher Blöcke binärer Daten in Textform ist jedoch wenig effizient.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-131">However, transmitting large blocks of binary data as text is not efficient.</span></span>  
  
- <span data-ttu-id="ccb0e-132">Die <xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement>-Klasse stellt das Bindungselement dar, von dem die Zeichencodierung und die für binäre XML-Nachrichten verwendete Nachrichtenversion angegeben werden.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-132"><xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement>: Represents the binding element that specifies the character encoding and message versioning used for binary-based XML messages.</span></span> <span data-ttu-id="ccb0e-133">Dies ist die effizienteste der Codierungsoptionen, aber die am wenigsten interoperabel, da Sie nur von WCF-Endpunkten unterstützt wird.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-133">This is most efficient of the encoding options, but the least interoperable, because it is only supported by WCF endpoints.</span></span>  
  
- <span data-ttu-id="ccb0e-134"><xref:System.ServiceModel.Channels.MtomMessageEncodingBindingElement>: Stellt das Bindungselement dar, von dem die Zeichencodierung und die für eine Meldung mit MTOM-Codierung (Message Transmission Optimization Mechanism) verwendete Nachrichtenversion angegeben werden.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-134"><xref:System.ServiceModel.Channels.MtomMessageEncodingBindingElement>: Represents the binding element that specifies the character encoding and message versioning used for a message using a Message Transmission Optimization Mechanism (MTOM) encoding.</span></span> <span data-ttu-id="ccb0e-135">MTOM ist eine effiziente Technologie zum Übertragen von Binärdaten in WCF-Nachrichten.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-135">MTOM is an efficient technology for transmitting binary data in WCF messages.</span></span> <span data-ttu-id="ccb0e-136">Der MTOM-Encoder versucht, einen Ausgleich zwischen Effizienz und Interoperabilität zu erschaffen.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-136">The MTOM encoder attempts to balance between efficiency and interoperability.</span></span> <span data-ttu-id="ccb0e-137">Die MTOM-Verschlüsselung überträgt die meisten XML-Daten in Textform, optimiert aber große Binärdatenblöcke durch Übertragung ohne Textkonvertierung.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-137">The MTOM encoding transmits most XML in textual form, but optimizes large blocks of binary data by transmitting them as-is, without conversion to text.</span></span>  
  
 <span data-ttu-id="ccb0e-138">Vom Bindungselement wird eine Binär-, MTOM- oder Text-<xref:System.ServiceModel.Channels.MessageEncoderFactory> erstellt.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-138">The binding element creates a binary, MTOM, or text <xref:System.ServiceModel.Channels.MessageEncoderFactory>.</span></span> <span data-ttu-id="ccb0e-139">Von der Factory wird eine <xref:System.ServiceModel.Channels.MessageEncoderFactory>-Binär-, MTOM- oder Textinstanz erstellt.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-139">The factory creates a binary, MTOM, or text <xref:System.ServiceModel.Channels.MessageEncoderFactory> instance.</span></span> <span data-ttu-id="ccb0e-140">Üblicherweise ist lediglich eine einzelne Instanz vorhanden.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-140">Typically, there is only a single instance.</span></span> <span data-ttu-id="ccb0e-141">Bei Verwendung von Sitzungen kann jedoch für jede Sitzung ein anderer Encoder bereitgestellt werden.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-141">However if sessions are used, a different encoder may be provided to each session.</span></span> <span data-ttu-id="ccb0e-142">Vom Binärencoder wird diese Möglichkeit zum Koordinieren dynamischer Wörterbücher genutzt (siehe XML-Infrastruktur).</span><span class="sxs-lookup"><span data-stu-id="ccb0e-142">The Binary encoder makes use of this to coordinate dynamic dictionaries (see XML Infrastructure).</span></span>  
  
 <span data-ttu-id="ccb0e-143">Die Methoden <xref:System.ServiceModel.Channels.MessageEncoder.ReadMessage%2A> und <xref:System.ServiceModel.Channels.MessageEncoder.WriteMessage%2A> bilden den Kern der Encoder.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-143">The <xref:System.ServiceModel.Channels.MessageEncoder.ReadMessage%2A> and <xref:System.ServiceModel.Channels.MessageEncoder.WriteMessage%2A> methods are the core of the encoders.</span></span> <span data-ttu-id="ccb0e-144">Sie dienen zum Lesen einer Nachricht aus einem Stream oder aus einem <xref:System.Byte>-Array.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-144">The methods provide for reading a message from a stream or from a <xref:System.Byte> array.</span></span> <span data-ttu-id="ccb0e-145">Bytearrays werden verwendet, wenn der Transport im Puffermodus betrieben wird.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-145">Byte arrays are used when the transport is operating in buffered mode.</span></span> <span data-ttu-id="ccb0e-146">Nachrichten werden stets in Streams geschrieben.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-146">Messages are always written to streams.</span></span> <span data-ttu-id="ccb0e-147">Muss die Nachricht gepuffert werden, wird hierzu ein Stream bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-147">If the transport must buffer the message, it provides a stream that does the buffering.</span></span>  
  
 <span data-ttu-id="ccb0e-148">Die restlichen Member arbeiten mit Supportinhalten, Medientypen und <xref:System.ServiceModel.Channels.MessageEncoder.MessageVersion%2A>.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-148">The rest of the members work with support content, media types, and <xref:System.ServiceModel.Channels.MessageEncoder.MessageVersion%2A>.</span></span> <span data-ttu-id="ccb0e-149">Die Encodermethoden werden vom Transport aufgerufen, um zu testen, ob die eingehende Nachricht damit decodiert werden kann, oder um festzustellen, ob die ausgehende Nachricht für diesen Encoder geeignet ist.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-149">The transport calls these encoder methods to test whether the incoming message can be decoded by it, or to determine if the outgoing message is valid for this encoder.</span></span>  
  
 <span data-ttu-id="ccb0e-150">Mit jeder der drei Encoderimplementierungen werden Eigenschaften hinzugefügt, die für die jeweilige Codierung benötigt werden. Darüber hinaus sind sie vollständig konfigurierbar.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-150">Each of the three encoder implementations adds properties that are relevant to the specific encodings and is fully configurable.</span></span> <span data-ttu-id="ccb0e-151">Von den Encodern werden überdies Readerkontingente mit sicheren Standardeinstellungen verfügbar gemacht.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-151">The encoders also expose reader quotas that have secure defaults.</span></span> <span data-ttu-id="ccb0e-152">Informationen zu Kontingenten finden Sie im Thema zur XML-Infrastruktur.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-152">See XML Infrastructure for a discussion of the quotas.</span></span>  
  
## <a name="features-of-system-provided-encoders"></a><span data-ttu-id="ccb0e-153">Funktionen der vom System bereitgestellten Encoder</span><span class="sxs-lookup"><span data-stu-id="ccb0e-153">Features of System-Provided Encoders</span></span>  

 <span data-ttu-id="ccb0e-154">Die vom System bereitgestellten Encoder verfügen über eine Reihe von Funktionen.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-154">There are a number of features provided by the system-provided encoders.</span></span>  
  
### <a name="pooling"></a><span data-ttu-id="ccb0e-155">Pooling</span><span class="sxs-lookup"><span data-stu-id="ccb0e-155">Pooling</span></span>  

 <span data-ttu-id="ccb0e-156">Für jede der Encoderimplementierungen wird versucht, ein Höchstmaß an Pooling zu erzielen.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-156">Each of the encoder implementations tries to pool as much as possible.</span></span> <span data-ttu-id="ccb0e-157">Eine geeignete Vorgehensweise zum Verbessern der Leistung verwalteten Codes besteht im Verringern der Speicherbelegung.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-157">Reducing allocations is a key way to improve the performance of managed code.</span></span> <span data-ttu-id="ccb0e-158">Für das Pooling wird von den Implementierungen die `SynchronizedPool`-Klasse verwendet.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-158">To accomplish this pooling, the implementations use the `SynchronizedPool` class.</span></span> <span data-ttu-id="ccb0e-159">Die C#-Datei enthält eine Beschreibung der zusätzlichen, von dieser Klasse verwendeten Optimierungen.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-159">The C# file contains a description of the additional optimizations used by this class.</span></span>  
  
 <span data-ttu-id="ccb0e-160">Die Instanzen <xref:System.Xml.XmlDictionaryReader> und <xref:System.Xml.XmlDictionaryWriter> werden in einem Pool zusammengefasst und neu initialisiert, um eine Neuzuordnung von Instanzen für jede Nachricht zu unterbinden.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-160"><xref:System.Xml.XmlDictionaryReader> and <xref:System.Xml.XmlDictionaryWriter> instances are pooled and reinitialized to prevent allocating new ones for each message.</span></span> <span data-ttu-id="ccb0e-161">Bei einem Reader wird dieser mithilfe eines `OnClose`-Rückrufs zurückgefordert, wenn `Close()` aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-161">For the readers, an `OnClose` callback reclaims the reader when `Close()` is called.</span></span> <span data-ttu-id="ccb0e-162">Vom Encoder werden auch einige Nachrichtenzustandsobjekte wiederverwendet, die bei der Nachrichtenerstellung verwendet wurden.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-162">The encoder also recycles some message state objects used when constructing messages.</span></span> <span data-ttu-id="ccb0e-163">Die Größe dieser Pools kann über die Eigenschaften `MaxReadPoolSize` und `MaxWritePoolSize` für jede der drei von <xref:System.ServiceModel.Channels.MessageEncodingBindingElement> abgeleiteten Klassen konfiguriert werden.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-163">The sizes of these pools are configurable by the `MaxReadPoolSize` and `MaxWritePoolSize` properties on each of the three classes derived from <xref:System.ServiceModel.Channels.MessageEncodingBindingElement>.</span></span>  
  
### <a name="binary-encoding"></a><span data-ttu-id="ccb0e-164">Binärcodierung</span><span class="sxs-lookup"><span data-stu-id="ccb0e-164">Binary Encoding</span></span>  

 <span data-ttu-id="ccb0e-165">Werden bei der Binärcodierung Sitzungen verwendet, muss die dynamische Wörterbuchzeichenfolge an den Empfänger der Nachricht übermittelt werden.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-165">When binary encoding uses sessions, the dynamic dictionary string must be communicated to the receiver of the message.</span></span> <span data-ttu-id="ccb0e-166">Hierzu werden der Nachricht die dynamischen Wörterbuchzeichenfolgen als Präfix hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-166">This is done by prefixing the message with the dynamic dictionary strings.</span></span> <span data-ttu-id="ccb0e-167">Vom Empfänger werden die Zeichenfolgen entfernt und der Sitzung hinzugefügt. Anschließend wird die Nachricht verarbeitet.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-167">The receiver strips off the strings, adds them to the session, and processes the message.</span></span> <span data-ttu-id="ccb0e-168">Für die ordnungsgemäße Übergabe der Wörterbuchzeichenfolgen muss der Transport gepuffert werden.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-168">Correctly passing dictionary strings requires that the transport be buffered.</span></span>  
  
 <span data-ttu-id="ccb0e-169">Die Zeichenfolgen werden der Meldung mithilfe einer internen `AddSessionInformationToMessage`-Methode angehängt.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-169">The strings are appended to the message by an internal `AddSessionInformationToMessage` method.</span></span> <span data-ttu-id="ccb0e-170">Mit dieser Methode werden die Zeichenfolgen dem Nachrichtenanfang als UTF-8 hinzugefügt. Davor wird als Präfix die Länge der Zeichenfolgen eingefügt.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-170">It adds the strings as UTF-8 to the front of the message prefixed with their length.</span></span> <span data-ttu-id="ccb0e-171">Der gesamte Wörterbuchheader wird daraufhin mit einem Präfix versehen, das die Datenlänge enthält.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-171">The entire dictionary header is then prefixed with the length of its data.</span></span> <span data-ttu-id="ccb0e-172">Der umgekehrte Vorgang erfolgt mittels einer internen `ExtractSessionInformationFromMessage`-Methode.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-172">The reverse operation is performed by an internal `ExtractSessionInformationFromMessage` method.</span></span>  
  
 <span data-ttu-id="ccb0e-173">Zusätzlich zum Verarbeiten dynamischer Wörterbuchschlüssel erfolgt der Empfang sitzungsbasierter Meldungen auf eindeutige Weise.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-173">In addition to processing dynamic dictionary keys, buffered sessionful messages are received in a unique way.</span></span> <span data-ttu-id="ccb0e-174">Anstatt einen Reader über das Dokument zu erstellen und dieses anschließend zu verarbeiten, wird der binäre Stream bei der Binärcodierung mithilfe der internen `MessagePatterns`-Klasse zerlegt.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-174">Instead of creating a reader over the document and processing it, the binary encoder uses the internal `MessagePatterns` class to deconstruct the binary stream.</span></span> <span data-ttu-id="ccb0e-175">Die Idee ist, dass die meisten Nachrichten über einen bestimmten Satz von Headern verfügen, die bei der Generierung durch WCF in einer bestimmten Reihenfolge angezeigt werden.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-175">The idea is that most messages have a certain set of headers that show up in a certain order when generated by WCF.</span></span> <span data-ttu-id="ccb0e-176">Die Nachricht wird vom Mustersystem auf Basis der jeweiligen Erwartung zerlegt.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-176">The pattern system breaks the message apart based on what it expects.</span></span> <span data-ttu-id="ccb0e-177">Ist der Vorgang erfolgreich, wird ohne XML-Analyse ein <xref:System.ServiceModel.Channels.MessageHeaders>-Objekt erstellt.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-177">If it is successful, it initializes a <xref:System.ServiceModel.Channels.MessageHeaders> object without parsing the XML.</span></span> <span data-ttu-id="ccb0e-178">Andernfalls wird wieder die Standardmethode verwendet.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-178">If not, it falls back to the standard method.</span></span>  
  
### <a name="mtom-encoding"></a><span data-ttu-id="ccb0e-179">MTOM-Codierung</span><span class="sxs-lookup"><span data-stu-id="ccb0e-179">MTOM Encoding</span></span>  

 <span data-ttu-id="ccb0e-180">Die <xref:System.ServiceModel.Channels.MtomMessageEncodingBindingElement>-Klasse verfügt über eine zusätzliche Konfigurationseigenschaft mit der Bezeichnung <xref:System.ServiceModel.Channels.MtomMessageEncodingBindingElement.MaxBufferSize%2A>.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-180">The <xref:System.ServiceModel.Channels.MtomMessageEncodingBindingElement> class has an additional configuration property called <xref:System.ServiceModel.Channels.MtomMessageEncodingBindingElement.MaxBufferSize%2A>.</span></span> <span data-ttu-id="ccb0e-181">Hierdurch wird eine Obergrenze für die Menge der Daten festgelegt, die beim Lesen einer Nachricht gepuffert werden dürfen.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-181">This places an upper bound on how much data it is allowed to buffer during the process of reading a message.</span></span> <span data-ttu-id="ccb0e-182">Das XML Information Set (Infoset) sowie andere MIME-Teile müssen möglicherweise gepuffert werden, um MIME-Teile wieder zu einer einzelnen Nachricht zusammenzufügen.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-182">The XML Information Set (Infoset), or other MIME parts, may need to be buffered to reassemble all the MIME parts into a single message.</span></span>  
  
 <span data-ttu-id="ccb0e-183">Für das ordnungsgemäße Funktionieren mit HTTP werden vom internen MTOM-Nachrichtenencoder einige interne APIs für `GetContentType` (ebenfalls intern) und `WriteMessage` bereitgestellt. Letzteres Element ist öffentlich und kann außer Kraft gesetzt werden.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-183">To work correctly with HTTP, the internal MTOM message encoder class provides some internal APIs for `GetContentType` (which is also internal) and `WriteMessage`, which is public and can be overridden.</span></span> <span data-ttu-id="ccb0e-184">Damit sichergestellt ist, dass die Werte in den HTTP-Headern mit den Werten in den MIME-Headern übereinstimmen, ist ein höheres Kommunikationsaufkommen erforderlich.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-184">More communication must occur to ensure values in the HTTP headers agree with values in the MIME headers.</span></span>  
  
 <span data-ttu-id="ccb0e-185">Intern verwendet der MTOM-Nachrichten Encoder WCF-Text Reader und ähnelt dem Text Encoder.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-185">Internally, the MTOM message encoder uses WCF's text readers, and is similar to the Text encoder.</span></span> <span data-ttu-id="ccb0e-186">Der Hauptunterschied besteht darin, dass vom MTOM-Nachrichtenencoder große Binärcodeabschnitte (oder "Binary Large Objects", so genannte BLOBs) optimiert werden, indem sie vor dem Einbetten in die Nachrichtenbytes nicht in eine Base-64-Codierung umgewandelt werden.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-186">The main difference is that it optimizes large chunks of binary, or "Binary Large Objects" (BLOBs), by not converting them to Base-64 encoding prior to being embedded into the message bytes.</span></span> <span data-ttu-id="ccb0e-187">Stattdessen bleiben diese BLOBs extrahiert und werden als MIME-Anhänge referenziert.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-187">Instead, these BLOBs are kept extracted, and referenced as the MIME attachments.</span></span>  
  
## <a name="writing-your-own-encoder"></a><span data-ttu-id="ccb0e-188">Schreiben eigener Encoder</span><span class="sxs-lookup"><span data-stu-id="ccb0e-188">Writing your own Encoder</span></span>  

 <span data-ttu-id="ccb0e-189">Zum Implementieren eines eigenen Nachrichtenencoders müssen benutzerdefinierte Implementierungen der folgenden abstrakten Basisklassen bereitgestellt werden:</span><span class="sxs-lookup"><span data-stu-id="ccb0e-189">To implement your own custom message encoder, you must provide custom implementations of the following abstract base classes:</span></span>  
  
- <xref:System.ServiceModel.Channels.MessageEncoder>  
  
- <xref:System.ServiceModel.Channels.MessageEncoderFactory>  
  
- <xref:System.ServiceModel.Channels.MessageEncodingBindingElement>  
  
 <span data-ttu-id="ccb0e-190">Die Umwandlung der speicherinternen Version einer Nachricht zu einer Version, die in einen Stream geschrieben werden kann, ist Teil der <xref:System.ServiceModel.Channels.MessageEncoder>-Klasse, die als Factory für XML-Reader und XML-Writer mit Unterstützung für bestimmte XML-Codierungstypen fungiert.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-190">Converting from the in-memory representation of a message to a representation that can be written to a stream is encapsulated within the <xref:System.ServiceModel.Channels.MessageEncoder> class, which serves as a factory for XML readers and XML writers that support specific types of XML encodings.</span></span>  
  
- <span data-ttu-id="ccb0e-191">Folgende Schlüsselmethoden dieser Klasse müssen außer Kraft gesetzt werden:</span><span class="sxs-lookup"><span data-stu-id="ccb0e-191">The key methods of this class that you must override are:</span></span>  
  
- <span data-ttu-id="ccb0e-192"><xref:System.ServiceModel.Channels.MessageEncoder.WriteMessage%2A>: nimmt ein <xref:System.ServiceModel.Channels.MessageEncodingBindingElement>-Objekt an und schreibt es in ein <xref:System.IO.Stream>-Objekt.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-192"><xref:System.ServiceModel.Channels.MessageEncoder.WriteMessage%2A> which takes a <xref:System.ServiceModel.Channels.MessageEncodingBindingElement> object and writes it into a <xref:System.IO.Stream> object.</span></span>  
  
- <span data-ttu-id="ccb0e-193"><xref:System.ServiceModel.Channels.MessageEncoder.ReadMessage%2A>: nimmt ein <xref:System.IO.Stream>-Objekt sowie eine maximale Headergröße an und gibt ein <xref:System.ServiceModel.Channels.Message>-Objekt zurück.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-193"><xref:System.ServiceModel.Channels.MessageEncoder.ReadMessage%2A> which takes a <xref:System.IO.Stream> object and a maximum header size and returns a <xref:System.ServiceModel.Channels.Message> object.</span></span>  
  
 <span data-ttu-id="ccb0e-194">Die Umwandlung zwischen dem standardmäßigen Transportprotokoll und der benutzerdefinierten Codierung wird anhand des in diese Methoden geschriebenen Codes behandelt.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-194">It is the code you write in these methods that handles conversion between the standard transport protocol, and your customized encoding.</span></span>  
  
 <span data-ttu-id="ccb0e-195">Der nächste Schritt besteht im Codieren einer Factoryklasse zum Erstellen des benutzerdefinierten Encoders.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-195">Next you need to code a factory class that creates your custom encoder.</span></span> <span data-ttu-id="ccb0e-196">Überschreiben Sie den <xref:System.ServiceModel.Channels.MessageEncoderFactory.Encoder%2A>, um eine Instanz des benutzerdefinierten <xref:System.ServiceModel.Channels.MessageEncoder> zurückzugeben.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-196">Override the <xref:System.ServiceModel.Channels.MessageEncoderFactory.Encoder%2A> to return an instance of your custom <xref:System.ServiceModel.Channels.MessageEncoder>.</span></span>  
  
 <span data-ttu-id="ccb0e-197">Verbinden Sie anschließend die benutzerdefinierte <xref:System.ServiceModel.Channels.MessageEncoderFactory> mit dem Bindungselementstapel für die Konfiguration des Diensts oder des Clients durch Überschreiben der <xref:System.ServiceModel.Channels.MessageEncodingBindingElement.CreateMessageEncoderFactory%2A>-Methode, um eine Instanz der Factory zurückzugeben.</span><span class="sxs-lookup"><span data-stu-id="ccb0e-197">Then connect your custom <xref:System.ServiceModel.Channels.MessageEncoderFactory> to the binding element stack used to configure the service or client by overriding the <xref:System.ServiceModel.Channels.MessageEncodingBindingElement.CreateMessageEncoderFactory%2A> method to return an instance of this factory.</span></span>  
  
 <span data-ttu-id="ccb0e-198">WCF enthält zwei Beispiele, die diesen Prozess mit Beispielcode veranschaulichen: [benutzerdefinierter Nachrichten Encoder: benutzerdefinierter Text Encoder](../samples/custom-message-encoder-custom-text-encoder.md) und [benutzerdefinierter Nachrichten Encoder: Komprimierungs Encoder](../samples/custom-message-encoder-compression-encoder.md).</span><span class="sxs-lookup"><span data-stu-id="ccb0e-198">There are two samples provided with WCF that illustrate this process with sample code: [Custom Message Encoder: Custom Text Encoder](../samples/custom-message-encoder-custom-text-encoder.md) and [Custom Message Encoder: Compression Encoder](../samples/custom-message-encoder-compression-encoder.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ccb0e-199">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="ccb0e-199">See also</span></span>

- <xref:System.ServiceModel.Channels.MessageEncodingBindingElement>
- <xref:System.ServiceModel.Channels.MessageEncoderFactory>
- <xref:System.ServiceModel.Channels.MessageEncoder>
- [<span data-ttu-id="ccb0e-200">Datenübertragungsarchitektur - Übersicht</span><span class="sxs-lookup"><span data-stu-id="ccb0e-200">Data Transfer Architectural Overview</span></span>](../feature-details/data-transfer-architectural-overview.md)
- [<span data-ttu-id="ccb0e-201">Auswählen eines Nachrichtenencoders</span><span class="sxs-lookup"><span data-stu-id="ccb0e-201">Choosing a Message Encoder</span></span>](../feature-details/choosing-a-message-encoder.md)
- [<span data-ttu-id="ccb0e-202">Wählen eines Transports</span><span class="sxs-lookup"><span data-stu-id="ccb0e-202">Choosing a Transport</span></span>](../feature-details/choosing-a-transport.md)
