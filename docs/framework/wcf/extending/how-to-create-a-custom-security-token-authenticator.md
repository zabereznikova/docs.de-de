---
title: 'Gewusst wie: erstellen ein benutzerdefinierten sicherheitstokenauthentifizierers'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, authentication
ms.assetid: 10e245f7-d31e-42e7-82a2-d5780325d372
author: BrucePerlerMS
ms.openlocfilehash: cbedab4064173186251defead8394735de033cf7
ms.sourcegitcommit: fb78d8abbdb87144a3872cf154930157090dd933
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 09/26/2018
ms.locfileid: "47196576"
---
# <a name="how-to-create-a-custom-security-token-authenticator"></a><span data-ttu-id="7b5a9-102">Gewusst wie: erstellen ein benutzerdefinierten sicherheitstokenauthentifizierers</span><span class="sxs-lookup"><span data-stu-id="7b5a9-102">How to: create a custom security token authenticator</span></span>
<span data-ttu-id="7b5a9-103">In diesem Thema wird beschrieben, wie Sie einen benutzerdefinierten Sicherheitstokenauthentifizierer erstellen und in einen benutzerdefinierten Sicherheitstoken-Manager integrieren.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-103">This topic shows how to create a custom security token authenticator and how to integrate it with a custom security token manager.</span></span> <span data-ttu-id="7b5a9-104">Ein Sicherheitstokenauthentifizierer überprüft den Inhalt eines Sicherheitstokens, das mit einer eingehenden Nachricht bereitgestellt wird.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-104">A security token authenticator validates the content of a security token provided with an incoming message.</span></span> <span data-ttu-id="7b5a9-105">Bei erfolgreicher Validierung gibt der Authentifizierer eine Sammlung von <xref:System.IdentityModel.Policy.IAuthorizationPolicy>-Instanzen zurück, die nach der Auswertung einen Satz von Ansprüchen zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-105">If the validation succeeds, the authenticator returns a collection of <xref:System.IdentityModel.Policy.IAuthorizationPolicy> instances that, when evaluated, returns a set of claims.</span></span>  
  
 <span data-ttu-id="7b5a9-106">Um einen benutzerdefinierten Sicherheitstoken-Authentifikator in Windows Communication Foundation (WCF) verwenden, müssen Sie zunächst benutzerdefinierte Anmeldeinformationen und Sicherheitstoken-managerimplementierungen erstellen.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-106">To use a custom security token authenticator in Windows Communication Foundation (WCF), you must first create custom credentials and security token manager implementations.</span></span> <span data-ttu-id="7b5a9-107">Weitere Informationen zum Erstellen von benutzerdefinierten Anmeldeinformationen und Sicherheitstoken-Manager finden Sie unter [Exemplarische Vorgehensweise: Erstellen von benutzerdefinierten Client- und Dienstanmeldeinformationen](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span><span class="sxs-lookup"><span data-stu-id="7b5a9-107">For more information about creating custom credentials and a security token manager, see [Walkthrough: Creating Custom Client and Service Credentials](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span></span> <span data-ttu-id="7b5a9-108">Weitere Informationen zu Anmeldeinformationen, Sicherheitstoken-Manager sowie Anbieter- und authentifiziererklassen finden Sie unter [Sicherheitsarchitektur](https://msdn.microsoft.com/library/16593476-d36a-408d-808c-ae6fd483e28f).</span><span class="sxs-lookup"><span data-stu-id="7b5a9-108">For more information about credentials, security token manager, and provider and authenticator classes, see [Security Architecture](https://msdn.microsoft.com/library/16593476-d36a-408d-808c-ae6fd483e28f).</span></span>  
  
## <a name="procedures"></a><span data-ttu-id="7b5a9-109">Verfahren</span><span class="sxs-lookup"><span data-stu-id="7b5a9-109">Procedures</span></span>  
  
#### <a name="to-create-a-custom-security-token-authenticator"></a><span data-ttu-id="7b5a9-110">So erstellen Sie einen benutzerdefinierten Sicherheitstokenauthentifizierer</span><span class="sxs-lookup"><span data-stu-id="7b5a9-110">To create a custom security token authenticator</span></span>  
  
1.  <span data-ttu-id="7b5a9-111">Definieren Sie eine neue von der <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator>-Klasse abgeleitete Klasse.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-111">Define a new class derived from the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> class.</span></span>  
  
2.  <span data-ttu-id="7b5a9-112">Überschreiben Sie die <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateTokenCore%2A>-Methode.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-112">Override the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateTokenCore%2A> method.</span></span> <span data-ttu-id="7b5a9-113">Die Methode gibt `true` oder `false` zurück, je nachdem, ob der benutzerdefinierte Authentifizierer den eingehenden Tokentyp auswerten kann oder nicht.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-113">The method returns `true` or `false` depending on whether the custom authenticator can validate the incoming token type or not.</span></span>  
  
3.  <span data-ttu-id="7b5a9-114">Überschreiben Sie die <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.ValidateTokenCore%2A>-Methode.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-114">Override the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.ValidateTokenCore%2A> method.</span></span> <span data-ttu-id="7b5a9-115">Diese Methode muss den Tokeninhalt entsprechend überprüfen.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-115">This method needs to validate the token contents appropriately.</span></span> <span data-ttu-id="7b5a9-116">Wenn das Token den Validierungsschritt übergibt, gibt es eine Auflistung von <xref:System.IdentityModel.Policy.IAuthorizationPolicy>-Instanzen zurück.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-116">If the token passes the validation step, it returns a collection of <xref:System.IdentityModel.Policy.IAuthorizationPolicy> instances.</span></span> <span data-ttu-id="7b5a9-117">Im folgenden Beispiel wird eine benutzerdefinierte Autorisierungsrichtlinienimplementierung, die in der nächsten Prozedur erstellt wird, verwendet.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-117">The following example uses a custom authorization policy implementation that will be created in the next procedure.</span></span>  
  
     [!code-csharp[C_CustomTokenAuthenticator#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtokenauthenticator/cs/source.cs#1)]
     [!code-vb[C_CustomTokenAuthenticator#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtokenauthenticator/vb/source.vb#1)]  
  
 <span data-ttu-id="7b5a9-118">Der vorherige Code gibt eine Auflistung von Autorisierungsrichtlinien in der <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateToken%28System.IdentityModel.Tokens.SecurityToken%29>-Methode zurück.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-118">The previous code returns a collection of authorization policies in the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateToken%28System.IdentityModel.Tokens.SecurityToken%29> method.</span></span> <span data-ttu-id="7b5a9-119">WCF stellt keine öffentliche Implementierung dieser Schnittstelle bereit.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-119">WCF does not provide a public implementation of this interface.</span></span> <span data-ttu-id="7b5a9-120">Die folgende Prozedur zeigt, wie Sie diese Schritte Ihren eigenen Anforderungen entsprechend ausführen.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-120">The following procedure shows how to do so for your own requirements.</span></span>  
  
#### <a name="to-create-a-custom-authorization-policy"></a><span data-ttu-id="7b5a9-121">So erstellen Sie eine benutzerdefinierte Autorisierungsrichtlinie</span><span class="sxs-lookup"><span data-stu-id="7b5a9-121">To create a custom authorization policy</span></span>  
  
1.  <span data-ttu-id="7b5a9-122">Definieren Sie eine neue Klasse, die die <xref:System.IdentityModel.Policy.IAuthorizationPolicy>-Schnittstelle implementiert.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-122">Define a new class implementing the <xref:System.IdentityModel.Policy.IAuthorizationPolicy> interface.</span></span>  
  
2.  <span data-ttu-id="7b5a9-123">Implementieren Sie die schreibgeschützte <xref:System.IdentityModel.Policy.IAuthorizationComponent.Id%2A>-Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-123">Implement the <xref:System.IdentityModel.Policy.IAuthorizationComponent.Id%2A> read-only property.</span></span> <span data-ttu-id="7b5a9-124">Eine Möglichkeit, diese Eigenschaft zu implementieren, besteht darin, eine GUID (Globally Unique Identifier) im Klassenkonstruktor zu generieren und jedes Mal zurückzugeben, wenn der Wert für diese Eigenschaft angefordert wird.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-124">One way to implement this property is to generate a globally unique identifier (GUID) in the class constructor and return it every time the value for this property is requested.</span></span>  
  
3.  <span data-ttu-id="7b5a9-125">Implementieren Sie die schreibgeschützte <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Issuer%2A>-Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-125">Implement the <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Issuer%2A> read-only property.</span></span> <span data-ttu-id="7b5a9-126">Diese Eigenschaft muss einen Aussteller der Sätze von Ansprüchen zurückgeben, die aus dem Token abgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-126">This property needs to return an issuer of the claim sets that are obtained from the token.</span></span> <span data-ttu-id="7b5a9-127">Dieser Aussteller sollte dem Aussteller des Tokens oder einer Autorität entsprechen, die für die Überprüfung der Tokeninhalte zuständig ist.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-127">This issuer should correspond to the issuer of the token or an authority that is responsible for validating the token contents.</span></span> <span data-ttu-id="7b5a9-128">Im folgenden Beispiel wird der Ausstelleranspruch, der von dem in der vorherigen Prozedur erstellten benutzerdefinierten Sicherheitstokenauthentifizierer an diese Klasse übergeben wird, verwendet.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-128">The following example uses the issuer claim that passed to this class from the custom security token authenticator created in the previous procedure.</span></span> <span data-ttu-id="7b5a9-129">Der benutzerdefinierte Sicherheitstokenauthentifizierer nutzt den vom System bereitgestellten Satz von Ansprüchen (der von der <xref:System.IdentityModel.Claims.ClaimSet.System%2A>-Eigenschaft zurückgegeben wird), um den Aussteller des Benutzernamentokens darzustellen.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-129">The custom security token authenticator uses the system-provided claim set (returned by the <xref:System.IdentityModel.Claims.ClaimSet.System%2A> property) to represent the issuer of the username token.</span></span>  
  
4.  <span data-ttu-id="7b5a9-130">Implementieren Sie die <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Evaluate%2A>-Methode.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-130">Implement the <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Evaluate%2A> method.</span></span> <span data-ttu-id="7b5a9-131">Diese Methode füllt eine Instanz der <xref:System.IdentityModel.Policy.EvaluationContext>-Klasse (die als Argument weitergegeben wurde) mit Ansprüchen auf, die auf dem eingehenden Sicherheitstokeninhalt basieren.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-131">This method populates an instance of the <xref:System.IdentityModel.Policy.EvaluationContext> class (passed in as an argument) with claims that are based on the incoming security token content.</span></span> <span data-ttu-id="7b5a9-132">Die Methode gibt `true` zurück, wenn der Vorgang mit der Evaluierung vorgenommen wird.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-132">The method returns `true` when it is done with the evaluation.</span></span> <span data-ttu-id="7b5a9-133">In Fällen, in denen die Implementierung vom Vorhandensein anderer Autorisierungsrichtlinien abhängt, die zusätzliche Informationen zum Evaluierungskontext bieten, kann diese Methode `false` zurückgeben, wenn die erforderlichen Informationen noch nicht im Evaluierungskontext vorhanden sind.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-133">In cases when the implementation relies on the presence of other authorization policies that provide additional information to the evaluation context, this method can return `false` if the required information is not present yet in the evaluation context.</span></span> <span data-ttu-id="7b5a9-134">In diesem Fall wird WCF Aufrufen der Methode erneut nach der Auswertung aller Autorisierungsrichtlinien, die für die eingehende Nachricht generiert wird, wenn mindestens eine der Autorisierungsrichtlinien den Evaluierungskontext modifiziert.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-134">In that case, WCF will call the method again after evaluating all other authorization policies generated for the incoming message if at least one of those authorization policies modified the evaluation context.</span></span>  
  
     [!code-csharp[c_CustomTokenAuthenticator#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtokenauthenticator/cs/source.cs#3)]
     [!code-vb[c_CustomTokenAuthenticator#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtokenauthenticator/vb/source.vb#3)]  

 <span data-ttu-id="7b5a9-135">[Exemplarische Vorgehensweise: Erstellen von benutzerdefinierten Client- und Dienstanmeldeinformationen](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md) wird beschrieben, wie benutzerdefinierte Anmeldeinformationen und einen benutzerdefinierten Sicherheitstoken-Manager erstellen.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-135">[Walkthrough: Creating Custom Client and Service Credentials](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md) describes how to create custom credentials and a custom security token manager.</span></span> <span data-ttu-id="7b5a9-136">Zur Verwendung des hier erstellten benutzerdefinierten Sicherheitstokenauthentifizierers wird eine Implementierung des Sicherheitstoken-Managers so geändert, dass der benutzerdefinierte Authentifizierer von der <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A>-Methode zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-136">To use the custom security token authenticator created here, an implementation of the security token manager is modified to return the custom authenticator from the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> method.</span></span> <span data-ttu-id="7b5a9-137">Die Methode gibt einen Authentifizierer zurück, wenn eine entsprechende Sicherheitstokenanforderung übergeben wird.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-137">The method returns an authenticator when an appropriate security token requirement is passed in.</span></span>  
  
#### <a name="to-integrate-a-custom-security-token-authenticator-with-a-custom-security-token-manager"></a><span data-ttu-id="7b5a9-138">So integrieren Sie einen benutzerdefinierten Sicherheitstokenauthentifizierer mit einem benutzerdefinierten Sicherheitstoken-Manager</span><span class="sxs-lookup"><span data-stu-id="7b5a9-138">To integrate a custom security token authenticator with a custom security token manager</span></span>  
  
1.  <span data-ttu-id="7b5a9-139">Überschreiben Sie die <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A>-Methode in der benutzerdefinierten Sicherheitstoken-Manager-Implementierung.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-139">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> method in your custom security token manager implementation.</span></span>  
  
2.  <span data-ttu-id="7b5a9-140">Fügen Sie Logik zur Methode hinzu, um diese zu befähigen, Ihren benutzerdefinierten Sicherheitstokenauthentifizierer basierend auf dem <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>-Parameter zurückzugeben.</span><span class="sxs-lookup"><span data-stu-id="7b5a9-140">Add logic to the method to enable it to return your custom security token authenticator based on the <xref:System.IdentityModel.Selectors.SecurityTokenRequirement> parameter.</span></span> <span data-ttu-id="7b5a9-141">Im folgenden Beispiel wird ein benutzerdefinierter Sicherheitstokenauthentifizierer zurückgegeben, wenn der Tokentyp der Tokenanforderungen ein Benutzername ist (der von der <xref:System.IdentityModel.Tokens.SecurityTokenTypes.UserName%2A>-Eigenschaft dargestellt wird) und die Nachrichtenrichtung, für die der Sicherheitstokenauthentifizierer angefordert wird, eingegeben wird (dargestellt durch das <xref:System.ServiceModel.Description.MessageDirection.Input>-Feld).</span><span class="sxs-lookup"><span data-stu-id="7b5a9-141">The following example returns a custom security token authenticator if the token requirements token type is a user name (represented by the <xref:System.IdentityModel.Tokens.SecurityTokenTypes.UserName%2A> property) and the message direction for which the security token authenticator is being requested is input (represented by the <xref:System.ServiceModel.Description.MessageDirection.Input> field).</span></span>  
  
     [!code-csharp[c_CustomTokenAuthenticator#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtokenauthenticator/cs/source.cs#2)]
     [!code-vb[c_CustomTokenAuthenticator#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtokenauthenticator/vb/source.vb#2)]  
 
## <a name="see-also"></a><span data-ttu-id="7b5a9-142">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="7b5a9-142">See also</span></span>  
 <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator>  
 <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>  
 <xref:System.IdentityModel.Selectors.SecurityTokenManager>  
 <xref:System.IdentityModel.Tokens.UserNameSecurityToken>  
 [<span data-ttu-id="7b5a9-143">Exemplarische Vorgehensweise: Erstellen von benutzerdefinierten Client- und Dienstanmeldeinformationen</span><span class="sxs-lookup"><span data-stu-id="7b5a9-143">Walkthrough: Creating Custom Client and Service Credentials</span></span>](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md)  
 [<span data-ttu-id="7b5a9-144">Vorgehensweise: Erstellen eines benutzerdefinierten Sicherheitstokenanbieters</span><span class="sxs-lookup"><span data-stu-id="7b5a9-144">How to: Create a Custom Security Token Provider</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md)  
 [<span data-ttu-id="7b5a9-145">Sicherheitsarchitektur</span><span class="sxs-lookup"><span data-stu-id="7b5a9-145">Security Architecture</span></span>](https://msdn.microsoft.com/library/16593476-d36a-408d-808c-ae6fd483e28f)
