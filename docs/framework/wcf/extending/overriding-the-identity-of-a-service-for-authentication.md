---
title: "Überschreiben der Identität eines Dienstes zur Authentifizierung"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
ms.assetid: d613a22b-07d7-41a4-bada-1adc653b9b5d
caps.latest.revision: "9"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.openlocfilehash: f625a9ebc3a522d93232922aa1f87ef15ed48558
ms.sourcegitcommit: ce279f2d7fe2220e6ea0a25a8a7a5370ddf8d9f0
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 12/02/2017
---
# <a name="overriding-the-identity-of-a-service-for-authentication"></a><span data-ttu-id="6b4df-102">Überschreiben der Identität eines Dienstes zur Authentifizierung</span><span class="sxs-lookup"><span data-stu-id="6b4df-102">Overriding the Identity of a Service for Authentication</span></span>
<span data-ttu-id="6b4df-103">In der Regel müssen Sie die Identität für einen Dienst nicht festlegen, da die Auswahl eines Clientanmeldeinformationstyps über den in den Dienstmetadaten angezeigten Identitätstyp entscheidet.</span><span class="sxs-lookup"><span data-stu-id="6b4df-103">Typically, you do not have to set the identity on a service because the selection of a client credential type dictates the type of identity exposed in the service metadata.</span></span> <span data-ttu-id="6b4df-104">Der folgende Konfigurationscode verwendet beispielsweise die [ \<WsHttpBinding >](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md) Element und legt die `clientCredentialType` -Attribut auf Windows.</span><span class="sxs-lookup"><span data-stu-id="6b4df-104">For example, the following configuration code uses the [\<wsHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md) element and sets the `clientCredentialType` attribute to Windows.</span></span>  
  
  
  
 <span data-ttu-id="6b4df-105">Das folgende Web Services Description Language (WSDL)-Fragment zeigt die Identität für den zuvor definierten Endpunkt an.</span><span class="sxs-lookup"><span data-stu-id="6b4df-105">The following Web Services Description Language (WSDL) fragment shows the identity for the endpoint previously defined.</span></span> <span data-ttu-id="6b4df-106">In diesem Beispiel wird der Dienst ausgeführt wird, als ein selbst gehosteter Dienst unter einem bestimmten Benutzerkonto (username@contoso.com) und aus diesem Grund enthält die Identität des Benutzers Benutzerprinzipalnamen (UPN) des Kontonamens.</span><span class="sxs-lookup"><span data-stu-id="6b4df-106">In this example, the service is running as a self-hosted service under a particular user account (username@contoso.com) and therefore the user principal name (UPN) identity contains the account name.</span></span> <span data-ttu-id="6b4df-107">Der UPN wird in einer Windows-Domäne auch als Benutzeranmeldename bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="6b4df-107">The UPN is also known as the user logon name in a Windows domain.</span></span>  
  
  
  
 <span data-ttu-id="6b4df-108">Eine beispielanwendung, die identitätseinstellung veranschaulicht, finden Sie unter [Dienstidentitätsbeispiel](../../../../docs/framework/wcf/samples/service-identity-sample.md).</span><span class="sxs-lookup"><span data-stu-id="6b4df-108">For a sample application that demonstrates identity setting, see [Service Identity Sample](../../../../docs/framework/wcf/samples/service-identity-sample.md).</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="6b4df-109">Dienstidentität, finden Sie unter [-Dienstidentität und Authentifizierung](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="6b4df-109"> service identity, see [Service Identity and Authentication](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span></span>  
  
## <a name="kerberos-authentication-and-identity"></a><span data-ttu-id="6b4df-110">Kerberos-Authentifizierung und Identität</span><span class="sxs-lookup"><span data-stu-id="6b4df-110">Kerberos Authentication and Identity</span></span>  
 <span data-ttu-id="6b4df-111">In der Standardeinstellung, wenn ein Dienst so konfiguriert ist, ein Windows-Anmeldeinformationen verwendet ein [ \<Identität >](../../../../docs/framework/configure-apps/file-schema/wcf/identity.md) -Element, enthält eine [ \<"userPrincipalName" >](../../../../docs/framework/configure-apps/file-schema/wcf/userprincipalname.md) oder [ \<ServicePrincipalName >](../../../../docs/framework/configure-apps/file-schema/wcf/serviceprincipalname.md) Element in die WSDL-Datei generiert wird.</span><span class="sxs-lookup"><span data-stu-id="6b4df-111">By default, when a service is configured to use a Windows credential, an [\<identity>](../../../../docs/framework/configure-apps/file-schema/wcf/identity.md) element that contains a [\<userPrincipalName>](../../../../docs/framework/configure-apps/file-schema/wcf/userprincipalname.md) or [\<servicePrincipalName>](../../../../docs/framework/configure-apps/file-schema/wcf/serviceprincipalname.md) element is generated in the WSDL.</span></span> <span data-ttu-id="6b4df-112">Wenn der Dienst, unter ausgeführt wird der `LocalSystem`, `LocalService`, oder `NetworkService` Konto, einen Dienst mit dem Dienstprinzipalnamen (SPN) wird standardmäßig, in Form von generiert `host/` \< *Hostname*> da Diese Konten haben Zugriff auf den Computer-SPN-Daten.</span><span class="sxs-lookup"><span data-stu-id="6b4df-112">If the service is running under the `LocalSystem`, `LocalService`, or `NetworkService` account, a service principal name (SPN) is generated by default in the form of `host/`\<*hostname*> because those accounts have access to the computer's SPN data.</span></span> <span data-ttu-id="6b4df-113">Wenn der Dienst unter einem anderen Konto ausgeführt wird [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] generiert einen UPN im Format \< *Benutzername*>@<*DomainName*`>`.</span><span class="sxs-lookup"><span data-stu-id="6b4df-113">If the service is running under a different account, [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] generates a UPN in the form of \<*username*>@<*domainName*`>`.</span></span> <span data-ttu-id="6b4df-114">Die Kerberos-Authentifizierung erfordert nämlich, dass für den Client ein UPN oder SPN zum Authentifizieren des Dienstes bereitgestellt wird.</span><span class="sxs-lookup"><span data-stu-id="6b4df-114">This occurs because Kerberos authentication requires that a UPN or SPN be supplied to the client to authenticate the service.</span></span>  
  
 <span data-ttu-id="6b4df-115">Sie können auch das Tool Setspn.exe zur Registrierung eines zusätzlichen SPN beim Konto eines Dienstes in einer Domäne verwenden.</span><span class="sxs-lookup"><span data-stu-id="6b4df-115">You can also use the Setspn.exe tool to register an additional SPN with a service's account in a domain.</span></span> <span data-ttu-id="6b4df-116">Sie können dann den SPN als die Identität des Dienstes verwenden.</span><span class="sxs-lookup"><span data-stu-id="6b4df-116">You can then use the SPN as the identity of the service.</span></span> <span data-ttu-id="6b4df-117">Zum Herunterladen des Tools finden Sie unter [Windows 2000 Resource Kit Tool: Setspn.exe](http://go.microsoft.com/fwlink/?LinkId=91752).</span><span class="sxs-lookup"><span data-stu-id="6b4df-117">To download the tool, see [Windows 2000 Resource Kit Tool : Setspn.exe](http://go.microsoft.com/fwlink/?LinkId=91752).</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="6b4df-118">Das Tool finden Sie unter [Übersicht über Setspn](http://go.microsoft.com/fwlink/?LinkId=61374).</span><span class="sxs-lookup"><span data-stu-id="6b4df-118"> the tool, see [Setspn Overview](http://go.microsoft.com/fwlink/?LinkId=61374).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="6b4df-119">Zur Verwendung des Windows-Anmeldeinformationstyps ohne Aushandlung muss das Benutzerkonto des Dienstes Zugriff auf den bei der Active Directory-Domäne registrierten SPN haben.</span><span class="sxs-lookup"><span data-stu-id="6b4df-119">To use the Windows credential type without negotiation, the service's user account must have access to the SPN that is registered with the Active Directory domain.</span></span> <span data-ttu-id="6b4df-120">Dazu stehen Ihnen folgende Möglichkeiten zur Verfügung:</span><span class="sxs-lookup"><span data-stu-id="6b4df-120">You can do this in the following ways:</span></span>  
  
-   <span data-ttu-id="6b4df-121">Verwenden Sie das NetworkService- oder das LocalSystem-Konto, um den Dienst auszuführen.</span><span class="sxs-lookup"><span data-stu-id="6b4df-121">Use the NetworkService or LocalSystem account to run your service.</span></span> <span data-ttu-id="6b4df-122">Da diese Konten Zugriff auf den beim Hinzufügen des Computers zur Active Directory-Domäne erstellten Computer-SPN haben, generiert [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] automatisch das zutreffende SPN-Element im Endpunkt des Dienstes in den Dienstmetadaten (WSDL).</span><span class="sxs-lookup"><span data-stu-id="6b4df-122">Because those accounts have access to the machine SPN that is established when the machine joins the Active Directory domain, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] automatically generates the proper SPN element inside the service's endpoint in the service's metadata (WSDL).</span></span>  
  
-   <span data-ttu-id="6b4df-123">Verwenden Sie ein beliebiges Active Directory-Domänenkonto, um den Dienst auszuführen.</span><span class="sxs-lookup"><span data-stu-id="6b4df-123">Use an arbitrary Active Directory domain account to run your service.</span></span> <span data-ttu-id="6b4df-124">Erstellen Sie in diesem Fall mit dem Tool Setspn.exe einen SPN für dieses Domänenkonto.</span><span class="sxs-lookup"><span data-stu-id="6b4df-124">In this case, establish an SPN for that domain account, which you can do by using the Setspn.exe utility tool.</span></span> <span data-ttu-id="6b4df-125">Konfigurieren Sie nach dem Erstellen des SPN für das Konto des Dienstes [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] so, dass dieser SPN für die Clients des Dienstes über seine Metadaten (WSDL) veröffentlicht wird.</span><span class="sxs-lookup"><span data-stu-id="6b4df-125">Once you create the SPN for the service's account, configure [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] to publish that SPN to the service's clients through its metadata (WSDL).</span></span> <span data-ttu-id="6b4df-126">Legen Sie dazu die Endpunktidentität für den angezeigten Endpunkt entweder mit einer Anwendungskonfigurationsdatei oder mit Code fest.</span><span class="sxs-lookup"><span data-stu-id="6b4df-126">This is done by setting the endpoint identity for the exposed endpoint, either through an application configuration file or code.</span></span>  
  
 [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="6b4df-127">SPNs, Kerberos-Protokoll und Active Directory finden Sie unter [technische Kerberos-Ergänzung für Windows](http://go.microsoft.com/fwlink/?LinkId=88330).</span><span class="sxs-lookup"><span data-stu-id="6b4df-127"> SPNs, the Kerberos protocol, and Active Directory, see [Kerberos Technical Supplement for Windows](http://go.microsoft.com/fwlink/?LinkId=88330).</span></span>  
  
### <a name="when-spn-or-upn-equals-the-empty-string"></a><span data-ttu-id="6b4df-128">Wenn SPN oder UPN der leeren Zeichenfolge entspricht</span><span class="sxs-lookup"><span data-stu-id="6b4df-128">When SPN or UPN Equals the Empty String</span></span>  
 <span data-ttu-id="6b4df-129">Das Festlegen von SPN oder UPN gleich einer leeren Zeichenfolge führt abhängig von der Sicherheitsebene und dem verwendeten Authentifizierungsmodus zu verschiedenen Ergebnissen:</span><span class="sxs-lookup"><span data-stu-id="6b4df-129">If you set the SPN or UPN equal to an empty string, a number of different things happen, depending on the security level and authentication mode being used:</span></span>  
  
-   <span data-ttu-id="6b4df-130">Wenn Sie Sicherheit auf Transportebene verwenden, wird die NT LanMan (NTLM)-Authentifizierung ausgewählt.</span><span class="sxs-lookup"><span data-stu-id="6b4df-130">If you are using transport level security, NT LanMan (NTLM) authentication is chosen.</span></span>  
  
-   <span data-ttu-id="6b4df-131">Wenn Sie Sicherheit auf Nachrichtenebene verwenden, schlägt die Authentifizierung abhängig vom Authentifizierungsmodus möglicherweise fehl:</span><span class="sxs-lookup"><span data-stu-id="6b4df-131">If you are using message level security, authentication may fail, depending on the authentication mode:</span></span>  
  
-   <span data-ttu-id="6b4df-132">Wenn Sie den `spnego`-Modus verwenden und das `AllowNtlm`-Attribut auf `false` festgelegt ist, schlägt die Authentifizierung fehl.</span><span class="sxs-lookup"><span data-stu-id="6b4df-132">If you are using `spnego` mode and the `AllowNtlm` attribute is set to `false`, authentication fail.</span></span>  
  
-   <span data-ttu-id="6b4df-133">Verwenden Sie den `spnego`-Modus verwenden und ist das `AllowNtlm`-Attribut auf `true` festgelegt, schlägt die Authentifizierung fehl, wenn der UPN leer ist; sie ist jedoch erfolgreich, wenn der SPN leer ist.</span><span class="sxs-lookup"><span data-stu-id="6b4df-133">If you are using `spnego` mode and the `AllowNtlm` attribute is set to `true`, authentication fails if the UPN is empty, but succeeds if the SPN is empty.</span></span>  
  
-   <span data-ttu-id="6b4df-134">Wenn Sie Kerberos direkt (wird auch als "One-Shot" bezeichnet) verwenden, schlägt die Authentifizierung fehl.</span><span class="sxs-lookup"><span data-stu-id="6b4df-134">If you are using Kerberos direct (also known as "one-shot"), authentication fails.</span></span>  
  
### <a name="using-the-identity-element-in-configuration"></a><span data-ttu-id="6b4df-135">Mithilfe der \<Identity >-Elements in der Konfiguration</span><span class="sxs-lookup"><span data-stu-id="6b4df-135">Using the \<identity> Element in Configuration</span></span>  
 <span data-ttu-id="6b4df-136">Wenn Sie den Clientanmeldeinformationstyp in der zuvor gezeigten Bindung zu Certificate`,` ändern, enthält die generierte WSDL ein serialisiertes Base64-X.509-Zertifikat als Identitätswert, wie im folgenden Code gezeigt.</span><span class="sxs-lookup"><span data-stu-id="6b4df-136">If you change the client credential type in the binding previously shown to Certificate`,` then the generated WSDL contains a Base64 serialized X.509 certificate for the identity value as shown in the following code.</span></span> <span data-ttu-id="6b4df-137">Dies ist der Standard für alle Clientanmeldeinformationstypen außer Windows.</span><span class="sxs-lookup"><span data-stu-id="6b4df-137">This is the default for all client credential types other than Windows.</span></span>  
  
  
  
 <span data-ttu-id="6b4df-138">Sie können den Wert der standardmäßigen Dienstidentität oder den Typ der Identität mit dem <`identity`>-Element bei der Konfiguration oder durch Festlegen der Identität im Code ändern.</span><span class="sxs-lookup"><span data-stu-id="6b4df-138">You can change the value of the default service identity or change the type of the identity by using the <`identity`> element in configuration or by setting the identity in code.</span></span> <span data-ttu-id="6b4df-139">Der folgende Konfigurationscode legt eine DNS-Identität (Domain Name System) mit dem Wert `contoso.com` fest.</span><span class="sxs-lookup"><span data-stu-id="6b4df-139">The following configuration code sets a domain name system (DNS) identity with the value `contoso.com`.</span></span>  
  
  
  
### <a name="setting-identity-programmatically"></a><span data-ttu-id="6b4df-140">Programmgesteuertes Festlegen der Identität</span><span class="sxs-lookup"><span data-stu-id="6b4df-140">Setting Identity Programmatically</span></span>  
 <span data-ttu-id="6b4df-141">Der Dienst muss nicht explizit eine Identität angeben, da sie von [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] automatisch bestimmt wird.</span><span class="sxs-lookup"><span data-stu-id="6b4df-141">Your service does not have to explicitly specify an identity, because [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] automatically determines it.</span></span> <span data-ttu-id="6b4df-142">Allerdings können Sie mit [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] nach Bedarf eine Identität für einen Endpunkt angeben.</span><span class="sxs-lookup"><span data-stu-id="6b4df-142">However, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] allows you to specify an identity on an endpoint, if required.</span></span> <span data-ttu-id="6b4df-143">Mit dem folgenden Code wird ein neuer Dienstendpunkt mit einer bestimmten DNS-Identität hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="6b4df-143">The following code adds a new service endpoint with a specific DNS identity.</span></span>  
  
 [!code-csharp[C_Identity#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#5)]
 [!code-vb[C_Identity#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#5)]  
  
## <a name="see-also"></a><span data-ttu-id="6b4df-144">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="6b4df-144">See Also</span></span>  
 [<span data-ttu-id="6b4df-145">Vorgehensweise: Erstellen einer benutzerdefinierten Clientidentitätsüberprüfung</span><span class="sxs-lookup"><span data-stu-id="6b4df-145">How to: Create a Custom Client Identity Verifier</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-client-identity-verifier.md)  
 [<span data-ttu-id="6b4df-146">Dienstidentität und Authentifizierung</span><span class="sxs-lookup"><span data-stu-id="6b4df-146">Service Identity and Authentication</span></span>](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md)
