---
title: 'Vorgehensweise: Erstellen eines benutzerdefinierten Tokens'
description: Erfahren Sie, wie Sie ein benutzerdefiniertes Sicherheits Token in WCF mithilfe der SecurityToken-Klasse erstellen und in einen Sicherheitstokenanbieter und einen Authentifikator integrieren.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- SecurityTokenParameters class
- security [WCF], creating custom tokens
- WSSecurityTokenSerializer class
- SecurityToken class
ms.assetid: 6d892973-1558-4115-a9e1-696777776125
ms.openlocfilehash: e0d80fe2433d894ef1f9e110e9090701dc305d8e
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 11/26/2020
ms.locfileid: "96266752"
---
# <a name="how-to-create-a-custom-token"></a><span data-ttu-id="3faa9-103">Vorgehensweise: Erstellen eines benutzerdefinierten Tokens</span><span class="sxs-lookup"><span data-stu-id="3faa9-103">How to: Create a Custom Token</span></span>

<span data-ttu-id="3faa9-104">In diesem Thema wird beschrieben, wie Sie mit der <xref:System.IdentityModel.Tokens.SecurityToken>-Klasse ein benutzerdefiniertes Sicherheitstoken erstellen und in einen benutzerdefinierten Sicherheitstokenanbieter und -authentifizierer integrieren.</span><span class="sxs-lookup"><span data-stu-id="3faa9-104">This topic shows how to create a custom security token using the <xref:System.IdentityModel.Tokens.SecurityToken> class, and how to integrate it with a custom security token provider and authenticator.</span></span> <span data-ttu-id="3faa9-105">Ein umfassendes Codebeispiel finden Sie unter Beispiel für [benutzerdefiniertes Token](../samples/custom-token.md) .</span><span class="sxs-lookup"><span data-stu-id="3faa9-105">For a complete code example see the [Custom Token](../samples/custom-token.md) sample.</span></span>  
  
 <span data-ttu-id="3faa9-106">Ein *Sicherheits Token* ist im Grunde ein XML-Element, das vom Windows Communication Foundation (WCF)-Sicherheits Framework verwendet wird, um Ansprüche über einen Absender innerhalb der SOAP-Nachricht darzustellen.</span><span class="sxs-lookup"><span data-stu-id="3faa9-106">A *security token* is essentially an XML element that is used by the Windows Communication Foundation (WCF) security framework to represent claims about a sender inside the SOAP message.</span></span> <span data-ttu-id="3faa9-107">WCF-Sicherheit stellt verschiedene Token für die vom System bereitgestellten Authentifizierungs Modi bereit.</span><span class="sxs-lookup"><span data-stu-id="3faa9-107">WCF security provides various tokens for system-provided authentication modes.</span></span> <span data-ttu-id="3faa9-108">Dazu gehören u.&#160;a. ein Sicherheitstoken für ein X.509-Zertifikat, dargestellt durch die <xref:System.IdentityModel.Tokens.X509SecurityToken>-Klasse, oder ein Sicherheitstoken für den Benutzernamen, dargestellt durch die <xref:System.IdentityModel.Tokens.UserNameSecurityToken>-Klasse.</span><span class="sxs-lookup"><span data-stu-id="3faa9-108">Examples include an X.509 certificate security token represented by the <xref:System.IdentityModel.Tokens.X509SecurityToken> class or a Username security token represented by the <xref:System.IdentityModel.Tokens.UserNameSecurityToken> class.</span></span>  
  
 <span data-ttu-id="3faa9-109">Möglicherweise werden Authentifizierungsmodi oder Anmeldeinformationen nicht von den bereitgestellten Typen unterstützt.</span><span class="sxs-lookup"><span data-stu-id="3faa9-109">Sometimes an authentication mode or credential is not supported by the provided types.</span></span> <span data-ttu-id="3faa9-110">In diesem Fall müssen Sie ein benutzerdefiniertes Sicherheitstoken erstellen, um eine XML-Darstellung der benutzerdefinierten Anmeldeinformationen in der SOAP-Nachricht bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="3faa9-110">In that case, it is necessary to create a custom security token to provide an XML representation of the custom credential inside the SOAP message.</span></span>  
  
 <span data-ttu-id="3faa9-111">In den folgenden Verfahren wird gezeigt, wie Sie ein benutzerdefiniertes Sicherheits Token erstellen und es in die WCF-Sicherheitsinfrastruktur integrieren.</span><span class="sxs-lookup"><span data-stu-id="3faa9-111">The following procedures show how to create a custom security token and how to integrate it with the WCF security infrastructure.</span></span> <span data-ttu-id="3faa9-112">In diesem Thema wird ein Kreditkartentoken erstellt, mit dem Informationen über die Kreditkarte des Kunden an den Server übermittelt werden.</span><span class="sxs-lookup"><span data-stu-id="3faa9-112">This topic creates a credit card token that is used to pass information about the client's credit card to the server.</span></span>  
  
 <span data-ttu-id="3faa9-113">Weitere Informationen über benutzerdefinierte Anmelde Informationen und Sicherheits Token-Manager finden Sie unter Exemplarische Vorgehensweise [: Erstellen von benutzerdefinierten Client-und Dienst Anmelde](walkthrough-creating-custom-client-and-service-credentials.md)Informationen</span><span class="sxs-lookup"><span data-stu-id="3faa9-113">For more information about custom credentials and security token manager, see [Walkthrough: Creating Custom Client and Service Credentials](walkthrough-creating-custom-client-and-service-credentials.md).</span></span>  
  
 <span data-ttu-id="3faa9-114">Weitere Klassen, die Sicherheitstoken darstellen, finden Sie im <xref:System.IdentityModel.Tokens>-Namespace.</span><span class="sxs-lookup"><span data-stu-id="3faa9-114">See the <xref:System.IdentityModel.Tokens> namespace for more classes that represent security tokens.</span></span>  
  
## <a name="procedures"></a><span data-ttu-id="3faa9-115">Prozeduren</span><span class="sxs-lookup"><span data-stu-id="3faa9-115">Procedures</span></span>  

 <span data-ttu-id="3faa9-116">Clientanwendungen müssen über eine Möglichkeit zur Angabe von Kreditkarteninformationen für die Sicherheitsinfrastruktur verfügen.</span><span class="sxs-lookup"><span data-stu-id="3faa9-116">A client application must be provided with a way to specify credit card information for the security infrastructure.</span></span> <span data-ttu-id="3faa9-117">Diese Informationen werden von einer benutzerdefinierten Klasse für Clientanmeldeinformationen für die Anwendung verfügbar gemacht.</span><span class="sxs-lookup"><span data-stu-id="3faa9-117">This information is made available to the application by a custom client credentials class.</span></span> <span data-ttu-id="3faa9-118">Zunächst muss eine Klasse erstellt werden, um die Kreditkarteninformationen für die benutzerdefinierten Clientanmeldeinformationen darzustellen.</span><span class="sxs-lookup"><span data-stu-id="3faa9-118">The first step is to create a class to represent the credit card information for custom client credentials.</span></span>  
  
#### <a name="to-create-a-class-that-represents-credit-card-information-inside-client-credentials"></a><span data-ttu-id="3faa9-119">So erstellen Sie eine Klasse, die Kreditkarteninformationen in Clientanmeldeinformationen darstellt</span><span class="sxs-lookup"><span data-stu-id="3faa9-119">To create a class that represents credit card information inside client credentials</span></span>  
  
1. <span data-ttu-id="3faa9-120">Definieren Sie eine neue Klasse, die die Kreditkarteninformationen für die Anwendung darstellt.</span><span class="sxs-lookup"><span data-stu-id="3faa9-120">Define a new class that represents the credit card information for the application.</span></span> <span data-ttu-id="3faa9-121">Im folgenden Beispiel wird diese Klasse als `CreditCardInfo` bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="3faa9-121">The following example names the class `CreditCardInfo`.</span></span>  
  
2. <span data-ttu-id="3faa9-122">Fügen Sie der Klasse entsprechende Eigenschaften hinzu, damit die erforderlichen Informationen für das benutzerdefinierte Token von der Anwendung festgelegt werden können.</span><span class="sxs-lookup"><span data-stu-id="3faa9-122">Add appropriate properties to the class to allow an application set the necessary information required for the custom token.</span></span> <span data-ttu-id="3faa9-123">In diesem Beispiel verfügt die Klasse über drei Eigenschaften: `CardNumber`, `CardIssuer` und `ExpirationDate`.</span><span class="sxs-lookup"><span data-stu-id="3faa9-123">In this example, the class has three properties: `CardNumber`, `CardIssuer`, and `ExpirationDate`.</span></span>  
  
     [!code-csharp[c_CustomToken#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtoken/cs/source.cs#4)]
     [!code-vb[c_CustomToken#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtoken/vb/source.vb#4)]  
  
 <span data-ttu-id="3faa9-124">Im Anschluss muss eine Klasse erstellt werden, die das benutzerdefinierte Sicherheitstoken darstellt.</span><span class="sxs-lookup"><span data-stu-id="3faa9-124">Next, a class that represents the custom security token must be created.</span></span> <span data-ttu-id="3faa9-125">Diese Klasse wird von den Klassen des Sicherheitstokenanbieters, des Authentifizierers und des Serialisierungsprogramms verwendet, um Informationen über das Sicherheits Token an die und von der WCF-Sicherheitsinfrastruktur zu übergeben.</span><span class="sxs-lookup"><span data-stu-id="3faa9-125">This class is used by the security token provider, authenticator, and serializer classes to pass information about the security token to and from the WCF security infrastructure.</span></span>  
  
#### <a name="to-create-a-custom-security-token-class"></a><span data-ttu-id="3faa9-126">So erstellen Sie eine benutzerdefinierte Sicherheitstokenklasse</span><span class="sxs-lookup"><span data-stu-id="3faa9-126">To create a custom security token class</span></span>  
  
1. <span data-ttu-id="3faa9-127">Definieren Sie eine neue von der <xref:System.IdentityModel.Tokens.SecurityToken>-Klasse abgeleitete Klasse.</span><span class="sxs-lookup"><span data-stu-id="3faa9-127">Define a new class derived from the <xref:System.IdentityModel.Tokens.SecurityToken> class.</span></span> <span data-ttu-id="3faa9-128">In diesem Beispiel wird eine Klasse mit der Bezeichnung `CreditCardToken` erstellt.</span><span class="sxs-lookup"><span data-stu-id="3faa9-128">This example creates a class named `CreditCardToken`.</span></span>  
  
2. <span data-ttu-id="3faa9-129">Überschreiben Sie die <xref:System.IdentityModel.Tokens.SecurityToken.Id%2A>-Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="3faa9-129">Override the <xref:System.IdentityModel.Tokens.SecurityToken.Id%2A> property.</span></span> <span data-ttu-id="3faa9-130">Mit dieser Eigenschaft wird der lokale Bezeichner des Sicherheitstokens abgerufen, mit dem von anderen Elementen in der SOAP-Nachricht auf die XML-Darstellung des Sicherheitstokens verwiesen wird.</span><span class="sxs-lookup"><span data-stu-id="3faa9-130">This property is used to get the local identifier of the security token that is used to point to the security token XML representation from other elements inside the SOAP message.</span></span> <span data-ttu-id="3faa9-131">Der Bezeichner des Tokens in diesem Beispiel kann als Konstruktorparameter übergeben werden. Alternativ wird immer dann ein neuer Parameter generiert, wenn eine Instanz des Sicherheitstokens erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="3faa9-131">In this example, a token identifier can be either passed to it as a constructor parameter or a new random one is generated every time a security token instance is created.</span></span>  
  
3. <span data-ttu-id="3faa9-132">Implementiert die <xref:System.IdentityModel.Tokens.SecurityToken.SecurityKeys%2A>-Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="3faa9-132">Implement the <xref:System.IdentityModel.Tokens.SecurityToken.SecurityKeys%2A> property.</span></span> <span data-ttu-id="3faa9-133">Diese Eigenschaft gibt eine Auflistung von Sicherheitsschlüsseln zurück, die die Instanz des Sicherheitstokens darstellt.</span><span class="sxs-lookup"><span data-stu-id="3faa9-133">This property returns a collection of security keys that the security token instance represents.</span></span> <span data-ttu-id="3faa9-134">Diese Schlüssel können von WCF verwendet werden, um Teile der SOAP-Nachricht zu signieren oder zu verschlüsseln.</span><span class="sxs-lookup"><span data-stu-id="3faa9-134">Such keys can be used by WCF to sign or encrypt parts of the SOAP message.</span></span> <span data-ttu-id="3faa9-135">Das Sicherheitstoken für die Kreditkarte kann in diesem Beispiel keine Sicherheitsschlüssel enthalten. Aus diesem Grund wird von der Implementierung stets eine leere Auflistung zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="3faa9-135">In this example, the credit card security token cannot contain any security keys; therefore, the implementation always returns an empty collection.</span></span>  
  
4. <span data-ttu-id="3faa9-136">Überschreiben Sie die <xref:System.IdentityModel.Tokens.SecurityToken.ValidFrom%2A>-Eigenschaft und die <xref:System.IdentityModel.Tokens.SecurityToken.ValidTo%2A>-Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="3faa9-136">Override the <xref:System.IdentityModel.Tokens.SecurityToken.ValidFrom%2A> and <xref:System.IdentityModel.Tokens.SecurityToken.ValidTo%2A> properties.</span></span> <span data-ttu-id="3faa9-137">Diese Eigenschaften werden von WCF verwendet, um die Gültigkeit der Instanz des Sicherheits Tokens zu bestimmen.</span><span class="sxs-lookup"><span data-stu-id="3faa9-137">These properties are used by WCF to determine the validity of the security token instance.</span></span> <span data-ttu-id="3faa9-138">Das Sicherheitstoken für die Kreditkarte in diesem Beispiel weist nur ein Ablaufdatum auf. Die `ValidFrom`-Eigenschaft gibt daher einen <xref:System.DateTime>-Wert zurück, der das Datum und die Uhrzeit der Instanzerstellung enthält.</span><span class="sxs-lookup"><span data-stu-id="3faa9-138">In this example, the credit card security token has only an expiration date, so the `ValidFrom` property returns a <xref:System.DateTime> that represents the date and time of the instance creation.</span></span>  
  
     [!code-csharp[c_CustomToken#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtoken/cs/source.cs#1)]
     [!code-vb[c_CustomToken#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtoken/vb/source.vb#1)]  
  
 <span data-ttu-id="3faa9-139">Wenn ein neuer Sicherheitstokentyp erstellt wird, ist eine Implementierung der <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters>-Klasse erforderlich.</span><span class="sxs-lookup"><span data-stu-id="3faa9-139">When a new security token type is created, it requires an implementation of the <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters> class.</span></span> <span data-ttu-id="3faa9-140">Mit dieser Implementierung wird in der Konfiguration des Sicherheitsbindungselements der neue Tokentyp dargestellt.</span><span class="sxs-lookup"><span data-stu-id="3faa9-140">The implementation is used in the security binding element configuration to represent the new token type.</span></span> <span data-ttu-id="3faa9-141">Die Parameterklasse für das Sicherheitstoken dient als Vorlage zur Anpassung der Instanz des Sicherheitstokens, das beim Verarbeiten einer Nachricht verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="3faa9-141">The security token parameters class serves as a template that is used to match the actual security token instance to when a message is processed.</span></span> <span data-ttu-id="3faa9-142">Die Vorlage stellt zusätzliche Eigenschaften bereit, mit der die Anwendung Kriterien angeben kann, die vom Sicherheitstoken für eine Verwendung oder Authentifizierung erfüllt werden müssen.</span><span class="sxs-lookup"><span data-stu-id="3faa9-142">The template provides additional properties that an application can use to specify criteria that the security token must match to be used or authenticated.</span></span> <span data-ttu-id="3faa9-143">Im folgenden Beispiel werden keine zusätzlichen Eigenschaften hinzugefügt, sodass nur der Sicherheitstokentyp abgeglichen wird, wenn die WCF-Infrastruktur nach einer zu verwendenden oder zu validierenden Instanz von Sicherheits Token sucht.</span><span class="sxs-lookup"><span data-stu-id="3faa9-143">The following example does not add any additional properties, so only the security token type is matched when the WCF infrastructure searches for a security token instance to use or to validate.</span></span>  
  
#### <a name="to-create-a-custom-security-token-parameters-class"></a><span data-ttu-id="3faa9-144">So erstellen Sie eine Parameterklasse für das benutzerdefinierte Sicherheitstoken</span><span class="sxs-lookup"><span data-stu-id="3faa9-144">To create a custom security token parameters class</span></span>  
  
1. <span data-ttu-id="3faa9-145">Definieren Sie eine neue von der <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters>-Klasse abgeleitete Klasse.</span><span class="sxs-lookup"><span data-stu-id="3faa9-145">Define a new class derived from the <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters> class.</span></span>  
  
2. <span data-ttu-id="3faa9-146">Implementieren Sie die <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.CloneCore%2A>-Methode.</span><span class="sxs-lookup"><span data-stu-id="3faa9-146">Implement the <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.CloneCore%2A> method.</span></span> <span data-ttu-id="3faa9-147">Kopieren Sie ggf. alle in der Klasse definierten internen Felder.</span><span class="sxs-lookup"><span data-stu-id="3faa9-147">Copy all internal fields defined in your class, if any.</span></span> <span data-ttu-id="3faa9-148">In diesem Beispiel werden keine weiteren Felder definiert.</span><span class="sxs-lookup"><span data-stu-id="3faa9-148">This example does not define any additional fields.</span></span>  
  
3. <span data-ttu-id="3faa9-149">Implementieren Sie die schreibgeschützte <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.SupportsClientAuthentication%2A>-Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="3faa9-149">Implement the <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.SupportsClientAuthentication%2A> read-only property.</span></span> <span data-ttu-id="3faa9-150">Diese Eigenschaft gibt `true` zurück, wenn der Typ des Sicherheitstokens, der von dieser Klasse dargestellt wird, zur Authentifizierung eines Clients gegenüber einem Dienst verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="3faa9-150">This property returns `true` if the security token type represented by this class can be used to authenticate a client to a service.</span></span> <span data-ttu-id="3faa9-151">Das Sicherheitstoken der Kreditkarte kann in diesem Beispiel zur Authentifizierung eines Clients gegenüber einem Dienst verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="3faa9-151">In this example, the credit card security token can be used to authenticate a client to a service.</span></span>  
  
4. <span data-ttu-id="3faa9-152">Implementieren Sie die schreibgeschützte <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.SupportsServerAuthentication%2A>-Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="3faa9-152">Implement the <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.SupportsServerAuthentication%2A> read-only property.</span></span> <span data-ttu-id="3faa9-153">Diese Eigenschaft gibt `true` zurück, wenn der Typ des Sicherheitstokens, der von dieser Klasse dargestellt wird, zur Authentifizierung eines Diensts gegenüber einem Client verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="3faa9-153">This property returns `true` if the security token type represented by this class can be used to authenticate a service to a client.</span></span> <span data-ttu-id="3faa9-154">Das Sicherheitstoken der Kreditkarte kann in diesem Beispiel nicht zur Authentifizierung eines Diensts gegenüber einem Client verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="3faa9-154">In this example, the credit card security token cannot be used to authenticate a service to a client.</span></span>  
  
5. <span data-ttu-id="3faa9-155">Implementieren Sie die schreibgeschützte <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.SupportsClientWindowsIdentity%2A>-Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="3faa9-155">Implement the <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.SupportsClientWindowsIdentity%2A> read-only property.</span></span> <span data-ttu-id="3faa9-156">Diese Eigenschaft gibt `true` zurück, wenn der Typ des Sicherheitstokens, der von dieser Klasse dargestellt wird, einem Windows-Konto zugeordnet werden kann.</span><span class="sxs-lookup"><span data-stu-id="3faa9-156">This property returns `true` if the security token type represented by this class can be mapped to a Windows account.</span></span> <span data-ttu-id="3faa9-157">In diesem Fall wird das Ergebnis der Authentifizierung durch eine Instanz der <xref:System.Security.Principal.WindowsIdentity>-Klasse dargestellt.</span><span class="sxs-lookup"><span data-stu-id="3faa9-157">If so, the authentication result is represented by a <xref:System.Security.Principal.WindowsIdentity> class instance.</span></span> <span data-ttu-id="3faa9-158">Das Token in diesem Beispiel kann keinem Windows-Konto zugeordnet werden.</span><span class="sxs-lookup"><span data-stu-id="3faa9-158">In this example, the token cannot be mapped to a Windows account.</span></span>  
  
6. <span data-ttu-id="3faa9-159">Implementieren Sie die <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.CreateKeyIdentifierClause%28System.IdentityModel.Tokens.SecurityToken%2CSystem.ServiceModel.Security.Tokens.SecurityTokenReferenceStyle%29>-Methode.</span><span class="sxs-lookup"><span data-stu-id="3faa9-159">Implement the <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.CreateKeyIdentifierClause%28System.IdentityModel.Tokens.SecurityToken%2CSystem.ServiceModel.Security.Tokens.SecurityTokenReferenceStyle%29> method.</span></span> <span data-ttu-id="3faa9-160">Diese Methode wird vom WCF-Sicherheits Framework aufgerufen, wenn ein Verweis auf die von dieser Sicherheitstokenparameter-Klasse dargestellte sicherheitstokeninstanz erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="3faa9-160">This method is called by WCF security framework when it requires a reference to the security token instance represented by this security token parameters class.</span></span> <span data-ttu-id="3faa9-161">Sowohl die tatsächliche Instanz des Sicherheitstokens als auch der <xref:System.ServiceModel.Security.Tokens.SecurityTokenReferenceStyle>, der den angeforderten Verweistyp angibt, werden als Argumente an diese Methode übergeben.</span><span class="sxs-lookup"><span data-stu-id="3faa9-161">Both the actual security token instance and <xref:System.ServiceModel.Security.Tokens.SecurityTokenReferenceStyle> that specifies the type of the reference that is being requested are passed to this method as arguments.</span></span> <span data-ttu-id="3faa9-162">In diesem Beispiel werden vom Kreditkarten-Sicherheitstoken nur interne Verweise unterstützt.</span><span class="sxs-lookup"><span data-stu-id="3faa9-162">In this example, only internal references are supported by the credit card security token.</span></span> <span data-ttu-id="3faa9-163">Mit der <xref:System.IdentityModel.Tokens.SecurityToken>-Klasse können interne Verweise erstellt werden, sodass für die Implementierung kein zusätzlicher Code erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="3faa9-163">The <xref:System.IdentityModel.Tokens.SecurityToken> class has functionality to create internal references; therefore, the implementation does not require additional code.</span></span>  
  
7. <span data-ttu-id="3faa9-164">Implementieren Sie die <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.InitializeSecurityTokenRequirement%28System.IdentityModel.Selectors.SecurityTokenRequirement%29>-Methode.</span><span class="sxs-lookup"><span data-stu-id="3faa9-164">Implement the <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.InitializeSecurityTokenRequirement%28System.IdentityModel.Selectors.SecurityTokenRequirement%29> method.</span></span> <span data-ttu-id="3faa9-165">Diese Methode wird von WCF aufgerufen, um die Instanz der Sicherheits Token-Parameter Klasse in eine Instanz der-Klasse zu konvertieren <xref:System.IdentityModel.Selectors.SecurityTokenRequirement> .</span><span class="sxs-lookup"><span data-stu-id="3faa9-165">This method is called by WCF to convert the security token parameters class instance into an instance of the <xref:System.IdentityModel.Selectors.SecurityTokenRequirement> class.</span></span> <span data-ttu-id="3faa9-166">Das Ergebnis wird von Sicherheitstokenanbietern zum Erstellen der entsprechenden Instanz des Sicherheitstokens verwendet.</span><span class="sxs-lookup"><span data-stu-id="3faa9-166">The result is used by security token providers to create the appropriate security token instance.</span></span>  
  
     [!code-csharp[c_CustomToken#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtoken/cs/source.cs#2)]
     [!code-vb[c_CustomToken#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtoken/vb/source.vb#2)]  
  
 <span data-ttu-id="3faa9-167">Sicherheitstoken werden in SOAP-Nachrichten übertragen. Hierfür ist ein Übersetzungsmechanismus zwischen der Darstellung des Sicherheitstokens im Speicher und in der Übertragung erforderlich.</span><span class="sxs-lookup"><span data-stu-id="3faa9-167">Security tokens are transmitted inside SOAP messages, which requires a translation mechanism between the in-memory security token representation and the on-the-wire representation.</span></span> <span data-ttu-id="3faa9-168">WCF verwendet zum Ausführen dieser Aufgabe ein sicherheitstokenserialisierungsprogramm.</span><span class="sxs-lookup"><span data-stu-id="3faa9-168">WCF uses a security token serializer to accomplish this task.</span></span> <span data-ttu-id="3faa9-169">Für jedes benutzerdefinierte Token muss ein benutzerdefiniertes Sicherheitstoken-Serialisierungsprogramm verfügbar sein, mit dem das benutzerdefinierte Sicherheitstoken aus der SOAP-Nachricht serialisiert bzw. deserialisiert werden kann.</span><span class="sxs-lookup"><span data-stu-id="3faa9-169">Every custom token must be accompanied by a custom security token serializer that can serialize and deserialize the custom security token from the SOAP message.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="3faa9-170">Abgeleitete Schlüssel sind standardmäßig aktiviert.</span><span class="sxs-lookup"><span data-stu-id="3faa9-170">Derived keys are enabled by default.</span></span> <span data-ttu-id="3faa9-171">Wenn Sie ein benutzerdefiniertes Sicherheits Token erstellen und es als primäres Token verwenden, leitet WCF einen Schlüssel davon ab.</span><span class="sxs-lookup"><span data-stu-id="3faa9-171">If you create a custom security token and use it as the primary token, WCF derives a key from it.</span></span> <span data-ttu-id="3faa9-172">Dabei wird das Serialisierungsprogramm für benutzerdefnierte Sicherheitstoken aufgerufen, um die <xref:System.IdentityModel.Tokens.SecurityKeyIdentifierClause> für das benutzerdefinierte Sicherheitstoken zur Übertragung zu schreiben, während das `DerivedKeyToken` serialisiert wird.</span><span class="sxs-lookup"><span data-stu-id="3faa9-172">While doing so, it calls the custom security token serializer to write the <xref:System.IdentityModel.Tokens.SecurityKeyIdentifierClause> for the custom security token while serializing the `DerivedKeyToken` to the wire.</span></span> <span data-ttu-id="3faa9-173">Auf der Empfangsseite erwartet das `DerivedKeyToken`-Serialisierungsprogramm beim Deserialisieren des Tokens aus der Übertragung ein `SecurityTokenReference`-Element als sich selbst untergeordnetes Element oberster Ebene.</span><span class="sxs-lookup"><span data-stu-id="3faa9-173">On the receiving end, when deserializing the token off the wire, the `DerivedKeyToken` serializer expects a `SecurityTokenReference` element as the top-level child under itself.</span></span> <span data-ttu-id="3faa9-174">Wurde vom Serialisierungsprogramm für benutzerdefinierte Sicherheitstokens beim Serialisieren des eigenen Klauseltyps kein `SecurityTokenReference`-Element hinzugefügt, wird eine Ausnahme ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="3faa9-174">If the custom security token serializer did not add a `SecurityTokenReference` element while serializing its clause type, an exception is thrown.</span></span>  
  
#### <a name="to-create-a-custom-security-token-serializer"></a><span data-ttu-id="3faa9-175">So erstellen Sie ein benutzerdefiniertes Sicherheitstoken-Serialisierungsprogramm</span><span class="sxs-lookup"><span data-stu-id="3faa9-175">To create a custom security token serializer</span></span>  
  
1. <span data-ttu-id="3faa9-176">Definieren Sie eine neue von der <xref:System.ServiceModel.Security.WSSecurityTokenSerializer>-Klasse abgeleitete Klasse.</span><span class="sxs-lookup"><span data-stu-id="3faa9-176">Define a new class derived from the <xref:System.ServiceModel.Security.WSSecurityTokenSerializer> class.</span></span>  
  
2. <span data-ttu-id="3faa9-177">Überschreiben Sie die <xref:System.ServiceModel.Security.WSSecurityTokenSerializer.CanReadTokenCore%28System.Xml.XmlReader%29>-Methode, die den XML-Stream mit dem <xref:System.Xml.XmlReader> liest.</span><span class="sxs-lookup"><span data-stu-id="3faa9-177">Override the <xref:System.ServiceModel.Security.WSSecurityTokenSerializer.CanReadTokenCore%28System.Xml.XmlReader%29> method, which relies on an <xref:System.Xml.XmlReader> to read the XML stream.</span></span> <span data-ttu-id="3faa9-178">Diese Methode gibt `true` zurück, wenn das Sicherheitstoken für das aktuelle Element von der Implementierung des Serialisierungsprogramms deserialisiert werden kann.</span><span class="sxs-lookup"><span data-stu-id="3faa9-178">The method returns `true` if the serializer implementation can deserialize the security token based given its current element.</span></span> <span data-ttu-id="3faa9-179">In diesem Beispiel überprüft die Methode, ob das aktuelle XML-Element des XML-Readers den richtigen Namen und den richtigen Namespace aufweist.</span><span class="sxs-lookup"><span data-stu-id="3faa9-179">In this example, this method checks whether the XML reader's current XML element has the correct element name and namespace.</span></span> <span data-ttu-id="3faa9-180">Ist dies nicht der Fall, wird die Basisklassenimplementierung dieser Methode aufgerufen, um das XML-Element zu behandeln.</span><span class="sxs-lookup"><span data-stu-id="3faa9-180">If it does not, it calls the base class implementation of this method to handle the XML element.</span></span>  
  
3. <span data-ttu-id="3faa9-181">Überschreiben Sie die <xref:System.ServiceModel.Security.WSSecurityTokenSerializer.ReadTokenCore%28System.Xml.XmlReader%2CSystem.IdentityModel.Selectors.SecurityTokenResolver%29> -Methode.</span><span class="sxs-lookup"><span data-stu-id="3faa9-181">Override the <xref:System.ServiceModel.Security.WSSecurityTokenSerializer.ReadTokenCore%28System.Xml.XmlReader%2CSystem.IdentityModel.Selectors.SecurityTokenResolver%29> method.</span></span> <span data-ttu-id="3faa9-182">Diese Methode wird zum Lesen des XML-Inhalts des Sicherheitstokens sowie zum Erstellen der entsprechenden Darstellung im Speicher verwendet.</span><span class="sxs-lookup"><span data-stu-id="3faa9-182">This method reads the XML content of the security token and constructs the appropriate in-memory representation for it.</span></span> <span data-ttu-id="3faa9-183">Wenn das XML-Element, das gerade vom übergebenen XML-Reader erfasst wird, von der Methode nicht erkannt wird, wird die Basisklassenimplementierung zur Verarbeitung der vom System bereitgestellten Tokentypen aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="3faa9-183">If it does not recognize the XML element on which the passed-in XML reader is standing, it calls the base class implementation to process the system-provided token types.</span></span>  
  
4. <span data-ttu-id="3faa9-184">Überschreiben Sie die <xref:System.ServiceModel.Security.WSSecurityTokenSerializer.CanWriteTokenCore%28System.IdentityModel.Tokens.SecurityToken%29> -Methode.</span><span class="sxs-lookup"><span data-stu-id="3faa9-184">Override the <xref:System.ServiceModel.Security.WSSecurityTokenSerializer.CanWriteTokenCore%28System.IdentityModel.Tokens.SecurityToken%29> method.</span></span> <span data-ttu-id="3faa9-185">Diese Methode gibt `true` zurück, wenn die (als Argument übergebene) Darstellung des Tokens im Speicher in die XML-Darstellung konvertiert werden kann.</span><span class="sxs-lookup"><span data-stu-id="3faa9-185">This method returns `true` if it can convert the in-memory token representation (passed in as an argument) to the XML representation.</span></span> <span data-ttu-id="3faa9-186">Wenn dies nicht der Fall ist, wird die Basisklassenimplementierung aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="3faa9-186">If it cannot convert, it calls the base class implementation.</span></span>  
  
5. <span data-ttu-id="3faa9-187">Überschreiben Sie die <xref:System.ServiceModel.Security.WSSecurityTokenSerializer.WriteTokenCore%28System.Xml.XmlWriter%2CSystem.IdentityModel.Tokens.SecurityToken%29> -Methode.</span><span class="sxs-lookup"><span data-stu-id="3faa9-187">Override the <xref:System.ServiceModel.Security.WSSecurityTokenSerializer.WriteTokenCore%28System.Xml.XmlWriter%2CSystem.IdentityModel.Tokens.SecurityToken%29> method.</span></span> <span data-ttu-id="3faa9-188">Diese Methode konvertiert die Darstellung eines Sicherheitstokens im Speicher in eine XML-Darstellung.</span><span class="sxs-lookup"><span data-stu-id="3faa9-188">This method converts an in-memory security token representation into an XML representation.</span></span> <span data-ttu-id="3faa9-189">Andernfalls wird die Basisklassenimplementierung aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="3faa9-189">If the method cannot convert, it calls the base class implementation.</span></span>  
  
     [!code-csharp[c_CustomToken#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtoken/cs/source.cs#3)]
     [!code-vb[c_CustomToken#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtoken/vb/source.vb#3)]  
  
 <span data-ttu-id="3faa9-190">Integrieren Sie das benutzerdefinierte Sicherheitstoken nach Abschluss dieser vier Verfahren in den Anbieter, Authentifizierer, Manager und Client sowie in die Anmeldeinformationen des Diensts für das Sicherheitstoken.</span><span class="sxs-lookup"><span data-stu-id="3faa9-190">After completing the four previous procedures, integrate the custom security token with the security token provider, authenticator, manager, and client and service credentials.</span></span>  
  
#### <a name="to-integrate-the-custom-security-token-with-a-security-token-provider"></a><span data-ttu-id="3faa9-191">So integrieren Sie das benutzerdefinierte Sicherheitstoken in einen Sicherheitstokenanbieter</span><span class="sxs-lookup"><span data-stu-id="3faa9-191">To integrate the custom security token with a security token provider</span></span>  
  
1. <span data-ttu-id="3faa9-192">Der Sicherheitstokenanbieter erstellt das Token, ändert es gegebenenfalls und gibt eine Instanz des Tokens zurück.</span><span class="sxs-lookup"><span data-stu-id="3faa9-192">The security token provider creates, modifies (if necessary), and returns an instance of the token.</span></span> <span data-ttu-id="3faa9-193">Um einen benutzerdefinierten Anbieter für das benutzerdefinierte Sicherheitstoken zu erstellen, erstellen Sie eine Klasse, die von der <xref:System.IdentityModel.Selectors.SecurityTokenProvider>-Klasse erbt.</span><span class="sxs-lookup"><span data-stu-id="3faa9-193">To create a custom provider for the custom security token, create a class that inherits from the <xref:System.IdentityModel.Selectors.SecurityTokenProvider> class.</span></span> <span data-ttu-id="3faa9-194">Im folgenden Beispiel wird die <xref:System.IdentityModel.Selectors.SecurityTokenProvider.GetTokenCore%2A>-Methode überschrieben, um eine Instanz von `CreditCardToken` zurückzugeben.</span><span class="sxs-lookup"><span data-stu-id="3faa9-194">The following example overrides the <xref:System.IdentityModel.Selectors.SecurityTokenProvider.GetTokenCore%2A> method to return an instance of the `CreditCardToken`.</span></span> <span data-ttu-id="3faa9-195">Weitere Informationen zu benutzerdefinierten Sicherheitstokenanbietern finden Sie unter Gewusst [wie: Erstellen eines benutzerdefinierten Sicherheitstokenanbieters](how-to-create-a-custom-security-token-provider.md).</span><span class="sxs-lookup"><span data-stu-id="3faa9-195">For more information about custom security token providers, see [How to: Create a Custom Security Token Provider](how-to-create-a-custom-security-token-provider.md).</span></span>  
  
     [!code-csharp[c_CustomToken#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtoken/cs/source.cs#6)]
     [!code-vb[c_CustomToken#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtoken/vb/source.vb#6)]  
  
#### <a name="to-integrate-the-custom-security-token-with-a-security-token-authenticator"></a><span data-ttu-id="3faa9-196">So integrieren Sie das benutzerdefinierte Sicherheitstoken in einen Sicherheitstokenauthentifizierer</span><span class="sxs-lookup"><span data-stu-id="3faa9-196">To integrate the custom security token with a security token authenticator</span></span>  
  
1. <span data-ttu-id="3faa9-197">Der Sicherheitstokenauthentifizierer überprüft den Inhalt des Sicherheitstokens beim Extrahieren aus der Nachricht.</span><span class="sxs-lookup"><span data-stu-id="3faa9-197">The security token authenticator validates the content of the security token when it is extracted from the message.</span></span> <span data-ttu-id="3faa9-198">Um einen benutzerdefinierten Authentifizierer für das benutzerdefinierte Sicherheitstoken zu erstellen, erstellen Sie eine Klasse, die von der <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator>-Klasse erbt.</span><span class="sxs-lookup"><span data-stu-id="3faa9-198">To create a custom authenticator for the custom security token, create a class that inherits from the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> class.</span></span> <span data-ttu-id="3faa9-199">Im folgenden Beispiel wird die <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.ValidateTokenCore%2A>-Methode überschrieben.</span><span class="sxs-lookup"><span data-stu-id="3faa9-199">The following example overrides the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.ValidateTokenCore%2A> method.</span></span> <span data-ttu-id="3faa9-200">Weitere Informationen zu benutzerdefinierten Sicherheitstokenauthentifizierern finden Sie unter Gewusst [wie: Erstellen eines benutzerdefinierten Sicherheitstokenauthentifizierers](how-to-create-a-custom-security-token-authenticator.md).</span><span class="sxs-lookup"><span data-stu-id="3faa9-200">For more information about custom security token authenticators, see [How to: Create a Custom Security Token Authenticator](how-to-create-a-custom-security-token-authenticator.md).</span></span>  
  
     [!code-csharp[c_CustomToken#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtoken/cs/source.cs#7)]
     [!code-vb[c_CustomToken#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtoken/vb/source.vb#7)]  
  
     [!code-csharp[c_CustomToken#12](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtoken/cs/source.cs#12)]
     [!code-vb[c_CustomToken#12](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtoken/vb/source.vb#12)]  
  
#### <a name="to-integrate-the-custom-security-token-with-a-security-token-manager"></a><span data-ttu-id="3faa9-201">So integrieren Sie das benutzerdefinierte Sicherheitstoken in einen Sicherheitstoken-Manager</span><span class="sxs-lookup"><span data-stu-id="3faa9-201">To integrate the custom security token with a security token manager</span></span>  
  
1. <span data-ttu-id="3faa9-202">Der Sicherheitstoken-Manager erstellt die entsprechenden Instanzen für den Anbieter, den Sicherheitsauthentifizierer und das Serialisierungsprogramm für das Token.</span><span class="sxs-lookup"><span data-stu-id="3faa9-202">The security token manager creates the appropriate token provider, security authenticator, and token serializer instances.</span></span> <span data-ttu-id="3faa9-203">Zum Erstellen eines Managers für das benutzerdefinierte Token erstellen Sie eine Klasse, die von der <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>-Klasse erbt.</span><span class="sxs-lookup"><span data-stu-id="3faa9-203">To create a custom token manager, create a class that inherits from the <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager> class.</span></span> <span data-ttu-id="3faa9-204">Die primären Methoden der Klasse erstellen den entsprechenden Anbieter und den entsprechenden Client oder die entsprechenden Anmeldeinformationen für den Dienst mit einer <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>.</span><span class="sxs-lookup"><span data-stu-id="3faa9-204">The primary methods of the class use a <xref:System.IdentityModel.Selectors.SecurityTokenRequirement> to create the appropriate provider and client or service credentials.</span></span> <span data-ttu-id="3faa9-205">Weitere Informationen zu benutzerdefinierten Sicherheits Token-Managern finden Sie unter Exemplarische Vorgehensweise [: Erstellen von benutzerdefinierten Client-und Dienst Anmelde](walkthrough-creating-custom-client-and-service-credentials.md)Informationen.</span><span class="sxs-lookup"><span data-stu-id="3faa9-205">For more information about custom security token managers, see [Walkthrough: Creating Custom Client and Service Credentials](walkthrough-creating-custom-client-and-service-credentials.md).</span></span>  
  
     [!code-csharp[c_CustomToken#8](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtoken/cs/source.cs#8)]
     [!code-vb[c_CustomToken#8](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtoken/vb/source.vb#8)]  
  
     [!code-csharp[c_CustomToken#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtoken/cs/source.cs#9)]
     [!code-vb[c_CustomToken#9](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtoken/vb/source.vb#9)]  
  
#### <a name="to-integrate-the-custom-security-token-with-custom-client-and-service-credentials"></a><span data-ttu-id="3faa9-206">So integrieren Sie das benutzerdefinierte Sicherheitstoken in den benutzerdefinierten Client und die benutzerdefinierten Anmeldeinformationen des Diensts</span><span class="sxs-lookup"><span data-stu-id="3faa9-206">To integrate the custom security token with custom client and service credentials</span></span>  
  
1. <span data-ttu-id="3faa9-207">Der benutzerdefinierte Client und die benutzerdefinierten Anmeldeinformationen für den Dienst müssen hinzugefügt werden, damit eine API für die Anwendung Informationen zum benutzerdefinierten Token angeben kann, die von der zuvor erstellten Infrastruktur für das benutzerdefinierte Sicherheitstoken zur Bereitstellung und Authentifizierung von Inhalten für das benutzerdefinierte Sicherheitstoken verwendet werden können.</span><span class="sxs-lookup"><span data-stu-id="3faa9-207">The custom client and service credentials must be added to provide an API for the application to allow specifying custom token information that is used by the custom security token infrastructure created previously to provide and authenticate the custom security token content.</span></span> <span data-ttu-id="3faa9-208">Die folgenden Beispiele veranschaulichen diese Vorgehensweise.</span><span class="sxs-lookup"><span data-stu-id="3faa9-208">The following samples show how this can be done.</span></span> <span data-ttu-id="3faa9-209">Weitere Informationen zu benutzerdefinierten Client-und Dienst Anmelde Informationen finden Sie unter Exemplarische Vorgehensweise [: Erstellen benutzerdefinierter Client-und Dienst Anmelde](walkthrough-creating-custom-client-and-service-credentials.md)Informationen.</span><span class="sxs-lookup"><span data-stu-id="3faa9-209">For more information about custom client and service credentials, see [Walkthrough: Creating Custom Client and Service Credentials](walkthrough-creating-custom-client-and-service-credentials.md).</span></span>  
  
     [!code-csharp[c_CustomToken#10](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtoken/cs/source.cs#10)]
     [!code-vb[c_CustomToken#10](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtoken/vb/source.vb#10)]  
  
     [!code-csharp[c_customToken#11](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtoken/cs/source.cs#11)]
     [!code-vb[c_customToken#11](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtoken/vb/source.vb#11)]  
  
 <span data-ttu-id="3faa9-210">Die zuvor erstellte benutzerdefinierte Sicherheitstokenparameter-Klasse wird verwendet, um dem WCF-Sicherheits Framework mitzuteilen, dass bei der Kommunikation mit einem Dienst ein benutzerdefiniertes Sicherheits Token verwendet werden muss.</span><span class="sxs-lookup"><span data-stu-id="3faa9-210">The custom security token parameters class created previously is used to tell the WCF security framework that a custom security token must be used when communicating with a service.</span></span> <span data-ttu-id="3faa9-211">Das folgende Verfahren veranschaulicht die Vorgehensweise.</span><span class="sxs-lookup"><span data-stu-id="3faa9-211">The following procedure shows how this can be done.</span></span>  
  
#### <a name="to-integrate-the-custom-security-token-with-the-binding"></a><span data-ttu-id="3faa9-212">So integrieren Sie das benutzerdefinierte Sicherheitstoken in die Bindung</span><span class="sxs-lookup"><span data-stu-id="3faa9-212">To integrate the custom security token with the binding</span></span>  
  
1. <span data-ttu-id="3faa9-213">Die Parameterklasse für das benutzerdefinierte Sicherheitstoken muss in einer der Tokenparameterauflistungen angegeben werden, die für die <xref:System.ServiceModel.Channels.SecurityBindingElement>-Klasse verfügbar gemacht werden.</span><span class="sxs-lookup"><span data-stu-id="3faa9-213">The custom security token parameters class must be specified in one of the token parameters collections that are exposed on the <xref:System.ServiceModel.Channels.SecurityBindingElement> class.</span></span> <span data-ttu-id="3faa9-214">Im folgenden Beispiel wird die Auflistung verwendet, die von `SignedEncrypted` zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="3faa9-214">The following example uses the collection returned by `SignedEncrypted`.</span></span> <span data-ttu-id="3faa9-215">Mit diesem Code wird jeder Nachricht, die vom Client an den Dienst gesendet wird, das benutzerdefinierte Kreditkartentoken hinzugefügt, und der Inhalt wird automatisch signiert und verschlüsselt.</span><span class="sxs-lookup"><span data-stu-id="3faa9-215">The code adds the credit card custom token to every message sent from the client to the service with its content automatically signed and encrypted.</span></span>  
  
     [!code-csharp[c_CustomToken#13](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtoken/cs/source.cs#13)]
     [!code-vb[c_CustomToken#13](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtoken/vb/source.vb#13)]  
  
 <span data-ttu-id="3faa9-216">In diesem Thema werden die verschiedenen Codeteile behandelt, die zur Implementierung und Verwendung benutzerdefinierter Token erforderlich sind.</span><span class="sxs-lookup"><span data-stu-id="3faa9-216">This topic shows the various pieces of code necessary to implement and use a custom token.</span></span> <span data-ttu-id="3faa9-217">Ein vollständiges Beispiel dafür, wie diese Codeteile zusammenpassen, finden Sie unter [benutzerdefiniertes Token](../samples/custom-token.md).</span><span class="sxs-lookup"><span data-stu-id="3faa9-217">To see a complete example of how all these pieces of code fit together see, [Custom Token](../samples/custom-token.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="3faa9-218">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="3faa9-218">See also</span></span>

- <xref:System.IdentityModel.Tokens.SecurityToken>
- <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters>
- <xref:System.ServiceModel.Security.WSSecurityTokenSerializer>
- <xref:System.IdentityModel.Selectors.SecurityTokenProvider>
- <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator>
- <xref:System.IdentityModel.Policy.IAuthorizationPolicy>
- <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>
- <xref:System.IdentityModel.Selectors.SecurityTokenManager>
- <xref:System.ServiceModel.Description.ClientCredentials>
- <xref:System.ServiceModel.Description.ServiceCredentials>
- <xref:System.ServiceModel.Channels.SecurityBindingElement>
- [<span data-ttu-id="3faa9-219">Exemplarische Vorgehensweise: Erstellen von benutzerdefinierten Client- und Dienstanmeldeinformationen</span><span class="sxs-lookup"><span data-stu-id="3faa9-219">Walkthrough: Creating Custom Client and Service Credentials</span></span>](walkthrough-creating-custom-client-and-service-credentials.md)
- [<span data-ttu-id="3faa9-220">Vorgehensweise: Erstellen eines benutzerdefinierten Sicherheitstokenauthentifizierers</span><span class="sxs-lookup"><span data-stu-id="3faa9-220">How to: Create a Custom Security Token Authenticator</span></span>](how-to-create-a-custom-security-token-authenticator.md)
- [<span data-ttu-id="3faa9-221">Vorgehensweise: Erstellen eines benutzerdefinierten Sicherheitstokenanbieters</span><span class="sxs-lookup"><span data-stu-id="3faa9-221">How to: Create a Custom Security Token Provider</span></span>](how-to-create-a-custom-security-token-provider.md)
