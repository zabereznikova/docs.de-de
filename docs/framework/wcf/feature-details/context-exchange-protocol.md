---
title: Kontextaustauschprotokoll
ms.date: 03/30/2017
ms.assetid: 3dfd38e0-ae52-491c-94f4-7a862b9843d4
ms.openlocfilehash: ba613a2d12843ad00034057f8bbf08d5357d7f04
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 11/26/2020
ms.locfileid: "96237819"
---
# <a name="context-exchange-protocol"></a><span data-ttu-id="ade60-102">Kontextaustauschprotokoll</span><span class="sxs-lookup"><span data-stu-id="ade60-102">Context Exchange Protocol</span></span>

<span data-ttu-id="ade60-103">In diesem Abschnitt wird das in Windows Communication Foundation (WCF)-Release .NET Framework Version 3,5 eingeführte Kontext Austausch Protokoll beschrieben.</span><span class="sxs-lookup"><span data-stu-id="ade60-103">This section describes the context exchange protocol introduced in Windows Communication Foundation (WCF) release .NET Framework version 3.5.</span></span> <span data-ttu-id="ade60-104">Mithilfe dieses Protokolls kann vom Clientkanal ein vom Dienst bereitgestellter Kontext akzeptiert und für alle nachfolgenden Anforderungen übernommen werden, die über dieselbe Clientkanalinstanz an den Dienst gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="ade60-104">This protocol allows the client channel to accept a context supplied by a service and apply it to all subsequent requests to that service sent over the same client channel instance.</span></span> <span data-ttu-id="ade60-105">Zur Implementierung des Kontextaustauschprotokolls kann einer der beiden folgenden Mechanismen verwendet werden, um den Kontext zwischen dem Server und dem Client zu propagieren: HTTP-Cookies oder ein SOAP-Header.</span><span class="sxs-lookup"><span data-stu-id="ade60-105">The implementation of the context exchange protocol can use one of the following two mechanisms to propagate the context between the server and the client: HTTP cookies or a SOAP header.</span></span>  
  
 <span data-ttu-id="ade60-106">Das Kontextaustauschprotokoll wird in einer benutzerdefinierten Kanalebene implementiert.</span><span class="sxs-lookup"><span data-stu-id="ade60-106">The context exchange protocol is implemented in a custom channel layer.</span></span> <span data-ttu-id="ade60-107">Der Kontext wird mithilfe der <xref:System.ServiceModel.Channels.ContextMessageProperty>-Eigenschaft von der Kanalebene an die Anwendungsebene (und umgekehrt) übermittelt.</span><span class="sxs-lookup"><span data-stu-id="ade60-107">The channel communicates the context to and from the application layer using a <xref:System.ServiceModel.Channels.ContextMessageProperty> property.</span></span> <span data-ttu-id="ade60-108">Zur Übertragung zwischen Endpunkten wird der Wert des Kontexts entweder auf der Kanalebene in einen SOAP-Header serialisiert oder in die bzw. aus den Nachrichteneigenschaften konvertiert, die eine HTTP-Anforderung bzw. eine HTTP-Antwort darstellen.</span><span class="sxs-lookup"><span data-stu-id="ade60-108">For transmission between endpoints, the value of the context is either serialized as a SOAP header at the channel layer, or converted to or from the message properties that represent a HTTP request and response.</span></span> <span data-ttu-id="ade60-109">Im zweiten Fall wird erwartet, das eine der zugrunde liegenden Kanalebenen die Eigenschaften der HTTP-Anforderungs- bzw. HTTP-Antwortnachrichten in bzw. aus HTTP-Cookies umwandelt.</span><span class="sxs-lookup"><span data-stu-id="ade60-109">In the latter case, it is expected that one of the underlying channel layers converts the HTTP request and response message properties to and from HTTP cookies, respectively.</span></span> <span data-ttu-id="ade60-110">Der für den Kontextaustausch zu verwendende Mechanismus wird mithilfe der <xref:System.ServiceModel.Channels.ContextExchangeMechanism>-Eigenschaft für das <xref:System.ServiceModel.Channels.ContextBindingElement> ausgewählt</span><span class="sxs-lookup"><span data-stu-id="ade60-110">The choice of the mechanism used to exchange the context is done using the <xref:System.ServiceModel.Channels.ContextExchangeMechanism> property on the <xref:System.ServiceModel.Channels.ContextBindingElement>.</span></span> <span data-ttu-id="ade60-111">Gültige Werte sind `HttpCookie` und `SoapHeader`.</span><span class="sxs-lookup"><span data-stu-id="ade60-111">Valid values are `HttpCookie` or `SoapHeader`.</span></span>  
  
 <span data-ttu-id="ade60-112">Auf dem Client kann eine Kanalinstanz abhängig von der Einstellung der Kanaleigenschaft <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A> in zwei Modi arbeiten.</span><span class="sxs-lookup"><span data-stu-id="ade60-112">On the client, an instance of a channel can operate in two modes based on the settings on the channel property, <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A>.</span></span>  
  
## <a name="mode-1-channel-context-management"></a><span data-ttu-id="ade60-113">Modus 1: Kanalkontextverwaltung</span><span class="sxs-lookup"><span data-stu-id="ade60-113">Mode 1: Channel Context Management</span></span>  

 <span data-ttu-id="ade60-114">Dies ist der Standardmodus, wobei <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A> auf `true` festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="ade60-114">This is the default mode where <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A> is set to `true`.</span></span> <span data-ttu-id="ade60-115">In diesem Modus verwaltet der Kontextkanal den Kontext und speichert den Kontext während seiner Lebensdauer zwischen.</span><span class="sxs-lookup"><span data-stu-id="ade60-115">In this mode the context channel manages the context and caches the context during its lifetime.</span></span> <span data-ttu-id="ade60-116">Der Kontext kann über die Kanaleigenschaft `IContextManager` durch einen Aufruf der `GetContext`-Methode vom Kanal abgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="ade60-116">Context can be retrieved from the channel through channel property `IContextManager` by calling the `GetContext` method.</span></span> <span data-ttu-id="ade60-117">Der Kanal kann auch vor dem Öffnen vorab mit einem bestimmten Kontext initialisiert werden, indem die `SetContext`-Methode für die Kanaleigenschaft aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="ade60-117">The channel can also be pre-initialized with specific context before being opened by calling the `SetContext` method on the channel property.</span></span> <span data-ttu-id="ade60-118">Sobald der Kanal mit einem Kontext initialisiert wurde, kann er nicht mehr zurückgesetzt werden.</span><span class="sxs-lookup"><span data-stu-id="ade60-118">Once the channel is initialized with context it cannot be reset.</span></span>  
  
 <span data-ttu-id="ade60-119">Im Folgenden finden Sie eine Liste der Dinge, die in diesem Modus nicht verändert werden können:</span><span class="sxs-lookup"><span data-stu-id="ade60-119">The following is a list of invariants in this mode:</span></span>  
  
- <span data-ttu-id="ade60-120">Jeder Versuch, den Kontext mit `SetContext` zurückzusetzen, nachdem der Kanal geöffnet wurde, löst eine <xref:System.InvalidOperationException> aus.</span><span class="sxs-lookup"><span data-stu-id="ade60-120">Any attempt to reset the context using `SetContext` after the channel has been opened throws an <xref:System.InvalidOperationException>.</span></span>  
  
- <span data-ttu-id="ade60-121">Jeder Versuch, Kontext mithilfe der <xref:System.ServiceModel.Channels.ContextMessageProperty> in einer ausgehenden Nachricht zu senden, löst eine <xref:System.InvalidOperationException> aus.</span><span class="sxs-lookup"><span data-stu-id="ade60-121">Any attempt to send context by using the <xref:System.ServiceModel.Channels.ContextMessageProperty> in an outgoing message throws an <xref:System.InvalidOperationException>.</span></span>  
  
- <span data-ttu-id="ade60-122">Wenn eine Nachricht mit einem bestimmten Kontext vom Server empfangen wird, dann wird eine <xref:System.ServiceModel.ProtocolException> ausgelöst, wenn der Kanal bereits mit einem bestimmten Kontext initialisiert wurde.</span><span class="sxs-lookup"><span data-stu-id="ade60-122">If a message is received from server with a specific context, when the channel has already been initialized with a specific context, this results in a <xref:System.ServiceModel.ProtocolException>.</span></span>  
  
    > [!NOTE]
    > <span data-ttu-id="ade60-123">Der Empfang eines Anfangskontexts vom Server ist nur dann angemessen, wenn der Kanal geöffnet wird, ohne dass explizit ein Kontext festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="ade60-123">It is appropriate to receive an initial context from the server only if the channel is opened without any context set explicitly.</span></span>  
  
- <span data-ttu-id="ade60-124">Bei eingehenden Nachrichten hat <xref:System.ServiceModel.Channels.ContextMessageProperty> stets den Wert NULL.</span><span class="sxs-lookup"><span data-stu-id="ade60-124">The <xref:System.ServiceModel.Channels.ContextMessageProperty> on incoming message is always null.</span></span>  
  
## <a name="mode-2-application-context-management"></a><span data-ttu-id="ade60-125">Modus 2: Anwendungskontextverwaltung</span><span class="sxs-lookup"><span data-stu-id="ade60-125">Mode 2: Application Context Management</span></span>  

 <span data-ttu-id="ade60-126">Dieser Modus wird verwendet, wenn <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A> auf `false` festgelegt wurde.</span><span class="sxs-lookup"><span data-stu-id="ade60-126">This is the mode when <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A> is set to `false`.</span></span> <span data-ttu-id="ade60-127">In diesem Modus verwaltet der Kontextkanal keinen Kontext.</span><span class="sxs-lookup"><span data-stu-id="ade60-127">In this mode the context channel does not manage context.</span></span> <span data-ttu-id="ade60-128">Es liegt in der Verantwortung der Anwendung, den Kontext mithilfe von <xref:System.ServiceModel.Channels.ContextMessageProperty> abzurufen, zu verwalten und zu übernehmen.</span><span class="sxs-lookup"><span data-stu-id="ade60-128">It is the application's responsibility to retrieve, manage and apply context by using the <xref:System.ServiceModel.Channels.ContextMessageProperty>.</span></span> <span data-ttu-id="ade60-129">Jeder Versuch, `GetContext` oder `SetContext` aufzurufen, führt zu einer <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="ade60-129">Any attempt to call `GetContext` or `SetContext` results in an <xref:System.InvalidOperationException>.</span></span>  
  
 <span data-ttu-id="ade60-130">Unabhängig vom ausgewählten Modus unterstützt die Clientkanalfactory die Nachrichtenaustauschmuster <xref:System.ServiceModel.Channels.IRequestChannel>, <xref:System.ServiceModel.Channels.IRequestSessionChannel> und <xref:System.ServiceModel.Channels.IDuplexSessionChannel>.</span><span class="sxs-lookup"><span data-stu-id="ade60-130">No matter which mode is chosen the client channel factory supports <xref:System.ServiceModel.Channels.IRequestChannel>, <xref:System.ServiceModel.Channels.IRequestSessionChannel>, and <xref:System.ServiceModel.Channels.IDuplexSessionChannel> message exchange patterns.</span></span>  
  
 <span data-ttu-id="ade60-131">Auf der Dienstseite ist eine Instanz des Kanals für die Konvertierung des vom Client in eingehenden Nachrichten bereitgestellten Kontexts in eine <xref:System.ServiceModel.Channels.ContextMessageProperty>-Eigenschaft verantwortlich.</span><span class="sxs-lookup"><span data-stu-id="ade60-131">On the service, an instance of the channel is responsible for converting the context supplied by the client on incoming messages to the <xref:System.ServiceModel.Channels.ContextMessageProperty>.</span></span> <span data-ttu-id="ade60-132">Die Anwendungsebene oder andere Kanäle weiter oben im Aufrufstapel können dann auf diese Nachrichteneigenschaft zugreifen.</span><span class="sxs-lookup"><span data-stu-id="ade60-132">The message property can then be accessed by the application layer or other channels further up in the call stack.</span></span> <span data-ttu-id="ade60-133">Die Dienstkanäle erlauben es der Anwendungsebene auch, einen neuen Kontextwert anzugeben, der zurück zum Client übermittelt werden soll, indem der Antwortnachricht eine <xref:System.ServiceModel.Channels.ContextMessageProperty> angehängt wird.</span><span class="sxs-lookup"><span data-stu-id="ade60-133">The service channels also allow the application layer to specify a new context value to be propagated back to the client by attaching a <xref:System.ServiceModel.Channels.ContextMessageProperty> to the response message.</span></span> <span data-ttu-id="ade60-134">Diese Eigenschaft wird in einen SOAP-Header oder ein HTTP-Cookie umgewandelt, der bzw. das den Kontext enthält, der von der Konfiguration der Bindung abhängt.</span><span class="sxs-lookup"><span data-stu-id="ade60-134">This property is converted to the SOAP header or HTTP cookie that contains the context, which depends on the configuration of the binding.</span></span> <span data-ttu-id="ade60-135">Der Dienstkanallistener unterstützt die Nachrichtenaustauschmuster <xref:System.ServiceModel.Channels.IReplyChannel>, <xref:System.ServiceModel.Channels.IReplySessionChannel> und <xref:System.ServiceModel.Channels.IReplySessionChannel>.</span><span class="sxs-lookup"><span data-stu-id="ade60-135">The service channel listener supports <xref:System.ServiceModel.Channels.IReplyChannel>, <xref:System.ServiceModel.Channels.IReplySessionChannel>, and <xref:System.ServiceModel.Channels.IReplySessionChannel> message exchange patterns.</span></span>  
  
 <span data-ttu-id="ade60-136">Das Kontextaustauschprotokoll führt den neuen SOAP-Header `wsc:Context` ein, der zur Darstellung der Kontextinformationen dient, wenn der Kontext nicht mithilfe von HTTP-Cookies übermittelt wird.</span><span class="sxs-lookup"><span data-stu-id="ade60-136">The context exchange protocol introduces a new `wsc:Context` SOAP header to represent the context information when HTTP cookies are not used to propagate the context.</span></span> <span data-ttu-id="ade60-137">Das Kontextheaderschema lässt eine beliebige Anzahl untergeordneter Elemente zu, die jeweils einen Zeichenfolgenschlüssel und Zeichenfolgeninhalt enthalten.</span><span class="sxs-lookup"><span data-stu-id="ade60-137">The context header schema allows for any number of child elements, each with a string key and string content.</span></span> <span data-ttu-id="ade60-138">Es folgt ein Beispiel für einen Kontextheader.</span><span class="sxs-lookup"><span data-stu-id="ade60-138">The following is an example of a context header.</span></span>  
  
 `<Context xmlns="http://schemas.microsoft.com/ws/2006/05/context">`  
  
 `<property name="myContext">context-2</property>`  
  
 `</Context>`  
  
 <span data-ttu-id="ade60-139">Im `HttpCookie`-Modus werden Cookies mit dem `SetCookie`-Header festgelegt.</span><span class="sxs-lookup"><span data-stu-id="ade60-139">When in `HttpCookie` mode, cookies are set using the `SetCookie` header.</span></span> <span data-ttu-id="ade60-140">Der Cookiename lautet `WscContext`.</span><span class="sxs-lookup"><span data-stu-id="ade60-140">The cookie name is `WscContext`.</span></span> <span data-ttu-id="ade60-141">Der Wert des Cookies entspricht der Base64-Codierung des `wsc:Context`-Headers.</span><span class="sxs-lookup"><span data-stu-id="ade60-141">The value of the cookie is the Base64 encoding of the `wsc:Context` header.</span></span> <span data-ttu-id="ade60-142">Dieser Wert wird in Anführungszeichen eingeschlossen.</span><span class="sxs-lookup"><span data-stu-id="ade60-142">This value is enclosed in quotes.</span></span>  
  
 <span data-ttu-id="ade60-143">Der Wert des Kontexts muss während der Übermittlung aus den gleichen Gründen vor Veränderungen geschützt werden, aus denen WS-Adressierungsheader geschützt werden: Anhand des Headers wird ermittelt, an welchen Endpunkt im Dienst die Anforderung weitergeleitet werden soll.</span><span class="sxs-lookup"><span data-stu-id="ade60-143">The value of the context must be protected from modification while in transit for the same reason WS-Addressing headers are protected – the header is used to determine where to dispatch the request to on the service.</span></span> <span data-ttu-id="ade60-144">Deshalb muss der `wsc:Context`-Header entweder auf SOAP- oder auf Transportebene digital signiert und verschlüsselt werden, wenn für die Bindung ein Nachrichtenschutz verfügbar ist.</span><span class="sxs-lookup"><span data-stu-id="ade60-144">The `wsc:Context` header is therefore required to be digitally signed or signed and encrypted at either the SOAP or transport level when the binding offers message protection capability.</span></span> <span data-ttu-id="ade60-145">Werden zum Weitergeben von Kontext HTTP-Cookies verwendet, sollten diese mithilfe der Transportsicherheit geschützt werden.</span><span class="sxs-lookup"><span data-stu-id="ade60-145">When HTTP cookies are used to propagate context, they should be protected using transport security.</span></span>  
  
 <span data-ttu-id="ade60-146">Für Dienstendpunkte, bei denen die Unterstützung des Kontextaustauschprotokolls erforderlich ist, kann diese Anforderung in der veröffentlichten Richtlinie als explizite Anforderung festgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="ade60-146">Service endpoints that require support for the context exchange protocol can make it explicit in the published policy.</span></span> <span data-ttu-id="ade60-147">Es wurden zwei neue Richtlinienassertionen eingeführt, die die Anforderung des Clients zur Unterstützung des Kontextaustauschprotokolls auf SOAP-Ebene oder das Aktivieren der Unterstützung von HTTP-Cookies darstellen.</span><span class="sxs-lookup"><span data-stu-id="ade60-147">Two new policy assertions have been introduced to represent the requirement for the client to support the context exchange protocol at the SOAP level or to enable HTTP cookie support.</span></span> <span data-ttu-id="ade60-148">Die Generierung dieser Assertionen in der Richtlinie auf Dienstseite wird vom Wert der <xref:System.ServiceModel.Channels.ContextBindingElement.ContextExchangeMechanism%2A>-Eigenschaft folgendermaßen gesteuert:</span><span class="sxs-lookup"><span data-stu-id="ade60-148">Generation of these assertions into the policy on the service is controlled by the value of the <xref:System.ServiceModel.Channels.ContextBindingElement.ContextExchangeMechanism%2A> property as follows:</span></span>  
  
- <span data-ttu-id="ade60-149">Für <xref:System.ServiceModel.Channels.ContextExchangeMechanism.ContextSoapHeader> wird die folgende Assertion generiert:</span><span class="sxs-lookup"><span data-stu-id="ade60-149">For <xref:System.ServiceModel.Channels.ContextExchangeMechanism.ContextSoapHeader>, the following assertion is generated:</span></span>  
  
    ```xml  
    <IncludeContext
    xmlns="http://schemas.microsoft.com/ws/2006/05/context"  
    protectionLevel="Sign" />  
    ```  
  
- <span data-ttu-id="ade60-150">Für <xref:System.ServiceModel.Channels.ContextExchangeMechanism.HttpCookie> wird die folgende Assertion generiert:</span><span class="sxs-lookup"><span data-stu-id="ade60-150">For <xref:System.ServiceModel.Channels.ContextExchangeMechanism.HttpCookie>, the following assertion is generated:</span></span>  
  
    ```xml  
    <HttpUseCookie xmlns="http://schemas.xmlsoap.org/soap/http"/>  
    ```  
  
## <a name="see-also"></a><span data-ttu-id="ade60-151">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="ade60-151">See also</span></span>

- [<span data-ttu-id="ade60-152">Handbuch für die Interoperabilität von Webdienstprotokollen</span><span class="sxs-lookup"><span data-stu-id="ade60-152">Web Services Protocols Interoperability Guide</span></span>](web-services-protocols-interoperability-guide.md)
