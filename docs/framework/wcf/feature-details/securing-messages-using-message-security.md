---
title: Sichern von Nachrichten mithilfe der Nachrichtensicherheit
ms.date: 03/30/2017
ms.assetid: a17ebe67-836b-4c52-9a81-2c3d58e225ee
ms.openlocfilehash: 70c645101033c31da01d79f624ab03ce328dd3a6
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 06/09/2020
ms.locfileid: "84589980"
---
# <a name="securing-messages-using-message-security"></a><span data-ttu-id="4ab82-102">Sichern von Nachrichten mithilfe der Nachrichtensicherheit</span><span class="sxs-lookup"><span data-stu-id="4ab82-102">Securing Messages Using Message Security</span></span>
<span data-ttu-id="4ab82-103">In diesem Abschnitt wird die WCF-Nachrichten Sicherheit bei Verwendung von erörtert <xref:System.ServiceModel.NetMsmqBinding> .</span><span class="sxs-lookup"><span data-stu-id="4ab82-103">This section discusses WCF message security when using <xref:System.ServiceModel.NetMsmqBinding>.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="4ab82-104">Bevor Sie dieses Thema lesen, empfiehlt es sich, [Sicherheitskonzepte](security-concepts.md)zu lesen.</span><span class="sxs-lookup"><span data-stu-id="4ab82-104">Before reading through this topic, it is recommended that you read [Security Concepts](security-concepts.md).</span></span>  
  
 <span data-ttu-id="4ab82-105">Die folgende Abbildung stellt ein konzeptionelles Modell der Kommunikation in der Warteschlange mithilfe von WCF bereit.</span><span class="sxs-lookup"><span data-stu-id="4ab82-105">The following illustration provides a conceptual model of queued communication using WCF.</span></span> <span data-ttu-id="4ab82-106">Anhand dieser Abbildung und der Terminologie werden</span><span class="sxs-lookup"><span data-stu-id="4ab82-106">This illustration and terminology are used to explain</span></span>  
  
 <span data-ttu-id="4ab82-107">die Konzepte der Transportsicherheit erläutert.</span><span class="sxs-lookup"><span data-stu-id="4ab82-107">transport security concepts.</span></span>  
  
 <span data-ttu-id="4ab82-108">![In die Warteschlange gestelltes Anwendungsdiagramm](media/distributed-queue-figure.jpg "Verteilte Warteschlangen (Abbildung)")</span><span class="sxs-lookup"><span data-stu-id="4ab82-108">![Queued Application Diagram](media/distributed-queue-figure.jpg "Distributed-Queue-Figure")</span></span>  
  
 <span data-ttu-id="4ab82-109">Beim Senden von Nachrichten in der Warteschlange mithilfe von WCF wird die WCF-Nachricht als Text der MSMQ-Nachricht (Message Queuing) angefügt.</span><span class="sxs-lookup"><span data-stu-id="4ab82-109">When sending queued messages using WCF, the WCF message is attached as a body of the Message Queuing (MSMQ) message.</span></span> <span data-ttu-id="4ab82-110">Mit der Transportsicherheit wird die gesamte MSMQ-Nachricht gesichert, mit der Nachrichtensicherheit (oder SOAP-Sicherheit) hingegen wird nur der Textkörper der MSMQ-Nachricht gesichert.</span><span class="sxs-lookup"><span data-stu-id="4ab82-110">While transport security secures the entire MSMQ message, message (or SOAP) security only secures the body of the MSMQ message.</span></span>  
  
 <span data-ttu-id="4ab82-111">Das Kernkonzept der Nachrichtensicherheit besteht darin, dass der Client die Nachricht für die empfangende Anwendung (Dienst) sichert. Im Gegensatz dazu sichert der Client bei der Transportsicherheit die Nachricht für die Zielwarteschlange.</span><span class="sxs-lookup"><span data-stu-id="4ab82-111">The key concept of message security is that the client secures the message for the receiving application (service), unlike transport security where the client secures the message for the Target Queue.</span></span> <span data-ttu-id="4ab82-112">Daher spielt MSMQ keinen Teil, wenn die WCF-Nachricht mithilfe der Nachrichten Sicherheit gesichert wird.</span><span class="sxs-lookup"><span data-stu-id="4ab82-112">As such, MSMQ plays no part when securing the WCF message using message security.</span></span>  
  
 <span data-ttu-id="4ab82-113">WCF Message Security fügt der WCF-Nachricht Sicherheits Header hinzu, die in vorhandene Sicherheitsinfrastrukturen integriert sind, z. b. ein Zertifikat oder das Kerberos-Protokoll.</span><span class="sxs-lookup"><span data-stu-id="4ab82-113">WCF message security adds security headers to the WCF message that integrate with existing security infrastructures, such as a certificate or the Kerberos protocol.</span></span>  
  
## <a name="message-credential-type"></a><span data-ttu-id="4ab82-114">Anmeldeinformationstypen für Nachrichten</span><span class="sxs-lookup"><span data-stu-id="4ab82-114">Message Credential Type</span></span>  
 <span data-ttu-id="4ab82-115">Bei der Verwendung der Nachrichtensicherheit können der Dienst und der Client Anmeldeinformationen bereitstellen, um sich gegenseitig zu authentifizieren.</span><span class="sxs-lookup"><span data-stu-id="4ab82-115">Using message security, the service and client can present credentials to authenticate each another.</span></span> <span data-ttu-id="4ab82-116">Sie können die Nachrichtensicherheit auswählen, indem Sie den <xref:System.ServiceModel.NetMsmqBinding.Security%2A>-Modus auf `Message` oder `Both` (d. h. Transport- und Nachrichtensicherheit werden verwendet) festlegen.</span><span class="sxs-lookup"><span data-stu-id="4ab82-116">You can select message security by setting the <xref:System.ServiceModel.NetMsmqBinding.Security%2A> mode to `Message` or `Both` (that is, use both transport security and message security).</span></span>  
  
 <span data-ttu-id="4ab82-117">Der Dienst kann anhand der <xref:System.ServiceModel.ServiceSecurityContext.Current%2A>-Eigenschaft die Anmeldeinformationen überprüfen, mit denen der Client authentifiziert wird.</span><span class="sxs-lookup"><span data-stu-id="4ab82-117">The service can use the <xref:System.ServiceModel.ServiceSecurityContext.Current%2A> property to inspect the credential used to authenticate the client.</span></span> <span data-ttu-id="4ab82-118">Damit können weitere Autorisierungsüberprüfungen vorgenommen werden, die der Dienst zur Implementierung auswählen kann.</span><span class="sxs-lookup"><span data-stu-id="4ab82-118">This can also be used for further authorization checks that the service chooses to implement.</span></span>  
  
 <span data-ttu-id="4ab82-119">Dieser Abschnitt erklärt die verschiedenen Anmeldeinformationstypen und ihre Verwendung mit Warteschlangen.</span><span class="sxs-lookup"><span data-stu-id="4ab82-119">This section explains the different credential types and how to use them with queues.</span></span>  
  
### <a name="certificate"></a><span data-ttu-id="4ab82-120">Zertifikat</span><span class="sxs-lookup"><span data-stu-id="4ab82-120">Certificate</span></span>  
 <span data-ttu-id="4ab82-121">Der Zertifikat-Anmeldeinformationstyp identifiziert mit einem X.509-Zertifikat den Dienst und den Client.</span><span class="sxs-lookup"><span data-stu-id="4ab82-121">The certificate credential type uses an X.509 certificate to identify the service and the client.</span></span>  
  
 <span data-ttu-id="4ab82-122">In einem typischen Szenario stellt eine vertrauenswürdige Zertifizierungsstelle dem Client und dem Dienst ein gültiges Zertifikat aus.</span><span class="sxs-lookup"><span data-stu-id="4ab82-122">In a typical scenario, the client and the service are issued a valid certificate by a trusted certification authority.</span></span> <span data-ttu-id="4ab82-123">Dann wird die Verbindung hergestellt, und der Client authentifiziert die Gültigkeit des Dienstes, indem er anhand des Zertifikat des Dienstes entscheidet, ob der Dienst vertrauenswürdig ist.</span><span class="sxs-lookup"><span data-stu-id="4ab82-123">Then the connection is established, the client authenticates the validity of the service using the service's certificate to decide whether it can trust the service.</span></span> <span data-ttu-id="4ab82-124">Entsprechend verwendet der Dienst das Zertifikat des Clients, um dessen Vertrauenswürdigkeit zu überprüfen.</span><span class="sxs-lookup"><span data-stu-id="4ab82-124">Similarly, the service uses the client's certificate to validate the client trust.</span></span>  
  
 <span data-ttu-id="4ab82-125">Da im Fall von Warteschlangen nicht immer eine Verbindung hergestellt ist, sind der Client und der Dienst möglicherweise nicht zur selben Zeit online.</span><span class="sxs-lookup"><span data-stu-id="4ab82-125">Given the disconnected nature of queues, the client and the service may not be online at the same time.</span></span> <span data-ttu-id="4ab82-126">Daher müssen der Client und der Dienst Zertifikate out-of-band austauschen.</span><span class="sxs-lookup"><span data-stu-id="4ab82-126">As such, the client and service have to exchange certificates out-of-band.</span></span> <span data-ttu-id="4ab82-127">Insbesondere der Client, bei dem sich das Dienstzertifikat (das mit einer Zertifizierungsstelle verkettet sein kann) im vertrauenswürdigen Speicher befindet, muss verlässlich mit dem richtigen Dienst kommunizieren.</span><span class="sxs-lookup"><span data-stu-id="4ab82-127">In particular, the client, by virtue of holding the service's certificate (which can be chained to a certification authority) in its trusted store, must trust that it is communicating with the correct service.</span></span> <span data-ttu-id="4ab82-128">Zur Authentifizierung des Clients gleicht der Dienst das X.509-Zertifikat, das an die Nachricht angehängt ist, mit dem Zertifikat in seinem Speicher ab, um die Echtzeit des Clients zu überprüfen.</span><span class="sxs-lookup"><span data-stu-id="4ab82-128">For authenticating the client, the service uses the X.509 certificate attached with the message to matches it with the certificate in its store to verify the authenticity of the client.</span></span> <span data-ttu-id="4ab82-129">Auch hier muss das Zertifikat mit einer Zertifizierungsstelle verkettet sein.</span><span class="sxs-lookup"><span data-stu-id="4ab82-129">Again, the certificate must be chained to a certification authority.</span></span>  
  
 <span data-ttu-id="4ab82-130">Auf einem Computer unter Windows befinden sich die Zertifikate in verschiedenen Arten von Speichern.</span><span class="sxs-lookup"><span data-stu-id="4ab82-130">On a computer running Windows, certificates are held in several kinds of stores.</span></span> <span data-ttu-id="4ab82-131">Weitere Informationen zu den unterschiedlichen speichern finden Sie unter [Zertifikat Speicher](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc757138(v=ws.10)).</span><span class="sxs-lookup"><span data-stu-id="4ab82-131">For more information about the different stores, see [Certificate stores](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc757138(v=ws.10)).</span></span>  
  
### <a name="windows"></a><span data-ttu-id="4ab82-132">Windows</span><span class="sxs-lookup"><span data-stu-id="4ab82-132">Windows</span></span>  
 <span data-ttu-id="4ab82-133">Der Windows-Anmeldeinformationstyp für Nachrichten verwendet das Kerberos-Protokoll.</span><span class="sxs-lookup"><span data-stu-id="4ab82-133">Windows message credential type uses the Kerberos protocol.</span></span>  
  
 <span data-ttu-id="4ab82-134">Das Kerberos-Protokoll ist ein Sicherheitsmechanismus, der Benutzer in einer Domäne authentifiziert und den authentifizierten Benutzern das Erstellen sicherer Kontexte mit anderen Entitäten einer Domäne ermöglicht.</span><span class="sxs-lookup"><span data-stu-id="4ab82-134">The Kerberos protocol is a security mechanism that authenticates users on a domain and allows the authenticated users to establish secure contexts with other entities on a domain.</span></span>  
  
 <span data-ttu-id="4ab82-135">Die Verwendung des Kerberos-Protokolls für die Kommunikation unter Verwendung von Warteschlangen ist problematisch, insofern als die vom Schlüsselverteilungscenter verteilten Tickets mit der Clientidentität relativ kurzlebig sind.</span><span class="sxs-lookup"><span data-stu-id="4ab82-135">The problem with using the Kerberos protocol for queued communication is that the tickets that contain client identity that the Key Distribution Center (KDC) distributes are relatively short-lived.</span></span> <span data-ttu-id="4ab82-136">Dem Kerberos-Ticket wird eine *Lebensdauer* zugeordnet, die die Gültigkeit des Tickets angibt.</span><span class="sxs-lookup"><span data-stu-id="4ab82-136">A *lifetime* is associated with the Kerberos ticket that indicates the validity of the ticket.</span></span> <span data-ttu-id="4ab82-137">Bei einer hohen Latenz können Sie somit nicht sicher sein, ob das Token noch für den Dienst gültig ist, der den Client authentifiziert.</span><span class="sxs-lookup"><span data-stu-id="4ab82-137">As such, given high latency, you cannot be sure that the token is still valid for the service that authenticates the client.</span></span>  
  
 <span data-ttu-id="4ab82-138">Wenn dieser Anmeldeinformationstyp verwendet wird, muss der Dienst unter dem SERVICE-Konto ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="4ab82-138">Note that when using this credential type, the service must be running under the SERVICE account.</span></span>  
  
 <span data-ttu-id="4ab82-139">Das Kerberos-Protokoll wird standardmäßig bei der Auswahl von Nachrichtenanmeldeinformationen verwendet.</span><span class="sxs-lookup"><span data-stu-id="4ab82-139">The Kerberos protocol is used by default when choosing message credential.</span></span>
  
### <a name="username-password"></a><span data-ttu-id="4ab82-140">Benutzernamenkennwort (Username Password)</span><span class="sxs-lookup"><span data-stu-id="4ab82-140">Username Password</span></span>  
 <span data-ttu-id="4ab82-141">Mit dieser Eigenschaft kann sich der Client beim Server durch Angabe eines Benutzernamenkennworts im Sicherheitsheader der Nachricht authentifizieren.</span><span class="sxs-lookup"><span data-stu-id="4ab82-141">Using this property, the client can authenticate to the server using a username password in the security header of the message.</span></span>  
  
### <a name="issuedtoken"></a><span data-ttu-id="4ab82-142">IssuedToken</span><span class="sxs-lookup"><span data-stu-id="4ab82-142">IssuedToken</span></span>  
 <span data-ttu-id="4ab82-143">Der Client kann den Sicherheitstokendienst zum Ausstellen eines Tokens verwenden. Dieses Token kann dann der Nachricht angefügt werden, um den Client für den Dienst zu identifizieren.</span><span class="sxs-lookup"><span data-stu-id="4ab82-143">The client can use the security token service to issue a token that can then be attached to the message for the service to authenticate the client.</span></span>  
  
## <a name="using-transport-and-message-security"></a><span data-ttu-id="4ab82-144">Verwenden der Transport- und der Nachrichtensicherheit</span><span class="sxs-lookup"><span data-stu-id="4ab82-144">Using Transport and Message Security</span></span>  
 <span data-ttu-id="4ab82-145">Wenn die Transportsicherheit und die Nachrichtensicherheit verwendet werden, muss das auf der Transportebene zum Sichern der Nachricht verwendete Zertifikat mit dem auf der SOAP-Nachrichtenebene verwendeten Zertifikat identisch sein.</span><span class="sxs-lookup"><span data-stu-id="4ab82-145">When using both transport security and message security, the certificate used to secure the message both at the transport and the SOAP message level must be the same.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4ab82-146">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="4ab82-146">See also</span></span>

- [<span data-ttu-id="4ab82-147">Sichern von Nachrichten mit Transportsicherheit</span><span class="sxs-lookup"><span data-stu-id="4ab82-147">Securing Messages Using Transport Security</span></span>](securing-messages-using-transport-security.md)
- [<span data-ttu-id="4ab82-148">Nachrichtensicherheit über Message Queuing</span><span class="sxs-lookup"><span data-stu-id="4ab82-148">Message Security over Message Queuing</span></span>](../samples/message-security-over-message-queuing.md)
- [<span data-ttu-id="4ab82-149">Sicherheitskonzepte</span><span class="sxs-lookup"><span data-stu-id="4ab82-149">Security Concepts</span></span>](security-concepts.md)
- [<span data-ttu-id="4ab82-150">Sichern von Diensten und Clients</span><span class="sxs-lookup"><span data-stu-id="4ab82-150">Securing Services and Clients</span></span>](securing-services-and-clients.md)
