---
title: 'Vorgehensweise: Konfigurieren von Anmeldeinformationen auf einem Verbunddienst'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, federation
- federation
ms.assetid: 149ab165-0ef3-490a-83a9-4322a07bd98a
ms.openlocfilehash: 692ccc0c39ca7ed40601551ea6bbcdd840fa03af
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 11/26/2020
ms.locfileid: "96257586"
---
# <a name="how-to-configure-credentials-on-a-federation-service"></a><span data-ttu-id="d463c-102">Vorgehensweise: Konfigurieren von Anmeldeinformationen auf einem Verbunddienst</span><span class="sxs-lookup"><span data-stu-id="d463c-102">How to: Configure Credentials on a Federation Service</span></span>

<span data-ttu-id="d463c-103">In Windows Communication Foundation (WCF) besteht das Erstellen eines Verbund Dienstanbieter aus den folgenden Haupt Prozeduren:</span><span class="sxs-lookup"><span data-stu-id="d463c-103">In Windows Communication Foundation (WCF), creating a federated service consists of the following main procedures:</span></span>  
  
1. <span data-ttu-id="d463c-104">Konfigurieren einer <xref:System.ServiceModel.WSFederationHttpBinding> oder einer ähnlichen benutzerdefinierten Bindung.</span><span class="sxs-lookup"><span data-stu-id="d463c-104">Configuring a <xref:System.ServiceModel.WSFederationHttpBinding> or similar custom binding.</span></span> <span data-ttu-id="d463c-105">Weitere Informationen zum Erstellen einer entsprechenden Bindung finden Sie unter Gewusst [wie: Erstellen einer WSFederationHttpBinding](how-to-create-a-wsfederationhttpbinding.md).</span><span class="sxs-lookup"><span data-stu-id="d463c-105">For more information about creating an appropriate binding, see [How to: Create a WSFederationHttpBinding](how-to-create-a-wsfederationhttpbinding.md).</span></span>  
  
2. <span data-ttu-id="d463c-106">Konfigurieren von <xref:System.ServiceModel.Security.IssuedTokenServiceCredential>, die kontrollieren, wie dem Dienst präsentierte ausgestellte Token authentifiziert werden.</span><span class="sxs-lookup"><span data-stu-id="d463c-106">Configuring the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> that controls how issued tokens presented to the service are authenticated.</span></span>  
  
 <span data-ttu-id="d463c-107">Dieses Thema enthält Details über den zweiten Schritt.</span><span class="sxs-lookup"><span data-stu-id="d463c-107">This topic provides details about the second step.</span></span> <span data-ttu-id="d463c-108">Weitere Informationen über die Funktionsweise eines Verbund Dienstanbieter finden Sie unter [Federation](federation.md).</span><span class="sxs-lookup"><span data-stu-id="d463c-108">For more information about how a federated service works, see [Federation](federation.md).</span></span>  
  
### <a name="to-set-the-properties-of-issuedtokenservicecredential-in-code"></a><span data-ttu-id="d463c-109">So legen Sie die Eigenschaften von IssuedTokenServiceCredential in Code fest</span><span class="sxs-lookup"><span data-stu-id="d463c-109">To set the properties of IssuedTokenServiceCredential in code</span></span>  
  
1. <span data-ttu-id="d463c-110">Verwenden Sie die <xref:System.ServiceModel.Description.ServiceCredentials.IssuedTokenAuthentication%2A>-Eigenschaft der <xref:System.ServiceModel.Description.ServiceCredentials>-Klasse, um einen Verweis an eine <xref:System.ServiceModel.Security.IssuedTokenServiceCredential>-Instanz zurückzugeben.</span><span class="sxs-lookup"><span data-stu-id="d463c-110">Use the <xref:System.ServiceModel.Description.ServiceCredentials.IssuedTokenAuthentication%2A> property of the <xref:System.ServiceModel.Description.ServiceCredentials> class to return a reference to an <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> instance.</span></span> <span data-ttu-id="d463c-111">Der Zugriff auf die Eigenschaft erfolgt über die <xref:System.ServiceModel.ServiceHostBase.Credentials%2A>-Eigenschaft der <xref:System.ServiceModel.ServiceHostBase>-Klasse.</span><span class="sxs-lookup"><span data-stu-id="d463c-111">The property is accessed from the <xref:System.ServiceModel.ServiceHostBase.Credentials%2A> property of the <xref:System.ServiceModel.ServiceHostBase> class.</span></span>  
  
2. <span data-ttu-id="d463c-112">Legen Sie die- <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.AllowUntrustedRsaIssuers%2A> Eigenschaft auf fest, `true` Wenn selbst ausgestellte Token wie CardSpace-Karten authentifiziert werden sollen.</span><span class="sxs-lookup"><span data-stu-id="d463c-112">Set the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.AllowUntrustedRsaIssuers%2A> property to `true` if self-issued tokens such as CardSpace cards are to be authenticated.</span></span> <span data-ttu-id="d463c-113">Der Standardwert ist `false`.</span><span class="sxs-lookup"><span data-stu-id="d463c-113">The default is `false`.</span></span>  
  
3. <span data-ttu-id="d463c-114">Füllen Sie die von der <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A>-Eigenschaft zurückgegebene Sammlung mit Instanzen der <xref:System.Security.Cryptography.X509Certificates.X509Certificate2>-Klasse auf.</span><span class="sxs-lookup"><span data-stu-id="d463c-114">Populate the collection returned by the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> property with instances of the <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> class.</span></span> <span data-ttu-id="d463c-115">Jede Instanz stellt einen Aussteller dar, von dem der Dienst Token authentifiziert.</span><span class="sxs-lookup"><span data-stu-id="d463c-115">Each instance represents an issuer from which the service will authenticate tokens.</span></span>  
  
    > [!NOTE]
    > <span data-ttu-id="d463c-116">Im Gegensatz zur clientseitigen Sammlung, die von der <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.ScopedCertificates%2A>-Eigenschaft zurückgegeben wird, handelt es sich bei der Sammlung bekannter Zertifikate nicht um eine schlüsselgebundene Sammlung.</span><span class="sxs-lookup"><span data-stu-id="d463c-116">Unlike the client-side collection returned by the <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.ScopedCertificates%2A> property, the known certificates collection is not a keyed collection.</span></span> <span data-ttu-id="d463c-117">Der Dienst akzeptiert die Token, die die angegebenen Zertifikate unabhängig von der Adresse des Clients, der die Nachricht mit dem ausgestellten Token gesendet hat, ausstellen (mit gewissen Einschränkungen, die später in diesem Thema beschrieben werden).</span><span class="sxs-lookup"><span data-stu-id="d463c-117">The service accepts the tokens that the specified certificates issue regardless of the address of the client that sent the message containing the issued token (subject to the further constraints, which are described later in this topic).</span></span>  
  
4. <span data-ttu-id="d463c-118">Legen Sie die <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A>-Eigenschaft auf einen der <xref:System.ServiceModel.Security.X509CertificateValidationMode>-Enumerationswerte fest.</span><span class="sxs-lookup"><span data-stu-id="d463c-118">Set the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> property to one of the <xref:System.ServiceModel.Security.X509CertificateValidationMode> enumeration values.</span></span> <span data-ttu-id="d463c-119">Dies kann nur in Code erfolgen.</span><span class="sxs-lookup"><span data-stu-id="d463c-119">This can be done only in code.</span></span> <span data-ttu-id="d463c-120">Der Standardwert ist <xref:System.IdentityModel.Selectors.X509CertificateValidator.ChainTrust%2A>.</span><span class="sxs-lookup"><span data-stu-id="d463c-120">The default is <xref:System.IdentityModel.Selectors.X509CertificateValidator.ChainTrust%2A>.</span></span>  
  
5. <span data-ttu-id="d463c-121">Wenn die <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A>-Eigenschaft auf <xref:System.ServiceModel.Security.X509CertificateValidationMode.Custom> gesetzt ist, weisen Sie eine Instanz der benutzerdefinierten <xref:System.IdentityModel.Selectors.X509CertificateValidator>-Klasse zur <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CustomCertificateValidator%2A>-Eigenschaft zu.</span><span class="sxs-lookup"><span data-stu-id="d463c-121">If the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> property is set to <xref:System.ServiceModel.Security.X509CertificateValidationMode.Custom>, then assign an instance of the custom <xref:System.IdentityModel.Selectors.X509CertificateValidator> class to the <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CustomCertificateValidator%2A> property.</span></span>  
  
6. <span data-ttu-id="d463c-122">Wenn <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> auf `ChainTrust` oder `PeerOrChainTrust` eingestellt ist, legen Sie die <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.RevocationMode%2A>-Eigenschaft auf einen entsprechenden Wert aus der <xref:System.Security.Cryptography.X509Certificates.X509RevocationMode>-Enumeration fest.</span><span class="sxs-lookup"><span data-stu-id="d463c-122">If the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> is set to `ChainTrust` or `PeerOrChainTrust`, set the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.RevocationMode%2A> property to an appropriate value from the <xref:System.Security.Cryptography.X509Certificates.X509RevocationMode> enumeration.</span></span> <span data-ttu-id="d463c-123">Beachten Sie, dass der Sperrmodus nicht im `PeerTrust`-Validierungsmodus oder im `Custom`-Validierungsmodus verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="d463c-123">Note that the revocation mode is not used in `PeerTrust` or `Custom` validation modes.</span></span>  
  
7. <span data-ttu-id="d463c-124">Weisen Sie, sofern erforderlich, eine Instanz einer benutzerdefinierten <xref:System.IdentityModel.Tokens.SamlSerializer>-Klasse zur <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.SamlSerializer%2A>-Eigenschaft zu.</span><span class="sxs-lookup"><span data-stu-id="d463c-124">If needed, assign an instance of a custom <xref:System.IdentityModel.Tokens.SamlSerializer> class to the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.SamlSerializer%2A> property.</span></span> <span data-ttu-id="d463c-125">Ein benutzerdefiniertes SAML-Serialisierungsprogramm (Security Assertions Markup Language) wird benötigt, z. B. zum Analysieren von benutzerdefinierten SAML-Assertionen.</span><span class="sxs-lookup"><span data-stu-id="d463c-125">A custom Security Assertions Markup Language (SAML) serializer is needed, for example, for parsing custom SAML assertions.</span></span>  
  
### <a name="to-set-the-properties-of-issuedtokenservicecredential-in-configuration"></a><span data-ttu-id="d463c-126">So legen Sie die Eigenschaften von IssuedTokenServiceCredential in der Konfiguration fest</span><span class="sxs-lookup"><span data-stu-id="d463c-126">To set the properties of IssuedTokenServiceCredential in configuration</span></span>  
  
1. <span data-ttu-id="d463c-127">Erstellen Sie ein- `<issuedTokenAuthentication>` Element als untergeordnetes Element eines <`serviceCredentials`>-Elements.</span><span class="sxs-lookup"><span data-stu-id="d463c-127">Create an `<issuedTokenAuthentication>` element as a child of a <`serviceCredentials`> element.</span></span>  
  
2. <span data-ttu-id="d463c-128">Legen Sie das- `allowUntrustedRsaIssuers` Attribut des- `<issuedTokenAuthentication>` Elements auf fest `true` , wenn Sie ein selbst ausgestelltes Token authentifizieren, z. b. eine CardSpace-Karte.</span><span class="sxs-lookup"><span data-stu-id="d463c-128">Set the `allowUntrustedRsaIssuers` attribute of the `<issuedTokenAuthentication>` element to `true` if authenticating a self-issued token, such as a CardSpace card.</span></span>  
  
3. <span data-ttu-id="d463c-129">Erstellen Sie ein `<knownCertificates>`-Element als untergeordnetes Element des `<issuedTokenAuthentication>`-Elements.</span><span class="sxs-lookup"><span data-stu-id="d463c-129">Create a `<knownCertificates>` element as a child of the `<issuedTokenAuthentication>` element.</span></span>  
  
4. <span data-ttu-id="d463c-130">Erstellen Sie null oder mehr `<add>``<knownCertificates>``storeLocation``storeName`-Attribut und dem -Attribut an, wie das Zertifikat zu finden ist.</span><span class="sxs-lookup"><span data-stu-id="d463c-130">Create zero or more `<add>` elements as children of the `<knownCertificates>` element, and specify how to locate the certificate using the `storeLocation`, `storeName`, `x509FindType`, and `findValue` attributes.</span></span>  
  
5. <span data-ttu-id="d463c-131">Legen Sie bei Bedarf das- `samlSerializer` Attribut des <`issuedTokenAuthentication`>-Elements auf den Typnamen der benutzerdefinierten <xref:System.IdentityModel.Tokens.SamlSerializer> Klasse fest.</span><span class="sxs-lookup"><span data-stu-id="d463c-131">If necessary, set the `samlSerializer` attribute of the <`issuedTokenAuthentication`> element to the type name of the custom <xref:System.IdentityModel.Tokens.SamlSerializer> class.</span></span>  
  
## <a name="example"></a><span data-ttu-id="d463c-132">Beispiel</span><span class="sxs-lookup"><span data-stu-id="d463c-132">Example</span></span>  

 <span data-ttu-id="d463c-133">Im folgenden Beispiel werden die Eigenschaften von <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> in Code festgelegt.</span><span class="sxs-lookup"><span data-stu-id="d463c-133">The following example sets the properties of an <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> in code.</span></span>  
  
 [!code-csharp[C_FederatedService#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_federatedservice/cs/source.cs#2)]
 [!code-vb[C_FederatedService#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_federatedservice/vb/source.vb#2)]  
  
 <span data-ttu-id="d463c-134">Damit ein Verbunddienst einen Client authentifizieren kann, muss Folgendes für das ausgestellte Token zutreffen:</span><span class="sxs-lookup"><span data-stu-id="d463c-134">In order for a federated service to authenticate a client, the following must be true about the issued token:</span></span>  
  
- <span data-ttu-id="d463c-135">Wenn die digitale Signatur des ausgestellten Tokens einen RSA-Sicherheitsschlüsselbezeichner verwendet, muss die <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.AllowUntrustedRsaIssuers%2A>-Eigenschaft `true` lauten.</span><span class="sxs-lookup"><span data-stu-id="d463c-135">When the issued token’s digital signature uses an RSA security key identifier, the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.AllowUntrustedRsaIssuers%2A> property must be `true`.</span></span>  
  
- <span data-ttu-id="d463c-136">Wenn die Signatur des ausgestellten Tokens eine Seriennummer eines X.509-Ausstellers, einen Subjektschlüsselbezeichner des X.509-Zertifikats oder einen Fingerabdruck-Sicherheitsbezeichner des X.509-Zertifikats verwendet, muss das ausgestellte Token von einem Zertifikat in der Sammlung signiert sein, die von der <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A>-Eigenschaft der <xref:System.ServiceModel.Security.IssuedTokenServiceCredential>-Klasse zurückgegeben wurde.</span><span class="sxs-lookup"><span data-stu-id="d463c-136">When the issued token’s signature uses an X.509 issuer serial number, X.509 subject key identifier, or X.509 thumbprint security identifier, the issued token must be signed by a certificate in the collection returned by the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> property of the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> class.</span></span>  
  
- <span data-ttu-id="d463c-137">Wenn das ausgestellte Token mit einem X.509-Zertifikat signiert ist, muss das Zertifikat anhand der semantischen Informationen validiert werden, die vom Wert der <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CertificateValidationMode%2A>-Eigenschaft angegeben werden, unabhängig davon, ob das Zertifikat als <xref:System.IdentityModel.Tokens.X509RawDataKeyIdentifierClause> an die vertrauende Seite gesendet wurde oder von der <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A>-Eigenschaft stammt.</span><span class="sxs-lookup"><span data-stu-id="d463c-137">When the issued token is signed using an X.509 certificate, the certificate must validate per the semantics specified by the value of the <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CertificateValidationMode%2A> property, regardless of whether the certificate was sent to the relying party as a <xref:System.IdentityModel.Tokens.X509RawDataKeyIdentifierClause> or was obtained from the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> property.</span></span> <span data-ttu-id="d463c-138">Weitere Informationen zur Überprüfung des X. 509-Zertifikats finden Sie unter [Arbeiten mit Zertifikaten](working-with-certificates.md).</span><span class="sxs-lookup"><span data-stu-id="d463c-138">For more information about X.509 certificate validation, see [Working with Certificates](working-with-certificates.md).</span></span>  
  
 <span data-ttu-id="d463c-139">Durch Festlegen von <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> auf <xref:System.ServiceModel.Security.X509CertificateValidationMode.PeerTrust> würde beispielsweise jedes ausgestellte Token, dessen Signaturzertifikat im `TrustedPeople`-Zertifikatspeicher abgelegt ist, authentifiziert werden.</span><span class="sxs-lookup"><span data-stu-id="d463c-139">For example, setting the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> to <xref:System.ServiceModel.Security.X509CertificateValidationMode.PeerTrust> would authenticate any issued token whose signing certificate is in the `TrustedPeople` certificate store.</span></span> <span data-ttu-id="d463c-140">Legen Sie in diesem Fall die <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.TrustedStoreLocation%2A>-Eigenschaft entweder auf <xref:System.Security.Cryptography.X509Certificates.StoreLocation.CurrentUser> oder auf <xref:System.Security.Cryptography.X509Certificates.StoreLocation.LocalMachine> fest.</span><span class="sxs-lookup"><span data-stu-id="d463c-140">In that case, set the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.TrustedStoreLocation%2A> property to either <xref:System.Security.Cryptography.X509Certificates.StoreLocation.CurrentUser> or <xref:System.Security.Cryptography.X509Certificates.StoreLocation.LocalMachine>.</span></span> <span data-ttu-id="d463c-141">Sie können andere Modi auswählen, einschließlich <xref:System.ServiceModel.Security.X509CertificateValidationMode.Custom>.</span><span class="sxs-lookup"><span data-stu-id="d463c-141">You can select other modes, including <xref:System.ServiceModel.Security.X509CertificateValidationMode.Custom>.</span></span> <span data-ttu-id="d463c-142">Bei Auswahl von `Custom` müssen Sie eine Instanz der <xref:System.IdentityModel.Selectors.X509CertificateValidator>-Klasse zur <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CustomCertificateValidator%2A>-Eigenschaft zuweisen.</span><span class="sxs-lookup"><span data-stu-id="d463c-142">When `Custom` is selected, you must assign an instance of the <xref:System.IdentityModel.Selectors.X509CertificateValidator> class to the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CustomCertificateValidator%2A> property.</span></span> <span data-ttu-id="d463c-143">Das benutzerdefinierte Validierungssteuerelement kann Zertifikate mit allen beliebigen Kriterien überprüfen.</span><span class="sxs-lookup"><span data-stu-id="d463c-143">The custom validator can validate certificates using any criteria it likes.</span></span> <span data-ttu-id="d463c-144">Weitere Informationen finden Sie unter Vorgehens [Weise: Erstellen eines Dienstanbieter, der ein benutzerdefiniertes zertifikatvalidator verwendet](../extending/how-to-create-a-service-that-employs-a-custom-certificate-validator.md).</span><span class="sxs-lookup"><span data-stu-id="d463c-144">For more information, see [How to: Create a Service that Employs a Custom Certificate Validator](../extending/how-to-create-a-service-that-employs-a-custom-certificate-validator.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d463c-145">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="d463c-145">See also</span></span>

- [<span data-ttu-id="d463c-146">Verbund</span><span class="sxs-lookup"><span data-stu-id="d463c-146">Federation</span></span>](federation.md)
- [<span data-ttu-id="d463c-147">Verbund und Vertrauenswürdigkeit</span><span class="sxs-lookup"><span data-stu-id="d463c-147">Federation and Trust</span></span>](federation-and-trust.md)
- [<span data-ttu-id="d463c-148">Verbundbeispiel</span><span class="sxs-lookup"><span data-stu-id="d463c-148">Federation Sample</span></span>](../samples/federation-sample.md)
- [<span data-ttu-id="d463c-149">Vorgehensweise: Deaktivieren sicherer Sitzungen auf einer WSFederationHttpBinding</span><span class="sxs-lookup"><span data-stu-id="d463c-149">How to: Disable Secure Sessions on a WSFederationHttpBinding</span></span>](how-to-disable-secure-sessions-on-a-wsfederationhttpbinding.md)
- [<span data-ttu-id="d463c-150">Vorgehensweise: Erstellen einer WSFederationHttpBinding</span><span class="sxs-lookup"><span data-stu-id="d463c-150">How to: Create a WSFederationHttpBinding</span></span>](how-to-create-a-wsfederationhttpbinding.md)
- [<span data-ttu-id="d463c-151">Vorgehensweise: Erstellen eines Verbundclients</span><span class="sxs-lookup"><span data-stu-id="d463c-151">How to: Create a Federated Client</span></span>](how-to-create-a-federated-client.md)
- [<span data-ttu-id="d463c-152">Verwenden von Zertifikaten</span><span class="sxs-lookup"><span data-stu-id="d463c-152">Working with Certificates</span></span>](working-with-certificates.md)
- [<span data-ttu-id="d463c-153">SecurityBindingElement-Authentifizierungsmodi</span><span class="sxs-lookup"><span data-stu-id="d463c-153">SecurityBindingElement Authentication Modes</span></span>](securitybindingelement-authentication-modes.md)
