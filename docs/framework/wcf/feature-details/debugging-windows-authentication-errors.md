---
title: Debuggen von Windows-Authentifizierungsfehlern
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, authentication
- WCF, Windows authentication
ms.assetid: 181be4bd-79b1-4a66-aee2-931887a6d7cc
ms.openlocfilehash: c8aa87bdbf9488bce8e1a62f6d1a3898f923d349
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 11/26/2020
ms.locfileid: "96291660"
---
# <a name="debug-windows-authentication-errors"></a><span data-ttu-id="25063-102">Windows-Authentifizierungsfehler Debuggen</span><span class="sxs-lookup"><span data-stu-id="25063-102">Debug Windows authentication errors</span></span>

<span data-ttu-id="25063-103">Bei Verwendung der Windows-Authentifizierung als Sicherheitsmechanismus wickelt die Security Support Provider-Schnittstelle (SSPI) Sicherheitsprozesse ab.</span><span class="sxs-lookup"><span data-stu-id="25063-103">When using Windows authentication as a security mechanism, the Security Support Provider Interface (SSPI) handles security processes.</span></span> <span data-ttu-id="25063-104">Wenn auf der SSPI-Ebene Sicherheitsfehler auftreten, werden Sie von Windows Communication Foundation (WCF) angezeigt.</span><span class="sxs-lookup"><span data-stu-id="25063-104">When security errors occur at the SSPI layer, they are surfaced by Windows Communication Foundation (WCF).</span></span> <span data-ttu-id="25063-105">Dieses Thema enthält ein Framework und eine Reihe von Fragen zur Diagnose der Fehler.</span><span class="sxs-lookup"><span data-stu-id="25063-105">This topic provides a framework and set of questions to help diagnose the errors.</span></span>  
  
 <span data-ttu-id="25063-106">Eine Übersicht über das Kerberos-Protokoll finden Sie unter [Kerberos](/previous-versions/windows/it-pro/windows-2000-server/bb742516(v=technet.10))-Protokoll. eine Übersicht über SSPI finden Sie unter [SSPI](/windows/win32/secauthn/sspi).</span><span class="sxs-lookup"><span data-stu-id="25063-106">For an overview of the Kerberos protocol, see [Kerberos Explained](/previous-versions/windows/it-pro/windows-2000-server/bb742516(v=technet.10)); for an overview of SSPI, see [SSPI](/windows/win32/secauthn/sspi).</span></span>  
  
 <span data-ttu-id="25063-107">Bei der Windows-Authentifizierung verwendet WCF in der Regel den *aushandeln* Security Support Provider (SSP), der die gegenseitige Kerberos-Authentifizierung zwischen Client und Dienst durchführt.</span><span class="sxs-lookup"><span data-stu-id="25063-107">For Windows authentication, WCF typically uses the *Negotiate* Security Support Provider (SSP), which performs Kerberos mutual authentication between the client and service.</span></span> <span data-ttu-id="25063-108">Wenn das Kerberos-Protokoll nicht verfügbar ist, greift WCF standardmäßig auf den NT-LAN-Manager (NTLM) zurück.</span><span class="sxs-lookup"><span data-stu-id="25063-108">If the Kerberos protocol is not available, by default WCF falls back to NT LAN Manager (NTLM).</span></span> <span data-ttu-id="25063-109">Allerdings können Sie WCF so konfigurieren, dass nur das Kerberos-Protokoll verwendet wird (und eine Ausnahme ausgelöst wird, wenn Kerberos nicht verfügbar ist).</span><span class="sxs-lookup"><span data-stu-id="25063-109">However, you can configure WCF to use only the Kerberos protocol (and to throw an exception if Kerberos is not available).</span></span> <span data-ttu-id="25063-110">Sie können auch WCF so konfigurieren, dass eingeschränkte Formen des Kerberos-Protokolls verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="25063-110">You can also configure WCF to use restricted forms of the Kerberos protocol.</span></span>  
  
## <a name="debugging-methodology"></a><span data-ttu-id="25063-111">Debugmethodik</span><span class="sxs-lookup"><span data-stu-id="25063-111">Debugging Methodology</span></span>  

 <span data-ttu-id="25063-112">Die grundlegende Methode lautet wie folgt:</span><span class="sxs-lookup"><span data-stu-id="25063-112">The basic method is as follows:</span></span>  
  
1. <span data-ttu-id="25063-113">Bestimmen Sie, ob Sie die Windows-Authentifizierung verwenden.</span><span class="sxs-lookup"><span data-stu-id="25063-113">Determine whether you are using Windows authentication.</span></span> <span data-ttu-id="25063-114">Wenn Sie ein anderes Schema verwenden, ist dieses Thema irrelevant.</span><span class="sxs-lookup"><span data-stu-id="25063-114">If you are using any other scheme, this topic does not apply.</span></span>  
  
2. <span data-ttu-id="25063-115">Wenn Sie sicher sind, dass Sie die Windows-Authentifizierung verwenden, stellen Sie fest, ob die WCF-Konfiguration Kerberos Direct oder aushandeln verwendet.</span><span class="sxs-lookup"><span data-stu-id="25063-115">If you are sure you are using Windows authentication, determine whether your WCF configuration uses Kerberos direct or Negotiate.</span></span>  
  
3. <span data-ttu-id="25063-116">Nachdem Sie festgestellt haben, ob Ihre Konfiguration das Kerberos-Protokoll oder NTLM verwendet, können Sie Fehlermeldungen im richtigen Kontext verstehen.</span><span class="sxs-lookup"><span data-stu-id="25063-116">Once you have determined whether your configuration is using the Kerberos protocol or NTLM, you can understand error messages in the correct context.</span></span>  
  
### <a name="availability-of-the-kerberos-protocol-and-ntlm"></a><span data-ttu-id="25063-117">Verfügbarkeit des Kerberos-Protokolls und von NTLM</span><span class="sxs-lookup"><span data-stu-id="25063-117">Availability of the Kerberos Protocol and NTLM</span></span>  

 <span data-ttu-id="25063-118">Der Kerberos SSP erfordert einen Domänencontroller, der als Kerberos Key Distribution Center (KDC) fungiert.</span><span class="sxs-lookup"><span data-stu-id="25063-118">The Kerberos SSP requires a domain controller to act as the Kerberos Key Distribution Center (KDC).</span></span> <span data-ttu-id="25063-119">Das Kerberos-Protokoll ist nur verfügbar, wenn sowohl der Client als auch der Dienst Domänenidentitäten verwenden.</span><span class="sxs-lookup"><span data-stu-id="25063-119">The Kerberos protocol is available only when both the client and service are using domain identities.</span></span> <span data-ttu-id="25063-120">In anderen Kontokombinationen wird NTLM verwendet, wie in der folgenden Tabelle zusammengefasst.</span><span class="sxs-lookup"><span data-stu-id="25063-120">In other account combinations, NTLM is used, as summarized in the following table.</span></span>  
  
 <span data-ttu-id="25063-121">Die Tabellenheader zeigen mögliche vom Server verwendete Kontotypen.</span><span class="sxs-lookup"><span data-stu-id="25063-121">The table headers show possible account types used by the server.</span></span> <span data-ttu-id="25063-122">Die linke Spalte zeigt mögliche vom Client verwendete Kontotypen.</span><span class="sxs-lookup"><span data-stu-id="25063-122">The left column shows possible account types used by the client.</span></span>  
  
||<span data-ttu-id="25063-123">Lokaler Benutzer</span><span class="sxs-lookup"><span data-stu-id="25063-123">Local User</span></span>|<span data-ttu-id="25063-124">Lokales System</span><span class="sxs-lookup"><span data-stu-id="25063-124">Local System</span></span>|<span data-ttu-id="25063-125">Domänenbenutzer</span><span class="sxs-lookup"><span data-stu-id="25063-125">Domain User</span></span>|<span data-ttu-id="25063-126">Domänencomputer</span><span class="sxs-lookup"><span data-stu-id="25063-126">Domain Machine</span></span>|  
|-|----------------|------------------|-----------------|--------------------|  
|<span data-ttu-id="25063-127">Lokaler Benutzer</span><span class="sxs-lookup"><span data-stu-id="25063-127">Local User</span></span>|<span data-ttu-id="25063-128">NTLM</span><span class="sxs-lookup"><span data-stu-id="25063-128">NTLM</span></span>|<span data-ttu-id="25063-129">NTLM</span><span class="sxs-lookup"><span data-stu-id="25063-129">NTLM</span></span>|<span data-ttu-id="25063-130">NTLM</span><span class="sxs-lookup"><span data-stu-id="25063-130">NTLM</span></span>|<span data-ttu-id="25063-131">NTLM</span><span class="sxs-lookup"><span data-stu-id="25063-131">NTLM</span></span>|  
|<span data-ttu-id="25063-132">Lokales System</span><span class="sxs-lookup"><span data-stu-id="25063-132">Local System</span></span>|<span data-ttu-id="25063-133">Anonymous NTLM</span><span class="sxs-lookup"><span data-stu-id="25063-133">Anonymous NTLM</span></span>|<span data-ttu-id="25063-134">Anonymous NTLM</span><span class="sxs-lookup"><span data-stu-id="25063-134">Anonymous NTLM</span></span>|<span data-ttu-id="25063-135">Anonymous NTLM</span><span class="sxs-lookup"><span data-stu-id="25063-135">Anonymous NTLM</span></span>|<span data-ttu-id="25063-136">Anonymous NTLM</span><span class="sxs-lookup"><span data-stu-id="25063-136">Anonymous NTLM</span></span>|  
|<span data-ttu-id="25063-137">Domänenbenutzer</span><span class="sxs-lookup"><span data-stu-id="25063-137">Domain User</span></span>|<span data-ttu-id="25063-138">NTLM</span><span class="sxs-lookup"><span data-stu-id="25063-138">NTLM</span></span>|<span data-ttu-id="25063-139">NTLM</span><span class="sxs-lookup"><span data-stu-id="25063-139">NTLM</span></span>|<span data-ttu-id="25063-140">Kerberos</span><span class="sxs-lookup"><span data-stu-id="25063-140">Kerberos</span></span>|<span data-ttu-id="25063-141">Kerberos</span><span class="sxs-lookup"><span data-stu-id="25063-141">Kerberos</span></span>|  
|<span data-ttu-id="25063-142">Domänencomputer</span><span class="sxs-lookup"><span data-stu-id="25063-142">Domain Machine</span></span>|<span data-ttu-id="25063-143">NTLM</span><span class="sxs-lookup"><span data-stu-id="25063-143">NTLM</span></span>|<span data-ttu-id="25063-144">NTLM</span><span class="sxs-lookup"><span data-stu-id="25063-144">NTLM</span></span>|<span data-ttu-id="25063-145">Kerberos</span><span class="sxs-lookup"><span data-stu-id="25063-145">Kerberos</span></span>|<span data-ttu-id="25063-146">Kerberos</span><span class="sxs-lookup"><span data-stu-id="25063-146">Kerberos</span></span>|  
  
 <span data-ttu-id="25063-147">Zu den vier Kontotypen gehören im Einzelnen:</span><span class="sxs-lookup"><span data-stu-id="25063-147">Specifically, the four account types include:</span></span>  
  
- <span data-ttu-id="25063-148">Lokaler Benutzer: Nur Computerbenutzerprofil.</span><span class="sxs-lookup"><span data-stu-id="25063-148">Local User: Machine-only user profile.</span></span> <span data-ttu-id="25063-149">Beispiel: `MachineName\Administrator` oder `MachineName\ProfileName`.</span><span class="sxs-lookup"><span data-stu-id="25063-149">For example: `MachineName\Administrator` or `MachineName\ProfileName`.</span></span>  
  
- <span data-ttu-id="25063-150">Lokales System: Das integrierte Konto SYSTEM auf einem Computer, der nicht mit einer Domäne verknüpft ist.</span><span class="sxs-lookup"><span data-stu-id="25063-150">Local System: The built-in account SYSTEM on a machine that is not joined to a domain.</span></span>  
  
- <span data-ttu-id="25063-151">Domänenbenutzer: Ein Benutzerkonto auf einer Windows-Domäne.</span><span class="sxs-lookup"><span data-stu-id="25063-151">Domain User: A user account on a Windows domain.</span></span> <span data-ttu-id="25063-152">Beispiel: `DomainName\ProfileName`.</span><span class="sxs-lookup"><span data-stu-id="25063-152">For example: `DomainName\ProfileName`.</span></span>  
  
- <span data-ttu-id="25063-153">Domänencomputer: Ein Prozess mit Computeridentität, der auf einem Computer ausgeführt wird, der mit einer Windows-Domäne verknüpft ist.</span><span class="sxs-lookup"><span data-stu-id="25063-153">Domain Machine: A process with machine identity running on a machine joined to a Windows domain.</span></span> <span data-ttu-id="25063-154">Beispiel: `MachineName\Network Service`.</span><span class="sxs-lookup"><span data-stu-id="25063-154">For example: `MachineName\Network Service`.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="25063-155">Die Dienstanmeldeinformationen werden aufgezeichnet, wenn die <xref:System.ServiceModel.ICommunicationObject.Open%2A>-Methode der <xref:System.ServiceModel.ServiceHost>-Klasse aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="25063-155">The service credential is captured when the <xref:System.ServiceModel.ICommunicationObject.Open%2A> method of the <xref:System.ServiceModel.ServiceHost> class is called.</span></span> <span data-ttu-id="25063-156">Die Clientanmeldeinformationen werden immer dann gelesen, wenn der Client eine Nachricht sendet.</span><span class="sxs-lookup"><span data-stu-id="25063-156">The client credential is read whenever the client sends a message.</span></span>  
  
## <a name="common-windows-authentication-problems"></a><span data-ttu-id="25063-157">Allgemeine Windows-Authentifizierungsprobleme</span><span class="sxs-lookup"><span data-stu-id="25063-157">Common Windows Authentication Problems</span></span>  

 <span data-ttu-id="25063-158">In diesem Abschnitt werden einige allgemeine Windows-Authentifizierungsprobleme und mögliche Abhilfen erläutert.</span><span class="sxs-lookup"><span data-stu-id="25063-158">This section discusses some common Windows authentication problems and possible remedies.</span></span>  
  
### <a name="kerberos-protocol"></a><span data-ttu-id="25063-159">Kerberos-Protokoll</span><span class="sxs-lookup"><span data-stu-id="25063-159">Kerberos Protocol</span></span>  
  
#### <a name="spnupn-problems-with-the-kerberos-protocol"></a><span data-ttu-id="25063-160">SPN-/UPN-Probleme mit dem Kerberos-Protokoll</span><span class="sxs-lookup"><span data-stu-id="25063-160">SPN/UPN Problems with the Kerberos Protocol</span></span>  

 <span data-ttu-id="25063-161">Bei Verwendung der Windows-Authentifizierung und des Kerberos-Protokolls oder der Aushandlung durch SSPI muss die vom Clientendpunkt verwendete URL den vollqualifizierten Domänennamen des Diensthosts in der Dienst-URL enthalten.</span><span class="sxs-lookup"><span data-stu-id="25063-161">When using Windows authentication, and the Kerberos protocol is used or negotiated by SSPI, the URL the client endpoint uses must include the fully qualified domain name of the service's host inside the service URL.</span></span> <span data-ttu-id="25063-162">Dies setzt voraus, dass das Konto, unter dem der Dienst ausgeführt wird, Zugriff auf den (Standard-) Dienstprinzipalnamen-Schlüssel (SPN) hat, der beim Hinzufügen des Computers zur Active Directory-Domäne erstellt wird. Dieser Vorgang wird im Allgemeinen durchgeführt, indem der Dienst unter dem Netzwerkdienstkonto ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="25063-162">This assumes that the account under which the service is running has access to the machine (default) service principal name (SPN) key that is created when the computer is added to the Active Directory domain, which is most commonly done by running the service under the Network Service account.</span></span> <span data-ttu-id="25063-163">Wenn der Dienst keinen Zugriff auf den SPN-Schlüssel des Computers hat, müssen Sie den korrekten SPN oder Benutzerprinzipalnamen (UPN) des Kontos, unter dem der Dienst ausgeführt wird, in der Endpunktidentität des Clients angeben.</span><span class="sxs-lookup"><span data-stu-id="25063-163">If the service does not have access to the machine SPN key, you must supply the correct SPN or user principal name (UPN) of the account under which the service is running in the client's endpoint identity.</span></span> <span data-ttu-id="25063-164">Weitere Informationen zur Funktionsweise von WCF mit SPN und UPN finden Sie unter [Dienst Identität und-Authentifizierung](service-identity-and-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="25063-164">For more information about how WCF works with SPN and UPN, see [Service Identity and Authentication](service-identity-and-authentication.md).</span></span>  
  
 <span data-ttu-id="25063-165">Eine gängige Praxis für Lastenausgleichszenarien (beispielsweise bei Webfarmen und Webgärten) ist das Definieren eines eindeutigen Kontos für die einzelnen Anwendungen. Anschließend wird dem Konto ein SPN zugewiesen und sichergestellt, dass alle Dienste der Anwendung in diesem Konto ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="25063-165">In load-balancing scenarios, such as Web farms or Web gardens, a common practice is to define a unique account for each application, assign an SPN to that account, and ensure that all of the application's services run in that account.</span></span>  
  
 <span data-ttu-id="25063-166">Zum Erhalten eines SPN für das Konto des Diensts müssen Sie Active Directory-Domänenadministrator sein.</span><span class="sxs-lookup"><span data-stu-id="25063-166">To obtain an SPN for your service's account, you need to be an Active Directory domain administrator.</span></span> <span data-ttu-id="25063-167">Weitere Informationen finden Sie in der [technischen Ergänzung zu Kerberos für Windows](/previous-versions/msp-n-p/ff649429(v=pandp.10)).</span><span class="sxs-lookup"><span data-stu-id="25063-167">For more information, see [Kerberos Technical Supplement for Windows](/previous-versions/msp-n-p/ff649429(v=pandp.10)).</span></span>  
  
#### <a name="kerberos-protocol-direct-requires-the-service-to-run-under-a-domain-machine-account"></a><span data-ttu-id="25063-168">Kerberos-Protokoll Direct erfordert, dass der Dienst unter einem Domänencomputerkonto ausgeführt wird</span><span class="sxs-lookup"><span data-stu-id="25063-168">Kerberos Protocol Direct Requires the Service to Run Under a Domain Machine Account</span></span>  

 <span data-ttu-id="25063-169">Dieser Fehler tritt auf, wenn die `ClientCredentialType`-Eigenschaft auf `Windows` und die <xref:System.ServiceModel.MessageSecurityOverHttp.NegotiateServiceCredential%2A>-Eigenschaft auf `false` festgelegt ist, wie im folgenden Code dargestellt.</span><span class="sxs-lookup"><span data-stu-id="25063-169">This occurs when the `ClientCredentialType` property is set to `Windows` and the <xref:System.ServiceModel.MessageSecurityOverHttp.NegotiateServiceCredential%2A> property is set to `false`, as shown in the following code.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#1)]
 [!code-vb[C_DebuggingWindowsAuth#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#1)]  
  
 <span data-ttu-id="25063-170">Zum Beheben des Fehlers führen Sie den Dienst mit einem Domänencomputerkonto, wie Netzwerkdienst, auf einem Computer aus, der mit einer Domäne verknüpft ist.</span><span class="sxs-lookup"><span data-stu-id="25063-170">To remedy, run the service using a Domain Machine account, such as Network Service, on a domain joined machine.</span></span>  
  
### <a name="delegation-requires-credential-negotiation"></a><span data-ttu-id="25063-171">Delegierung erfordert eine Anmeldeinformationen-Aushandlung</span><span class="sxs-lookup"><span data-stu-id="25063-171">Delegation Requires Credential Negotiation</span></span>  

 <span data-ttu-id="25063-172">Um das Kerberos-Authentifizierungsprotokoll mit Delegierung zu verwenden, müssen Sie das Kerberos-Protokoll mit Anmeldeinformationen-Aushandlung (mitunter als "bilaterales" oder "mehrstufiges" Kerberos bezeichnet) implementieren.</span><span class="sxs-lookup"><span data-stu-id="25063-172">To use the Kerberos authentication protocol with delegation, you must implement the Kerberos protocol with credential negotiation (sometimes called "multi-leg" or "multi-step" Kerberos).</span></span> <span data-ttu-id="25063-173">Wenn Sie die Kerberos-Authentifizierung ohne Anmeldeinformationen-Aushandlung (mitunter als "One-Shot"-Kerberos bezeichnet) implementieren, wird eine Ausnahme ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="25063-173">If you implement Kerberos authentication without credential negotiation (sometimes called "one-shot" or "single-leg" Kerberos), an exception will be thrown.</span></span>  
  
 <span data-ttu-id="25063-174">Um Kerberos mit Anmeldeinformationen-Aushandlung zu implementieren, führen Sie die folgenden Schritte aus:</span><span class="sxs-lookup"><span data-stu-id="25063-174">To implement Kerberos with credential negotiation, do the following steps:</span></span>  
  
1. <span data-ttu-id="25063-175">Implementieren Sie die Delegierung, indem Sie <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> auf <xref:System.Security.Principal.TokenImpersonationLevel.Delegation> festlegen.</span><span class="sxs-lookup"><span data-stu-id="25063-175">Implement delegation by setting <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> to <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span></span>  
  
2. <span data-ttu-id="25063-176">SSPI-Aushandlung erforderlich:</span><span class="sxs-lookup"><span data-stu-id="25063-176">Require SSPI negotiation:</span></span>  
  
    1. <span data-ttu-id="25063-177">Wenn Sie Standardbindungen verwenden, legen Sie die `NegotiateServiceCredential`-Eigenschaft auf `true` fest.</span><span class="sxs-lookup"><span data-stu-id="25063-177">If you are using standard bindings, set the `NegotiateServiceCredential` property to `true`.</span></span>  
  
    2. <span data-ttu-id="25063-178">Bei Verwendung von benutzerdefinierten Bindungen legen Sie das `AuthenticationMode`-Attribut des `Security`-Elements auf `SspiNegotiated` fest.</span><span class="sxs-lookup"><span data-stu-id="25063-178">If you are using custom bindings, set the `AuthenticationMode` attribute of the `Security` element to `SspiNegotiated`.</span></span>  
  
3. <span data-ttu-id="25063-179">Legen Sie fest, dass die SSPI-Aushandlung Kerberos verwenden muss, indem Sie die Verwendung von NTLM nicht zulasssen:</span><span class="sxs-lookup"><span data-stu-id="25063-179">Require the SSPI negotiation to use Kerberos by disallowing the use of NTLM:</span></span>  
  
    1. <span data-ttu-id="25063-180">Führen Sie dies mit der folgenden Anweisung in Code aus: `ChannelFactory.Credentials.Windows.AllowNtlm = false`</span><span class="sxs-lookup"><span data-stu-id="25063-180">Do this in code, with the following statement: `ChannelFactory.Credentials.Windows.AllowNtlm = false`</span></span>  
  
    2. <span data-ttu-id="25063-181">Sie können diese Einstellung auch in der Konfigurationsdatei vornehmen, indem Sie das `allowNtlm`-Attribut auf `false` festlegen.</span><span class="sxs-lookup"><span data-stu-id="25063-181">Or you can do this in the configuration file by setting the `allowNtlm` attribute to `false`.</span></span> <span data-ttu-id="25063-182">Dieses Attribut ist in enthalten [\<windows>](../../configure-apps/file-schema/wcf/windows-of-clientcredentials-element.md) .</span><span class="sxs-lookup"><span data-stu-id="25063-182">This attribute is contained in the [\<windows>](../../configure-apps/file-schema/wcf/windows-of-clientcredentials-element.md).</span></span>  
  
### <a name="ntlm-protocol"></a><span data-ttu-id="25063-183">NTLM-Protokoll</span><span class="sxs-lookup"><span data-stu-id="25063-183">NTLM Protocol</span></span>  
  
#### <a name="negotiate-ssp-falls-back-to-ntlm-but-ntlm-is-disabled"></a><span data-ttu-id="25063-184">SSP-Aushandlung greift auf NTLM zurück, NTLM ist jedoch deaktiviert</span><span class="sxs-lookup"><span data-stu-id="25063-184">Negotiate SSP Falls Back to NTLM, but NTLM Is Disabled</span></span>  

 <span data-ttu-id="25063-185">Die- <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> Eigenschaft ist auf festgelegt `false` , was bewirkt, dass Windows Communication Foundation (WCF) einen Best-Effort-Wert auslöst, wenn NTLM verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="25063-185">The <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> property is set to `false`, which causes Windows Communication Foundation (WCF) to make a best-effort to throw an exception if NTLM is used.</span></span> <span data-ttu-id="25063-186">Wenn Sie diese Eigenschaft auf festlegen, `false` wird möglicherweise nicht verhindert, dass NTLM-Anmelde Informationen über das Netzwerk gesendet werden</span><span class="sxs-lookup"><span data-stu-id="25063-186">Setting this property to `false` may not prevent NTLM credentials from being sent over the wire.</span></span>  
  
 <span data-ttu-id="25063-187">Die folgenden Schritte zeigen, wie ein Zurückgreifen auf NTLM deaktiviert wird.</span><span class="sxs-lookup"><span data-stu-id="25063-187">The following shows how to disable fallback to NTLM.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#4)]
 [!code-vb[C_DebuggingWindowsAuth#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#4)]  
  
#### <a name="ntlm-logon-fails"></a><span data-ttu-id="25063-188">Fehler bei der NTLM-Anmeldung</span><span class="sxs-lookup"><span data-stu-id="25063-188">NTLM Logon Fails</span></span>  

 <span data-ttu-id="25063-189">Die Clientanmeldeinformationen sind im Dienst nicht gültig.</span><span class="sxs-lookup"><span data-stu-id="25063-189">The client credentials are not valid on the service.</span></span> <span data-ttu-id="25063-190">Überprüfen Sie, ob Benutzername und Kennwort richtig eingestellt sind und einem Konto entsprechen, das dem Computer, auf dem der Dienst ausgeführt wird, bekannt ist.</span><span class="sxs-lookup"><span data-stu-id="25063-190">Check that the user name and password are correctly set and correspond to an account that is known to the computer where the service is running.</span></span> <span data-ttu-id="25063-191">NTLM verwendet die angegebenen Anmeldeinformationen, um sich am Computer des Diensts anzumelden.</span><span class="sxs-lookup"><span data-stu-id="25063-191">NTLM uses the specified credentials to log on to the service's computer.</span></span> <span data-ttu-id="25063-192">Während die Anmeldeinformationen auf dem Computer, auf dem der Client ausgeführt wird, gültig sein können, schlägt diese Anmeldung fehl, wenn die Anmeldeinformationen für den Computer des Diensts nicht gültig sind.</span><span class="sxs-lookup"><span data-stu-id="25063-192">While the credentials may be valid on the computer where the client is running, this logon will fail if the credentials are not valid on the service's computer.</span></span>  
  
#### <a name="anonymous-ntlm-logon-occurs-but-anonymous-logons-are-disabled-by-default"></a><span data-ttu-id="25063-193">Anonyme NTLM-Anmeldung wird ausgeführt, anonyme Anmeldungen sind jedoch standardmäßig deaktiviert</span><span class="sxs-lookup"><span data-stu-id="25063-193">Anonymous NTLM Logon Occurs, but Anonymous Logons Are Disabled by Default</span></span>  

 <span data-ttu-id="25063-194">Beim Erstellen eines Clients wird die <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A>-Eigenschaft auf <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous> festgelegt, wie im folgenden Beispiel veranschaulicht. Standardmäßig lässt der Server allerdings keine anonymen Anmeldungen zu.</span><span class="sxs-lookup"><span data-stu-id="25063-194">When creating a client, the <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> property is set to <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous>, as shown in the following example, but by default the server disallows anonymous logons.</span></span> <span data-ttu-id="25063-195">Dies tritt auf, da der Standardwert der <xref:System.ServiceModel.Security.WindowsServiceCredential.AllowAnonymousLogons%2A>-Eigenschaft der <xref:System.ServiceModel.Security.WindowsServiceCredential>-Klasse `false` ist.</span><span class="sxs-lookup"><span data-stu-id="25063-195">This occurs because the default value of the <xref:System.ServiceModel.Security.WindowsServiceCredential.AllowAnonymousLogons%2A> property of the <xref:System.ServiceModel.Security.WindowsServiceCredential> class is `false`.</span></span>  
  
 <span data-ttu-id="25063-196">Der folgende Clientcode versucht, anonyme Anmeldungen zu aktivieren (beachten Sie, dass die Standardeigenschaft `Identification` ist).</span><span class="sxs-lookup"><span data-stu-id="25063-196">The following client code attempts to enable anonymous logons (note that the default property is `Identification`).</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#5)]
 [!code-vb[C_DebuggingWindowsAuth#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#5)]  
  
 <span data-ttu-id="25063-197">Der folgende Dienstcode ändert die Standardeinstellung, um anonyme Anmeldungen durch den Server zu aktivieren.</span><span class="sxs-lookup"><span data-stu-id="25063-197">The following service code changes the default to enable anonymous logons by the server.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#6)]
 [!code-vb[C_DebuggingWindowsAuth#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#6)]  
  
 <span data-ttu-id="25063-198">Weitere Informationen zum Identitätswechsel finden Sie unter [Delegierung und](delegation-and-impersonation-with-wcf.md)Identitätswechsel.</span><span class="sxs-lookup"><span data-stu-id="25063-198">For more information about impersonation, see [Delegation and Impersonation](delegation-and-impersonation-with-wcf.md).</span></span>  
  
 <span data-ttu-id="25063-199">Alternativ wird der Client als Windows-Dienst ausgeführt und verwendet das integrierte Konto-SYSTEM.</span><span class="sxs-lookup"><span data-stu-id="25063-199">Alternatively, the client is running as a Windows service, using the built-in account SYSTEM.</span></span>  
  
### <a name="other-problems"></a><span data-ttu-id="25063-200">Andere Probleme</span><span class="sxs-lookup"><span data-stu-id="25063-200">Other Problems</span></span>  
  
#### <a name="client-credentials-are-not-set-correctly"></a><span data-ttu-id="25063-201">Clientanmeldeinformationen werden nicht ordnungsgemäß festgelegt.</span><span class="sxs-lookup"><span data-stu-id="25063-201">Client Credentials Are Not Set Correctly</span></span>  

 <span data-ttu-id="25063-202">Die Windows-Authentifizierung verwendet die <xref:System.ServiceModel.Security.WindowsClientCredential>-Instanz, die von der <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A>-Eigenschaft der <xref:System.ServiceModel.ClientBase%601>-Klasse zurückgegeben wird, nicht <xref:System.ServiceModel.Security.UserNamePasswordClientCredential>.</span><span class="sxs-lookup"><span data-stu-id="25063-202">Windows authentication uses the <xref:System.ServiceModel.Security.WindowsClientCredential> instance returned by the <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> property of the <xref:System.ServiceModel.ClientBase%601> class, not the <xref:System.ServiceModel.Security.UserNamePasswordClientCredential>.</span></span> <span data-ttu-id="25063-203">Im Folgenden wird ein nicht korrektes Beispiel dargestellt.</span><span class="sxs-lookup"><span data-stu-id="25063-203">The following shows an incorrect example.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#2)]
 [!code-vb[C_DebuggingWindowsAuth#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#2)]  
  
 <span data-ttu-id="25063-204">Im Folgenden wird ein korrektes Beispiel dargestellt.</span><span class="sxs-lookup"><span data-stu-id="25063-204">The following shows the correct example.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#3)]
 [!code-vb[C_DebuggingWindowsAuth#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#3)]  
  
#### <a name="sspi-is-not-available"></a><span data-ttu-id="25063-205">SSPI ist nicht verfügbar</span><span class="sxs-lookup"><span data-stu-id="25063-205">SSPI Is Not Available</span></span>  

 <span data-ttu-id="25063-206">Die folgenden Betriebssysteme unterstützen die Windows-Authentifizierung nicht, wenn Sie als Server verwendet wird: Windows XP Home Edition, Windows XP Media Center Edition und Windows Vista Home Editionen.</span><span class="sxs-lookup"><span data-stu-id="25063-206">The following operating systems do not support Windows authentication when used as a server: Windows XP Home Edition, Windows XP Media Center Edition, and Windows Vista Home editions.</span></span>  
  
#### <a name="developing-and-deploying-with-different-identities"></a><span data-ttu-id="25063-207">Entwickeln und Bereitstellen mit unterschiedlichen Identitäten</span><span class="sxs-lookup"><span data-stu-id="25063-207">Developing and Deploying with Different Identities</span></span>  

 <span data-ttu-id="25063-208">Wenn Sie Ihre Anwendung auf einem bestimmten Computer entwickeln, die Anwendung anschließend auf einem anderen Computer bereitstellen und dabei unterschiedliche Kontotypen für die Authentifizierung verwenden, kann es vorkommen, dass sich das Verhalten von Computer zu Computer unterscheidet.</span><span class="sxs-lookup"><span data-stu-id="25063-208">If you develop your application on one machine, and deploy on another, and use different account types to authenticate on each machine, you may experience different behavior.</span></span> <span data-ttu-id="25063-209">Ein Beispiel: Angenommen, Sie entwickeln Ihre Anwendung auf einem Computer unter Windows&#160;XP&#160;Pro und verwenden dabei den `SSPI Negotiated`-Authentifizierungsmodus.</span><span class="sxs-lookup"><span data-stu-id="25063-209">For example, suppose you develop your application on a Windows XP Pro machine using the `SSPI Negotiated` authentication mode.</span></span> <span data-ttu-id="25063-210">Wenn die Authentifizierung unter Verwendung eines lokalen Benutzerkontos erfolgt, wird das NTLM-Protokoll verwendet.</span><span class="sxs-lookup"><span data-stu-id="25063-210">If you use a local user account to authenticate with, then NTLM protocol will be used.</span></span> <span data-ttu-id="25063-211">Nachdem die Entwicklung der Anwendung abgeschlossen ist, stellen Sie den Dienst für einen Computer unter Windows Server&#160;2003 bereit, wo er im Rahmen eines Domänenkontos ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="25063-211">Once the application is developed, you deploy the service to a Windows Server 2003 machine where it runs under a domain account.</span></span> <span data-ttu-id="25063-212">An diesem Punkt wird der Client nicht in der Lage sein, den Dienst zu authentifizieren, da er Kerberos und einen Domänen Controller verwendet.</span><span class="sxs-lookup"><span data-stu-id="25063-212">At this point, the client will not be able to authenticate the service because it will be using Kerberos and a domain controller.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="25063-213">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="25063-213">See also</span></span>

- <xref:System.ServiceModel.Security.WindowsClientCredential>
- <xref:System.ServiceModel.Security.WindowsServiceCredential>
- <xref:System.ServiceModel.Security.WindowsClientCredential>
- <xref:System.ServiceModel.ClientBase%601>
- [<span data-ttu-id="25063-214">Delegierung und Identitätswechsel</span><span class="sxs-lookup"><span data-stu-id="25063-214">Delegation and Impersonation</span></span>](delegation-and-impersonation-with-wcf.md)
- [<span data-ttu-id="25063-215">Nicht unterstützte Szenarien</span><span class="sxs-lookup"><span data-stu-id="25063-215">Unsupported Scenarios</span></span>](unsupported-scenarios.md)
