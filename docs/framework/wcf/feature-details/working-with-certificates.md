---
title: Verwenden von Zertifikaten
description: Erfahren Sie mehr über die Features digitaler X. 509-Zertifikate und deren Verwendung in WCF. In den Ressourcen in diesem Artikel werden diese Konzepte ausführlicher erläutert.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- certificates [WCF]
ms.assetid: 6ffb8682-8f07-4a45-afbb-8d2487e9dbc3
ms.openlocfilehash: 8090e84b33e2a6f442d387c7012e6ccdc2900dd1
ms.sourcegitcommit: 358a28048f36a8dca39a9fe6e6ac1f1913acadd5
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 06/23/2020
ms.locfileid: "85246401"
---
# <a name="working-with-certificates"></a><span data-ttu-id="8e3da-104">Verwenden von Zertifikaten</span><span class="sxs-lookup"><span data-stu-id="8e3da-104">Working with Certificates</span></span>

<span data-ttu-id="8e3da-105">Zum Programmieren der WCF-Sicherheit (Windows Communication Foundation) werden häufig digitale X.509-Zertifikate zum Authentifizieren von Clients und Servern sowie zum Verschlüsseln und digitalen Signieren von Nachrichten verwendet.</span><span class="sxs-lookup"><span data-stu-id="8e3da-105">To program Windows Communication Foundation (WCF) security, X.509 digital certificates are commonly used to authenticate clients and servers, encrypt, and digitally sign messages.</span></span> <span data-ttu-id="8e3da-106">Dieser Artikel bietet einen Überblick über die Funktionen digitaler X.509-Zertifikate und ihre Verwendung in WCF und enthält Links zu Themen, in denen diese Konzepte näher beschrieben oder die Ausführung allgemeiner Aufgaben mit WCF und Zertifikaten erläutert werden.</span><span class="sxs-lookup"><span data-stu-id="8e3da-106">This topic briefly explains X.509 digital certificate features and how to use them in WCF, and includes links to topics that explain these concepts further or that show how to accomplish common tasks using WCF and certificates.</span></span>

<span data-ttu-id="8e3da-107">Digitale Zertifikate sind Teil einer *Public Key-Infrastruktur* (PKI). Dabei handelt es sich um ein System aus digitalen Zertifikaten, Zertifizierungsstellen und anderen Registrierungsstellen zur Überprüfung und Authentifizierung der Gültigkeit aller beteiligten Parteien in einer elektronischen Transaktion unter Verwendung der Public Key-Kryptografie.</span><span class="sxs-lookup"><span data-stu-id="8e3da-107">In brief, a digital certificate is a part of a *public key infrastructure* (PKI), which is a system of digital certificates, certificate authorities, and other registration authorities that verify and authenticate the validity of each party involved in an electronic transaction through the use of public key cryptography.</span></span> <span data-ttu-id="8e3da-108">Die Zertifikate werden von einer Zertifizierungsstelle ausgestellt, und jedes Zertifikat enthält eine Reihe von Feldern mit Daten, z.B. *Antragsteller* (die Entität, für die das Zertifikat ausgestellt wird), Gültigkeitsdatum (das Datum, bis zu dem das Zertifikat gültig ist), Aussteller (die Entität, von der das Zertifikat ausgestellt wurde) und öffentlicher Schlüssel.</span><span class="sxs-lookup"><span data-stu-id="8e3da-108">A certification authority issues certificates and each certificate has a set of fields that contain data, such as *subject* (the entity to which the certificate is issued), validity dates (when the certificate is valid), issuer (the entity that issued the certificate), and a public key.</span></span> <span data-ttu-id="8e3da-109">In WCF werden diese Eigenschaften als <xref:System.IdentityModel.Claims.Claim> verarbeitet, und jeder Anspruch wird weiter in zwei Typen unterteilt: Identität und Recht.</span><span class="sxs-lookup"><span data-stu-id="8e3da-109">In WCF, each of these properties is processed as a <xref:System.IdentityModel.Claims.Claim>, and each claim is further divided into two types: identity and right.</span></span> <span data-ttu-id="8e3da-110">Weitere Informationen zu X.509-Zertifikaten finden Sie unter [X.509 Public Key Certificates (X.509-Zertifikate mit öffentlichem Schlüssel)](/windows/desktop/SecCertEnroll/about-x-509-public-key-certificates).</span><span class="sxs-lookup"><span data-stu-id="8e3da-110">For more information about X.509 certificates see [X.509 Public Key Certificates](/windows/desktop/SecCertEnroll/about-x-509-public-key-certificates).</span></span> <span data-ttu-id="8e3da-111">Weitere Informationen über Ansprüche und Autorisierung in WCF finden Sie unter [Managing Claims and Authorization with the Identity Model (Verwalten von Ansprüchen und Autorisierung mit dem Identitätsmodell)](managing-claims-and-authorization-with-the-identity-model.md).</span><span class="sxs-lookup"><span data-stu-id="8e3da-111">For more information about Claims and Authorization in WCF see [Managing Claims and Authorization with the Identity Model](managing-claims-and-authorization-with-the-identity-model.md).</span></span> <span data-ttu-id="8e3da-112">Weitere Informationen zum Implementieren einer PKI finden Sie [unter Unternehmens-PKI mit Windows Server 2012 R2 Active Directory Certificate Services](https://docs.microsoft.com/archive/blogs/yungchou/enterprise-pki-with-windows-server-2012-r2-active-directory-certificate-services-part-1-of-2).</span><span class="sxs-lookup"><span data-stu-id="8e3da-112">For more information about implementing a PKI, see [Enterprise PKI with Windows Server 2012 R2 Active Directory Certificate Services](https://docs.microsoft.com/archive/blogs/yungchou/enterprise-pki-with-windows-server-2012-r2-active-directory-certificate-services-part-1-of-2).</span></span>

<span data-ttu-id="8e3da-113">Die zentrale Funktion eines Zertifikats ist die Authentifizierung der Identität des Besitzers des Zertifikats gegenüber anderen.</span><span class="sxs-lookup"><span data-stu-id="8e3da-113">The primary function of a certificate is to authenticate the identity of the owner of the certificate to others.</span></span> <span data-ttu-id="8e3da-114">Ein Zertifikat enthält den *öffentlichen Schlüssel* des Besitzers, während der Besitzer den privaten Schlüssel behält.</span><span class="sxs-lookup"><span data-stu-id="8e3da-114">A certificate contains the *public key* of the owner, while the owner retains the private key.</span></span> <span data-ttu-id="8e3da-115">Der öffentliche Schlüssel kann zum Verschlüsseln von Nachrichten verwendet werden, die an den Besitzer des Zertifikats gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="8e3da-115">The public key can be used to encrypt messages sent to the owner of the certificate.</span></span> <span data-ttu-id="8e3da-116">Nur der Besitzer hat Zugriff auf den privaten Schlüssel, sodass niemand anders diese Nachrichten entschlüsseln kann.</span><span class="sxs-lookup"><span data-stu-id="8e3da-116">Only the owner has access to the private key, so only the owner can decrypt those messages.</span></span>

<span data-ttu-id="8e3da-117">Zertifikate müssen von einer Zertifizierungsstelle ausgestellt werden, bei der es sich oft um einen Drittanbieter-Zertifikataussteller handelt.</span><span class="sxs-lookup"><span data-stu-id="8e3da-117">Certificates must be issued by a certification authority, which is often a third-party  issuer of certificates.</span></span> <span data-ttu-id="8e3da-118">Windows-Domänen verfügen über eine Zertifizierungsstelle, von der Zertifikate für Computer in der Domäne ausgestellt werden können.</span><span class="sxs-lookup"><span data-stu-id="8e3da-118">On a Windows domain, a certification authority is included that can be used to issue certificates to computers on the domain.</span></span>

## <a name="viewing-certificates"></a><span data-ttu-id="8e3da-119">Anzeigen von Zertifikaten</span><span class="sxs-lookup"><span data-stu-id="8e3da-119">Viewing Certificates</span></span>

<span data-ttu-id="8e3da-120">Bei der Verwendung von Zertifikaten ist es oft erforderlich, die Zertifikate anzuzeigen und ihre Eigenschaften zu überprüfen.</span><span class="sxs-lookup"><span data-stu-id="8e3da-120">To work with certificates, it is often necessary to view them and examine their properties.</span></span> <span data-ttu-id="8e3da-121">Die einfachste Methode dazu ist das MMC (Microsoft Management Console)-Snap-In-Tool.</span><span class="sxs-lookup"><span data-stu-id="8e3da-121">This is easily done with the Microsoft Management Console (MMC) snap-in tool.</span></span> <span data-ttu-id="8e3da-122">Weitere Informationen finden Sie unter [Vorgehensweise: Anzeigen von Zertifikaten mit dem MMC-Snap-In](how-to-view-certificates-with-the-mmc-snap-in.md).</span><span class="sxs-lookup"><span data-stu-id="8e3da-122">For more information, see [How to: View Certificates with the MMC Snap-in](how-to-view-certificates-with-the-mmc-snap-in.md).</span></span>

## <a name="certificate-stores"></a><span data-ttu-id="8e3da-123">Zertifikatspeicher</span><span class="sxs-lookup"><span data-stu-id="8e3da-123">Certificate Stores</span></span>

<span data-ttu-id="8e3da-124">Zertifikate werden in Speichern abgelegt.</span><span class="sxs-lookup"><span data-stu-id="8e3da-124">Certificates are found in stores.</span></span> <span data-ttu-id="8e3da-125">Die zwei Hauptspeicherorte sind in weitere Unterspeicher unterteilt.</span><span class="sxs-lookup"><span data-stu-id="8e3da-125">Two major store locations exist that are further divided into sub-stores.</span></span> <span data-ttu-id="8e3da-126">Administratoren können beide Hauptspeicher mit dem MMC-Snap-In-Tool anzeigen.</span><span class="sxs-lookup"><span data-stu-id="8e3da-126">If you are the administrator on a computer, you can view both major stores by using the MMC snap-in tool.</span></span> <span data-ttu-id="8e3da-127">Alle anderen Benutzer können lediglich den Speicher des aktuellen Benutzers anzeigen.</span><span class="sxs-lookup"><span data-stu-id="8e3da-127">Non-administrators can view only the current user store.</span></span>

- <span data-ttu-id="8e3da-128">**Lokaler Computerspeicher**</span><span class="sxs-lookup"><span data-stu-id="8e3da-128">**The local machine store**.</span></span> <span data-ttu-id="8e3da-129">Diese enthält die Zertifikate, auf die Computer Prozesse zugreifen, wie z. b. ASP.net.</span><span class="sxs-lookup"><span data-stu-id="8e3da-129">This contains the certificates accessed by machine processes, such as ASP.NET.</span></span> <span data-ttu-id="8e3da-130">Speichern Sie die Zertifikate zur Authentifizierung des Servers gegenüber Clients im lokalen Computerspeicher.</span><span class="sxs-lookup"><span data-stu-id="8e3da-130">Use this location to store certificates that authenticate the server to clients.</span></span>

- <span data-ttu-id="8e3da-131">**Aktueller Benutzerspeicher**</span><span class="sxs-lookup"><span data-stu-id="8e3da-131">**The current user store**.</span></span> <span data-ttu-id="8e3da-132">Interaktive Anwendungen legen Zertifikate für den aktuellen Benutzer des Computers normalerweise im aktuellen Benutzerspeicher ab.</span><span class="sxs-lookup"><span data-stu-id="8e3da-132">Interactive applications typically place certificates here for the computer's current user.</span></span> <span data-ttu-id="8e3da-133">Beim Erstellen einer Clientanwendung werden die Zertifikate zur Authentifizierung eines Benutzers gegenüber einem Dienst normalerweise hier abgelegt.</span><span class="sxs-lookup"><span data-stu-id="8e3da-133">If you are creating a client application, this is where you typically place certificates that authenticate a user to a service.</span></span>

<span data-ttu-id="8e3da-134">Diese beiden Speicher teilen sich in weitere Unterspeicher auf.</span><span class="sxs-lookup"><span data-stu-id="8e3da-134">These two stores are further divided into sub-stores.</span></span> <span data-ttu-id="8e3da-135">Die wichtigsten Unterspeicher für die Programmierung mit WCF sind folgende:</span><span class="sxs-lookup"><span data-stu-id="8e3da-135">The most important of these when programming with WCF include:</span></span>

- <span data-ttu-id="8e3da-136">**Vertrauenswürdige Stammzertifizierungsstellen**</span><span class="sxs-lookup"><span data-stu-id="8e3da-136">**Trusted Root Certification Authorities**.</span></span> <span data-ttu-id="8e3da-137">Mit den Zertifikaten in diesem Speicher können Sie eine Zertifikatkette erstellen, die zum Zertifikat einer Zertifizierungsstelle in diesem Speicher zurückverfolgt werden kann.</span><span class="sxs-lookup"><span data-stu-id="8e3da-137">You can use the certificates in this store to create a chain of certificates, which can be traced back to a certification authority certificate in this store.</span></span>

  > [!IMPORTANT]
  > <span data-ttu-id="8e3da-138">Der lokale Computer stuft alle Zertifikate in diesem Speicher als implizit vertrauenswürdig ein; dies gilt auch, wenn das Zertifikat im Speicher nicht von einer vertrauenswürdigen Zertifizierungsstelle eines Drittanbieters stammt.</span><span class="sxs-lookup"><span data-stu-id="8e3da-138">The local computer implicitly trusts any certificate placed in this store, even if the certificate does not come from a trusted third-party certification authority.</span></span> <span data-ttu-id="8e3da-139">Aus diesem Grund sollten Sie in diesem Speicher nur Zertifikate ablegen, wenn Sie dem Aussteller uneingeschränkt vertrauen und sich der möglichen Folgen bewusst sind.</span><span class="sxs-lookup"><span data-stu-id="8e3da-139">For this reason, do not place any certificate into this store unless you fully trust the issuer and understand the consequences.</span></span>

- <span data-ttu-id="8e3da-140">**Persönlich**.</span><span class="sxs-lookup"><span data-stu-id="8e3da-140">**Personal**.</span></span> <span data-ttu-id="8e3da-141">Dieser Speicher wird für Zertifikate verwendet, die dem Benutzer eines Computers zugeordnet sind.</span><span class="sxs-lookup"><span data-stu-id="8e3da-141">This store is used for certificates associated with a user of a computer.</span></span> <span data-ttu-id="8e3da-142">Dieser Speicher wird normalerweise für Zertifikate verwendet, die von einem der Zertifikate der Zertifizierungsstelle im Speicher vertrauenswürdiger Stammzertifizierungsstellen stammen.</span><span class="sxs-lookup"><span data-stu-id="8e3da-142">Typically this store is used for certificates issued by one of the certification authority certificates found in the Trusted Root Certification Authorities store.</span></span> <span data-ttu-id="8e3da-143">Darüber hinaus können in diesem Speicher auch selbst ausgestellte Zertifikate abgelegt werden, die von einer Anwendung als vertrauenswürdig eingestuft werden.</span><span class="sxs-lookup"><span data-stu-id="8e3da-143">Alternatively, a certificate found here may be self-issued and trusted by an application.</span></span>

<span data-ttu-id="8e3da-144">Weitere Informationen zu den Zertifikatformaten finden Sie unter [Certificate Stores (Zertifikatspeicher)](/windows/desktop/secauthn/certificate-stores).</span><span class="sxs-lookup"><span data-stu-id="8e3da-144">For more information about certificate stores, see [Certificate Stores](/windows/desktop/secauthn/certificate-stores).</span></span>

### <a name="selecting-a-store"></a><span data-ttu-id="8e3da-145">Auswählen eines Speichers</span><span class="sxs-lookup"><span data-stu-id="8e3da-145">Selecting a Store</span></span>

<span data-ttu-id="8e3da-146">Die Auswahl des Speichers für ein Zertifikat hängt davon ab, wie und wann der Dienst oder Client ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="8e3da-146">Selecting where to store a certificate depends how and when the service or client runs.</span></span> <span data-ttu-id="8e3da-147">Dabei gelten folgende allgemeine Regeln:</span><span class="sxs-lookup"><span data-stu-id="8e3da-147">The following general rules apply:</span></span>

- <span data-ttu-id="8e3da-148">Wenn der WCF-Dienst in einem Windows-Dienst gehostet wird, wird der Speicher des **lokalen Computers** verwendet.</span><span class="sxs-lookup"><span data-stu-id="8e3da-148">If the WCF service is hosted in a Windows service use the **local machine** store.</span></span> <span data-ttu-id="8e3da-149">Sie benötigen Administratorrechte, wenn Sie Zertifikate im lokalen Computerspeicher installieren möchten.</span><span class="sxs-lookup"><span data-stu-id="8e3da-149">Note that administrator privileges are required to install certificates into the local machine store.</span></span>

- <span data-ttu-id="8e3da-150">Wenn es sich beim Dienst oder Client um eine Anwendung handelt, die unter einem Benutzerkonto ausgeführt wird, wird der Speicher des **aktuellen Benutzers** verwendet.</span><span class="sxs-lookup"><span data-stu-id="8e3da-150">If the service or client is an application that runs under a user account, then use the **current user** store.</span></span>

### <a name="accessing-stores"></a><span data-ttu-id="8e3da-151">Zugreifen auf Speicher</span><span class="sxs-lookup"><span data-stu-id="8e3da-151">Accessing Stores</span></span>

<span data-ttu-id="8e3da-152">Speicher werden analog zu Ordnern auf einem Computer durch Zugriffssteuerungslisten (ACLs) geschützt.</span><span class="sxs-lookup"><span data-stu-id="8e3da-152">Stores are protected by access control lists (ACLs), just like folders on a computer.</span></span> <span data-ttu-id="8e3da-153">Wenn Sie einen von Internetinformationsdienste (IIS) gehosteten Dienst erstellen, wird der ASP.NET-Prozess unter dem ASP.NET-Konto ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="8e3da-153">When creating a service hosted by Internet Information Services (IIS), the ASP.NET process runs under the ASP.NET account.</span></span> <span data-ttu-id="8e3da-154">Dieses Konto muss über Zugriff auf den Speicher mit den Zertifikaten verfügen, die von einem Dienst verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="8e3da-154">That account must have access to the store that contains the certificates a service uses.</span></span> <span data-ttu-id="8e3da-155">Die zentralen Speicher werden durch eine Standardzugriffssteuerungsliste geschützt, eine Änderung der Listen ist jedoch möglich.</span><span class="sxs-lookup"><span data-stu-id="8e3da-155">Each of the major stores is protected with a default access list, but the lists can be modified.</span></span> <span data-ttu-id="8e3da-156">Wenn Sie eine separate Rolle für den Speicherzugriff erstellen, muss diese über die entsprechende Zugriffsberechtigung verfügen.</span><span class="sxs-lookup"><span data-stu-id="8e3da-156">If you create a separate role to access a store, you must grant that role access permission.</span></span> <span data-ttu-id="8e3da-157">Unter [How to: Create Temporary Certificates for Use During Development (Vorgehensweise: Erstellen temporärer Zertifikate zur Verwendung während der Entwicklung)](how-to-create-temporary-certificates-for-use-during-development.md) erfahren Sie, wie Sie die Zugriffsliste mit dem Tool „WinHttpCertConfig.exe“ bearbeiten.</span><span class="sxs-lookup"><span data-stu-id="8e3da-157">To learn how to modify the access list using the WinHttpCertConfig.exe tool, see [How to: Create Temporary Certificates for Use During Development](how-to-create-temporary-certificates-for-use-during-development.md).</span></span>

## <a name="chain-trust-and-certificate-authorities"></a><span data-ttu-id="8e3da-158">Vertrauensketten und Zertifizierungsstellen</span><span class="sxs-lookup"><span data-stu-id="8e3da-158">Chain Trust and Certificate Authorities</span></span>

<span data-ttu-id="8e3da-159">Zertifikate werden in einer Hierarchie erstellt, in der jedes einzelne Zertifikat mit der Zertifizierungsstelle verknüpft ist, von der es ausgestellt wurde.</span><span class="sxs-lookup"><span data-stu-id="8e3da-159">Certificates are created in a hierarchy where each individual certificate is linked to the CA that issued the certificate.</span></span> <span data-ttu-id="8e3da-160">Dieser Link verweist auf das Zertifikat der Zertifizierungsstelle.</span><span class="sxs-lookup"><span data-stu-id="8e3da-160">This link is to the CA’s certificate.</span></span> <span data-ttu-id="8e3da-161">Das Zertifikat der Zertifizierungsstelle wird dann mit der Zertifizierungsstelle verknüpft, von der das Zertifikat der ursprünglichen Zertifizierungsstelle ausgestellt wurde.</span><span class="sxs-lookup"><span data-stu-id="8e3da-161">The CA’s certificate then links to the CA that issued the original CA’s certificate.</span></span> <span data-ttu-id="8e3da-162">Dieser Prozess wird wiederholt, bis das Zertifikat der Stammzertifizierungsstelle erreicht wird.</span><span class="sxs-lookup"><span data-stu-id="8e3da-162">This process is repeated up until the Root CA’s certificate is reached.</span></span> <span data-ttu-id="8e3da-163">Das Zertifikat der Stammzertifizierungsstelle ist grundsätzlich vertrauenswürdig.</span><span class="sxs-lookup"><span data-stu-id="8e3da-163">The Root CA’s certificate is inherently trusted.</span></span>

<span data-ttu-id="8e3da-164">Digitale Zertifikate werden verwendet, um eine Entität anhand dieser als *Zertifikatkette* bezeichneten Hierarchie zu authentifizieren.</span><span class="sxs-lookup"><span data-stu-id="8e3da-164">Digital certificates are used to authenticate an entity by relying on this hierarchy, also called a *chain of trust*.</span></span> <span data-ttu-id="8e3da-165">Mit dem MMC-Snap-in können Sie die Kette eines Zertifikats anzeigen, indem Sie auf ein beliebiges Zertifikat doppelklicken und dann auf die Registerkarte **Zertifikat Pfad** klicken. Weitere Informationen zum Importieren von Zertifikat Ketten für eine Zertifizierungsstelle finden Sie unter Gewusst [wie: Angeben der Zertifizierungsstellen Zertifikatskette, die zum Überprüfen von Signaturen verwendet wird](specify-the-certificate-authority-chain-verify-signatures-wcf.md).</span><span class="sxs-lookup"><span data-stu-id="8e3da-165">You can view any certificate's chain using the MMC snap-in by double-clicking any certificate, then clicking the **Certificate Path** tab. For more information about importing certificate chains for a Certification authority, see [How to: Specify the Certificate Authority Certificate Chain Used to Verify Signatures](specify-the-certificate-authority-chain-verify-signatures-wcf.md).</span></span>

> [!NOTE]
> <span data-ttu-id="8e3da-166">Sie können jeden Aussteller zu einer vertrauenswürdigen Stammzertifizierungsstelle machen, indem Sie das Zertifikat des Ausstellers im Zertifikatspeicher der Stammzertifizierungsstelle ablegen.</span><span class="sxs-lookup"><span data-stu-id="8e3da-166">Any issuer can be designated a trusted root authority by placing the issuer's certificate in the trusted root authority certificate store.</span></span>

### <a name="disabling-chain-trust"></a><span data-ttu-id="8e3da-167">Deaktivieren von Vertrauensketten</span><span class="sxs-lookup"><span data-stu-id="8e3da-167">Disabling Chain Trust</span></span>

<span data-ttu-id="8e3da-168">Wenn Sie einen neuen Dienst erstellen, verwenden Sie möglicherweise ein Zertifikat, das nicht von einer vertrauenswürdigen Stammzertifizierungsstelle ausgegeben wurde, oder das ausstellende Zertifikat befindet sich nicht im Speicher vertrauenswürdiger Stammzertifizierungsstellen.</span><span class="sxs-lookup"><span data-stu-id="8e3da-168">When creating a new service, you may be using a certificate that is not issued by a trusted root certificate, or the issuing certificate itself may not be in the Trusted Root Certification Authorities store.</span></span> <span data-ttu-id="8e3da-169">Sie können die Überprüfung der Kette von Vertrauensstellungen für ein Zertifikat in Entwicklungsumgebungen vorübergehend deaktivieren.</span><span class="sxs-lookup"><span data-stu-id="8e3da-169">For development purposes only, you can temporarily disable the mechanism that checks the chain of trust for a certificate.</span></span> <span data-ttu-id="8e3da-170">Legen Sie dazu die `CertificateValidationMode`-Eigenschaft auf entweder `PeerTrust` oder `PeerOrChainTrust` fest.</span><span class="sxs-lookup"><span data-stu-id="8e3da-170">To do this, set the `CertificateValidationMode` property to either `PeerTrust` or `PeerOrChainTrust`.</span></span> <span data-ttu-id="8e3da-171">Durch den jeweiligen Modus wird angegeben, dass das Zertifikat entweder selbst ausgegeben (Peervertrauenszertifikat) oder Teil einer Kette von Vertrauensstellungen ist.</span><span class="sxs-lookup"><span data-stu-id="8e3da-171">Either mode specifies that the certificate can either be self-issued (peer trust) or part of a chain of trust.</span></span> <span data-ttu-id="8e3da-172">Die Eigenschaft kann auf eine der folgenden Klassen festgelegt werden:</span><span class="sxs-lookup"><span data-stu-id="8e3da-172">You can set the property on any of the following classes.</span></span>

|<span data-ttu-id="8e3da-173">Klasse</span><span class="sxs-lookup"><span data-stu-id="8e3da-173">Class</span></span>|<span data-ttu-id="8e3da-174">Eigenschaft</span><span class="sxs-lookup"><span data-stu-id="8e3da-174">Property</span></span>|
|-----------|--------------|
|<xref:System.ServiceModel.Security.X509ClientCertificateAuthentication>|<xref:System.ServiceModel.Security.X509ClientCertificateAuthentication.CertificateValidationMode%2A?displayProperty=nameWithType>|
|<xref:System.ServiceModel.Security.X509PeerCertificateAuthentication>|<xref:System.ServiceModel.Security.X509PeerCertificateAuthentication.CertificateValidationMode%2A?displayProperty=nameWithType>|
|<xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication>|<xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CertificateValidationMode%2A?displayProperty=nameWithType>|
|<xref:System.ServiceModel.Security.IssuedTokenServiceCredential>|<xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A?displayProperty=nameWithType>|

<span data-ttu-id="8e3da-175">Sie können die Eigenschaft auch in der Konfiguration festlegen.</span><span class="sxs-lookup"><span data-stu-id="8e3da-175">You can also set the property using configuration.</span></span> <span data-ttu-id="8e3da-176">Folgende Elemente werden verwendet, um den Validierungsmodus anzugeben:</span><span class="sxs-lookup"><span data-stu-id="8e3da-176">The following elements are used to specify the validation mode:</span></span>

- [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-servicecertificate-element.md)

- [\<peerAuthentication>](../../configure-apps/file-schema/wcf/peerauthentication-element.md)

- [\<messageSenderAuthentication>](../../configure-apps/file-schema/wcf/messagesenderauthentication-element.md)

## <a name="custom-authentication"></a><span data-ttu-id="8e3da-177">Benutzerdefinierte Authentifizierung</span><span class="sxs-lookup"><span data-stu-id="8e3da-177">Custom Authentication</span></span>

<span data-ttu-id="8e3da-178">Die `CertificateValidationMode`-Eigenschaft ermöglicht es auch, die Authentifizierung von Zertifikaten anzupassen.</span><span class="sxs-lookup"><span data-stu-id="8e3da-178">The `CertificateValidationMode` property also enables you to customize how certificates are authenticated.</span></span> <span data-ttu-id="8e3da-179">Die Standardvertrauensebene ist `ChainTrust`.</span><span class="sxs-lookup"><span data-stu-id="8e3da-179">By default, the level is set to `ChainTrust`.</span></span> <span data-ttu-id="8e3da-180">Wenn Sie den <xref:System.ServiceModel.Security.X509CertificateValidationMode.Custom>-Wert verwenden möchten, müssen Sie auch das `CustomCertificateValidatorType`-Attribut auf eine Assembly und einen Typ festlegen, die zur Validierung des Zertifikats verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="8e3da-180">To use the <xref:System.ServiceModel.Security.X509CertificateValidationMode.Custom> value, you must also set the `CustomCertificateValidatorType` attribute to an assembly and type used to validate the certificate.</span></span> <span data-ttu-id="8e3da-181">Wenn Sie eine benutzerdefinierte Überprüfung erstellen möchten, müssen Sie die abstrakte <xref:System.IdentityModel.Selectors.X509CertificateValidator>-Klasse vererben.</span><span class="sxs-lookup"><span data-stu-id="8e3da-181">To create a custom validator, you must inherit from the abstract <xref:System.IdentityModel.Selectors.X509CertificateValidator> class.</span></span>

<span data-ttu-id="8e3da-182">Wenn Sie eine benutzerdefinierte Authentifizierung erstellen, müssen Sie auf jeden Fall die <xref:System.IdentityModel.Selectors.X509CertificateValidator.Validate%2A>-Methode überschreiben.</span><span class="sxs-lookup"><span data-stu-id="8e3da-182">When creating a custom authenticator, the most important method to override is the <xref:System.IdentityModel.Selectors.X509CertificateValidator.Validate%2A> method.</span></span> <span data-ttu-id="8e3da-183">Ein Beispiel zur benutzerdefinierten Authentifizierung finden Sie im Beispiel zum [Validierungssteuerelement des X.509-Zertifikats](../samples/x-509-certificate-validator.md).</span><span class="sxs-lookup"><span data-stu-id="8e3da-183">For an example of custom authentication, see the [X.509 Certificate Validator](../samples/x-509-certificate-validator.md) sample.</span></span> <span data-ttu-id="8e3da-184">Weitere Informationen finden Sie unter [Custom Credential and Credential Validation (Benutzerdefinierte Anmeldeinformationen und Validierung der Anmeldeinformationen)](../extending/custom-credential-and-credential-validation.md).</span><span class="sxs-lookup"><span data-stu-id="8e3da-184">For more information, see [Custom Credential and Credential Validation](../extending/custom-credential-and-credential-validation.md).</span></span>

## <a name="using-the-powershell-new-selfsignedcertificate-cmdlet-to-build-a-certificate-chain"></a><span data-ttu-id="8e3da-185">Verwenden des PowerShell-Cmdlets "New-selfsignedcertificate" zum Erstellen einer Zertifikat Kette</span><span class="sxs-lookup"><span data-stu-id="8e3da-185">Using the PowerShell New-SelfSignedCertificate Cmdlet to Build a Certificate Chain</span></span>

<span data-ttu-id="8e3da-186">Mit dem PowerShell-Cmdlet "New-selfsignedcertificate" werden X. 509-Zertifikate und private Schlüssel/öffentliche Schlüsselpaare erstellt.</span><span class="sxs-lookup"><span data-stu-id="8e3da-186">The PowerShell New-SelfSignedCertificate cmdlet creates X.509 certificates and private key/public key pairs.</span></span> <span data-ttu-id="8e3da-187">Sie können den privaten Schlüssel speichern und zum Ausstellen und Signieren neuer Zertifikate verwenden, um eine Hierarchie von Zertifikaten in einer Kette zu simulieren.</span><span class="sxs-lookup"><span data-stu-id="8e3da-187">You can save the private key to disk and then use it to issue and sign new certificates, thus simulating a hierarchy of chained certificates.</span></span> <span data-ttu-id="8e3da-188">Das-Cmdlet ist nur für die Verwendung als Hilfe beim Entwickeln von Diensten vorgesehen und sollte nie zum Erstellen von Zertifikaten für die tatsächliche Bereitstellung verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="8e3da-188">The cmdlet is intended for use only as an aid when developing services and should never be used to create certificates for actual deployment.</span></span> <span data-ttu-id="8e3da-189">Wenn Sie einen WCF-Dienst entwickeln, führen Sie die folgenden Schritte aus, um mit dem New-selfsignedcertificate-Cmdlet eine Vertrauenskette zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="8e3da-189">When developing a WCF service, use the following steps to build a chain of trust with the New-SelfSignedCertificate cmdlet.</span></span>

#### <a name="to-build-a-chain-of-trust-with-the-new-selfsignedcertificate-cmdlet"></a><span data-ttu-id="8e3da-190">So erstellen Sie eine Vertrauenskette mit dem Cmdlet "New-selfsignedcertificate"</span><span class="sxs-lookup"><span data-stu-id="8e3da-190">To build a chain of trust with the New-SelfSignedCertificate cmdlet</span></span>

1. <span data-ttu-id="8e3da-191">Erstellen Sie mit dem Cmdlet "New-selfsignedcertificate" ein temporäres Stamm Zertifizierungsstellen-Zertifikat (selbst signiert).</span><span class="sxs-lookup"><span data-stu-id="8e3da-191">Create a temporary root authority (self-signed) certificate using the New-SelfSignedCertificate cmdlet.</span></span> <span data-ttu-id="8e3da-192">Speichern Sie den privaten Schlüssel.</span><span class="sxs-lookup"><span data-stu-id="8e3da-192">Save the private key to the disk.</span></span>

2. <span data-ttu-id="8e3da-193">Verwenden Sie das neue Zertifikat, um ein anderes Zertifikat auszustellen, das den öffentlichen Schlüssel enthält.</span><span class="sxs-lookup"><span data-stu-id="8e3da-193">Use the new certificate to issue another certificate that contains the public key.</span></span>

3. <span data-ttu-id="8e3da-194">Importieren Sie das Zertifikat der Stammzertifizierungsstelle in den Speicher vertrauenswürdiger Stammzertifizierungsstellen.</span><span class="sxs-lookup"><span data-stu-id="8e3da-194">Import the root authority certificate into the Trusted Root Certification Authorities store.</span></span>

4. <span data-ttu-id="8e3da-195">Anweisungen finden Sie unter [How to: Create Temporary Certificates for Use During Development (Vorgehensweise: Erstellen von temporären Zertifikaten für die Verwendung während der Entwicklung)](how-to-create-temporary-certificates-for-use-during-development.md).</span><span class="sxs-lookup"><span data-stu-id="8e3da-195">For step-by-step instructions, see [How to: Create Temporary Certificates for Use During Development](how-to-create-temporary-certificates-for-use-during-development.md).</span></span>

## <a name="which-certificate-to-use"></a><span data-ttu-id="8e3da-196">Welches Zertifikat soll verwendet werden?</span><span class="sxs-lookup"><span data-stu-id="8e3da-196">Which Certificate to Use?</span></span>

<span data-ttu-id="8e3da-197">Im Zusammenhang mit Zertifikaten wird häufig danach gefragt, welches Zertifikat und warum dieses verwendet werden soll.</span><span class="sxs-lookup"><span data-stu-id="8e3da-197">Common questions about certificates are which certificate to use, and why.</span></span> <span data-ttu-id="8e3da-198">Die Antwort hängt davon ab, ob Sie einen Client oder einen Dienst programmieren.</span><span class="sxs-lookup"><span data-stu-id="8e3da-198">The answer depends on whether you are programming a client or service.</span></span> <span data-ttu-id="8e3da-199">Die folgenden Informationen bieten eine allgemeine Orientierung und stellen keine erschöpfende Antwort auf diese Fragen dar.</span><span class="sxs-lookup"><span data-stu-id="8e3da-199">The following information provides a general guideline and is not an exhaustive answer to these questions.</span></span>

### <a name="service-certificates"></a><span data-ttu-id="8e3da-200">Dienstzertifikate</span><span class="sxs-lookup"><span data-stu-id="8e3da-200">Service Certificates</span></span>

<span data-ttu-id="8e3da-201">Dienstzertifikate werden in erster Linie zur Authentifizierung von Servern gegenüber Clients verwendet.</span><span class="sxs-lookup"><span data-stu-id="8e3da-201">Service certificates have the primary task of authenticating the server to clients.</span></span> <span data-ttu-id="8e3da-202">Bei der Authentifizierung eines Servers durch einen Client wird u.a. zunächst überprüft, ob der Wert im Feld **Antragsteller** mit dem Uniform Resource Identifier (URI) übereinstimmt, der zum Herstellen der Verbindung mit dem Dienst verwendet wird: das DNS von Client und Server muss übereinstimmen.</span><span class="sxs-lookup"><span data-stu-id="8e3da-202">One of the initial checks when a client authenticates a server is to compare the value of the **Subject** field to the Uniform Resource Identifier (URI) used to contact the service: the DNS of both must match.</span></span> <span data-ttu-id="8e3da-203">Wenn beispielsweise der URI des Dienstes ist, `http://www.contoso.com/endpoint/` muss das **Betrefffeld** auch den Wert enthalten `www.contoso.com` .</span><span class="sxs-lookup"><span data-stu-id="8e3da-203">For example, if the URI of the service is `http://www.contoso.com/endpoint/` then the **Subject** field must also contain the value `www.contoso.com`.</span></span>

<span data-ttu-id="8e3da-204">Das Feld kann mehrere Werte enthalten, denen jeweils eine Initialisierung zur Angabe des Werts vorangeht.</span><span class="sxs-lookup"><span data-stu-id="8e3da-204">Note that the field can contain several values, each prefixed with an initialization to indicate the value.</span></span> <span data-ttu-id="8e3da-205">In den meisten Fällen ist die Initialisierung "CN" (allgemeiner Name), z `CN = www.contoso.com` . b..</span><span class="sxs-lookup"><span data-stu-id="8e3da-205">Most commonly, the initialization is "CN" for common name, for example, `CN = www.contoso.com`.</span></span> <span data-ttu-id="8e3da-206">Das Feld **Antragsteller** kann auch leer sein. In diesem Fall kann das Feld **Alternativer Antragstellername** den Wert **DNS-Name** enthalten.</span><span class="sxs-lookup"><span data-stu-id="8e3da-206">It is also possible for the **Subject** field to be blank, in which case the **Subject Alternative Name** field can contain the **DNS Name** value.</span></span>

<span data-ttu-id="8e3da-207">Der Wert des Felds **Beabsichtigte Zwecke** des Zertifikats sollte einen entsprechenden Wert enthalten, z.B. „Serverauthentifizierung“ oder „Clientauthentifizierung“.</span><span class="sxs-lookup"><span data-stu-id="8e3da-207">Also note the value of the **Intended Purposes** field of the certificate should include an appropriate value, such as "Server Authentication" or "Client Authentication".</span></span>

### <a name="client-certificates"></a><span data-ttu-id="8e3da-208">Clientzertifikate</span><span class="sxs-lookup"><span data-stu-id="8e3da-208">Client Certificates</span></span>

<span data-ttu-id="8e3da-209">Clientzertifikate werden normalerweise nicht von der Zertifizierungsstelle eines Drittanbieters ausgegeben.</span><span class="sxs-lookup"><span data-stu-id="8e3da-209">Client certificates are not typically issued by a third-party certification authority.</span></span> <span data-ttu-id="8e3da-210">Stattdessen enthält der persönliche Speicher des aktuellen Benutzers für gewöhnlich Zertifikate, die von einer Stammzertifizierungsstelle dort abgelegt wurden und deren beabsichtigter Zweck die "Clientauthentifizierung" ist.</span><span class="sxs-lookup"><span data-stu-id="8e3da-210">Instead, the Personal store of the current user location typically contains certificates placed there by a root authority, with an intended purpose of "Client Authentication".</span></span> <span data-ttu-id="8e3da-211">Der Client kann ein solches Zertifikat verwenden, wenn eine gegenseitige Authentifizierung erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="8e3da-211">The client can use such a certificate when mutual authentication is required.</span></span>

## <a name="online-revocation-and-offline-revocation"></a><span data-ttu-id="8e3da-212">Online-Sperrüberprüfung und Offline-Sperrüberprüfung</span><span class="sxs-lookup"><span data-stu-id="8e3da-212">Online Revocation and Offline Revocation</span></span>

### <a name="certificate-validity"></a><span data-ttu-id="8e3da-213">Zertifikatsgültigkeit</span><span class="sxs-lookup"><span data-stu-id="8e3da-213">Certificate Validity</span></span>

<span data-ttu-id="8e3da-214">Jedes Zertifikat ist nur für einen angegebenen Zeitraum gültig, der auch als *Gültigkeitsdauer* bezeichnet wird.</span><span class="sxs-lookup"><span data-stu-id="8e3da-214">Every certificate is valid only for a given period of time, called the *validity period*.</span></span> <span data-ttu-id="8e3da-215">Die Gültigkeitsdauer wird durch die Felder **Gültig ab** und **Gültig bis** eines X.509-Zertifikats bestimmt.</span><span class="sxs-lookup"><span data-stu-id="8e3da-215">The validity period is defined by the **Valid from** and **Valid to** fields of an X.509 certificate.</span></span> <span data-ttu-id="8e3da-216">Während der Authentifizierung wird überprüft, ob das Zertifikat eine entsprechende Gültigkeitsdauer aufweist.</span><span class="sxs-lookup"><span data-stu-id="8e3da-216">During authentication, the certificate is checked to determine whether the certificate is still within the validity period.</span></span>

### <a name="certificate-revocation-list"></a><span data-ttu-id="8e3da-217">Zertifikatsperrliste</span><span class="sxs-lookup"><span data-stu-id="8e3da-217">Certificate Revocation List</span></span>

<span data-ttu-id="8e3da-218">Zertifikate können innerhalb der Gültigkeitsdauer jederzeit von der Zertifizierungsstelle widerrufen werden.</span><span class="sxs-lookup"><span data-stu-id="8e3da-218">At any time during the validity period, the certification authority can revoke a certificate.</span></span> <span data-ttu-id="8e3da-219">Dafür kann es viele Gründe geben, beispielsweise kann die Sicherheit des privaten Schlüssels eines Zertifikats gefährdet sein.</span><span class="sxs-lookup"><span data-stu-id="8e3da-219">This can occur for many reasons, such as a compromise of the private key of the certificate.</span></span>

<span data-ttu-id="8e3da-220">In diesem Fall werden auch alle untergeordneten Zertifikate des widerrufenen Zertifikats ungültig und im Rahmen des Authentifizierungsprozesses als nicht vertrauenswürdig eingestuft.</span><span class="sxs-lookup"><span data-stu-id="8e3da-220">When this occurs, any chains that descend from the revoked certificate are also invalid, and are not trusted during authentication procedures.</span></span> <span data-ttu-id="8e3da-221">Mithilfe einer *Zertifikatsperrliste* (CRL), die über Datums- und Zeitstempel verfügt, können Sie herausfinden, welche Zertifikate widerrufen wurden.</span><span class="sxs-lookup"><span data-stu-id="8e3da-221">To find out which certificates are revoked, each issuer publishes a time- and date-stamped *certificate revocation list* (CRL).</span></span> <span data-ttu-id="8e3da-222">Diese Liste kann mit einer Online-Sperrüberprüfung oder mit einer Offline-Sperrüberprüfung überprüft werden, indem die `RevocationMode`-Eigenschaft oder die `DefaultRevocationMode`-Eigenschaft der folgenden Klassen einschließlich der <xref:System.Security.Cryptography.X509Certificates.X509RevocationMode>-Klassen auf einen der <xref:System.ServiceModel.Security.X509ClientCertificateAuthentication>-Enumerationswerte festgelegt wird: <xref:System.ServiceModel.Security.X509PeerCertificateAuthentication>, <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication>, <xref:System.ServiceModel.Security.IssuedTokenServiceCredential>.</span><span class="sxs-lookup"><span data-stu-id="8e3da-222">The list can be checked using either online revocation or offline revocation by setting the `RevocationMode` or `DefaultRevocationMode` property of the following classes to one of the <xref:System.Security.Cryptography.X509Certificates.X509RevocationMode> enumeration values: <xref:System.ServiceModel.Security.X509ClientCertificateAuthentication>, <xref:System.ServiceModel.Security.X509PeerCertificateAuthentication>, <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication>, and the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> classes.</span></span> <span data-ttu-id="8e3da-223">Der Standardwert aller Eigenschaften lautet `Online`.</span><span class="sxs-lookup"><span data-stu-id="8e3da-223">The default value for all properties is `Online`.</span></span>

<span data-ttu-id="8e3da-224">Sie können den Modus auch mit dem `revocationMode` -Attribut der [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-clientcertificate-element.md) (von [\<serviceBehaviors>](../../configure-apps/file-schema/wcf/servicebehaviors.md) ) und der [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-clientcertificate-element.md) (von [\<endpointBehaviors>](../../configure-apps/file-schema/wcf/endpointbehaviors.md) ) in der Konfiguration festlegen.</span><span class="sxs-lookup"><span data-stu-id="8e3da-224">You can also set the mode in configuration using the `revocationMode` attribute of both the [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-clientcertificate-element.md) (of the [\<serviceBehaviors>](../../configure-apps/file-schema/wcf/servicebehaviors.md)) and the [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-clientcertificate-element.md) (of the [\<endpointBehaviors>](../../configure-apps/file-schema/wcf/endpointbehaviors.md)).</span></span>

## <a name="the-setcertificate-method"></a><span data-ttu-id="8e3da-225">SetCertificate-Methode</span><span class="sxs-lookup"><span data-stu-id="8e3da-225">The SetCertificate Method</span></span>

<span data-ttu-id="8e3da-226">In WCF müssen häufig Zertifikate oder Gruppen von Zertifikaten angegeben werden, die von einem Dienst oder von einem Client zum Authentifizieren, Verschlüsseln oder digitalen Signieren von Nachrichten verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="8e3da-226">In WCF, you must often specify a certificate or set of certificates a service or client is to use to authenticate, encrypt, or digitally sign a message.</span></span> <span data-ttu-id="8e3da-227">Dies kann programmgesteuert mit der `SetCertificate`-Methode verschiedener Klassen geschehen, die X.509-Zertifikate darstellen.</span><span class="sxs-lookup"><span data-stu-id="8e3da-227">You can do this programmatically by using the `SetCertificate` method of various classes that represent X.509 certificates.</span></span> <span data-ttu-id="8e3da-228">Folgende Klassen geben mit der `SetCertificate`-Methode ein Zertifikat an.</span><span class="sxs-lookup"><span data-stu-id="8e3da-228">The following classes use the `SetCertificate` method to specify a certificate.</span></span>

|<span data-ttu-id="8e3da-229">Klasse</span><span class="sxs-lookup"><span data-stu-id="8e3da-229">Class</span></span>|<span data-ttu-id="8e3da-230">Methode</span><span class="sxs-lookup"><span data-stu-id="8e3da-230">Method</span></span>|
|-----------|------------|
|<xref:System.ServiceModel.Security.PeerCredential>|<xref:System.ServiceModel.Security.PeerCredential.SetCertificate%2A>|
|<xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential>|<xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential.SetCertificate%2A>|
|<xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential>|<xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential.SetCertificate%2A>|
|<xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential>|
|<xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential.SetCertificate%2A>|

<span data-ttu-id="8e3da-231">Bei der `SetCertificate`-Methode werden ein Speicherort und ein Speicher angegeben sowie ein Suchtyp (`x509FindType`-Parameter), der ein Feld des Zertifikats bestimmt, und ein Wert, der im Feld gefunden werden soll.</span><span class="sxs-lookup"><span data-stu-id="8e3da-231">The `SetCertificate` method works by designating a store location and store, a "find" type (`x509FindType` parameter) that specifies a field of the certificate, and a value to find in the field.</span></span> <span data-ttu-id="8e3da-232">So wird beispielsweise mit dem folgenden Code eine <xref:System.ServiceModel.ServiceHost>-Instanz erstellt, und das Dienstzertifikat, mit dem der Dienst gegenüber Clients mit der `SetCertificate`-Methode authentifiziert wird, wird festgelegt.</span><span class="sxs-lookup"><span data-stu-id="8e3da-232">For example, the following code creates a <xref:System.ServiceModel.ServiceHost> instance and sets the service certificate used to authenticate the service to clients with the `SetCertificate` method.</span></span>

[!code-csharp[c_WorkingWithCertificates#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_workingwithcertificates/cs/source.cs#1)]
[!code-vb[c_WorkingWithCertificates#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_workingwithcertificates/vb/source.vb#1)]

### <a name="multiple-certificates-with-the-same-value"></a><span data-ttu-id="8e3da-233">Mehrere Zertifikate mit dem gleichen Wert</span><span class="sxs-lookup"><span data-stu-id="8e3da-233">Multiple Certificates with the Same Value</span></span>

<span data-ttu-id="8e3da-234">Ein Speicher kann mehrere Zertifikate mit dem gleichen Antragstellernamen enthalten.</span><span class="sxs-lookup"><span data-stu-id="8e3da-234">A store may contain multiple certificates with the same subject name.</span></span> <span data-ttu-id="8e3da-235">Wenn Sie also `x509FindType` auf <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindBySubjectName> oder <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindBySubjectDistinguishedName> festlegen und mehrere Zertifikate den gleichen Wert aufweisen, wird eine Ausnahme ausgelöst, da nicht ermittelt werden kann, welches Zertifikat benötigt wird.</span><span class="sxs-lookup"><span data-stu-id="8e3da-235">This means that if you specify that the `x509FindType` is <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindBySubjectName> or <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindBySubjectDistinguishedName>, and more than one certificate has the same value, an exception is thrown because there is no way to distinguish which certificate is required.</span></span> <span data-ttu-id="8e3da-236">Legen Sie den `x509FindType` auf <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByThumbprint> fest, um dem entgegenzuwirken.</span><span class="sxs-lookup"><span data-stu-id="8e3da-236">You can mitigate this by setting the `x509FindType` to <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByThumbprint>.</span></span> <span data-ttu-id="8e3da-237">Das Fingerabdruckfeld enthält einen eindeutigen Wert, mit dem ein bestimmtes Zertifikat in einem Speicher gefunden werden kann.</span><span class="sxs-lookup"><span data-stu-id="8e3da-237">The thumbprint field contains a unique value that can be used to find a specific certificate in a store.</span></span> <span data-ttu-id="8e3da-238">Dies hat jedoch einen Nachteil: Wenn das Zertifikat widerrufen oder erneuert wird, schlägt die `SetCertificate`-Methode fehl, da der Fingerabdruck ebenfalls nicht mehr verfügbar ist.</span><span class="sxs-lookup"><span data-stu-id="8e3da-238">However, this has its own disadvantage: if the certificate is revoked or renewed, the `SetCertificate` method fails because the thumbprint is also gone.</span></span> <span data-ttu-id="8e3da-239">Ist das Zertifikat nicht mehr gültig ist, schlägt die Authentifizierung fehl.</span><span class="sxs-lookup"><span data-stu-id="8e3da-239">Or, if the certificate is no longer valid, authentication fails.</span></span> <span data-ttu-id="8e3da-240">Legen Sie den `x590FindType`-Parameter auf <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByIssuerName> fest, und geben Sie den Namen des Ausstellers an, um dem entgegenzuwirken.</span><span class="sxs-lookup"><span data-stu-id="8e3da-240">The way to mitigate this is to set the `x590FindType` parameter to <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByIssuerName> and specify the issuer's name.</span></span> <span data-ttu-id="8e3da-241">Wenn kein bestimmter Aussteller angegeben werden muss, können Sie auch einen der anderen <xref:System.Security.Cryptography.X509Certificates.X509FindType>-Enumerationswerte wie <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByTimeValid> festlegen.</span><span class="sxs-lookup"><span data-stu-id="8e3da-241">If no particular issuer is required, you can also set one of the other <xref:System.Security.Cryptography.X509Certificates.X509FindType> enumeration values, such as <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByTimeValid>.</span></span>

## <a name="certificates-in-configuration"></a><span data-ttu-id="8e3da-242">Zertifikate in der Konfiguration</span><span class="sxs-lookup"><span data-stu-id="8e3da-242">Certificates in Configuration</span></span>

<span data-ttu-id="8e3da-243">Sie können Zertifikate auch in der Konfiguration festlegen.</span><span class="sxs-lookup"><span data-stu-id="8e3da-243">You can also set certificates by using configuration.</span></span> <span data-ttu-id="8e3da-244">Wenn Sie einen Dienst erstellen, werden die Anmelde Informationen, einschließlich der Zertifikate, unter der angegeben [\<serviceBehaviors>](../../configure-apps/file-schema/wcf/servicebehaviors.md) .</span><span class="sxs-lookup"><span data-stu-id="8e3da-244">If you are creating a service, credentials, including certificates, are specified under the [\<serviceBehaviors>](../../configure-apps/file-schema/wcf/servicebehaviors.md).</span></span> <span data-ttu-id="8e3da-245">Wenn Sie einen Client programmieren, werden die Zertifikate unter der angegeben [\<endpointBehaviors>](../../configure-apps/file-schema/wcf/endpointbehaviors.md) .</span><span class="sxs-lookup"><span data-stu-id="8e3da-245">When you are programming a client, certificates are specified under the [\<endpointBehaviors>](../../configure-apps/file-schema/wcf/endpointbehaviors.md).</span></span>

## <a name="mapping-a-certificate-to-a-user-account"></a><span data-ttu-id="8e3da-246">Zuordnen eines Zertifikats zu einem Benutzerkonto</span><span class="sxs-lookup"><span data-stu-id="8e3da-246">Mapping a Certificate to a User Account</span></span>

<span data-ttu-id="8e3da-247">IIS und Active Directory bieten u. a. die Möglichkeit, ein Zertifikat einem Windows-Benutzerkonto zuzuordnen.</span><span class="sxs-lookup"><span data-stu-id="8e3da-247">A feature of IIS and Active Directory is the ability to map a certificate to a Windows user account.</span></span> <span data-ttu-id="8e3da-248">Weitere Informationen über das Feature finden Sie unter [Map certificates to user accounts (Zuordnen von Zertifikaten zu Benutzerkonten)](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc736706(v=ws.10)).</span><span class="sxs-lookup"><span data-stu-id="8e3da-248">For more information about the feature, see [Map certificates to user accounts](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc736706(v=ws.10)).</span></span>

<span data-ttu-id="8e3da-249">Informationen zur Verwendung der Azure Directory-Zuweisung finden Sie unter [Mapping Client Certificates with Directory Service Mapping (Zuordnen von Clientzertifikaten mit der Verzeichnisdienstzuordnung)](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc758484(v=ws.10)).</span><span class="sxs-lookup"><span data-stu-id="8e3da-249">For more information about using Active Directory mapping, see [Mapping Client Certificates with Directory Service Mapping](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc758484(v=ws.10)).</span></span>

<span data-ttu-id="8e3da-250">Wenn diese Funktion aktiviert ist, können Sie die <xref:System.ServiceModel.Security.X509ClientCertificateAuthentication.MapClientCertificateToWindowsAccount%2A>-Eigenschaft der <xref:System.ServiceModel.Security.X509ClientCertificateAuthentication>-Klasse auf `true` festlegen.</span><span class="sxs-lookup"><span data-stu-id="8e3da-250">With this capability enabled, you can set the <xref:System.ServiceModel.Security.X509ClientCertificateAuthentication.MapClientCertificateToWindowsAccount%2A> property of the <xref:System.ServiceModel.Security.X509ClientCertificateAuthentication> class to `true`.</span></span> <span data-ttu-id="8e3da-251">In der Konfiguration können Sie das- `mapClientCertificateToWindowsAccount` Attribut des- [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-servicecertificate-element.md) Elements auf festlegen `true` , wie im folgenden Code gezeigt.</span><span class="sxs-lookup"><span data-stu-id="8e3da-251">In configuration, you can set the `mapClientCertificateToWindowsAccount` attribute of the [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-servicecertificate-element.md) element to `true`, as shown in the following code.</span></span>

```xml
<serviceBehaviors>
 <behavior name="MappingBehavior">
  <serviceCredentials>
   <clientCertificate>
    <authentication certificateValidationMode="None" mapClientCertificateToWindowsAccount="true" />
   </clientCertificate>
  </serviceCredentials>
 </behavior>
</serviceBehaviors>
```

<span data-ttu-id="8e3da-252">Die Zuordnung eines X.509-Zertifikats zu einem Token, das ein Windows-Benutzerkonto darstellt, wird als Erweiterung der Berechtigungen angesehen, da das Windows-Token nach der Zuordnung Zugriff auf geschützte Ressourcen ermöglicht.</span><span class="sxs-lookup"><span data-stu-id="8e3da-252">Mapping an X.509 certificate to the token that represents a Windows user account is considered an elevation of privilege because, once mapped, the Windows token can be used to gain access to protected resources.</span></span> <span data-ttu-id="8e3da-253">Das X.509-Zertifikat muss daher vor der Zuordnung die entsprechenden Anforderungen der Domänenrichtlinie erfüllen.</span><span class="sxs-lookup"><span data-stu-id="8e3da-253">Therefore, domain policy requires the X.509 certificate to comply with its policy prior to mapping.</span></span> <span data-ttu-id="8e3da-254">Dies wird durch das *SChannel*-Sicherheitspaket sichergestellt.</span><span class="sxs-lookup"><span data-stu-id="8e3da-254">The *SChannel* security package enforces this requirement.</span></span>

<span data-ttu-id="8e3da-255">Wenn Sie .NET Framework 3,5 oder höhere Versionen verwenden, stellt WCF sicher, dass das Zertifikat der Domänen Richtlinie entspricht, bevor es einem Windows-Konto zugeordnet wird.</span><span class="sxs-lookup"><span data-stu-id="8e3da-255">When using .NET Framework 3.5 or later versions, WCF ensures the certificate conforms to domain policy before it is mapped to a Windows account.</span></span>

<span data-ttu-id="8e3da-256">Im ersten Release von WCF erfolgt die Zuordnung ohne auf die Domänenrichtlinie zurückzugreifen.</span><span class="sxs-lookup"><span data-stu-id="8e3da-256">In the first release of WCF, mapping is done without consulting the domain policy.</span></span> <span data-ttu-id="8e3da-257">Möglicherweise tritt daher bei älteren Anwendungen, die mit dem ersten Release ausgeführt werden konnten, ein Fehler auf, wenn die Zuordnung aktiviert ist und die Anforderungen der Domänenrichtlinie vom X.509-Zertifikat nicht erfüllt werden.</span><span class="sxs-lookup"><span data-stu-id="8e3da-257">Therefore it is possible that older applications that used to work when running under the first release, fails if the mapping is enabled and the X.509 certificate does not satisfy the domain policy.</span></span>

## <a name="see-also"></a><span data-ttu-id="8e3da-258">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="8e3da-258">See also</span></span>

- <xref:System.ServiceModel.Channels>
- <xref:System.ServiceModel.Security>
- <xref:System.ServiceModel>
- <xref:System.Security.Cryptography.X509Certificates.X509FindType>
- [<span data-ttu-id="8e3da-259">Sichern von Diensten und Clients</span><span class="sxs-lookup"><span data-stu-id="8e3da-259">Securing Services and Clients</span></span>](securing-services-and-clients.md)
