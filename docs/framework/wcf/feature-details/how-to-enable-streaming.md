---
title: 'Vorgehensweise: Aktivieren des Streamingmodus'
description: Erfahren Sie, wie Sie per Streaming übertragene Nachrichten in WCF anstelle der standardmäßigen gepufferten Übertragungen aktivieren, die vor der Verarbeitung vollständig empfangen werden müssen.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 6ca2cf4b-c7a1-49d8-a79b-843a90556ba4
ms.openlocfilehash: 538fd8634094aa6fbf097ddb94469d7bca749a63
ms.sourcegitcommit: 358a28048f36a8dca39a9fe6e6ac1f1913acadd5
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 06/23/2020
ms.locfileid: "85247025"
---
# <a name="how-to-enable-streaming"></a><span data-ttu-id="9b41a-103">Vorgehensweise: Aktivieren des Streamingmodus</span><span class="sxs-lookup"><span data-stu-id="9b41a-103">How to: Enable Streaming</span></span>
<span data-ttu-id="9b41a-104">Windows Communication Foundation (WCF) kann Nachrichten mit gepufferten oder Streamingübertragungen senden.</span><span class="sxs-lookup"><span data-stu-id="9b41a-104">Windows Communication Foundation (WCF) can send messages using either buffered or streamed transfers.</span></span> <span data-ttu-id="9b41a-105">Im voreingestellten gepufferten Übertragungsmodus müssen Nachrichten vollständig übertragen worden sein, bevor sie vom Empfänger gelesen werden können.</span><span class="sxs-lookup"><span data-stu-id="9b41a-105">In the default buffered-transfer mode, a message must be completely delivered before a receiver can read it.</span></span> <span data-ttu-id="9b41a-106">Im Streamingmodus kann der Empfänger mit der Verarbeitung der Nachricht beginnen, bevor diese vollständig übertragen wurde.</span><span class="sxs-lookup"><span data-stu-id="9b41a-106">In streaming transfer mode, the receiver can begin to process the message before it is completely delivered.</span></span> <span data-ttu-id="9b41a-107">Der Streamingmodus ist hilfreich, wenn die zu übergebenden Informationen sehr umfangreich sind und hintereinander verarbeitet werden können.</span><span class="sxs-lookup"><span data-stu-id="9b41a-107">The streaming mode is useful when the information that is passed is lengthy and can be processed serially.</span></span> <span data-ttu-id="9b41a-108">Der Streamingmodus ist auch dann nützlich, wenn eine Nachricht zu groß ist, um als Ganzes gepuffert zu werden.</span><span class="sxs-lookup"><span data-stu-id="9b41a-108">Streaming mode is also useful when the message is too large to be entirely buffered.</span></span>  
  
 <span data-ttu-id="9b41a-109">Um den Streamingmodus zu aktivieren, definieren Sie den `OperationContract` angemessen, und aktivieren Sie den Streamingmodus auf Transportebene.</span><span class="sxs-lookup"><span data-stu-id="9b41a-109">To enable streaming, define the `OperationContract` appropriately and enable streaming at the transport level.</span></span>  
  
### <a name="to-stream-data"></a><span data-ttu-id="9b41a-110">So werden Daten im Streamingmodus übertragen</span><span class="sxs-lookup"><span data-stu-id="9b41a-110">To stream data</span></span>  
  
1. <span data-ttu-id="9b41a-111">Damit Daten im Streamingmodus übermittelt werden können, muss der `OperationContract` für den Dienst zwei Anforderungen erfüllen:</span><span class="sxs-lookup"><span data-stu-id="9b41a-111">To stream data, the `OperationContract` for the service must satisfy two requirements:</span></span>  
  
    1. <span data-ttu-id="9b41a-112">Der Parameter, der die zu übermittelten Daten enthält, muss der einzige Parameter der Methode sein.</span><span class="sxs-lookup"><span data-stu-id="9b41a-112">The parameter that holds the data to be streamed must be the only parameter in the method.</span></span> <span data-ttu-id="9b41a-113">Wenn beispielsweise die Eingabenachricht im Streamingmodus übertragen werden soll, muss der Vorgang genau einen Eingabeparameter haben.</span><span class="sxs-lookup"><span data-stu-id="9b41a-113">For example, if the input message is the one to be streamed, the operation must have exactly one input parameter.</span></span> <span data-ttu-id="9b41a-114">Ebenso gilt, wenn die Ausgabenachricht im Streamingmodus übertragen werden soll, muss der Vorgang entweder genau einen Ausgabeparameter oder einen Rückgabewert haben.</span><span class="sxs-lookup"><span data-stu-id="9b41a-114">Similarly, if the output message is to be streamed, the operation must have either exactly one output parameter or a return value.</span></span>  
  
    2. <span data-ttu-id="9b41a-115">Mindestens einer der Parameter bzw. der Rückgabewert muss vom Typ <xref:System.IO.Stream>, <xref:System.ServiceModel.Channels.Message> oder <xref:System.Xml.Serialization.IXmlSerializable> sein</span><span class="sxs-lookup"><span data-stu-id="9b41a-115">At least one of the types of the parameter and return value must be either <xref:System.IO.Stream>, <xref:System.ServiceModel.Channels.Message>, or <xref:System.Xml.Serialization.IXmlSerializable>.</span></span>  
  
     <span data-ttu-id="9b41a-116">Das folgende Beispiel enthält einen Vertrag für im Streamingmodus zu übertragende Daten.</span><span class="sxs-lookup"><span data-stu-id="9b41a-116">The following is an example of a contract for streamed data.</span></span>  
  
     [!code-csharp[c_HowTo_EnableStreaming#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/cs/service.cs#1)]
     [!code-vb[c_HowTo_EnableStreaming#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming/vb/service.vb#1)]  
  
     <span data-ttu-id="9b41a-117">Der `GetStream`-Vorgang muss gepufferte Eingabedaten des Typs `string` erhalten, die dann gepuffert werden, und er gibt einen `Stream`-Wert zurück, der im Streamingmodus übertragen wird.</span><span class="sxs-lookup"><span data-stu-id="9b41a-117">The `GetStream` operation receives some buffered input data as a `string`, which is buffered, and returns a `Stream`, which is streamed.</span></span> <span data-ttu-id="9b41a-118">Umgekehrt akzeptiert `UploadStream` einen (per Streaming übertragenen) `Stream` und gibt einen (gepufferten) `bool` zurück.</span><span class="sxs-lookup"><span data-stu-id="9b41a-118">Conversely `UploadStream` takes in a `Stream` (streamed) and returns a `bool` (buffered).</span></span> <span data-ttu-id="9b41a-119">`EchoStream` akzeptiert und gibt einen Wert des Typs `Stream` zurück und ist ein Beispiel für einen Vorgang, dessen Eingabe- und Ausgabenachrichten per Streaming übertragen werden.</span><span class="sxs-lookup"><span data-stu-id="9b41a-119">`EchoStream` takes and returns `Stream` and is an example of an operation whose input and output messages are both streamed.</span></span> <span data-ttu-id="9b41a-120">`GetReversedStream` akzeptiert keine Eingaben und gibt einen `Stream`-Wert (im Streamingmodus) zurück.</span><span class="sxs-lookup"><span data-stu-id="9b41a-120">Finally, `GetReversedStream` takes no inputs and returns a `Stream` (streamed).</span></span>  
  
2. <span data-ttu-id="9b41a-121">Der Streamingmodus muss für die Bindung aktiviert werden.</span><span class="sxs-lookup"><span data-stu-id="9b41a-121">Streaming must be enabled on the binding.</span></span> <span data-ttu-id="9b41a-122">Sie legen eine `TransferMode`-Eigenschaft fest, für die die folgenden Werte zulässig sind:</span><span class="sxs-lookup"><span data-stu-id="9b41a-122">You set a `TransferMode` property, which can take one of the following values:</span></span>  
  
    1. <span data-ttu-id="9b41a-123">`Buffered`,</span><span class="sxs-lookup"><span data-stu-id="9b41a-123">`Buffered`,</span></span>  
  
    2. <span data-ttu-id="9b41a-124">`Streamed`, womit ein Kommunikationsstream in beide Richtungen ermöglicht wird.</span><span class="sxs-lookup"><span data-stu-id="9b41a-124">`Streamed`, which enables streaming communication in both directions.</span></span>  
  
    3. <span data-ttu-id="9b41a-125">`StreamedRequest`, womit der Streamingmodus lediglich für die Übertragung der Anforderung aktiviert wird.</span><span class="sxs-lookup"><span data-stu-id="9b41a-125">`StreamedRequest`, which enables streaming the request only.</span></span>  
  
    4. <span data-ttu-id="9b41a-126">`StreamedResponse`, womit der Streamingmodus lediglich für die Übertragung der Antwort aktiviert wird.</span><span class="sxs-lookup"><span data-stu-id="9b41a-126">`StreamedResponse`, which enables streaming the response only.</span></span>  
  
     <span data-ttu-id="9b41a-127">Die `BasicHttpBinding`-Bindung macht die `TransferMode`-Eigenschaft für die Bindung verfügbar. Dies gilt ebenso für `NetTcpBinding` und `NetNamedPipeBinding`.</span><span class="sxs-lookup"><span data-stu-id="9b41a-127">The `BasicHttpBinding` exposes the `TransferMode` property on the binding, as does `NetTcpBinding` and `NetNamedPipeBinding`.</span></span> <span data-ttu-id="9b41a-128">Die `TransferMode`-Eigenschaft kann auch für das Transportbindungselement festgelegt und in einer benutzerdefinierten Bindung verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="9b41a-128">The `TransferMode` property can also be set on the transport binding element and used in a custom binding.</span></span>  
  
     <span data-ttu-id="9b41a-129">In den folgenden Beispielen wird gezeigt, wie `TransferMode` im Code und durch Ändern der Konfigurationsdatei festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="9b41a-129">The following samples show how to set `TransferMode` by code and by changing the configuration file.</span></span> <span data-ttu-id="9b41a-130">In beiden Beispielen wird zudem die `maxReceivedMessageSize`-Eigenschaft auf 64&#160;MB festgelegt und damit die maximal zulässige Größe für den Empfang von Nachrichten beschränkt.</span><span class="sxs-lookup"><span data-stu-id="9b41a-130">The samples also both set the `maxReceivedMessageSize` property to 64 MB, which places a cap on the maximum allowable size of messages on receive.</span></span> <span data-ttu-id="9b41a-131">Die Standardeinstellung von `maxReceivedMessageSize` ist 64&#160;KB, was normalerweise zu niedrig für die Verwendung des Streamingmodus ist.</span><span class="sxs-lookup"><span data-stu-id="9b41a-131">The default `maxReceivedMessageSize` is 64 KB, which is usually too low for streaming scenarios.</span></span> <span data-ttu-id="9b41a-132">Legen Sie diese Größeneinstellung, abhängig von der maximalen Größe der Nachrichten, die von der Anwendung empfangen werden sollen, auf einen geeigneten Wert fest.</span><span class="sxs-lookup"><span data-stu-id="9b41a-132">Set this quota setting as appropriate depending on the maximum size of messages your application expects to receive.</span></span> <span data-ttu-id="9b41a-133">Beachten Sie außerdem, dass die `maxBufferSize`-Einstellung die maximale Puffergröße angibt, und legen Sie diese Eigenschaft auf einen angemessenen Wert fest.</span><span class="sxs-lookup"><span data-stu-id="9b41a-133">Also note that `maxBufferSize` controls the maximum size that is buffered, and set it appropriately.</span></span>  
  
    1. <span data-ttu-id="9b41a-134">Der folgende Ausschnitt aus der Konfiguration des Beispiel zeigt, wie die `TransferMode`-Eigenschaft für `basicHttpBinding` und eine benutzerdefinierte HTTP-Bindung auf den Streamingmodus festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="9b41a-134">The following configuration snippet from the sample shows setting the `TransferMode` property to streaming on the `basicHttpBinding` and a custom HTTP binding.</span></span>  
  
         [!code-xml[c_HowTo_EnableStreaming#103](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/common/app.config#103)]
  
    2. <span data-ttu-id="9b41a-135">Der folgende Codeausschnitt zeigt, wie die `TransferMode`-Eigenschaft für `basicHttpBinding` und eine benutzerdefinierte HTTP-Bindung auf den Streamingmodus festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="9b41a-135">The following code snippet shows setting the `TransferMode` property to streaming on the `basicHttpBinding` and a custom HTTP binding.</span></span>  
  
         [!code-csharp[c_HowTo_EnableStreaming_code#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming_code/cs/c_howto_enablestreaming_code.cs#2)]
         [!code-vb[c_HowTo_EnableStreaming_code#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming_code/vb/c_howto_enablestreaming_code.vb#2)]  
  
    3. <span data-ttu-id="9b41a-136">Der folgende Codeausschnitt zeigt, wie die `TransferMode`-Eigenschaft für eine benutzerdefinierte TCP-Bindung auf den Streamingmodus festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="9b41a-136">The following code snippet shows setting the `TransferMode` property to streaming on a custom TCP binding.</span></span>  
  
         [!code-csharp[c_HowTo_EnableStreaming_code#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming_code/cs/c_howto_enablestreaming_code.cs#3)]
         [!code-vb[c_HowTo_EnableStreaming_code#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming_code/vb/c_howto_enablestreaming_code.vb#3)]  
  
3. <span data-ttu-id="9b41a-137">Die Vorgänge `GetStream`, `UploadStream` und `EchoStream` sind damit befasst, Daten direkt aus einer Datei zu senden oder empfangene Daten direkt in eine Datei auszugeben.</span><span class="sxs-lookup"><span data-stu-id="9b41a-137">The operations `GetStream`, `UploadStream`, and `EchoStream` all deal with sending data directly from a file or saving received data directly to a file.</span></span> <span data-ttu-id="9b41a-138">Der folgende Code ist für `GetStream` vorgesehen</span><span class="sxs-lookup"><span data-stu-id="9b41a-138">The following code is for `GetStream`.</span></span>  
  
     [!code-csharp[c_HowTo_EnableStreaming#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/cs/service.cs#4)]
     [!code-vb[c_HowTo_EnableStreaming#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming/vb/service.vb#4)]  
  
### <a name="writing-a-custom-stream"></a><span data-ttu-id="9b41a-139">Schreiben einer benutzerdefinierten Streamklasse</span><span class="sxs-lookup"><span data-stu-id="9b41a-139">Writing a custom stream</span></span>  
  
1. <span data-ttu-id="9b41a-140">Wenn jedes Element eines Datenstreams beim Senden oder Empfangen auf eine besondere Weise verarbeitet werden soll, müssen Sie eine benutzerdefinierte Streamklasse von der <xref:System.IO.Stream>-Klasse ableiten</span><span class="sxs-lookup"><span data-stu-id="9b41a-140">To do special processing on each chunk of a data stream as it is being sent or received, derive a custom stream class from <xref:System.IO.Stream>.</span></span> <span data-ttu-id="9b41a-141">Der folgende Code enthält als Beispiel für einen benutzerdefinierten Stream die `GetReversedStream`-Methode und die `ReverseStream`-Klasse.</span><span class="sxs-lookup"><span data-stu-id="9b41a-141">As an example of a custom stream, the following code contains a `GetReversedStream` method and a `ReverseStream` class-.</span></span>  
  
     <span data-ttu-id="9b41a-142">`GetReversedStream` erstellt eine neue Instanz der `ReverseStream`-Klasse und gibt eine Instanz dieser Klasse zurück.</span><span class="sxs-lookup"><span data-stu-id="9b41a-142">`GetReversedStream` creates and returns a new instance of `ReverseStream`.</span></span> <span data-ttu-id="9b41a-143">Die tatsächliche Verarbeitung erfolgt, wenn das System Daten aus dem `ReverseStream`-Objekt liest.</span><span class="sxs-lookup"><span data-stu-id="9b41a-143">The actual processing happens as the system reads from the `ReverseStream` object.</span></span> <span data-ttu-id="9b41a-144">Die `ReverseStream.Read`-Methode liest eine Gruppe von Bytes aus der zugrunde liegenden Datei, invertiert die Reihenfolge der Bytes und gibt die invertierten Bytes zurück.</span><span class="sxs-lookup"><span data-stu-id="9b41a-144">The `ReverseStream.Read` method reads a chunk of bytes from the underlying file, reverses them, then returns the reversed bytes.</span></span> <span data-ttu-id="9b41a-145">Diese Methode invertiert nicht den gesamten Dateiinhalt, sondern jeweils nur eine Gruppe von Bytes.</span><span class="sxs-lookup"><span data-stu-id="9b41a-145">This method does not reverse the entire file content; it reverses one chunk of bytes at a time.</span></span> <span data-ttu-id="9b41a-146">Dieses Beispiel zeigt, wie Daten im Streamingmodus verarbeitet werden, wenn Daten aus dem Stream gelesen oder in den Stream geschrieben werden.</span><span class="sxs-lookup"><span data-stu-id="9b41a-146">This example shows how you can perform stream processing as the content is being read to or written from the stream.</span></span>  
  
     [!code-csharp[c_HowTo_EnableStreaming#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/cs/service.cs#2)]
     [!code-vb[c_HowTo_EnableStreaming#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming/vb/service.vb#2)]  
  
## <a name="see-also"></a><span data-ttu-id="9b41a-147">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="9b41a-147">See also</span></span>

- [<span data-ttu-id="9b41a-148">Umfangreiche Daten und Streaming</span><span class="sxs-lookup"><span data-stu-id="9b41a-148">Large Data and Streaming</span></span>](large-data-and-streaming.md)
- [<span data-ttu-id="9b41a-149">STREAM</span><span class="sxs-lookup"><span data-stu-id="9b41a-149">Stream</span></span>](../samples/stream.md)
