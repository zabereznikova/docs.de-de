---
title: Verwenden von Warteschlangen für unzustellbare Nachrichten zur Handhabung von Nachrichtenübertragungsfehlern
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 9e891c6a-d960-45ea-904f-1a00e202d61a
ms.openlocfilehash: d3087021c717d6ee055a4a1f5332d9d259f06381
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 11/26/2020
ms.locfileid: "96289593"
---
# <a name="using-dead-letter-queues-to-handle-message-transfer-failures"></a><span data-ttu-id="cb39c-102">Verwenden von Warteschlangen für unzustellbare Nachrichten zur Handhabung von Nachrichtenübertragungsfehlern</span><span class="sxs-lookup"><span data-stu-id="cb39c-102">Using Dead-Letter Queues to Handle Message Transfer Failures</span></span>

<span data-ttu-id="cb39c-103">Die Zustellung von in der Warteschlange stehenden Nachrichten kann fehlschlagen.</span><span class="sxs-lookup"><span data-stu-id="cb39c-103">Queued messages can fail delivery.</span></span> <span data-ttu-id="cb39c-104">Diese fehlgeschlagenen Nachrichten werden in einer Warteschlange für unzustellbare Nachrichten aufgezeichnet.</span><span class="sxs-lookup"><span data-stu-id="cb39c-104">These failed messages are recorded in a dead-letter queue.</span></span> <span data-ttu-id="cb39c-105">Das Fehlschlagen der Zustellung kann beispielsweise durch Netzwerkfehler, eine gelöschte Warteschlange, eine volle Warteschlange, einen Authentifizierungsfehler oder eine zu späte Zustellung verursacht werden.</span><span class="sxs-lookup"><span data-stu-id="cb39c-105">The failed delivery can be caused by reasons such as network failures, a deleted queue, a full queue, authentication failure, or a failure to deliver on time.</span></span>  
  
 <span data-ttu-id="cb39c-106">In der Warteschlange stehende Nachrichten können über lange Zeit hinweg in der Warteschlange verbleiben, wenn die empfangende Anwendung sie nicht umgehend aus der Warteschlange liest.</span><span class="sxs-lookup"><span data-stu-id="cb39c-106">Queued messages can remain in the queue for a long time if the receiving application does not read them from the queue in a timely fashion.</span></span> <span data-ttu-id="cb39c-107">Dieses Verhalten ist möglicherweise nicht für zeitempfindliche Nachrichten geeignet.</span><span class="sxs-lookup"><span data-stu-id="cb39c-107">This behavior may not be appropriate for time-sensitive messages.</span></span> <span data-ttu-id="cb39c-108">Zeitempfindliche Nachrichten verfügen über eine Eigenschaft für die Gültigkeitsdauer (Time to Live, TTL), die in der Bindung der Warteschlange festgelegt ist und angibt, wie lange die Nachrichten in der Warteschlange verbleiben können, bevor sie ablaufen.</span><span class="sxs-lookup"><span data-stu-id="cb39c-108">Time-sensitive messages have a Time to Live (TTL) property set in the queued binding, which indicates how long the messages can be in the queue before they must expire.</span></span> <span data-ttu-id="cb39c-109">Abgelaufene Nachrichten werden an eine spezielle Warteschlange gesendet und zwar an die Warteschlange für unzustellbare Nachrichten.</span><span class="sxs-lookup"><span data-stu-id="cb39c-109">Expired messages are sent to a special queue called the dead-letter queue.</span></span> <span data-ttu-id="cb39c-110">Nachrichten können auch aus anderen Gründen in einer Warteschlange für unzustellbare Nachrichten platziert werden, z. B. aufgrund des Überschreitens eines Warteschlangenkontingents oder aufgrund eines Authentifizierungsfehlers.</span><span class="sxs-lookup"><span data-stu-id="cb39c-110">Messages can also be put in a dead-letter queue for other reasons, such as exceeding a queue quota or because of authentication failure.</span></span>  
  
 <span data-ttu-id="cb39c-111">Im Allgemeinen schreiben Anwendungen Entschädigungslogik, um Nachrichten aus der Warteschlange für unzustellbare Nachrichten sowie Fehlerursachen zu lesen.</span><span class="sxs-lookup"><span data-stu-id="cb39c-111">Generally, applications write compensation logic to read messages from the dead-letter queue and failure reasons.</span></span> <span data-ttu-id="cb39c-112">Die Entschädigungslogik hängt von der Ursache des Fehlers ab.</span><span class="sxs-lookup"><span data-stu-id="cb39c-112">The compensation logic depends on the cause of the failure.</span></span> <span data-ttu-id="cb39c-113">Im Falle eines Authentifizierungsfehlers können Sie beispielsweise das an die Nachricht angehängte Zertifikat korrigieren und die Nachricht anschließend erneut senden.</span><span class="sxs-lookup"><span data-stu-id="cb39c-113">For example, in the case of authentication failure, you can correct the certificate attached with the message and resend the message.</span></span> <span data-ttu-id="cb39c-114">Wenn eine Zustellung fehlgeschlagen ist, weil das Zielwarteschlangenkontingent nicht erreicht wurde, können Sie erneut einen Zustellungsversuch vornehmen, in der Hoffnung, dass das Kontingentproblem behoben wurde.</span><span class="sxs-lookup"><span data-stu-id="cb39c-114">If delivery failed because the target queue quota was reached, you can reattempt delivery in the hope that the quota problem was resolved.</span></span>  
  
 <span data-ttu-id="cb39c-115">Die meisten Warteschlangensysteme haben eine systemweite Warteschlange für unzustellbare Nachrichten, in der alle fehlgeschlagenen Nachrichten dieses Systems gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="cb39c-115">Most queuing systems have a system-wide dead-letter queue where all failed messages from that system are stored.</span></span> <span data-ttu-id="cb39c-116">Message Queuing (MSMQ) bietet zwei systemweite Warteschlangen für unzustellbare Nachrichten: eine transaktionale systemweite Warteschlange für unzustellbare Nachrichten, die Nachrichten speichert, die nicht an die transaktionale Warteschlange gesendet werden konnten, und eine nicht transaktionale Warteschlange für unzustellbare Nachrichten, die Nachrichten speichert, die nicht an die nicht transaktionale Warteschlange gesendet werden konnten.</span><span class="sxs-lookup"><span data-stu-id="cb39c-116">Message Queuing (MSMQ) provides two system-wide dead-letter queues: a transactional system-wide dead-letter queue that stores messages that failed delivery to the transactional queue and a non-transactional system-wide dead-letter queue that stores messages that failed delivery to the non-transactional queue.</span></span> <span data-ttu-id="cb39c-117">Wenn zwei Clients Nachrichten an zwei verschiedene Dienste senden und daher die unterschiedlichen Warteschlangen in WCF denselben MSMQ-Dienst zum Senden gemeinsam nutzen, ist es möglich, dass eine Kombination aus Nachrichten in der System Warteschlange für unzustellbare Nachrichten vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="cb39c-117">If two clients are sending messages to two different services, and therefore different queues in WCF are sharing the same MSMQ service to send, then it is possible to have a mix of messages in the system dead-letter queue.</span></span> <span data-ttu-id="cb39c-118">Dies ist nicht immer optimal.</span><span class="sxs-lookup"><span data-stu-id="cb39c-118">This is not always optimal.</span></span> <span data-ttu-id="cb39c-119">In vielen Fällen (z. B. im Hinblick auf die Sicherheit) ist es nicht ratsam, dass ein Client die Nachrichten eines anderen Clients aus der Warteschlange für unzustellbare Nachrichten liest.</span><span class="sxs-lookup"><span data-stu-id="cb39c-119">In several cases (security, for example), you may not want one client to read another client's messages from a dead-letter queue.</span></span> <span data-ttu-id="cb39c-120">Bei einer gemeinsam genutzten Warteschlange für unzustellbare Nachrichten müssen die Clients darüber hinaus die Warteschlange nach von ihnen gesendeten Nachrichten durchsuchen, was je nach Anzahl der Nachrichten in der Warteschlange für unzustellbare Nachrichten viel zu aufwendig sein kann.</span><span class="sxs-lookup"><span data-stu-id="cb39c-120">A shared dead-letter queue also requires clients to browse through the queue to find a message that they sent, which can be prohibitively expensive based on the number of messages in the dead-letter queue.</span></span> <span data-ttu-id="cb39c-121">Daher stellen in WCF `NetMsmqBinding` `MsmqIntegrationBinding,` und MSMQ unter Windows Vista eine benutzerdefinierte Warteschlange für unzustellbare Nachrichten bereit (manchmal auch als anwendungsspezifische Warteschlange für unzustellbare Nachrichten bezeichnet).</span><span class="sxs-lookup"><span data-stu-id="cb39c-121">Therefore, in WCF`NetMsmqBinding`, `MsmqIntegrationBinding,` and MSMQ on Windows Vista provide a custom dead-letter queue (sometimes referred to as an application-specific dead-letter queue).</span></span>  
  
 <span data-ttu-id="cb39c-122">Die benutzerdefinierte Warteschlange für unzustellbare Nachrichten ermöglicht eine Isolation zwischen Clients, die den gleichen MSMQ-Dienst verwenden, um Nachrichten zu senden.</span><span class="sxs-lookup"><span data-stu-id="cb39c-122">The custom dead-letter queue provides isolation between clients that share the same MSMQ service to send messages.</span></span>  
  
 <span data-ttu-id="cb39c-123">Unter Windows Server 2003 und Windows XP bietet Windows Communication Foundation (WCF) eine systemweite Warteschlange für unzustellbare Nachrichten für alle Client Anwendungen in der Warteschlange.</span><span class="sxs-lookup"><span data-stu-id="cb39c-123">On Windows Server 2003 and Windows XP, Windows Communication Foundation (WCF) provides a system-wide dead-letter queue for all queued client applications.</span></span> <span data-ttu-id="cb39c-124">Unter Windows Vista stellt WCF eine Warteschlange für unzustellbare Nachrichten für jede Client Anwendung in der Warteschlange bereit.</span><span class="sxs-lookup"><span data-stu-id="cb39c-124">On Windows Vista, WCF provides a dead-letter queue for each queued client application.</span></span>  
  
## <a name="specifying-use-of-the-dead-letter-queue"></a><span data-ttu-id="cb39c-125">Angeben der Verwendung der Warteschlange für unzustellbare Nachrichten</span><span class="sxs-lookup"><span data-stu-id="cb39c-125">Specifying Use of the Dead-Letter Queue</span></span>  

 <span data-ttu-id="cb39c-126">Eine Warteschlange für unzustellbare Nachrichten befindet sich im Warteschlangen-Manager der sendenden Anwendung.</span><span class="sxs-lookup"><span data-stu-id="cb39c-126">A dead-letter queue is in the queue manager of the sending application.</span></span> <span data-ttu-id="cb39c-127">Sie speichert Nachrichten, die abgelaufen sind oder nicht zugestellt werden konnten.</span><span class="sxs-lookup"><span data-stu-id="cb39c-127">It stores messages that have expired or that have failed transfer or delivery.</span></span>  
  
 <span data-ttu-id="cb39c-128">Die Bindung weist die folgenden Eigenschaften für eine Warteschlange für unzustellbare Nachrichten auf:</span><span class="sxs-lookup"><span data-stu-id="cb39c-128">The binding has the following dead-letter queue properties:</span></span>  
  
- <xref:System.ServiceModel.MsmqBindingBase.DeadLetterQueue%2A>  
  
- <xref:System.ServiceModel.MsmqBindingBase.CustomDeadLetterQueue%2A>  
  
## <a name="reading-messages-from-the-dead-letter-queue"></a><span data-ttu-id="cb39c-129">Lesen von Nachrichten aus der Warteschlange für unzustellbare Nachrichten</span><span class="sxs-lookup"><span data-stu-id="cb39c-129">Reading Messages from the Dead-Letter Queue</span></span>  

 <span data-ttu-id="cb39c-130">Eine Anwendung, die Nachrichten aus einer Warteschlange für unzustellbare Nachrichten liest, ähnelt einem WCF-Dienst, der aus einer Anwendungs Warteschlange liest, mit Ausnahme der folgenden geringfügigen Unterschiede:</span><span class="sxs-lookup"><span data-stu-id="cb39c-130">An application that reads messages out of a dead-letter queue is similar to a WCF service that reads from an application queue, except for the following minor differences:</span></span>  
  
- <span data-ttu-id="cb39c-131">Zum Lesen von Nachrichten aus einer transaktionalen Systemwarteschlange für unzustellbare Nachrichten muss der URI (Uniform Resource Identifier) folgendes Format aufweisen: net.msmq://localhost/system$;DeadXact.</span><span class="sxs-lookup"><span data-stu-id="cb39c-131">To read messages from a system transactional dead-letter queue, the Uniform Resource Identifier (URI) must be of the form: net.msmq://localhost/system$;DeadXact.</span></span>  
  
- <span data-ttu-id="cb39c-132">Zum Lesen von Nachrichten aus einer nicht transaktionalen Systemwarteschlange für unzustellbare Nachrichten muss der URI folgendes Format aufweisen: net.msmq://localhost/system$;DeadLetter.</span><span class="sxs-lookup"><span data-stu-id="cb39c-132">To read messages from a system non-transactional dead-letter queue, the URI must be of the form: net.msmq://localhost/system$;DeadLetter.</span></span>  
  
- <span data-ttu-id="cb39c-133">Zum Lesen von Nachrichten aus einer benutzerdefinierten Warteschlange für unzustellbare Nachrichten muss der URI folgendes Format aufweisen: net. MSMQ://localhost/private/, \<*custom-dlq-name*> wobei *Custom-dlq-Name* der Name der benutzerdefinierten Warteschlange für unzustellbare Nachrichten ist.</span><span class="sxs-lookup"><span data-stu-id="cb39c-133">To read messages from a custom dead-letter queue, the URI must be of the form:net.msmq://localhost/private/\<*custom-dlq-name*> where *custom-dlq-name* is the name of the custom dead-letter queue.</span></span>  
  
 <span data-ttu-id="cb39c-134">Weitere Informationen zum Adressieren von Warteschlangen finden Sie unter [Dienst Endpunkte und Adressierung von warte](service-endpoints-and-queue-addressing.md)Schlangen.</span><span class="sxs-lookup"><span data-stu-id="cb39c-134">For more information about how to address queues, see [Service Endpoints and Queue Addressing](service-endpoints-and-queue-addressing.md).</span></span>  
  
 <span data-ttu-id="cb39c-135">Der WCF-Stapel auf dem Empfänger stimmt mit den Adressen überein, die der Dienst mit der Adresse der Nachricht überwacht.</span><span class="sxs-lookup"><span data-stu-id="cb39c-135">The WCF stack on the receiver matches addresses that the service is listening on with the address on the message.</span></span> <span data-ttu-id="cb39c-136">Wenn die Adressen übereinstimmen, wird die Nachricht weitergeleitet; stimmen sie nicht überein, wird die Nachricht nicht weitergeleitet.</span><span class="sxs-lookup"><span data-stu-id="cb39c-136">If the addresses match, the message is dispatched; if not, the message is not dispatched.</span></span> <span data-ttu-id="cb39c-137">Dies kann Probleme beim Lesen aus der Warteschlange für unzustellbare Nachrichten verursachen, da die Nachrichten in der Warteschlange in der Regel an den Dienst und nicht an den Dienst der Warteschlange für unzustellbare Nachrichten adressiert sind.</span><span class="sxs-lookup"><span data-stu-id="cb39c-137">This can cause problems when reading from the dead-letter queue, because messages in the dead-letter queue are typically addressed to the service and not the dead-letter queue service.</span></span> <span data-ttu-id="cb39c-138">Daher muss der Dienst, der aus der Warteschlange für unzustellbare Nachrichten liest, einen Adressfilter `ServiceBehavior` installieren, der den Stapel auffordert, alle Nachrichten in der Warteschlange unabhängig vom Adressaten abzugleichen.</span><span class="sxs-lookup"><span data-stu-id="cb39c-138">Therefore, the service reading from the dead-letter queue must install an address filter `ServiceBehavior` that instructs the stack to match all messages in the queue independently of the addressee.</span></span> <span data-ttu-id="cb39c-139">Genau genommen müssen Sie dem Dienst, der die Nachrichten aus der Warteschlange für unzustellbare Nachrichten liest, ein `ServiceBehavior` mit dem Parameter <xref:System.ServiceModel.AddressFilterMode.Any> hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="cb39c-139">Specifically, you must add a `ServiceBehavior` with the <xref:System.ServiceModel.AddressFilterMode.Any> parameter to the service reading messages from the dead-letter queue.</span></span>  
  
## <a name="poison-message-handling-from-the-dead-letter-queue"></a><span data-ttu-id="cb39c-140">Die Handhabung von beschädigten Nachrichten aus der Warteschlange für unzustellbare Nachrichten</span><span class="sxs-lookup"><span data-stu-id="cb39c-140">Poison Message Handling from the Dead-Letter Queue</span></span>  

 <span data-ttu-id="cb39c-141">Die Handhabung beschädigter Nachrichten ist für Warteschlangen für unzustellbare Nachrichten verfügbar. Dabei gelten bestimmte Voraussetzungen.</span><span class="sxs-lookup"><span data-stu-id="cb39c-141">Poison message handling is available on dead-letter queues, with some conditions.</span></span> <span data-ttu-id="cb39c-142">Da beim Lesen aus der Systemwarteschlange für unzustellbare Nachrichten keine untergeordneten Warteschlangen erstellt werden können, kann `ReceiveErrorHandling` nicht auf `Move` festgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="cb39c-142">Because you cannot create sub-queues from system queues, when reading from the system dead-letter queue, the `ReceiveErrorHandling` cannot be set to `Move`.</span></span> <span data-ttu-id="cb39c-143">Beachten Sie, dass Sie beim Lesen aus einer benutzerdefinierten Warteschlange für unzustellbare Nachrichten untergeordnete Warteschlangen nutzen können und dass `Move` daher eine gültige Disposition für die beschädigte Nachricht ist.</span><span class="sxs-lookup"><span data-stu-id="cb39c-143">Note that if you are reading from a custom dead-letter queue, you can have sub-queues and, therefore, `Move` is a valid disposition for the poison message.</span></span>  
  
 <span data-ttu-id="cb39c-144">Wenn `ReceiveErrorHandling` beim Lesen aus der benutzerdefinierten Warteschlange für unzustellbare Nachrichten auf `Reject` eingestellt ist, wird die beschädigte Nachricht in der Systemwarteschlange für unzustellbare Nachrichten platziert.</span><span class="sxs-lookup"><span data-stu-id="cb39c-144">When `ReceiveErrorHandling` is set to `Reject`, when reading from the custom dead letter queue, the poison message is put in the system dead-letter queue.</span></span> <span data-ttu-id="cb39c-145">Beim Lesen aus der Systemwarteschlange für unzustellbare Nachrichten wird die Nachricht abgelegt (gelöscht).</span><span class="sxs-lookup"><span data-stu-id="cb39c-145">If reading from the system dead-letter queue, the message is dropped (purged).</span></span> <span data-ttu-id="cb39c-146">Ein Ausschluss aus einer Systemwarteschlange für unzustellbare Nachrichten in MSMQ legt die Nachricht ab (löscht sie).</span><span class="sxs-lookup"><span data-stu-id="cb39c-146">A reject from a system dead-letter queue in MSMQ drops (purges) the message.</span></span>  
  
## <a name="example"></a><span data-ttu-id="cb39c-147">Beispiel</span><span class="sxs-lookup"><span data-stu-id="cb39c-147">Example</span></span>  

 <span data-ttu-id="cb39c-148">Im folgenden Beispiel wird gezeigt, wie eine Warteschlange für unzustellbare Nachrichten erstellt und für die Verarbeitung abgelaufener Nachrichten verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="cb39c-148">The following example shows how to create a dead-letter queue and how to use it to process expired messages.</span></span> <span data-ttu-id="cb39c-149">Das Beispiel basiert auf dem Beispiel in Vorgehens [Weise: Austauschen von Nachrichten in der Warteschlange mit WCF-Endpunkten](how-to-exchange-queued-messages-with-wcf-endpoints.md).</span><span class="sxs-lookup"><span data-stu-id="cb39c-149">The example is based on the example in [How to: Exchange Queued Messages with WCF Endpoints](how-to-exchange-queued-messages-with-wcf-endpoints.md).</span></span> <span data-ttu-id="cb39c-150">Im folgenden Beispiel wird dargestellt, wie der Clientcode auf den Dienst für die Auftragsverarbeitung geschrieben wird, der für jede Anwendung eine Warteschlange für unzustellbare Nachrichten verwendet.</span><span class="sxs-lookup"><span data-stu-id="cb39c-150">The following example shows how to write the client code to the order processing service that uses a dead-letter queue for each application.</span></span> <span data-ttu-id="cb39c-151">Im Beispiel wird auch gezeigt, wie Nachrichten aus der Warteschlange für unzustellbare Nachrichten verarbeitet werden.</span><span class="sxs-lookup"><span data-stu-id="cb39c-151">The example also shows how to process messages from the dead-letter queue.</span></span>  
  
 <span data-ttu-id="cb39c-152">Der folgende Code ist für einen Client, der eine Warteschlange für unzustellbare Nachrichten für jede Anwendung angibt.</span><span class="sxs-lookup"><span data-stu-id="cb39c-152">The following is code for a client that specifies a dead-letter queue for each application.</span></span>  
  
 [!code-csharp[S_DeadLetter#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/s_deadletter/cs/client.cs#1)]
 [!code-vb[S_DeadLetter#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/s_deadletter/vb/client.vb#1)]  
  
 <span data-ttu-id="cb39c-153">Der folgende Code ist für die Clientkonfigurationsdatei.</span><span class="sxs-lookup"><span data-stu-id="cb39c-153">The following is code for the client configuration file.</span></span>  

 <span data-ttu-id="cb39c-154">Der folgende Code ist für einen Dienst, der Nachrichten aus einer Warteschlange für unzustellbare Nachrichten verarbeitet.</span><span class="sxs-lookup"><span data-stu-id="cb39c-154">The following is code for a service processing messages from a dead-letter queue.</span></span>  
  
 [!code-csharp[S_DeadLetter#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/s_deadletter/cs/dlservice.cs#3)]
 [!code-vb[S_DeadLetter#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/s_deadletter/vb/dlservice.vb#3)]  
  
 <span data-ttu-id="cb39c-155">Der folgende Code ist für die Dienstkonfigurationsdatei für die Warteschlange für unzustellbare Nachrichten.</span><span class="sxs-lookup"><span data-stu-id="cb39c-155">The following is code for the dead-letter queue service configuration file.</span></span>  

## <a name="see-also"></a><span data-ttu-id="cb39c-156">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="cb39c-156">See also</span></span>

- [<span data-ttu-id="cb39c-157">Warteschlangenübersicht</span><span class="sxs-lookup"><span data-stu-id="cb39c-157">Queues Overview</span></span>](queues-overview.md)
- [<span data-ttu-id="cb39c-158">Vorgehensweise: Austauschen von Nachrichten in einer Warteschlange mit WCF-Endpunkten</span><span class="sxs-lookup"><span data-stu-id="cb39c-158">How to: Exchange Queued Messages with WCF Endpoints</span></span>](how-to-exchange-queued-messages-with-wcf-endpoints.md)
- [<span data-ttu-id="cb39c-159">Behandlung nicht verarbeitbarer Nachrichten</span><span class="sxs-lookup"><span data-stu-id="cb39c-159">Poison Message Handling</span></span>](poison-message-handling.md)
