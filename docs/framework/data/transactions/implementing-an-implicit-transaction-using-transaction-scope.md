---
title: Implementieren einer impliziten Transaktion mit Transaktionsbereich
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 49d1706a-1e0c-4c85-9704-75c908372eb9
ms.openlocfilehash: 33b51cf26a35bbdda70582d86db6ac39c22597da
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/12/2020
ms.locfileid: "79174393"
---
# <a name="implementing-an-implicit-transaction-using-transaction-scope"></a><span data-ttu-id="e0c79-102">Implementieren einer impliziten Transaktion mit Transaktionsbereich</span><span class="sxs-lookup"><span data-stu-id="e0c79-102">Implementing an Implicit Transaction using Transaction Scope</span></span>
<span data-ttu-id="e0c79-103">Mit der <xref:System.Transactions.TransactionScope>-Klasse lassen sich Codeblöcke einfach als an einer Transaktion beteiligte Codeblöcke markieren, ohne die Transaktion selbst bearbeiten zu müssen.</span><span class="sxs-lookup"><span data-stu-id="e0c79-103">The <xref:System.Transactions.TransactionScope> class provides a simple way to mark a block of code as participating in a transaction, without requiring you to interact with the transaction itself.</span></span> <span data-ttu-id="e0c79-104">Ein Transaktionsbereich kann die Ambient-Transaktion automatisch auswählen und verwalten.</span><span class="sxs-lookup"><span data-stu-id="e0c79-104">A transaction scope can select and manage the ambient transaction automatically.</span></span> <span data-ttu-id="e0c79-105">Wegen ihrer einfachen Verwendung und Effizienz wird empfohlen, die <xref:System.Transactions.TransactionScope>-Klasse zur Entwicklung von Transaktionsanwendungen zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="e0c79-105">Due to its ease of use and efficiency, it is recommended that you use the <xref:System.Transactions.TransactionScope> class when developing a transaction application.</span></span>  
  
 <span data-ttu-id="e0c79-106">Außerdem müssen Sie keine Ressourcen für die Transaktion explizit eintragen.</span><span class="sxs-lookup"><span data-stu-id="e0c79-106">In addition, you do not need to enlist resources explicitly with the transaction.</span></span> <span data-ttu-id="e0c79-107">Jeder <xref:System.Transactions>-Ressourcen-Manager (z. B. SQL Server 2005) kann das Vorhandensein einer vom Bereich erstellten Ambient-Transaktion erkennen und diese automatisch eintragen.</span><span class="sxs-lookup"><span data-stu-id="e0c79-107">Any <xref:System.Transactions> resource manager (such as SQL Server 2005) can detect the existence of an ambient transaction created by the scope and automatically enlist.</span></span>  
  
## <a name="creating-a-transaction-scope"></a><span data-ttu-id="e0c79-108">Erstellen eines Transaktionsbereichs</span><span class="sxs-lookup"><span data-stu-id="e0c79-108">Creating a transaction scope</span></span>  
 <span data-ttu-id="e0c79-109">Es folgt ein Beispiel für die einfache Verwendung der <xref:System.Transactions.TransactionScope>-Klasse.</span><span class="sxs-lookup"><span data-stu-id="e0c79-109">The following sample shows a simple usage of the <xref:System.Transactions.TransactionScope> class.</span></span>  
  
 [!code-csharp[TransactionScope#1](../../../../samples/snippets/csharp/VS_Snippets_Remoting/TransactionScope/cs/ScopeWithSQL.cs#1)]
 [!code-vb[TransactionScope#1](../../../../samples/snippets/visualbasic/VS_Snippets_Remoting/TransactionScope/vb/ScopeWithSQL.vb#1)]  
  
 <span data-ttu-id="e0c79-110">Der Transaktionsbereich wird begonnen, sobald ein neues <xref:System.Transactions.TransactionScope>-Objekt erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="e0c79-110">The transaction scope is started once you create a new <xref:System.Transactions.TransactionScope> object.</span></span>  <span data-ttu-id="e0c79-111">Wie im Codebeispiel dargestellt, wird empfohlen, Bereiche `using` mit einer Anweisung zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="e0c79-111">As illustrated in the code sample, it is recommended that you create scopes with a `using` statement.</span></span> <span data-ttu-id="e0c79-112">Die `using` Anweisung ist sowohl in C- als auch `try`in Visual Basic verfügbar und funktioniert wie ein ... `finally` um sicherzustellen, dass der Umfang ordnungsgemäß entsorgt wird.</span><span class="sxs-lookup"><span data-stu-id="e0c79-112">The `using` statement is available both in C# and in Visual Basic, and works like a `try`...`finally` block to ensure that the scope is disposed of properly.</span></span>  
  
 <span data-ttu-id="e0c79-113">Beim Instanziieren von <xref:System.Transactions.TransactionScope> bestimmt der Transaktions-Manager, an welcher Transaktion der Bereich beteiligt sein soll.</span><span class="sxs-lookup"><span data-stu-id="e0c79-113">When you instantiate <xref:System.Transactions.TransactionScope>, the transaction manager determines which transaction to participate in.</span></span> <span data-ttu-id="e0c79-114">Sobald er festgelegt wurde, ist der Bereich immer an dieser Transaktion beteiligt.</span><span class="sxs-lookup"><span data-stu-id="e0c79-114">Once determined, the scope always participates in that transaction.</span></span> <span data-ttu-id="e0c79-115">Die Entscheidung hängt von zwei Faktoren ab: vom Vorhandensein einer umgebenden Transaktion und vom Wert des `TransactionScopeOption`-Parameters im Konstruktor.</span><span class="sxs-lookup"><span data-stu-id="e0c79-115">The decision is based on two factors: whether an ambient transaction is present and the value of the `TransactionScopeOption` parameter in the constructor.</span></span> <span data-ttu-id="e0c79-116">Die Ambient-Transaktion ist die Transaktion, in der der Code ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="e0c79-116">The ambient transaction is the transaction within which your code executes.</span></span> <span data-ttu-id="e0c79-117">Ein Verweis auf die Ambient-Transaktion kann durch einen Aufruf der statischen <xref:System.Transactions.Transaction.Current%2A?displayProperty=nameWithType>-Eigenschaft der <xref:System.Transactions.Transaction>-Klasse abgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="e0c79-117">You can obtain a reference to the ambient transaction by calling the static <xref:System.Transactions.Transaction.Current%2A?displayProperty=nameWithType> property of the <xref:System.Transactions.Transaction> class.</span></span> <span data-ttu-id="e0c79-118">Weitere Informationen zur Verwendung dieses Parameters finden Sie im Abschnitt Verwalten des Transaktionsflusses mithilfe von [TransactionScopeOption](#ManageTxFlow) in diesem Thema.</span><span class="sxs-lookup"><span data-stu-id="e0c79-118">For more information on how this parameter is used, see the [Managing transaction flow using TransactionScopeOption](#ManageTxFlow) section of this topic.</span></span>  
  
## <a name="completing-a-transaction-scope"></a><span data-ttu-id="e0c79-119">Vervollständigen eines Transaktionsbereichs</span><span class="sxs-lookup"><span data-stu-id="e0c79-119">Completing a transaction scope</span></span>  
 <span data-ttu-id="e0c79-120">Nachdem die Anwendung alle in einer Transaktion auszuführenden Arbeiten abgeschlossen hat, sollten Sie die <xref:System.Transactions.TransactionScope.Complete%2A?displayProperty=nameWIthType>-Methode nur einmal aufrufen, um den Transaktions-Manager darüber zu benachrichtigen, dass für die Transaktion ein Commit ausgeführt werden kann.</span><span class="sxs-lookup"><span data-stu-id="e0c79-120">When your application completes all the work it wants to perform in a transaction, you should call the <xref:System.Transactions.TransactionScope.Complete%2A?displayProperty=nameWIthType> method only once to inform the transaction manager that it is acceptable to commit the transaction.</span></span> <span data-ttu-id="e0c79-121">Es ist sehr gut, den <xref:System.Transactions.TransactionScope.Complete%2A> Aufruf als letzte `using` Aussage im Block zu setzen.</span><span class="sxs-lookup"><span data-stu-id="e0c79-121">It is very good practice to put the call to <xref:System.Transactions.TransactionScope.Complete%2A> as the last statement in the `using` block.</span></span>  
  
 <span data-ttu-id="e0c79-122">Wenn diese Methode nicht aufruft wird, wird die Transaktion abgebrochen, da der Transaktions-Manager dies als Systemfehler oder als äquivalent zu einer Ausnahme interpretiert, die im Rahmen der Transaktion ausgelöst wird.</span><span class="sxs-lookup"><span data-stu-id="e0c79-122">Failing to call this method aborts the transaction, because the transaction manager interprets this as a system failure, or equivalent to an exception thrown within the scope of the transaction.</span></span> <span data-ttu-id="e0c79-123">Ein Aufruf dieser Methode garantiert aber nicht, dass ein Commit für die Transaktion ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="e0c79-123">However, calling this method does not guarantee that the transaction wil be committed.</span></span> <span data-ttu-id="e0c79-124">Dies ist nur eine Möglichkeit, den Transaktions-Manager über den Status zu informieren.</span><span class="sxs-lookup"><span data-stu-id="e0c79-124">It is merely a way of informing the transaction manager of your status.</span></span> <span data-ttu-id="e0c79-125">Nach dem Aufruf der <xref:System.Transactions.TransactionScope.Complete%2A>-Methode können Sie nicht mehr über die <xref:System.Transactions.Transaction.Current%2A>-Eigenschaft auf die Ambient-Transaktion zugreifen. Wenn Sie dies dennoch versuchen, wird eine Ausnahme ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="e0c79-125">After calling the <xref:System.Transactions.TransactionScope.Complete%2A> method, you can no longer access the ambient transaction by using the <xref:System.Transactions.Transaction.Current%2A> property, and attempting to do so will result in an exception being thrown.</span></span>  
  
 <span data-ttu-id="e0c79-126">Wenn <xref:System.Transactions.TransactionScope> das Objekt die Buchung ursprünglich erstellt hat, erfolgt die eigentliche Arbeit beim Übertragen `using` der Buchung durch den Transaktions-Manager nach der letzten Codezeile im Block.</span><span class="sxs-lookup"><span data-stu-id="e0c79-126">If the <xref:System.Transactions.TransactionScope> object created the transaction initially, the actual work of committing the transaction by the transaction manager occurs after the last line of code in the `using` block.</span></span> <span data-ttu-id="e0c79-127">Wenn die Transaktion nicht erstellt wurde, wird der Commit ausgeführt, wenn <xref:System.Transactions.CommittableTransaction.Commit%2A> vom Besitzer des <xref:System.Transactions.CommittableTransaction>-Objekts aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="e0c79-127">If it did not create the transaction, the commit occurs whenever <xref:System.Transactions.CommittableTransaction.Commit%2A> is called by the owner of the <xref:System.Transactions.CommittableTransaction> object.</span></span> <span data-ttu-id="e0c79-128">Zu diesem Zeitpunkt ruft der Transaktions-Manager die Ressourcen-Manager auf und informiert <xref:System.Transactions.TransactionScope.Complete%2A> sie zum <xref:System.Transactions.TransactionScope> Commit oder Rollback, je nach dem, ob die Methode für das Objekt aufgerufen wurde.</span><span class="sxs-lookup"><span data-stu-id="e0c79-128">At that point the transaction manager calls the resource managers and informs them to either commit or rollback, based on whether the <xref:System.Transactions.TransactionScope.Complete%2A> method was called on the <xref:System.Transactions.TransactionScope> object.</span></span>  
  
 <span data-ttu-id="e0c79-129">Die `using` Anweisung stellt <xref:System.Transactions.TransactionScope.Dispose%2A> sicher, <xref:System.Transactions.TransactionScope> dass die Methode des Objekts auch dann aufgerufen wird, wenn eine Ausnahme auftritt.</span><span class="sxs-lookup"><span data-stu-id="e0c79-129">The `using` statement ensures that the <xref:System.Transactions.TransactionScope.Dispose%2A> method of the <xref:System.Transactions.TransactionScope> object is called even if an exception occurs.</span></span> <span data-ttu-id="e0c79-130">Der Aufruf der <xref:System.Transactions.TransactionScope.Dispose%2A>-Methode kennzeichnet das Ende des Transaktionsbereichs.</span><span class="sxs-lookup"><span data-stu-id="e0c79-130">The <xref:System.Transactions.TransactionScope.Dispose%2A> method marks the end of the transaction scope.</span></span> <span data-ttu-id="e0c79-131">Ausnahmen, die nach dem Aufrufen dieser Methode eintreten, beeinflussen die Transaktion möglicherweise nicht.</span><span class="sxs-lookup"><span data-stu-id="e0c79-131">Exceptions that occur after calling this method may not affect the transaction.</span></span> <span data-ttu-id="e0c79-132">Diese Methode stellt auch den vorherigen Zustand der Ambient-Transaktion wieder her.</span><span class="sxs-lookup"><span data-stu-id="e0c79-132">This method also restores the ambient transaction to it previous state.</span></span>  
  
 <span data-ttu-id="e0c79-133">Eine <xref:System.Transactions.TransactionAbortedException> wird ausgelöst, wenn eine vom Transaktionsbereich erstellte Transaktion abgebrochen wird.</span><span class="sxs-lookup"><span data-stu-id="e0c79-133">A <xref:System.Transactions.TransactionAbortedException> is thrown if the scope creates the transaction, and the transaction is aborted.</span></span> <span data-ttu-id="e0c79-134">Eine <xref:System.Transactions.TransactionInDoubtException> wird ausgelöst, wenn der Transaktions-Manager nicht entscheiden kann, ob ein Commit ausgeführt werden soll.</span><span class="sxs-lookup"><span data-stu-id="e0c79-134">A <xref:System.Transactions.TransactionInDoubtException> is thrown if the transaction manager cannot reach a Commit decision.</span></span> <span data-ttu-id="e0c79-135">Wenn ein Commit für die Transaktion ausgeführt wird, wird keine Ausnahme ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="e0c79-135">No exception is thrown if the transaction is committed.</span></span>  
  
## <a name="rolling-back-a-transaction"></a><span data-ttu-id="e0c79-136">Ausführen eines Rollbacks für eine Transaktion</span><span class="sxs-lookup"><span data-stu-id="e0c79-136">Rolling back a transaction</span></span>  
 <span data-ttu-id="e0c79-137">Wenn ein Rollback für eine Transaktion ausgeführt werden soll, dürfen Sie die <xref:System.Transactions.TransactionScope.Complete%2A>-Methode nicht im Transaktionsbereich aufrufen.</span><span class="sxs-lookup"><span data-stu-id="e0c79-137">If you want to rollback a transaction, you should not call the <xref:System.Transactions.TransactionScope.Complete%2A> method within the transaction scope.</span></span> <span data-ttu-id="e0c79-138">Zum Beispiel können Sie eine Ausnahme im Bereich auslösen.</span><span class="sxs-lookup"><span data-stu-id="e0c79-138">For example, you can throw an exception within the scope.</span></span> <span data-ttu-id="e0c79-139">Der Rollback wird für die Transaktion ausgeführt, die im Bereich liegt.</span><span class="sxs-lookup"><span data-stu-id="e0c79-139">The transaction in which it participates in will be rolled back.</span></span>  
  
## <a name="managing-transaction-flow-using-transactionscopeoption"></a><a name="ManageTxFlow"></a><span data-ttu-id="e0c79-140">Verwalten des Transaktionsflusses mit TransactionScopeOption</span><span class="sxs-lookup"><span data-stu-id="e0c79-140">Managing transaction flow using TransactionScopeOption</span></span>  
 <span data-ttu-id="e0c79-141">Transaktionsbereiche können geschachtelt werden, indem eine Methode aufgerufen wird, die ein <xref:System.Transactions.TransactionScope>-Objekt innerhalb einer Methode verwendet, die ihren eigenen Bereich verwendet. Die `RootMethod`-Methode im folgenden Beispiel veranschaulicht dies.</span><span class="sxs-lookup"><span data-stu-id="e0c79-141">Transaction scope can be nested by calling a method that uses a <xref:System.Transactions.TransactionScope> from within a method that uses its own scope, as is the case with the `RootMethod` method in the following example,</span></span>  
  
```csharp  
void RootMethod()
{
    using(TransactionScope scope = new TransactionScope())
    {
        /* Perform transactional work here */
        SomeMethod();
        scope.Complete();
    }
}

void SomeMethod()
{
    using(TransactionScope scope = new TransactionScope())
    {
        /* Perform transactional work here */
        scope.Complete();
    }
}
```  
  
 <span data-ttu-id="e0c79-142">Der oberste Transaktionsbereich wird als Stammbereich bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="e0c79-142">The top-most transaction scope is referred to as the root scope.</span></span>  
  
 <span data-ttu-id="e0c79-143">Die <xref:System.Transactions.TransactionScope>-Klasse enthält einige überladene Konstruktoren, die eine Enumeration vom Typ <xref:System.Transactions.TransactionScopeOption> akzeptieren, die das Transaktionsverhalten des Bereichs definiert.</span><span class="sxs-lookup"><span data-stu-id="e0c79-143">The <xref:System.Transactions.TransactionScope> class provides several overloaded constructors that accept an enumeration of the type <xref:System.Transactions.TransactionScopeOption>, which defines the transactional behavior of the scope.</span></span>  
  
 <span data-ttu-id="e0c79-144">Ein <xref:System.Transactions.TransactionScope>-Objekt verfügt über drei Optionen:</span><span class="sxs-lookup"><span data-stu-id="e0c79-144">A <xref:System.Transactions.TransactionScope> object has three options:</span></span>  
  
- <span data-ttu-id="e0c79-145">Verknüpfen der Ambient-Transaktion oder Erstellen einer neuen Transaktion, wenn keine vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="e0c79-145">Join the ambient transaction, or create a new one if one does not exist.</span></span>  
  
- <span data-ttu-id="e0c79-146">Definieren eines neuen Stammbereichs, d. h. Starten einer neuen Transaktion und Festlegen dieser Transaktion als neue Ambient-Transaktion in ihrem eigenem Bereich.</span><span class="sxs-lookup"><span data-stu-id="e0c79-146">Be a new root scope, that is, start a new transaction and have that transaction be the new ambient transaction inside its own scope.</span></span>  
  
- <span data-ttu-id="e0c79-147">Nicht teilnehmen an einer Transaktion.</span><span class="sxs-lookup"><span data-stu-id="e0c79-147">Not take part in a transaction at all.</span></span> <span data-ttu-id="e0c79-148">Daraus resultiert keine Ambient-Transaktion.</span><span class="sxs-lookup"><span data-stu-id="e0c79-148">There is no ambient transaction as a result.</span></span>  
  
 <span data-ttu-id="e0c79-149">Wenn der Bereich mit <xref:System.Transactions.TransactionScopeOption.Required> instanziiert wird und eine Ambient-Transaktion vorhanden ist, erstellt der Bereich eine Verknüpfung mit dieser Transaktion.</span><span class="sxs-lookup"><span data-stu-id="e0c79-149">If the scope is instantiated with <xref:System.Transactions.TransactionScopeOption.Required>, and an ambient transaction is present, the scope joins that transaction.</span></span> <span data-ttu-id="e0c79-150">Ist keine Ambient-Transaktion vorhanden, erstellt der Bereich eine neue Transaktion und wird zum Stammbereich.</span><span class="sxs-lookup"><span data-stu-id="e0c79-150">If, on the other hand, there is no ambient transaction, then the scope creates a new transaction, and become the root scope.</span></span> <span data-ttu-id="e0c79-151">Dies ist der Standardwert.</span><span class="sxs-lookup"><span data-stu-id="e0c79-151">This is the default value.</span></span> <span data-ttu-id="e0c79-152">Wenn <xref:System.Transactions.TransactionScopeOption.Required> verwendet wird, muss der Code innerhalb des Bereichs kein anderes Verhalten zeigen, gleichgültig, ob es sich um den Stammbereich oder nur um eine Verknüpfung mit der Ambient-Transaktion handelt.</span><span class="sxs-lookup"><span data-stu-id="e0c79-152">When <xref:System.Transactions.TransactionScopeOption.Required> is used, the code inside the scope does not need to behave differently whether it is the root or just joining the ambient transaction.</span></span> <span data-ttu-id="e0c79-153">Er sollte in beiden Fällen das Gleiche ausführen.</span><span class="sxs-lookup"><span data-stu-id="e0c79-153">It should operate identically in both cases.</span></span>  
  
 <span data-ttu-id="e0c79-154">Wenn der Bereich mit <xref:System.Transactions.TransactionScopeOption.RequiresNew> instanziiert wird, ist er immer der Stammbereich.</span><span class="sxs-lookup"><span data-stu-id="e0c79-154">If the scope is instantiated with <xref:System.Transactions.TransactionScopeOption.RequiresNew>, it is always the root scope.</span></span> <span data-ttu-id="e0c79-155">Er startet eine neue Transaktion, und seine Transaktion wird zur neuen Ambient-Transaktion im Bereich.</span><span class="sxs-lookup"><span data-stu-id="e0c79-155">It starts a new transaction, and its transaction becomes the new ambient transaction inside the scope.</span></span>  
  
 <span data-ttu-id="e0c79-156">Wird der Bereich mit <xref:System.Transactions.TransactionScopeOption.Suppress> instanziiert, dann ist er nie an einer Transaktion beteiligt, unabhängig davon, ob eine Ambient-Transaktion vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="e0c79-156">If the scope is instantiated with <xref:System.Transactions.TransactionScopeOption.Suppress>, it never takes part in a transaction, regardless of whether an ambient transaction is present.</span></span> <span data-ttu-id="e0c79-157">Ein Bereich, der mit diesem `null` Wert instanziiert wird, hat immer die Umgebungstransaktion.</span><span class="sxs-lookup"><span data-stu-id="e0c79-157">A scope instantiated with this value always have `null` as its ambient transaction.</span></span>  
  
 <span data-ttu-id="e0c79-158">Die obigen Optionen sind in der folgenden Tabelle zusammengefasst.</span><span class="sxs-lookup"><span data-stu-id="e0c79-158">The above options are summarized in the following table.</span></span>  
  
|<span data-ttu-id="e0c79-159">TransactionScopeOption</span><span class="sxs-lookup"><span data-stu-id="e0c79-159">TransactionScopeOption</span></span>|<span data-ttu-id="e0c79-160">Ambient-Transaktion</span><span class="sxs-lookup"><span data-stu-id="e0c79-160">Ambient Transaction</span></span>|<span data-ttu-id="e0c79-161">Der Bereich ist beteiligt an</span><span class="sxs-lookup"><span data-stu-id="e0c79-161">The scope takes part in</span></span>|  
|----------------------------|-------------------------|-----------------------------|  
|<span data-ttu-id="e0c79-162">Erforderlich</span><span class="sxs-lookup"><span data-stu-id="e0c79-162">Required</span></span>|<span data-ttu-id="e0c79-163">Nein </span><span class="sxs-lookup"><span data-stu-id="e0c79-163">No</span></span>|<span data-ttu-id="e0c79-164">Neue Transaktion (wird zum Stamm)</span><span class="sxs-lookup"><span data-stu-id="e0c79-164">New Transaction (will be the root)</span></span>|  
|<span data-ttu-id="e0c79-165">Requires New</span><span class="sxs-lookup"><span data-stu-id="e0c79-165">Requires New</span></span>|<span data-ttu-id="e0c79-166">Nein </span><span class="sxs-lookup"><span data-stu-id="e0c79-166">No</span></span>|<span data-ttu-id="e0c79-167">Neue Transaktion (wird zum Stamm)</span><span class="sxs-lookup"><span data-stu-id="e0c79-167">New Transaction (will be the root)</span></span>|  
|<span data-ttu-id="e0c79-168">Suppress</span><span class="sxs-lookup"><span data-stu-id="e0c79-168">Suppress</span></span>|<span data-ttu-id="e0c79-169">Nein </span><span class="sxs-lookup"><span data-stu-id="e0c79-169">No</span></span>|<span data-ttu-id="e0c79-170">Keine Transaktion</span><span class="sxs-lookup"><span data-stu-id="e0c79-170">No Transaction</span></span>|  
|<span data-ttu-id="e0c79-171">Erforderlich</span><span class="sxs-lookup"><span data-stu-id="e0c79-171">Required</span></span>|<span data-ttu-id="e0c79-172">Ja</span><span class="sxs-lookup"><span data-stu-id="e0c79-172">Yes</span></span>|<span data-ttu-id="e0c79-173">Ambient-Transaktion</span><span class="sxs-lookup"><span data-stu-id="e0c79-173">Ambient  Transaction</span></span>|  
|<span data-ttu-id="e0c79-174">Requires New</span><span class="sxs-lookup"><span data-stu-id="e0c79-174">Requires New</span></span>|<span data-ttu-id="e0c79-175">Ja</span><span class="sxs-lookup"><span data-stu-id="e0c79-175">Yes</span></span>|<span data-ttu-id="e0c79-176">Neue Transaktion (wird zum Stamm)</span><span class="sxs-lookup"><span data-stu-id="e0c79-176">New Transaction (will be the root)</span></span>|  
|<span data-ttu-id="e0c79-177">Suppress</span><span class="sxs-lookup"><span data-stu-id="e0c79-177">Suppress</span></span>|<span data-ttu-id="e0c79-178">Ja</span><span class="sxs-lookup"><span data-stu-id="e0c79-178">Yes</span></span>|<span data-ttu-id="e0c79-179">Keine Transaktion</span><span class="sxs-lookup"><span data-stu-id="e0c79-179">No Transaction</span></span>|  
  
 <span data-ttu-id="e0c79-180">Wenn ein <xref:System.Transactions.TransactionScope>-Objekt eine Verknüpfung mit einer vorhandenen Ambient-Transaktion erstellt, wird die Transaktion unter Umständen nur dann durch die Freigabe des Bereichsobjekts beendet, wenn der Bereich die Transaktion abbricht.</span><span class="sxs-lookup"><span data-stu-id="e0c79-180">When a <xref:System.Transactions.TransactionScope> object joins an existing ambient transaction, disposing of the scope object may not end the transaction, unless the scope aborts the transaction.</span></span> <span data-ttu-id="e0c79-181">Wenn die Ambient-Transaktion vom Stammbereich erstellt wurde, wird die <xref:System.Transactions.CommittableTransaction.Commit%2A>-Methode nur dann für die Transaktion aufgerufen, wenn der Stammbereich gelöscht wird.</span><span class="sxs-lookup"><span data-stu-id="e0c79-181">If the ambient transaction was created by a root scope, only when the root scope is disposed of, does <xref:System.Transactions.CommittableTransaction.Commit%2A> get called on the transaction.</span></span> <span data-ttu-id="e0c79-182">Wurde die Transaktion manuell erstellt, dann endet die Transaktion, wenn sie abgebrochen oder von ihrem Ersteller die Commit-Methode aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="e0c79-182">If the transaction was created manually, the transaction ends when it is either aborted, or committed by its creator.</span></span>  
  
 <span data-ttu-id="e0c79-183">Im folgenden Beispiel werden mit einem <xref:System.Transactions.TransactionScope>-Objekt drei verschachtelte Bereichsobjekte erstellt, die jeweils mit einem anderen <xref:System.Transactions.TransactionScopeOption>-Wert instanziiert werden.</span><span class="sxs-lookup"><span data-stu-id="e0c79-183">The following example shows a <xref:System.Transactions.TransactionScope> object that creates three nested scope objects, each instantiated with a different <xref:System.Transactions.TransactionScopeOption> value.</span></span>  
  
```csharp  
using(TransactionScope scope1 = new TransactionScope())
//Default is Required
{
    using(TransactionScope scope2 = new TransactionScope(TransactionScopeOption.Required))
    {
        //...
    }

    using(TransactionScope scope3 = new TransactionScope(TransactionScopeOption.RequiresNew))
    {
        //...  
    }
  
    using(TransactionScope scope4 = new TransactionScope(TransactionScopeOption.Suppress))
    {
        //...  
    }
}
```  
  
 <span data-ttu-id="e0c79-184">Im Beispiel wird ein Codeblock ohne Ambient-Transaktion gezeigt, in dem ein neuer Bereich (`scope1`) mit <xref:System.Transactions.TransactionScopeOption.Required> erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="e0c79-184">The example shows a code block without any ambient transaction creating a new scope (`scope1`) with <xref:System.Transactions.TransactionScopeOption.Required>.</span></span> <span data-ttu-id="e0c79-185">Der Bereich `scope1` ist ein Stammbereich, da er eine neue Transaktion (Transaction A) erstellt und Transaction A als Ambient-Transaktion definiert.</span><span class="sxs-lookup"><span data-stu-id="e0c79-185">The scope `scope1` is a root scope as it creates a new transaction (Transaction A) and makes Transaction A the ambient transaction.</span></span> <span data-ttu-id="e0c79-186">`Scope1`erstellt dann drei weitere Objekte <xref:System.Transactions.TransactionScopeOption> mit jeweils einem anderen Wert.</span><span class="sxs-lookup"><span data-stu-id="e0c79-186">`Scope1` then creates three more objects, each with a different <xref:System.Transactions.TransactionScopeOption> value.</span></span> <span data-ttu-id="e0c79-187">Beispielsweise wird `scope2` mit <xref:System.Transactions.TransactionScopeOption.Required> erstellt, und da eine Ambient-Transaktion vorhanden ist, wird eine Verknüpfung mit der ersten von `scope1` erstellten Transaktion erstellt.</span><span class="sxs-lookup"><span data-stu-id="e0c79-187">For example, `scope2` is created with <xref:System.Transactions.TransactionScopeOption.Required>, and since there is an ambient transaction, it joins the first transaction created by `scope1`.</span></span> <span data-ttu-id="e0c79-188">Beachten Sie, dass `scope3` der Stammbereich der neuen Transaktion ist, und dass `scope4` keine Ambient-Transaktion enthält.</span><span class="sxs-lookup"><span data-stu-id="e0c79-188">Note that `scope3` is the root scope of a new transaction, and that `scope4` has no ambient transaction.</span></span>  
  
 <span data-ttu-id="e0c79-189">Der am häufigsten verwendete Wert und Standardwert von <xref:System.Transactions.TransactionScopeOption> lautet zwar <xref:System.Transactions.TransactionScopeOption.Required>, aber auch die anderen Werte erfüllen jeweils einen bestimmten Zweck.</span><span class="sxs-lookup"><span data-stu-id="e0c79-189">Although the default and most commonly used value of <xref:System.Transactions.TransactionScopeOption> is <xref:System.Transactions.TransactionScopeOption.Required>, each of the other values has its unique purpose.</span></span>  

### <a name="non-transactional-code-inside-a-transaction-scope"></a><span data-ttu-id="e0c79-190">Nicht transaktionaler Code innerhalb eines Transaktionsbereichs</span><span class="sxs-lookup"><span data-stu-id="e0c79-190">Non-transactional code inside a transaction scope</span></span>

 <span data-ttu-id="e0c79-191"><xref:System.Transactions.TransactionScopeOption.Suppress>ist nützlich, wenn Sie die vom Codeabschnitt ausgeführten Vorgänge beibehalten und die Umgebungstransaktion nicht abbrechen möchten, wenn die Vorgänge fehlschlagen.</span><span class="sxs-lookup"><span data-stu-id="e0c79-191"><xref:System.Transactions.TransactionScopeOption.Suppress> is useful when you want to preserve the operations performed by the code section, and do not want to abort the ambient transaction if the operations fail.</span></span> <span data-ttu-id="e0c79-192">Wenn beispielsweise Aktivitäten protokolliert oder Überwachungsoperationen ausgeführt werden sollen oder wenn Ereignisse für Abonnenten veröffentlicht werden sollen, unabhängig davon, ob die Ambient-Transaktion abgeschlossen oder abgebrochen wird.</span><span class="sxs-lookup"><span data-stu-id="e0c79-192">For example, when you want to perform logging or audit operations, or when you want to publish events to subscribers regardless of whether your ambient transaction commits or aborts.</span></span> <span data-ttu-id="e0c79-193">Dieser Wert ermöglicht es, wie im folgenden Beispiel gezeigt, in einen Transaktionsbereich einen von der Transaktion unabhängigen Codeabschnitt einzufügen.</span><span class="sxs-lookup"><span data-stu-id="e0c79-193">This value allows you to have a non-transactional code section inside a transaction scope, as shown in the following example.</span></span>  
  
```csharp  
using(TransactionScope scope1 = new TransactionScope())
{
    try
    {
        //Start of non-transactional section
        using(TransactionScope scope2 = new
            TransactionScope(TransactionScopeOption.Suppress))  
        {  
            //Do non-transactional work here  
        }  
        //Restores ambient transaction here
   }
   catch {}  
   //Rest of scope1
}
```  
  
### <a name="voting-inside-a-nested-scope"></a><span data-ttu-id="e0c79-194">Abstimmen in einem geschachtelten Bereich</span><span class="sxs-lookup"><span data-stu-id="e0c79-194">Voting inside a nested scope</span></span>  
 <span data-ttu-id="e0c79-195">Obwohl ein verschachtelter Bereich eine Verknüpfung mit der Ambient-Transaktion des Stammbereichs erstellen kann, wirkt sich ein Aufruf von <xref:System.Transactions.TransactionScope.Complete%2A> im verschachtelten Bereich nicht auf den Stammbereich aus.</span><span class="sxs-lookup"><span data-stu-id="e0c79-195">Although a nested scope can join the ambient transaction of the root scope, calling <xref:System.Transactions.TransactionScope.Complete%2A> in the nested scope has no affect on the root scope.</span></span> <span data-ttu-id="e0c79-196">Nur wenn alle Bereiche vom Stammbereich bis zum letzten verschachtelten Bereich dafür stimmen, dass ein Commit für eine Transaktion ausgeführt wird, wird die Transaktion abgeschlossen.</span><span class="sxs-lookup"><span data-stu-id="e0c79-196">Only if all the scopes from the root scope down to the last nested scope vote to commit the transaction, will the transaction be committed.</span></span> <span data-ttu-id="e0c79-197">Wenn <xref:System.Transactions.TransactionScope.Complete%2A> nicht in einem geschachtelten Bereich aufgerufen wird, wirkt sich dies auf den Stammbereich aus, da die Ambient-Transaktion sofort abgebrochen wird.</span><span class="sxs-lookup"><span data-stu-id="e0c79-197">Not calling <xref:System.Transactions.TransactionScope.Complete%2A> in a nested scope will affect the root scope as the ambient transaction will immediately be aborted.</span></span>  
  
## <a name="setting-the-transactionscope-timeout"></a><span data-ttu-id="e0c79-198">Festlegen des TransactionScope-Timeouts</span><span class="sxs-lookup"><span data-stu-id="e0c79-198">Setting the TransactionScope timeout</span></span>  
 <span data-ttu-id="e0c79-199">Einige der überladenen Konstruktoren von <xref:System.Transactions.TransactionScope> akzeptieren einen Wert vom Typ <xref:System.TimeSpan>, der zur Steuerung des Timeouts einer Transaktion dient.</span><span class="sxs-lookup"><span data-stu-id="e0c79-199">Some of the overloaded constructors of <xref:System.Transactions.TransactionScope> accept a value of type <xref:System.TimeSpan>, which is used to control the timeout of the transaction.</span></span> <span data-ttu-id="e0c79-200">Ein Timeout mit dem Wert Null (0) steht für ein unendliches Timeout.</span><span class="sxs-lookup"><span data-stu-id="e0c79-200">A timeout set to zero means an infinite timeout.</span></span> <span data-ttu-id="e0c79-201">Ein unendliches Timeout ist vor allem beim Debuggen hilfreich, wenn ein Problem in der Geschäftslogik durch das schrittweise Ausführen des Codes eingegrenzt werden soll, und wenn während der Suche nach der Problemursache bei der Transaktion, die untersucht wird, kein Timeout auftreten soll.</span><span class="sxs-lookup"><span data-stu-id="e0c79-201">Infinite timeout is useful mostly for debugging, when you want to isolate a problem in your business logic by stepping through your code, and you do not want the transaction you debug to time out while you attempt to locate the problem.</span></span> <span data-ttu-id="e0c79-202">Verwenden Sie den unendlichen Timeoutwert in allen anderen Fällen mit äußerster Vorsicht, weil dadurch die Sicherungsmechanismen gegen Transaktions-Deadlocks außer Kraft gesetzt werden.</span><span class="sxs-lookup"><span data-stu-id="e0c79-202">Be extremely careful using the infinite timeout value in all other cases, because it overrides the safeguards against transaction deadlocks.</span></span>  
  
 <span data-ttu-id="e0c79-203">Sie legen den <xref:System.Transactions.TransactionScope>-Timeout i.&#160;d.&#160;R. in zwei Fällen auf einen anderen Wert als den Standardwert fest.</span><span class="sxs-lookup"><span data-stu-id="e0c79-203">You typically set the <xref:System.Transactions.TransactionScope> timeout to values other than default in two cases.</span></span> <span data-ttu-id="e0c79-204">Erstens während der Entwicklung, wenn Sie testen möchten, wie eine Anwendung mit abgebrochenen Transaktionen umgeht.</span><span class="sxs-lookup"><span data-stu-id="e0c79-204">The first is during development, when you want to test the way your application handles aborted transactions.</span></span> <span data-ttu-id="e0c79-205">Wenn Sie für den Timeout einen kleinen Wert (z.&#160;B. eine Millisekunde) angeben, kann dies zum Fehlschlagen der Transaktion führen, und Sie können folglich den Fehlerbehandlungscode überprüfen.</span><span class="sxs-lookup"><span data-stu-id="e0c79-205">By setting the timeout to a small value (such as one millisecond), you cause your transaction to fail and can thus observe your error handling code.</span></span> <span data-ttu-id="e0c79-206">Zweitens wählen Sie einen kleineren Wert als den Standardtimeoutwert, wenn Sie annehmen, dass der Bereich zu einem Ressourcenkonflikt beiträgt, der zu Deadlocks führt.</span><span class="sxs-lookup"><span data-stu-id="e0c79-206">The second case in which you set the value to be less than the default timeout is when you believe that the scope is involved in resource contention, resulting in deadlocks.</span></span> <span data-ttu-id="e0c79-207">In diesem Fall soll die Transaktion so bald wie möglich abgebrochen werden und nicht auf den Ablauf des Standardtimeouts warten.</span><span class="sxs-lookup"><span data-stu-id="e0c79-207">In that case, you want to abort the transaction as soon as possible and not wait for the default timeout to expire.</span></span>  
  
 <span data-ttu-id="e0c79-208">Wenn in einem Bereich eine Verknüpfung mit einer Ambient-Transaktion hergestellt wird, aber ein kleinerer Timeoutwert als der für die Ambient-Transaktion definierte Wert angegeben wird, dann wird der neue kürzere Timeoutwert für das <xref:System.Transactions.TransactionScope>-Objekt übernommen. Wird der Bereich hier nicht innerhalb der in der Ambient-Transaktion angegebenen Zeitspanne beendet, wird die Transaktion automatisch beendet.</span><span class="sxs-lookup"><span data-stu-id="e0c79-208">When a scope joins an ambient transaction but specifies a smaller timeout than the one the ambient transaction is set to, the new, shorter timeout is enforced on the <xref:System.Transactions.TransactionScope> object, and the scope must end within the nested time specified, or the transaction is automatically aborted.</span></span> <span data-ttu-id="e0c79-209">Wenn der Timeoutwert des geschachtelten Bereichs größer ist als der der Ambient-Transaktion, hat er keine Auswirkungen.</span><span class="sxs-lookup"><span data-stu-id="e0c79-209">If the nested scope's timeout is more than that of the ambient transaction, it has no effect.</span></span>  
  
## <a name="setting-the-transactionscope-isolation-level"></a><span data-ttu-id="e0c79-210">Festlegen der TransactionScope-Isolationsstufe</span><span class="sxs-lookup"><span data-stu-id="e0c79-210">Setting the TransactionScope isolation level</span></span>  
 <span data-ttu-id="e0c79-211">Einige der überladenen Konstruktoren von <xref:System.Transactions.TransactionScope> akzeptieren neben dem Timeoutwert eine Struktur vom Typ <xref:System.Transactions.TransactionOptions> zur Festlegung der Isolationsstufe.</span><span class="sxs-lookup"><span data-stu-id="e0c79-211">Some of the overloaded constructors of <xref:System.Transactions.TransactionScope> accept a structure of type <xref:System.Transactions.TransactionOptions> to specify an isolation level, in addition to a timeout value.</span></span> <span data-ttu-id="e0c79-212">Standardmäßig wird zur Ausführung einer Transaktion die Isolationsstufe auf <xref:System.Transactions.IsolationLevel.Serializable> festgelegt.</span><span class="sxs-lookup"><span data-stu-id="e0c79-212">By default, the transaction executes with isolation level set to <xref:System.Transactions.IsolationLevel.Serializable>.</span></span> <span data-ttu-id="e0c79-213">Häufig wird für Systeme, die viele Lesevorgänge ausführen müssen, eine andere Isolationsstufe als <xref:System.Transactions.IsolationLevel.Serializable> gewählt.</span><span class="sxs-lookup"><span data-stu-id="e0c79-213">Selecting an isolation level other than <xref:System.Transactions.IsolationLevel.Serializable> is commonly used for read-intensive systems.</span></span> <span data-ttu-id="e0c79-214">Dies erfordert ein umfassendes Verständnis der Transaktionsverarbeitungstheorie und der Semantik der betreffenden Transaktion, der einschlägigen Parallelitätsprobleme und der Auswirkungen auf die Systemkonsistenz.</span><span class="sxs-lookup"><span data-stu-id="e0c79-214">This requires a solid understanding of transaction processing theory and the semantics of the transaction itself, the concurrency issues involved, and the consequences for system consistency.</span></span>  
  
 <span data-ttu-id="e0c79-215">Überdies unterstützen nicht alle Ressourcen-Manager alle Isolationsstufen, sodass ein Ressourcen-Manager die Transaktion möglicherweise auf einer höheren als der konfigurierten Isolationsstufe bearbeitet.</span><span class="sxs-lookup"><span data-stu-id="e0c79-215">In addition, not all resource managers support all levels of isolation, and they may elect to take part in the transaction at a higher level than the one configured.</span></span>  
  
 <span data-ttu-id="e0c79-216">Jede Isolationsstufe außer <xref:System.Transactions.IsolationLevel.Serializable> ist für Inkonsistenzen anfällig, die sich daraus ergeben können, dass andere Transaktionen auf die gleichen Informationen zugreifen.</span><span class="sxs-lookup"><span data-stu-id="e0c79-216">Every isolation level besides <xref:System.Transactions.IsolationLevel.Serializable> is susceptible to inconsistency resulting from other transactions accessing the same information.</span></span> <span data-ttu-id="e0c79-217">Die verschiedenen Isolationsstufen unterscheiden sich darin, wie Lese- und Schreibsperren verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="e0c79-217">The difference between the different isolation levels is in the way read and write locks are used.</span></span> <span data-ttu-id="e0c79-218">Eine Sperre kann nur dann gelten, wenn die Transaktion im Ressourcen-Manager auf Daten zugreift. Sie kann aber solange gelten, bis die Transaktion abgeschlossen oder abgebrochen wurde.</span><span class="sxs-lookup"><span data-stu-id="e0c79-218">A lock can be held only when the transaction accesses the data in the resource manager, or it can be held until the transaction is committed or aborted.</span></span> <span data-ttu-id="e0c79-219">Im ersten Fall ist der Durchsatz höher, im zweiten Fall die Konsistenz.</span><span class="sxs-lookup"><span data-stu-id="e0c79-219">The former is better for throughput, the latter for consistency.</span></span> <span data-ttu-id="e0c79-220">Da es zwei Arten von Sperren und zwei Arten von Operationen (Lesen/Schreiben) gibt, sind vier grundlegende Isolationsstufen verfügbar.</span><span class="sxs-lookup"><span data-stu-id="e0c79-220">The two kinds of locks and the two kinds of operations (read/write) give four basic isolation levels.</span></span> <span data-ttu-id="e0c79-221">Weitere Informationen finden Sie unter <xref:System.Transactions.IsolationLevel>.</span><span class="sxs-lookup"><span data-stu-id="e0c79-221">See <xref:System.Transactions.IsolationLevel> for more information.</span></span>  
  
 <span data-ttu-id="e0c79-222">Beim Einsatz verschachtelter <xref:System.Transactions.TransactionScope>-Objekte muss für alle verschachtelten Bereiche die gleiche Isolationsstufe konfiguriert werden, wenn eine Verknüpfung mit der Ambient-Transaktion hergestellt werden soll</span><span class="sxs-lookup"><span data-stu-id="e0c79-222">When using nested <xref:System.Transactions.TransactionScope> objects, all nested scopes must be configured to use exactly the same isolation level if they want to join the ambient transaction.</span></span> <span data-ttu-id="e0c79-223">Wenn verschachtelte <xref:System.Transactions.TransactionScope>-Objekte eine Verknüpfung mit der Ambient-Transaktion herzustellen versuchen und für diese eine andere Isolationsstufe festgelegt wurde, dann wird eine Ausnahme des Typs <xref:System.ArgumentException> ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="e0c79-223">If a nested <xref:System.Transactions.TransactionScope> object tries to join the ambient transaction yet it specifies a different isolation level, an <xref:System.ArgumentException> is thrown.</span></span>  
  
## <a name="interop-with-com"></a><span data-ttu-id="e0c79-224">Zusammenarbeit mit COM+</span><span class="sxs-lookup"><span data-stu-id="e0c79-224">Interop with COM+</span></span>  
 <span data-ttu-id="e0c79-225">Wenn Sie eine neue <xref:System.Transactions.TransactionScope>-Instanz erstellen, können Sie die <xref:System.Transactions.EnterpriseServicesInteropOption>-Enumeration in einem der Konstruktoren verwenden, um die Zusammenarbeit mit COM+ näher zu bestimmen.</span><span class="sxs-lookup"><span data-stu-id="e0c79-225">When you create a new <xref:System.Transactions.TransactionScope> instance, you can use the <xref:System.Transactions.EnterpriseServicesInteropOption> enumeration in one of the constructors to specify how to interact with COM+.</span></span> <span data-ttu-id="e0c79-226">Weitere Informationen hierzu finden Sie unter [Interoperabilität mit Enterprise Services und COM+ Transactions](interoperability-with-enterprise-services-and-com-transactions.md).</span><span class="sxs-lookup"><span data-stu-id="e0c79-226">For more information on this, see [Interoperability with Enterprise Services and COM+ Transactions](interoperability-with-enterprise-services-and-com-transactions.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e0c79-227">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="e0c79-227">See also</span></span>

- <xref:System.Transactions.Transaction.Clone%2A>
- <xref:System.Transactions.TransactionScope>
