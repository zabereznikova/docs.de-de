---
title: Datenbankspiegelungen in SQL Server
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 89befaff-bb46-4290-8382-e67cdb0e3de9
ms.openlocfilehash: 7e2c1c8ea1cbc1bb22452b9ef9d1f250c96118ea
ms.sourcegitcommit: 5b475c1855b32cf78d2d1bbb4295e4c236f39464
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 09/24/2020
ms.locfileid: "91173535"
---
# <a name="database-mirroring-in-sql-server"></a><span data-ttu-id="775a0-102">Datenbankspiegelungen in SQL Server</span><span class="sxs-lookup"><span data-stu-id="775a0-102">Database Mirroring in SQL Server</span></span>

<span data-ttu-id="775a0-103">Mithilfe der Datenbankspiegelung in SQL Server können Sie eine Kopie, oder auch Spiegelbild, einer SQL Server-Datenbank auf einem Standbyserver speichern.</span><span class="sxs-lookup"><span data-stu-id="775a0-103">Database mirroring in SQL Server allows you to keep a copy, or mirror, of a SQL Server database on a standby server.</span></span> <span data-ttu-id="775a0-104">Die Spiegelung stellt sicher, dass jederzeit zwei getrennte Kopien der Daten vorhanden sind, was Hochverfügbarkeit und vollständige Datenredundanz gewährleistet.</span><span class="sxs-lookup"><span data-stu-id="775a0-104">Mirroring ensures that two separate copies of the data exist at all times, providing high availability and complete data redundancy.</span></span> <span data-ttu-id="775a0-105">Der .NET-Datenanbieter für SQL Server stellt implizite Unterstützung für die Datenbankspiegelung bereit. Daher muss der Entwickler keine weiteren Schritte ausführen oder Code programmieren, nachdem die Spiegelung für eine SQL Server-Datenbank konfiguriert wurde.</span><span class="sxs-lookup"><span data-stu-id="775a0-105">The .NET Data Provider for SQL Server provides implicit support for database mirroring, so that the developer does not need to take any action or write any code once it has been configured for a SQL Server database.</span></span> <span data-ttu-id="775a0-106">Zusätzlich unterstützt das <xref:System.Data.SqlClient.SqlConnection>-Objekt einen expliziten Verbindungsmodus, der es erlaubt, den Namen eines Failoverpartnerservers in <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A> anzugeben.</span><span class="sxs-lookup"><span data-stu-id="775a0-106">In addition, the <xref:System.Data.SqlClient.SqlConnection> object supports an explicit connection mode that allows supplying the name of a failover partner server in the <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.</span></span>  
  
 <span data-ttu-id="775a0-107">Die folgende vereinfachte Ereignissequenz erfolgt für ein <xref:System.Data.SqlClient.SqlConnection>-Objekt, das eine für Spiegelung konfigurierte Datenbank als Ziel hat:</span><span class="sxs-lookup"><span data-stu-id="775a0-107">The following simplified sequence of events occurs for a <xref:System.Data.SqlClient.SqlConnection> object that targets a database configured for mirroring:</span></span>  
  
1. <span data-ttu-id="775a0-108">Die Clientanwendung verbindet sich erfolgreich mit der Prinzipaldatenbank, und der Server sendet den Namen des Partnerservers zurück, der dann auf dem Client zwischengespeichert wird.</span><span class="sxs-lookup"><span data-stu-id="775a0-108">The client application successfully connects to the principal database, and the server sends back the name of the partner server, which is then cached on the client.</span></span>  
  
2. <span data-ttu-id="775a0-109">Wenn der Server mit der Prinzipaldatenbank ausfällt oder die Verbindung unterbrochen wird, gehen Verbindung und Transaktionsstatus verloren.</span><span class="sxs-lookup"><span data-stu-id="775a0-109">If the server containing the principal database fails or connectivity is interrupted, connection and transaction state is lost.</span></span> <span data-ttu-id="775a0-110">Die Clientanwendung versucht, wieder eine Verbindung mit der Prinzipaldatenbank herzustellen, und schlägt fehl.</span><span class="sxs-lookup"><span data-stu-id="775a0-110">The client application attempts to re-establish a connection to the principal database and fails.</span></span>  
  
3. <span data-ttu-id="775a0-111">Die Clientanwendung versucht dann auf transparente Weise, eine Verbindung mit der Spiegeldatenbank auf dem Partnerserver herzustellen.</span><span class="sxs-lookup"><span data-stu-id="775a0-111">The client application then transparently attempts to establish a connection to the mirror database on the partner server.</span></span> <span data-ttu-id="775a0-112">Bei Erfolg wird die Verbindung zur Spiegeldatenbank umgeleitet, die dann zur neuen Prinzipaldatenbank wird.</span><span class="sxs-lookup"><span data-stu-id="775a0-112">If it succeeds, the connection is redirected to the mirror database, which then becomes the new principal database.</span></span>  
  
## <a name="specifying-the-failover-partner-in-the-connection-string"></a><span data-ttu-id="775a0-113">Angeben des Failoverpartners in der Verbindungszeichenfolge</span><span class="sxs-lookup"><span data-stu-id="775a0-113">Specifying the Failover Partner in the Connection String</span></span>  

 <span data-ttu-id="775a0-114">Wenn Sie den Namen eines Failoverpartnerservers in der Verbindungszeichenfolge angeben, versucht der Client transparent eine Verbindung mit dem Failoverpartner herzustellen, sofern die Prinzipaldatenbank beim ersten Verbindungsversuch der Clientanwendung nicht verfügbar ist.</span><span class="sxs-lookup"><span data-stu-id="775a0-114">If you supply the name of a failover partner server in the connection string, the client will transparently attempt a connection with the failover partner if the principal database is unavailable when the client application first connects.</span></span>  
  
```csharp
";Failover Partner=PartnerServerName"  
```  
  
 <span data-ttu-id="775a0-115">Wenn Sie den Namen des Failoverpartnerservers weglassen und die Hauptdatenbank beim ersten Verbindungsversuch der Clientanwendung nicht verfügbar ist, wird eine <xref:System.Data.SqlClient.SqlException> ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="775a0-115">If you omit the name of the failover partner server and the principal database is unavailable when the client application first connects then a <xref:System.Data.SqlClient.SqlException> is raised.</span></span>  
  
 <span data-ttu-id="775a0-116">Wenn <xref:System.Data.SqlClient.SqlConnection> erfolgreich geöffnet wird, wird der Failoverpartnername vom Server zurückgegeben und ersetzt alle in der Verbindungszeichenfolge angegebenen Werte.</span><span class="sxs-lookup"><span data-stu-id="775a0-116">When a <xref:System.Data.SqlClient.SqlConnection> is successfully opened, the failover partner name is returned by the server and supersedes any values supplied in the connection string.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="775a0-117">In Szenarien mit Datenbankspiegelung müssen Sie den Ausgangskatalog oder Datenbanknamen explizit in der Verbindungszeichenfolge angeben.</span><span class="sxs-lookup"><span data-stu-id="775a0-117">You must explicitly specify the initial catalog or database name in the connection string for database mirroring scenarios.</span></span> <span data-ttu-id="775a0-118">Wenn der Client Failover-Informationen zu einer Verbindung empfängt, für die nicht explizit ein Anfangskatalog oder eine Anfangsdatenbank angegeben wurde, werden die Failover-Informationen nicht zwischengespeichert und die Anwendung versucht auch nicht, bei einem Ausfall des Prinzipalservers einen Failover durchzuführen.</span><span class="sxs-lookup"><span data-stu-id="775a0-118">If the client receives failover information on a connection that doesn't have an explicitly specified initial catalog or database, the failover information is not cached and the application does not attempt to fail over if the principal server fails.</span></span> <span data-ttu-id="775a0-119">Wenn eine Verbindungszeichenfolge einen Wert für den Failoverpartner, aber keinen Wert für den Ausgangskatalog oder die Datenbank hat, wird eine `InvalidArgumentException` ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="775a0-119">If a connection string has a value for the failover partner, but no value for the initial catalog or database, an `InvalidArgumentException` is raised.</span></span>  
  
## <a name="retrieving-the-current-server-name"></a><span data-ttu-id="775a0-120">Abrufen des Namens für den aktuellen Server</span><span class="sxs-lookup"><span data-stu-id="775a0-120">Retrieving the Current Server Name</span></span>  

 <span data-ttu-id="775a0-121">Bei einem Failover können Sie den Namen des Servers abrufen, mit dem die aktuelle Verbindung tatsächlich besteht, indem Sie die <xref:System.Data.SqlClient.SqlConnection.DataSource%2A>-Eigenschaft eines <xref:System.Data.SqlClient.SqlConnection>-Objekts verwenden.</span><span class="sxs-lookup"><span data-stu-id="775a0-121">In the event of a failover, you can retrieve the name of the server to which the current connection is actually connected by using the <xref:System.Data.SqlClient.SqlConnection.DataSource%2A> property of a <xref:System.Data.SqlClient.SqlConnection> object.</span></span> <span data-ttu-id="775a0-122">Das folgende Codefragment ruft den Namen des aktiven Servers ab, wobei angenommen wird, dass die Verbindungsvariable auf eine geöffnete <xref:System.Data.SqlClient.SqlConnection> verweist.</span><span class="sxs-lookup"><span data-stu-id="775a0-122">The following code fragment retrieves the name of the active server, assuming that the connection variable references an open <xref:System.Data.SqlClient.SqlConnection>.</span></span>  
  
 <span data-ttu-id="775a0-123">Wenn ein Failover-Ereignis eintritt und die Verbindung zum Spiegelserver wechselt, wird die **DataSource**-Eigenschaft aktualisiert, um den Namen des Spiegelservers wiederzugeben.</span><span class="sxs-lookup"><span data-stu-id="775a0-123">When a failover event occurs and the connection is switched to the mirror server, the **DataSource** property is updated to reflect the mirror name.</span></span>  
  
```vb  
Dim activeServer As String = connection.DataSource  
```  
  
```csharp  
string activeServer = connection.DataSource;  
```  
  
## <a name="sqlclient-mirroring-behavior"></a><span data-ttu-id="775a0-124">Spiegelungsverhalten bei "SqlClient"</span><span class="sxs-lookup"><span data-stu-id="775a0-124">SqlClient Mirroring Behavior</span></span>  

 <span data-ttu-id="775a0-125">Der Client versucht stets, eine Verbindung mit dem aktuellen Prinzipalserver herzustellen.</span><span class="sxs-lookup"><span data-stu-id="775a0-125">The client always tries to connect to the current principal server.</span></span> <span data-ttu-id="775a0-126">Bei Misserfolg wird der Failoverpartner versucht.</span><span class="sxs-lookup"><span data-stu-id="775a0-126">If it fails, it tries the failover partner.</span></span> <span data-ttu-id="775a0-127">Wenn die Spiegeldatenbank bereits auf die Prinzipalrolle auf dem Partnerserver umgestellt wurde, ist die Verbindung erfolgreich. Die neue Zuordnung zwischen Prinzipal und Spiegel wird an den Client gesendet und für die Lebensdauer des Aufrufs von <xref:System.AppDomain> zwischengespeichert.</span><span class="sxs-lookup"><span data-stu-id="775a0-127">If the mirror database has already been switched to the principal role on the partner server, the connection succeeds and the new principal-mirror mapping is sent to the client and cached for the lifetime of the calling <xref:System.AppDomain>.</span></span> <span data-ttu-id="775a0-128">Sie wird nicht im dauerhaften Speicher gespeichert und ist für nachfolgende Verbindungen in einer anderen **AppDomain** oder einem anderen Prozess nicht verfügbar.</span><span class="sxs-lookup"><span data-stu-id="775a0-128">It is not stored in persistent storage and is not available for subsequent connections in a different **AppDomain** or process.</span></span> <span data-ttu-id="775a0-129">Sie ist allerdings für nachfolgende Verbindungen innerhalb derselben **AppDomain** verfügbar.</span><span class="sxs-lookup"><span data-stu-id="775a0-129">However, it is available for subsequent connections within the same **AppDomain**.</span></span> <span data-ttu-id="775a0-130">Beachten Sie, dass eine andere **AppDomain** oder ein anderer Prozess, die oder der auf demselben oder einem anderen Computer ausgeführt wird, immer über einen eigenen Pool von Verbindungen verfügt, die nicht zurückgesetzt werden.</span><span class="sxs-lookup"><span data-stu-id="775a0-130">Note that another **AppDomain** or process running on the same or a different computer always has its pool of connections, and those connections are not reset.</span></span> <span data-ttu-id="775a0-131">Wenn in diesem Fall die primäre Datenbank ausfällt, wird jeder Prozess bzw. jede **AppDomain** einmal mit einem Fehler ausgeführt, und der Pool wird automatisch gelöscht.</span><span class="sxs-lookup"><span data-stu-id="775a0-131">In that case, if the primary database goes down, each process or **AppDomain** fails once, and the pool is automatically cleared.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="775a0-132">Die Unterstützung der Spiegelung auf dem Server wird datenbankbezogen konfiguriert.</span><span class="sxs-lookup"><span data-stu-id="775a0-132">Mirroring support on the server is configured on a per-database basis.</span></span> <span data-ttu-id="775a0-133">Wenn Datenbearbeitungsvorgänge auf andere, nicht im Prinzipal-/Spiegelsatz enthaltene Datenbanken angewendet werden, entweder durch Verwendung mehrteiliger Namen oder durch Änderung der aktuellen Datenbank, werden die Änderungen an diesen anderen Datenbanken bei einem Fehler nicht weitergegeben.</span><span class="sxs-lookup"><span data-stu-id="775a0-133">If data manipulation operations are executed against other databases not included in the principal/mirror set, either by using multipart names or by changing the current database, the changes to these other databases do not propagate in the event of failure.</span></span> <span data-ttu-id="775a0-134">Wenn Daten in einer nicht gespiegelten Datenbank geändert werden, wird kein Fehler ausgegeben.</span><span class="sxs-lookup"><span data-stu-id="775a0-134">No error is generated when data is modified in a database that is not mirrored.</span></span> <span data-ttu-id="775a0-135">Der Entwickler muss die möglichen Auswirkungen solcher Vorgänge einschätzen.</span><span class="sxs-lookup"><span data-stu-id="775a0-135">The developer must evaluate the possible impact of such operations.</span></span>  
  
## <a name="database-mirroring-resources"></a><span data-ttu-id="775a0-136">Ressourcen zur Datenbankspiegelung</span><span class="sxs-lookup"><span data-stu-id="775a0-136">Database Mirroring Resources</span></span>  

 <span data-ttu-id="775a0-137">Die Begriffsdokumentation und Informationen zum Konfigurieren, Bereitstellen und Verwalten der Spiegelung finden Sie in den folgenden Ressourcen in der SQL Server-Dokumentation.</span><span class="sxs-lookup"><span data-stu-id="775a0-137">For conceptual documentation and information on configuring, deploying and administering mirroring, see the following resources in SQL Server documentation.</span></span>  
  
|<span data-ttu-id="775a0-138">Resource</span><span class="sxs-lookup"><span data-stu-id="775a0-138">Resource</span></span>|<span data-ttu-id="775a0-139">BESCHREIBUNG</span><span class="sxs-lookup"><span data-stu-id="775a0-139">Description</span></span>|  
|--------------|-----------------|  
|[<span data-ttu-id="775a0-140">Datenbankspiegelung</span><span class="sxs-lookup"><span data-stu-id="775a0-140">Database Mirroring</span></span>](/sql/database-engine/database-mirroring/database-mirroring-sql-server)|<span data-ttu-id="775a0-141">Beschreibt, wie Spiegelung in SQL Server eingerichtet und konfiguriert wird.</span><span class="sxs-lookup"><span data-stu-id="775a0-141">Describes how to set up and configure mirroring in SQL Server.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="775a0-142">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="775a0-142">See also</span></span>

- [<span data-ttu-id="775a0-143">Übersicht über ADO.NET</span><span class="sxs-lookup"><span data-stu-id="775a0-143">ADO.NET Overview</span></span>](../ado-net-overview.md)
