---
title: Interop-Marshalling
ms.date: 03/30/2017
ms.prod: .net-framework
ms.technology:
- dotnet-clr
ms.topic: article
helpviewer_keywords:
- marshaling, COM interop
- interop marshaling
- interop marshaling, about interop marshaling
ms.assetid: 115f7a2f-d422-4605-ab36-13a8dd28142a
caps.latest.revision: 22
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.workload:
- dotnet
ms.openlocfilehash: cb22c708221fcc80962fd7da6e26c3720173d824
ms.sourcegitcommit: 9a4fe1a1c37b26532654b4bbe22d702237950009
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/16/2018
---
# <a name="interop-marshaling"></a><span data-ttu-id="b4874-102">Interop-Marshalling</span><span class="sxs-lookup"><span data-stu-id="b4874-102">Interop Marshaling</span></span>
<a name="top"></a> <span data-ttu-id="b4874-103">Interop-Marshalling steuert, wie Daten in Methodenargumenten und Rückgabewerten zwischen verwaltetem und nicht verwaltetem Speicher während Aufrufen übergeben werden.</span><span class="sxs-lookup"><span data-stu-id="b4874-103">Interop marshaling governs how data is passed in method arguments and return values between managed and unmanaged memory during calls.</span></span> <span data-ttu-id="b4874-104">Interop-Marshalling ist eine Laufzeitaktivität, die vom Marshallingdienst der Common Language Runtime ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="b4874-104">Interop marshaling is a run-time activity performed by the common language runtime's marshaling service.</span></span>  
  
 <span data-ttu-id="b4874-105">Die meisten Datentypen verfügen über gemeinsame Darstellungen im verwalteten und nicht verwalteten Speicher.</span><span class="sxs-lookup"><span data-stu-id="b4874-105">Most data types have common representations in both managed and unmanaged memory.</span></span> <span data-ttu-id="b4874-106">Der Interop-Marshaller behandelt diese Typen für Sie.</span><span class="sxs-lookup"><span data-stu-id="b4874-106">The interop marshaler handles these types for you.</span></span> <span data-ttu-id="b4874-107">Andere Typen können im verwalteten Speicher nicht eindeutig oder gar nicht dargestellt sein.</span><span class="sxs-lookup"><span data-stu-id="b4874-107">Other types can be ambiguous or not represented at all in managed memory.</span></span>  
  
 <span data-ttu-id="b4874-108">Ein nicht eindeutiger Typ kann entweder mehrere nicht verwaltete Darstellungen besitzen, die einem einzelnen verwalteten Typ zugeordnet werden, oder ihm können Typinformationen fehlen, wie z. B. die Größe eines Arrays.</span><span class="sxs-lookup"><span data-stu-id="b4874-108">An ambiguous type can have either multiple unmanaged representations that map to a single managed type, or missing type information, such as the size of an array.</span></span> <span data-ttu-id="b4874-109">Für nicht eindeutige Typen stellt der Marshaller eine Standarddarstellung und alternative Darstellungen, wenn mehrere Darstellungen vorhanden sind, bereit.</span><span class="sxs-lookup"><span data-stu-id="b4874-109">For ambiguous types, the marshaler provides a default representation and alternative representations where multiple representations exist.</span></span> <span data-ttu-id="b4874-110">Sie können explizite Anweisungen für den Marshaller angeben, wie ein nicht eindeutiger Typ zu marshallen ist.</span><span class="sxs-lookup"><span data-stu-id="b4874-110">You can supply explicit instructions to the marshaler on how it is to marshal an ambiguous type.</span></span>  
  
 <span data-ttu-id="b4874-111">Diese Übersicht enthält folgende Abschnitte:</span><span class="sxs-lookup"><span data-stu-id="b4874-111">This overview contains the following sections:</span></span>  
  
-   [<span data-ttu-id="b4874-112">Plattformaufruf und COM-Interop-Modelle</span><span class="sxs-lookup"><span data-stu-id="b4874-112">Platform Invoke and COM Interop Models</span></span>](#platform_invoke_and_com_interop_models)  
  
-   [<span data-ttu-id="b4874-113">Marshalling und COM-Apartments</span><span class="sxs-lookup"><span data-stu-id="b4874-113">Marshaling and COM Apartments</span></span>](#marshaling_and_com_apartments)  
  
-   [<span data-ttu-id="b4874-114">Marshalling von Remoteaufrufen</span><span class="sxs-lookup"><span data-stu-id="b4874-114">Marshaling Remote Calls</span></span>](#marshaling_remote_calls)  
  
-   [<span data-ttu-id="b4874-115">Verwandte Themen</span><span class="sxs-lookup"><span data-stu-id="b4874-115">Related Topics</span></span>](#related_topics)  
  
-   [<span data-ttu-id="b4874-116">Verweis</span><span class="sxs-lookup"><span data-stu-id="b4874-116">Reference</span></span>](#reference)  
  
<a name="platform_invoke_and_com_interop_models"></a>   
## <a name="platform-invoke-and-com-interop-models"></a><span data-ttu-id="b4874-117">Plattformaufruf und COM-Interop-Modelle</span><span class="sxs-lookup"><span data-stu-id="b4874-117">Platform Invoke and COM Interop Models</span></span>  
 <span data-ttu-id="b4874-118">Die Common Language Runtime stellt zwei Mechanismen für die Interoperation mit nicht verwaltetem Code bereit:</span><span class="sxs-lookup"><span data-stu-id="b4874-118">The common language runtime provides two mechanisms for interoperating with unmanaged code:</span></span>  
  
-   <span data-ttu-id="b4874-119">Plattformaufruf, wodurch verwalteter Code Funktionen aufrufen kann, die aus einer nicht verwalteten Bibliothek exportiert wurden.</span><span class="sxs-lookup"><span data-stu-id="b4874-119">Platform invoke, which enables managed code to call functions exported from an unmanaged library.</span></span>  
  
-   <span data-ttu-id="b4874-120">COM-Interop, wodurch verwalteter Code über Schnittstellen mit COM-Objekten (Component Object Model) interagieren kann.</span><span class="sxs-lookup"><span data-stu-id="b4874-120">COM interop, which enables managed code to interact with Component Object Model (COM) objects through interfaces.</span></span>  
  
 <span data-ttu-id="b4874-121">Sowohl Plattformaufruf als auch COM-Interop verwenden Interop-Marshalling, um, falls erforderlich, Methodenargumente präzise zwischen Aufrufer und Aufgerufenem und umgekehrt zu verschieben.</span><span class="sxs-lookup"><span data-stu-id="b4874-121">Both platform invoke and COM interop use interop marshaling to accurately move method arguments between caller and callee and back, if required.</span></span> <span data-ttu-id="b4874-122">Wie die folgende Abbildung zeigt, fließt ein Methodenaufruf eines Plattformaufrufs vom verwalteten zum nicht verwalteten Code und niemals umgekehrt, es sei denn, dass [Rückruffunktionen](callback-functions.md) beteiligt sind.</span><span class="sxs-lookup"><span data-stu-id="b4874-122">As the following illustration shows, a platform invoke method call flows from managed to unmanaged code and never the other way, except when [callback functions](callback-functions.md) are involved.</span></span> <span data-ttu-id="b4874-123">Obwohl Plattformaufrufe nur vom verwalteten zum nicht verwalteten Code fließen können, können Daten als Ein-oder Ausgabeparameter in beide Richtungen fließen.</span><span class="sxs-lookup"><span data-stu-id="b4874-123">Even though platform invoke calls can flow only from managed to unmanaged code, data can flow in both directions as input or output parameters.</span></span> <span data-ttu-id="b4874-124">COM-Interop-Methodenaufrufe können in beide Richtungen fließen.</span><span class="sxs-lookup"><span data-stu-id="b4874-124">COM interop method calls can flow in either direction.</span></span>  
  
 <span data-ttu-id="b4874-125">![Plattformaufruf](./media/interopmarshaling.png "Interop-Marshalling")</span><span class="sxs-lookup"><span data-stu-id="b4874-125">![Platform invoke](./media/interopmarshaling.png "interopmarshaling")</span></span>  
<span data-ttu-id="b4874-126">Plattformaufruf- und COM-Interop-Aufruffluss</span><span class="sxs-lookup"><span data-stu-id="b4874-126">Platform invoke and COM interop call flow</span></span>  
  
 <span data-ttu-id="b4874-127">Auf der niedrigsten Ebene verwenden beide Mechanismen denselben Interop-Marshallingdienst. Bestimmte Datentypen werden aber ausschließlich nur von COM-Interop oder von Plattformaufrufen unterstützt.</span><span class="sxs-lookup"><span data-stu-id="b4874-127">At the lowest level, both mechanisms use the same interop marshaling service; however, certain data types are supported exclusively by COM interop or platform invoke.</span></span> <span data-ttu-id="b4874-128">Details hierzu finden Sie unter [Default Marshaling Behavior (Standardmäßiges Marshallingverhalten)](default-marshaling-behavior.md).</span><span class="sxs-lookup"><span data-stu-id="b4874-128">For details, see [Default Marshaling Behavior](default-marshaling-behavior.md).</span></span>  
  
 [<span data-ttu-id="b4874-129">Zurück zum Anfang</span><span class="sxs-lookup"><span data-stu-id="b4874-129">Back to top</span></span>](#top)  
  
<a name="marshaling_and_com_apartments"></a>   
## <a name="marshaling-and-com-apartments"></a><span data-ttu-id="b4874-130">Marshalling und COM-Apartments</span><span class="sxs-lookup"><span data-stu-id="b4874-130">Marshaling and COM Apartments</span></span>  
 <span data-ttu-id="b4874-131">Der Interop-Marshaller marshallt Daten zwischen dem Common Language Runtime-Heap und dem nicht verwalteten Heap.</span><span class="sxs-lookup"><span data-stu-id="b4874-131">The interop marshaler marshals data between the common language runtime heap and the unmanaged heap.</span></span> <span data-ttu-id="b4874-132">Marshalling tritt auf, wenn der Aufrufer und der Aufgerufene nicht an derselben Instanz von Daten arbeiten können.</span><span class="sxs-lookup"><span data-stu-id="b4874-132">Marshaling occurs whenever the caller and callee cannot operate on the same instance of data.</span></span> <span data-ttu-id="b4874-133">Der Interop-Marshaller ermöglicht es dem Aufrufer und dem Aufgerufenen, scheinbar an denselben Daten zu arbeiten, auch wenn sie jeweils eine eigenen Kopie der Daten besitzen.</span><span class="sxs-lookup"><span data-stu-id="b4874-133">The interop marshaler makes it possible for the caller and callee to appear to be operating on the same data even if they have their own copy of the data.</span></span>  
  
 <span data-ttu-id="b4874-134">COM verfügt ebenfalls über einen Marshaller, der Daten zwischen COM-Apartments oder verschiedenen COM-Prozessen marshallt.</span><span class="sxs-lookup"><span data-stu-id="b4874-134">COM also has a marshaler that marshals data between COM apartments or different COM processes.</span></span> <span data-ttu-id="b4874-135">Beim Aufrufen zwischen verwaltetem und nicht verwaltetem Code innerhalb desselben COM-Apartments ist der Interop-Marshaller als einziger Marschaller beteiligt.</span><span class="sxs-lookup"><span data-stu-id="b4874-135">When calling between managed and unmanaged code within the same COM apartment, the interop marshaler is the only marshaler involved.</span></span> <span data-ttu-id="b4874-136">Beim Aufrufen zwischen verwaltetem und nicht verwaltetem Code in einem anderen COM-Apartment oder einem anderen Prozess sind sowohl der Interop-Marshaller als auch der COM-Marschaller beteiligt.</span><span class="sxs-lookup"><span data-stu-id="b4874-136">When calling between managed code and unmanaged code in a different COM apartment or a different process, both the interop marshaler and the COM marshaler are involved.</span></span>  
  
### <a name="com-clients-and-managed-servers"></a><span data-ttu-id="b4874-137">COM-Clients und verwaltete Server</span><span class="sxs-lookup"><span data-stu-id="b4874-137">COM Clients and Managed Servers</span></span>  
 <span data-ttu-id="b4874-138">Ein exportierter verwalteter Server mit einer vom [Assembly Registration-Tool (Regasm.exe)](../tools/regasm-exe-assembly-registration-tool.md) registrierten Typbibliothek besitzt einen auf `Both` festgelegten `ThreadingModel`-Registrierungseintrag.</span><span class="sxs-lookup"><span data-stu-id="b4874-138">An exported managed server with a type library registered by the [Regasm.exe (Assembly Registration Tool)](../tools/regasm-exe-assembly-registration-tool.md) has a `ThreadingModel` registry entry set to `Both`.</span></span> <span data-ttu-id="b4874-139">Dieser Wert gibt an, dass der Server in einem Singlethread-Apartment (STA) oder einem Multithread-Apartment (MTA) aktiviert werden kann.</span><span class="sxs-lookup"><span data-stu-id="b4874-139">This value indicates that the server can be activated in a single-threaded apartment (STA) or a multithreaded apartment (MTA).</span></span> <span data-ttu-id="b4874-140">Das Serverobjekt wird im selben Apartment wie sein Aufrufer erstellt, wie in der folgenden Tabelle dargestellt.</span><span class="sxs-lookup"><span data-stu-id="b4874-140">The server object is created in the same apartment as its caller, as shown in the following table.</span></span>  
  
|<span data-ttu-id="b4874-141">COM-Client</span><span class="sxs-lookup"><span data-stu-id="b4874-141">COM client</span></span>|<span data-ttu-id="b4874-142">.NET-Server</span><span class="sxs-lookup"><span data-stu-id="b4874-142">.NET server</span></span>|<span data-ttu-id="b4874-143">Marshallinganforderungen</span><span class="sxs-lookup"><span data-stu-id="b4874-143">Marshaling requirements</span></span>|  
|----------------|-----------------|-----------------------------|  
|<span data-ttu-id="b4874-144">STA</span><span class="sxs-lookup"><span data-stu-id="b4874-144">STA</span></span>|<span data-ttu-id="b4874-145">`Both` wird STA.</span><span class="sxs-lookup"><span data-stu-id="b4874-145">`Both` becomes STA.</span></span>|<span data-ttu-id="b4874-146">Marshalling im selben Apartment.</span><span class="sxs-lookup"><span data-stu-id="b4874-146">Same-apartment marshaling.</span></span>|  
|<span data-ttu-id="b4874-147">MTA</span><span class="sxs-lookup"><span data-stu-id="b4874-147">MTA</span></span>|<span data-ttu-id="b4874-148">`Both` wird MTA.</span><span class="sxs-lookup"><span data-stu-id="b4874-148">`Both` becomes MTA.</span></span>|<span data-ttu-id="b4874-149">Marshalling im selben Apartment.</span><span class="sxs-lookup"><span data-stu-id="b4874-149">Same-apartment marshaling.</span></span>|  
  
 <span data-ttu-id="b4874-150">Da Client und Server im selben Apartment sind, verarbeitet der Interop-Marshallingdienst automatisch das gesamte Daten-Marshalling.</span><span class="sxs-lookup"><span data-stu-id="b4874-150">Because the client and server are in the same apartment, the interop marshaling service automatically handles all data marshaling.</span></span> <span data-ttu-id="b4874-151">Die folgende Abbildung zeigt, wie der Interop-Marshallingdienst zwischen verwalteten und nicht verwalteten Heaps innerhalb desselben COM-artigen Apartments agiert.</span><span class="sxs-lookup"><span data-stu-id="b4874-151">The following illustration shows the interop marshaling service operating between managed and unmanaged heaps within the same COM-style apartment.</span></span>  
  
 <span data-ttu-id="b4874-152">![Interop-Marshalling](./media/interopheap.gif "Interop-Heap")</span><span class="sxs-lookup"><span data-stu-id="b4874-152">![Interop marshaling](./media/interopheap.gif "interopheap")</span></span>  
<span data-ttu-id="b4874-153">Marshallingprozess im selben Apartment.</span><span class="sxs-lookup"><span data-stu-id="b4874-153">Same-apartment marshaling process</span></span>  
  
 <span data-ttu-id="b4874-154">Wenn Sie planen, einen verwalteten Server zu exportieren, sollten Sie daran denken, dass der COM-Client das Apartment des Servers bestimmt.</span><span class="sxs-lookup"><span data-stu-id="b4874-154">If you plan to export a managed server, be aware that the COM client determines the apartment of the server.</span></span> <span data-ttu-id="b4874-155">Ein von einem COM-Client aufgerufener und in einem MTA initialisierter verwalteter Server muss Threadsicherheit sicherstellen.</span><span class="sxs-lookup"><span data-stu-id="b4874-155">A managed server called by a COM client initialized in an MTA must ensure thread safety.</span></span>  
  
### <a name="managed-clients-and-com-servers"></a><span data-ttu-id="b4874-156">Verwaltete Clients und COM-Server</span><span class="sxs-lookup"><span data-stu-id="b4874-156">Managed Clients and COM Servers</span></span>  
 <span data-ttu-id="b4874-157">Die Standardeinstellung für verwaltete Clientapartments ist MTA. Der Anwendungstyp des .NET-Clients kann jedoch die Standardeinstellung ändern.</span><span class="sxs-lookup"><span data-stu-id="b4874-157">The default setting for managed client apartments is MTA; however, the application type of the .NET client can change the default setting.</span></span> <span data-ttu-id="b4874-158">Angenommen, eine [!INCLUDE[vbprvblong](../../../includes/vbprvblong-md.md)]-Clientapartmenteinstellung ist STA.</span><span class="sxs-lookup"><span data-stu-id="b4874-158">For example, a [!INCLUDE[vbprvblong](../../../includes/vbprvblong-md.md)] client apartment setting is STA.</span></span> <span data-ttu-id="b4874-159">Sie können eine der Eigenschaften <xref:System.STAThreadAttribute?displayProperty=nameWithType>, <xref:System.MTAThreadAttribute?displayProperty=nameWithType>, <xref:System.Threading.Thread.ApartmentState%2A?displayProperty=nameWithType> oder die Eigenschaft <xref:System.Web.UI.Page.AspCompatMode%2A?displayProperty=nameWithType> verwenden, um die Apartmenteinstellung eines verwalteten Clients zu untersuchen und zu ändern.</span><span class="sxs-lookup"><span data-stu-id="b4874-159">You can use the <xref:System.STAThreadAttribute?displayProperty=nameWithType>, the <xref:System.MTAThreadAttribute?displayProperty=nameWithType>, the <xref:System.Threading.Thread.ApartmentState%2A?displayProperty=nameWithType> property, or the <xref:System.Web.UI.Page.AspCompatMode%2A?displayProperty=nameWithType> property to examine and change the apartment setting of a managed client.</span></span>  
  
 <span data-ttu-id="b4874-160">Der Autor der Komponente legt die Threadaffinität eines COM-Servers fest.</span><span class="sxs-lookup"><span data-stu-id="b4874-160">The author of the component sets the thread affinity of a COM server.</span></span> <span data-ttu-id="b4874-161">Die folgende Tabelle zeigt die Kombinationen von Apartmenteinstellungen für .NET-Clients und COM-Server.</span><span class="sxs-lookup"><span data-stu-id="b4874-161">The following table shows the combinations of apartment settings for .NET clients and COM servers.</span></span> <span data-ttu-id="b4874-162">Sie zeigt außerdem die resultierenden Marshallinganforderungen für die Kombinationen.</span><span class="sxs-lookup"><span data-stu-id="b4874-162">It also shows the resulting marshaling requirements for the combinations.</span></span>  
  
|<span data-ttu-id="b4874-163">.NET-Client</span><span class="sxs-lookup"><span data-stu-id="b4874-163">.NET client</span></span>|<span data-ttu-id="b4874-164">COM-Server</span><span class="sxs-lookup"><span data-stu-id="b4874-164">COM server</span></span>|<span data-ttu-id="b4874-165">Marshallinganforderungen</span><span class="sxs-lookup"><span data-stu-id="b4874-165">Marshaling requirements</span></span>|  
|-----------------|----------------|-----------------------------|  
|<span data-ttu-id="b4874-166">MTA (Standard)</span><span class="sxs-lookup"><span data-stu-id="b4874-166">MTA (default)</span></span>|<span data-ttu-id="b4874-167">MTA</span><span class="sxs-lookup"><span data-stu-id="b4874-167">MTA</span></span><br /><br /> <span data-ttu-id="b4874-168">STA</span><span class="sxs-lookup"><span data-stu-id="b4874-168">STA</span></span>|<span data-ttu-id="b4874-169">Interop-Marshalling</span><span class="sxs-lookup"><span data-stu-id="b4874-169">Interop marshaling.</span></span><br /><br /> <span data-ttu-id="b4874-170">Interop- und COM-Marshalling</span><span class="sxs-lookup"><span data-stu-id="b4874-170">Interop and COM marshaling.</span></span>|  
|<span data-ttu-id="b4874-171">STA</span><span class="sxs-lookup"><span data-stu-id="b4874-171">STA</span></span>|<span data-ttu-id="b4874-172">MTA</span><span class="sxs-lookup"><span data-stu-id="b4874-172">MTA</span></span><br /><br /> <span data-ttu-id="b4874-173">STA</span><span class="sxs-lookup"><span data-stu-id="b4874-173">STA</span></span>|<span data-ttu-id="b4874-174">Interop- und COM-Marshalling</span><span class="sxs-lookup"><span data-stu-id="b4874-174">Interop and COM marshaling.</span></span><br /><br /> <span data-ttu-id="b4874-175">Interop-Marshalling</span><span class="sxs-lookup"><span data-stu-id="b4874-175">Interop marshaling.</span></span>|  
  
 <span data-ttu-id="b4874-176">Wenn ein verwalteter Client und ein nicht verwalteter Server im selben Apartment sind, verarbeitet der Interop-Marshallingdienst das gesamte Daten-Marshalling.</span><span class="sxs-lookup"><span data-stu-id="b4874-176">When a managed client and unmanaged server are in the same apartment, the interop marshaling service handles all data marshaling.</span></span> <span data-ttu-id="b4874-177">Wenn Client und Server in unterschiedlichen Apartments initialisiert werden, ist jedoch auch COM-Marshalling erforderlich.</span><span class="sxs-lookup"><span data-stu-id="b4874-177">However, when client and server are initialized in different apartments, COM marshaling is also required.</span></span> <span data-ttu-id="b4874-178">Die folgende Abbildung zeigt die Elemente eines apartmentübergreifenden Aufrufs.</span><span class="sxs-lookup"><span data-stu-id="b4874-178">The following illustration shows the elements of a cross-apartment call.</span></span>  
  
 <span data-ttu-id="b4874-179">![COM-Marshalling](./media/singleprocessmultapt.gif "Singleprocessmultapt")</span><span class="sxs-lookup"><span data-stu-id="b4874-179">![COM marshaling](./media/singleprocessmultapt.gif "singleprocessmultapt")</span></span>  
<span data-ttu-id="b4874-180">Apartmentübergreifender Aufruf zwischen einem .NET-Client und einem COM-Objekt</span><span class="sxs-lookup"><span data-stu-id="b4874-180">Cross-apartment call between a .NET client and COM object</span></span>  
  
 <span data-ttu-id="b4874-181">Für apartmentübergreifendes Marshalling können Sie Folgendes tun:</span><span class="sxs-lookup"><span data-stu-id="b4874-181">For cross-apartment marshaling, you can do the following:</span></span>  
  
-   <span data-ttu-id="b4874-182">Akzeptieren Sie den Mehraufwand für das apartmentübergreifende Marshalling, der sich nur bemerkbar macht, wenn viele Aufrufe vorhanden sind, die die Apartmentgrenze überschreiten.</span><span class="sxs-lookup"><span data-stu-id="b4874-182">Accept the overhead of the cross-apartment marshaling, which is noticeable only when there are many calls across the boundary.</span></span> <span data-ttu-id="b4874-183">Sie müssen die Typbibliothek der COM-Komponente registrieren, damit Aufrufe erfolgreich die Apartmentgrenze überschreiten können.</span><span class="sxs-lookup"><span data-stu-id="b4874-183">You must register the type library of the COM component for calls to successfully cross the apartment boundary.</span></span>  
  
-   <span data-ttu-id="b4874-184">Ändern Sie den Hauptthread, indem den Clientthread auf STA oder MTA festlegen.</span><span class="sxs-lookup"><span data-stu-id="b4874-184">Alter the main thread by setting the client thread to STA or MTA.</span></span> <span data-ttu-id="b4874-185">Wenn z. B. Ihr C#-Client viele STA-COM-Komponenten aufruft, können Sie apartmentübergreifendes Marshalling vermeiden, indem Sie den Hauptthread auf STA festlegen.</span><span class="sxs-lookup"><span data-stu-id="b4874-185">For example, if your C# client calls many STA COM components, you can avoid cross-apartment marshaling by setting the main thread to STA.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="b4874-186">Sobald der Thread eines C#-Clients auf STA festgelegt ist, erfordern Aufrufe von MTA-COM-Komponenten apartmentübergreifendes Marshalling.</span><span class="sxs-lookup"><span data-stu-id="b4874-186">Once the thread of a C# client is set to STA, calls to MTA COM components will require cross-apartment marshaling.</span></span>  
  
 <span data-ttu-id="b4874-187">Anleitungen zum expliziten Auswählen eines Apartmentmodells finden Sie unter [Managed and Unmanaged Threading (Verwaltetes und nicht verwaltetes Threading)](https://msdn.microsoft.com/library/db425c20-4b2f-4433-bf96-76071c7881e5(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="b4874-187">For instructions on explicitly selecting an apartment model, see [Managed and Unmanaged Threading](https://msdn.microsoft.com/library/db425c20-4b2f-4433-bf96-76071c7881e5(v=vs.100)).</span></span>  
  
 [<span data-ttu-id="b4874-188">Zurück zum Anfang</span><span class="sxs-lookup"><span data-stu-id="b4874-188">Back to top</span></span>](#top)  
  
<a name="marshaling_remote_calls"></a>   
## <a name="marshaling-remote-calls"></a><span data-ttu-id="b4874-189">Marshalling von Remoteaufrufen</span><span class="sxs-lookup"><span data-stu-id="b4874-189">Marshaling Remote Calls</span></span>  
 <span data-ttu-id="b4874-190">Wie bei apartmentübergreifendem Marshalling ist bei jedem Aufruf zwischen verwaltetem und nicht verwaltetem Code COM-Marshalling beteiligt, wenn sich die Objekte in verschiedenen Prozessen befinden.</span><span class="sxs-lookup"><span data-stu-id="b4874-190">As with cross-apartment marshaling, COM marshaling is involved in each call between managed and unmanaged code whenever the objects reside in separate processes.</span></span> <span data-ttu-id="b4874-191">Beispiel:</span><span class="sxs-lookup"><span data-stu-id="b4874-191">For example:</span></span>  
  
-   <span data-ttu-id="b4874-192">Ein COM-Client, der einen verwalteten Server auf einem Remotehost aufruft, verwendet verteiltes COM (DCOM).</span><span class="sxs-lookup"><span data-stu-id="b4874-192">A COM client that invokes a managed server on a remote host uses distributed COM (DCOM).</span></span>  
  
-   <span data-ttu-id="b4874-193">Ein verwalteter Client, der einen COM-Server auf einem Remotehost aufruft, verwendet DCOM.</span><span class="sxs-lookup"><span data-stu-id="b4874-193">A managed client that invokes a COM server on a remote host uses DCOM.</span></span>  
  
 <span data-ttu-id="b4874-194">Die folgende Abbildung zeigt, wie Interop-Marshalling und COM-Marshalling Kommunikationskanäle über Prozess- und Hostgrenzen hinweg bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="b4874-194">The following illustration shows how interop marshaling and COM marshaling provide communications channels across process and host boundaries.</span></span>  
  
 <span data-ttu-id="b4874-195">![COM-Marshalling](./media/interophost.gif "Interop-Host")</span><span class="sxs-lookup"><span data-stu-id="b4874-195">![COM marshaling](./media/interophost.gif "interophost")</span></span>  
<span data-ttu-id="b4874-196">Prozessübergreifendes Marshalling</span><span class="sxs-lookup"><span data-stu-id="b4874-196">Cross-process marshaling</span></span>  
  
### <a name="preserving-identity"></a><span data-ttu-id="b4874-197">Beibehalten der Identität</span><span class="sxs-lookup"><span data-stu-id="b4874-197">Preserving Identity</span></span>  
 <span data-ttu-id="b4874-198">Die Common Language Runtime behält die Identität verwalteter und nicht verwalteter Verweise bei.</span><span class="sxs-lookup"><span data-stu-id="b4874-198">The common language runtime preserves the identity of managed and unmanaged references.</span></span> <span data-ttu-id="b4874-199">Die folgende Abbildung zeigt den Fluss direkter, nicht verwalteter Verweise (obere Zeile) und direkter, verwalteter Verweise (untere Zeile) über Prozess- und Hostgrenzen hinweg.</span><span class="sxs-lookup"><span data-stu-id="b4874-199">The following illustration shows the flow of direct unmanaged references (top row) and direct managed references (bottom row) across process and host boundaries.</span></span>  
  
 <span data-ttu-id="b4874-200">![COM Callable Wrapper und Runtime Callable Wrapper](./media/interopdirectref.gif "interopdirectref")</span><span class="sxs-lookup"><span data-stu-id="b4874-200">![COM callable wrapper and runtime callable wrapper](./media/interopdirectref.gif "interopdirectref")</span></span>  
<span data-ttu-id="b4874-201">Verweisübergabe über Prozess- und Hostgrenzen hinweg</span><span class="sxs-lookup"><span data-stu-id="b4874-201">Reference passing across process and host boundaries</span></span>  
  
 <span data-ttu-id="b4874-202">In dieser Abbildung:</span><span class="sxs-lookup"><span data-stu-id="b4874-202">In this illustration:</span></span>  
  
-   <span data-ttu-id="b4874-203">Ein nicht verwalteter Client ruft einen Verweis auf ein COM-Objekt von einem verwalteten Objekt ab, das diesen Verweis von einem Remotehost abruft.</span><span class="sxs-lookup"><span data-stu-id="b4874-203">An unmanaged client gets a reference to a COM object from a managed object that gets this reference from a remote host.</span></span> <span data-ttu-id="b4874-204">Der Remotingmechanismus ist DCOM.</span><span class="sxs-lookup"><span data-stu-id="b4874-204">The remoting mechanism is DCOM.</span></span>  
  
-   <span data-ttu-id="b4874-205">Ein verwalteter Client ruft einen Verweis auf ein verwaltetes Objekt von einem COM-Objekt ab, das diesen Verweis von einem Remotehost abruft.</span><span class="sxs-lookup"><span data-stu-id="b4874-205">A managed client gets a reference to a managed object from a COM object that gets this reference from a remote host.</span></span> <span data-ttu-id="b4874-206">Der Remotingmechanismus ist DCOM.</span><span class="sxs-lookup"><span data-stu-id="b4874-206">The remoting mechanism is DCOM.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="b4874-207">Die exportierte Typbibliothek des verwalteten Servers muss registriert sein.</span><span class="sxs-lookup"><span data-stu-id="b4874-207">The exported type library of the managed server must be registered.</span></span>  
  
 <span data-ttu-id="b4874-208">Die Anzahl der Prozessgrenzen zwischen Aufrufer und Aufgerufenem ist irrelevant. Dieselbe direkte Referenzierung tritt bei prozessinternen und -externen Aufrufen auf.</span><span class="sxs-lookup"><span data-stu-id="b4874-208">The number of process boundaries between caller and callee is irrelevant; the same direct referencing occurs for in-process and out-of-process calls.</span></span>  
  
### <a name="managed-remoting"></a><span data-ttu-id="b4874-209">Verwaltetes Remoting</span><span class="sxs-lookup"><span data-stu-id="b4874-209">Managed Remoting</span></span>  
 <span data-ttu-id="b4874-210">Die Laufzeit bietet auch verwaltetes Remoting, das Sie zum Einrichten eines Kommunikationskanals zwischen verwalteten Objekten über Prozess- und Hostgrenzen hinweg verwenden können.</span><span class="sxs-lookup"><span data-stu-id="b4874-210">The runtime also provides managed remoting, which you can use to establish a communications channel between managed objects across process and host boundaries.</span></span> <span data-ttu-id="b4874-211">Verwaltetes Remoting kann eine Firewall zwischen den kommunizierenden Komponenten unterstützen, wie die folgende Abbildung zeigt.</span><span class="sxs-lookup"><span data-stu-id="b4874-211">Managed remoting can accommodate a firewall between the communicating components, as the following illustration shows.</span></span>  
  
 <span data-ttu-id="b4874-212">![SOAP oder TcpChannel](./media/interopremotesoap.gif "Interopremotesoap")</span><span class="sxs-lookup"><span data-stu-id="b4874-212">![SOAP or TcpChannel](./media/interopremotesoap.gif "interopremotesoap")</span></span>  
<span data-ttu-id="b4874-213">Firewallübergreifende Remoteaufrufe mit SOAP oder der TcpChannel-Klasse</span><span class="sxs-lookup"><span data-stu-id="b4874-213">Remote calls across firewalls using SOAP or the TcpChannel class</span></span>  
  
 <span data-ttu-id="b4874-214">Einige nicht verwaltete Aufrufe können über SOAP geleitet werden, z. B. die Aufrufe zwischen serviced Components und com.</span><span class="sxs-lookup"><span data-stu-id="b4874-214">Some unmanaged calls can be channeled through SOAP, such as the calls between serviced components and COM.</span></span>  
  
 [<span data-ttu-id="b4874-215">Zurück zum Anfang</span><span class="sxs-lookup"><span data-stu-id="b4874-215">Back to top</span></span>](#top)  
  
<a name="related_topics"></a>   
## <a name="related-topics"></a><span data-ttu-id="b4874-216">Verwandte Themen</span><span class="sxs-lookup"><span data-stu-id="b4874-216">Related Topics</span></span>  
  
|<span data-ttu-id="b4874-217">Titel</span><span class="sxs-lookup"><span data-stu-id="b4874-217">Title</span></span>|<span data-ttu-id="b4874-218">Beschreibung</span><span class="sxs-lookup"><span data-stu-id="b4874-218">Description</span></span>|  
|-----------|-----------------|  
|[<span data-ttu-id="b4874-219">Default Marshaling Behavior (Standardmäßiges Marshallingverhalten)</span><span class="sxs-lookup"><span data-stu-id="b4874-219">Default Marshaling Behavior</span></span>](default-marshaling-behavior.md)|<span data-ttu-id="b4874-220">Beschreibt die Regeln, die der Interop-Marshallingdienst für das Marshalling von Daten verwendet.</span><span class="sxs-lookup"><span data-stu-id="b4874-220">Describes the rules that the interop marshaling service uses to marshal data.</span></span>|  
|[<span data-ttu-id="b4874-221">Marshallen von Daten mit Plattformaufruf</span><span class="sxs-lookup"><span data-stu-id="b4874-221">Marshaling Data with Platform Invoke</span></span>](marshaling-data-with-platform-invoke.md)|<span data-ttu-id="b4874-222">Beschreibt, wie Sie Methodenparameter deklarieren und Argumente an Funktionen übergeben, die aus nicht verwalteten Bibliotheken exportiert wurden.</span><span class="sxs-lookup"><span data-stu-id="b4874-222">Describes how to declare method parameters and pass arguments to functions exported by unmanaged libraries.</span></span>|  
|[<span data-ttu-id="b4874-223">Marshaling Data with COM Interop (Marshallen von Daten mit COM-Interop)</span><span class="sxs-lookup"><span data-stu-id="b4874-223">Marshaling Data with COM Interop</span></span>](marshaling-data-with-com-interop.md)|<span data-ttu-id="b4874-224">Beschreibt, wie Sie COM-Wrapper anpassen, um das Marshallingverhalten zu ändern.</span><span class="sxs-lookup"><span data-stu-id="b4874-224">Describes how to customize COM wrappers to alter marshaling behavior.</span></span>|  
|[<span data-ttu-id="b4874-225">How to: Migrate Managed-Code DCOM to WCF (Vorgehensweise: Migrieren von verwaltetem Code DCOM zu WCF)</span><span class="sxs-lookup"><span data-stu-id="b4874-225">How to: Migrate Managed-Code DCOM to WCF</span></span>](how-to-migrate-managed-code-dcom-to-wcf.md)|<span data-ttu-id="b4874-226">Beschreibt, wie Sie von DCOM zu WCF migrieren.</span><span class="sxs-lookup"><span data-stu-id="b4874-226">Describes how to migrate from DCOM to WCF.</span></span>|  
|[<span data-ttu-id="b4874-227">Gewusst wie: Zuordnen von HRESULTs und Ausnahmen</span><span class="sxs-lookup"><span data-stu-id="b4874-227">How to: Map HRESULTs and Exceptions</span></span>](how-to-map-hresults-and-exceptions.md)|<span data-ttu-id="b4874-228">Beschreibt, wie Sie benutzerdefinierte Ausnahmen zu HRESULTs zuordnen, und stellt die vollständige Zuordnung von jedem HRESULT zu seiner vergleichbaren Ausnahmeklasse in .NET Framework bereit.</span><span class="sxs-lookup"><span data-stu-id="b4874-228">Describes how to map custom exceptions to HRESULTs and provides the complete mapping from each HRESULT to its comparable exception class in the .NET Framework.</span></span>|  
|<span data-ttu-id="b4874-229">[Interoperation mit generischen Typen](https://msdn.microsoft.com/library/26b88e03-085b-4b53-94ba-a5a9c709ce58(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="b4874-229">[Interoperating Using Generic Types](https://msdn.microsoft.com/library/26b88e03-085b-4b53-94ba-a5a9c709ce58(v=vs.100))</span></span>|<span data-ttu-id="b4874-230">Beschreibt, welche Aktionen bei Verwendung von generischen Typen für COM-Interoperabilität unterstützt werden.</span><span class="sxs-lookup"><span data-stu-id="b4874-230">Describes which actions are supported when using generic types for COM interoperability.</span></span>|  
|[<span data-ttu-id="b4874-231">Interoperabilität mit nicht verwaltetem Code</span><span class="sxs-lookup"><span data-stu-id="b4874-231">Interoperating with Unmanaged Code</span></span>](index.md)|<span data-ttu-id="b4874-232">Beschreibt Interoperabilitätsdienste, die von der Common Language Runtime bereitgestellt werden.</span><span class="sxs-lookup"><span data-stu-id="b4874-232">Describes interoperability services provided by the common language runtime.</span></span>|  
|<span data-ttu-id="b4874-233">[Erweiterte COM-Interoperabilität](https://msdn.microsoft.com/library/3ada36e5-2390-4d70-b490-6ad8de92f2fb(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="b4874-233">[Advanced COM Interoperability](https://msdn.microsoft.com/library/3ada36e5-2390-4d70-b490-6ad8de92f2fb(v=vs.100))</span></span>|<span data-ttu-id="b4874-234">Stellt Links zu weiteren Informationen über das Einbinden von COM-Komponenten in Ihre .NET Framework-Anwendung bereit.</span><span class="sxs-lookup"><span data-stu-id="b4874-234">Provides links to more information about incorporating COM components into your .NET Framework application.</span></span>|  
|<span data-ttu-id="b4874-235">[Entwurfsüberlegungen für die Interoperation](https://msdn.microsoft.com/library/b59637f6-fe35-40d6-ae72-901e7a707689(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="b4874-235">[Design Considerations for Interoperation](https://msdn.microsoft.com/library/b59637f6-fe35-40d6-ae72-901e7a707689(v=vs.100))</span></span>|<span data-ttu-id="b4874-236">Bietet Tipps zum Schreiben integrierter COM-Komponenten.</span><span class="sxs-lookup"><span data-stu-id="b4874-236">Provides tips for writing integrated COM components.</span></span>|  
  
 [<span data-ttu-id="b4874-237">Zurück zum Anfang</span><span class="sxs-lookup"><span data-stu-id="b4874-237">Back to top</span></span>](#top)  
  
<a name="reference"></a>   
## <a name="reference"></a><span data-ttu-id="b4874-238">Referenz</span><span class="sxs-lookup"><span data-stu-id="b4874-238">Reference</span></span>  
 <xref:System.Runtime.InteropServices?displayProperty=nameWithType>  
  
 [<span data-ttu-id="b4874-239">Zurück zum Anfang</span><span class="sxs-lookup"><span data-stu-id="b4874-239">Back to top</span></span>](#top)
