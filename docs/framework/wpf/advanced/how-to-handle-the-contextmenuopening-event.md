---
title: 'Vorgehensweise: Behandeln des ContextMenuOpening-Ereignisses'
ms.date: 03/30/2017
helpviewer_keywords:
- ContextMenuOpening properties [WPF]
ms.assetid: 789652fb-1951-4217-934a-7843e355adf4
ms.openlocfilehash: 794fad2708c799b9e5fb8ff1d2875648f886fdbb
ms.sourcegitcommit: 6b308cf6d627d78ee36dbbae8972a310ac7fd6c8
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/23/2019
ms.locfileid: "54655841"
---
# <a name="how-to-handle-the-contextmenuopening-event"></a><span data-ttu-id="a1f0c-102">Vorgehensweise: Behandeln des ContextMenuOpening-Ereignisses</span><span class="sxs-lookup"><span data-stu-id="a1f0c-102">How to: Handle the ContextMenuOpening Event</span></span>
<span data-ttu-id="a1f0c-103">Die <xref:System.Windows.FrameworkElement.ContextMenuOpening> -Ereignis behandelt werden, in einer Anwendung anpassen, entweder ein vorhandenes Kontext vor oder im Menü zu unterdrücken, die andernfalls durch Festlegen von angezeigt werden würden die <xref:System.Windows.RoutedEventArgs.Handled%2A> Eigenschaft `true` in den Ereignisdaten.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-103">The <xref:System.Windows.FrameworkElement.ContextMenuOpening> event can be handled in an application to either adjust an existing context menu prior to display or to suppress the menu that would otherwise be displayed by setting the <xref:System.Windows.RoutedEventArgs.Handled%2A> property to `true` in the event data.</span></span> <span data-ttu-id="a1f0c-104">Der Hauptgrund für die Einstellung <xref:System.Windows.RoutedEventArgs.Handled%2A> zu `true` in der Daten befindet, klicken Sie im Menü vollständig durch einen neuen ersetzt <xref:System.Windows.Controls.ContextMenu> Objekt, der in einigen Fällen erfordert der Vorgang abgebrochen wird, und starten eine neue Open.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-104">The typical reason for setting <xref:System.Windows.RoutedEventArgs.Handled%2A> to `true` in the event data is to replace the menu entirely with a new <xref:System.Windows.Controls.ContextMenu> object, which sometimes requires canceling the operation and starting a new open.</span></span> <span data-ttu-id="a1f0c-105">Wenn Sie Handler für Schreiben der <xref:System.Windows.FrameworkElement.ContextMenuOpening> -Ereignis, sollten Sie Bedenken der Probleme mit der zeitsteuerung zwischen eine <xref:System.Windows.Controls.ContextMenu> Steuerelement und der Dienst, der für das Öffnen und die Position des Kontextmenüs für Steuerelemente in der Regel zuständig ist.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-105">If you write handlers for the <xref:System.Windows.FrameworkElement.ContextMenuOpening> event, you should be aware of timing issues between a <xref:System.Windows.Controls.ContextMenu> control and the service that is responsible for opening and positioning context menus for controls in general.</span></span> <span data-ttu-id="a1f0c-106">In diesem Thema veranschaulicht einige der Codetechniken für verschiedene Szenarien öffnen Kontextmenü, und zeigt einen Fall, in dem das Problem der zeitlichen Steuerung ins Spiel kommt.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-106">This topic illustrates some of the code techniques for various context menu opening scenarios and illustrates a case where the timing issue comes into play.</span></span>  
  
 <span data-ttu-id="a1f0c-107">Es gibt mehrere Szenarios für die Behandlung der <xref:System.Windows.FrameworkElement.ContextMenuOpening> Ereignis:</span><span class="sxs-lookup"><span data-stu-id="a1f0c-107">There are several scenarios for handling the <xref:System.Windows.FrameworkElement.ContextMenuOpening> event:</span></span>  
  
-   <span data-ttu-id="a1f0c-108">Anpassen von die Menüelemente vor der Anzeige.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-108">Adjusting the menu items before display.</span></span>  
  
-   <span data-ttu-id="a1f0c-109">Ersetzen das gesamte Menü vor der Anzeige.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-109">Replacing the entire menu before display.</span></span>  
  
-   <span data-ttu-id="a1f0c-110">Vollständig unterdrücken vorhandenen Kontextmenü, und kein Kontextmenü angezeigt.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-110">Completely suppressing any existing context menu and displaying no context menu.</span></span>  
  
## <a name="example"></a><span data-ttu-id="a1f0c-111">Beispiel</span><span class="sxs-lookup"><span data-stu-id="a1f0c-111">Example</span></span>  
  
## <a name="adjusting-the-menu-items-before-display"></a><span data-ttu-id="a1f0c-112">Anpassen der Menüelemente vor der Anzeige</span><span class="sxs-lookup"><span data-stu-id="a1f0c-112">Adjusting the Menu Items Before Display</span></span>  
 <span data-ttu-id="a1f0c-113">Anpassen von den vorhandenen Menüelementen ist recht einfach gehalten und ist wahrscheinlich das gängigste Szenario.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-113">Adjusting the existing menu items is fairly simple and is probably the most common scenario.</span></span> <span data-ttu-id="a1f0c-114">Sie können hierzu um addieren oder subtrahieren Kontextmenüoptionen, die als Reaktion auf die aktuelle Zustandsinformationen in Ihrer Anwendung oder bestimmte Statusinformationen, die als Eigenschaft für das Objekt verfügbar ist, in dem das Kontextmenü angefordert wird.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-114">You might do this in order to add or subtract context menu options in response to current state information in your application or particular state information that is available as a property on the object where the context menu is requested.</span></span>  
  
 <span data-ttu-id="a1f0c-115">Die allgemeine Vorgehensweise zum Abrufen der Quelle des Ereignisses, die das bestimmte Steuerelement geklickt wurde, und ist die <xref:System.Windows.FrameworkElement.ContextMenu%2A> Eigenschaft aus.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-115">The general technique is to get the source of the event, which is the specific control that was right-clicked, and get the <xref:System.Windows.FrameworkElement.ContextMenu%2A> property from it.</span></span> <span data-ttu-id="a1f0c-116">In der Regel überprüfen möchten die <xref:System.Windows.Controls.ItemsControl.Items%2A> -Auflistung, um festzustellen welche Kontextmenüelemente bereits vorhanden sind, klicken Sie im Menü, und klicken Sie dann hinzufügen oder entfernen entsprechende neue <xref:System.Windows.Controls.MenuItem> von Elementen in oder aus der Auflistung.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-116">You typically want to check the <xref:System.Windows.Controls.ItemsControl.Items%2A> collection to see what context menu items already exist in the menu, and then add or remove appropriate new <xref:System.Windows.Controls.MenuItem> items to or from the collection.</span></span>  
  
 [!code-csharp[ContextMenuOpeningHandlers#AddItemNoHandle](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ContextMenuOpeningHandlers/CSharp/Pane1.xaml.cs#additemnohandle)]  
  
## <a name="replacing-the-entire-menu-before-display"></a><span data-ttu-id="a1f0c-117">Ersetzen das gesamte Menü vor der Anzeige</span><span class="sxs-lookup"><span data-stu-id="a1f0c-117">Replacing the Entire Menu Before Display</span></span>  
 <span data-ttu-id="a1f0c-118">Eine alternative Szenario ist, wenn Sie das Kontextmenü für die gesamte ersetzen möchten.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-118">An alternative scenario is if you want to replace the entire context menu.</span></span> <span data-ttu-id="a1f0c-119">Sie können natürlich auch verwenden eine Variation des vorherigen Codes auf jedes Element von einem vorhandenen Kontextmenü zu entfernen und Hinzufügen von neuen Element 0 (null) ab.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-119">You could of course also use a variation of the preceding code, to remove every item of an existing context menu and add new ones starting with item zero.</span></span> <span data-ttu-id="a1f0c-120">Aber die intuitivere Ansatz zum Ersetzen aller Elemente im Kontextmenü zum Erstellen eines neuen <xref:System.Windows.Controls.ContextMenu>mit Elementen zu füllen, und legen Sie dann die <xref:System.Windows.FrameworkElement.ContextMenu%2A?displayProperty=nameWithType> Eigenschaft eines Steuerelements auf das neue <xref:System.Windows.Controls.ContextMenu>.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-120">But the more intuitive approach for replacing all items in the context menu is to create a new <xref:System.Windows.Controls.ContextMenu>, populate it with items, and then set the <xref:System.Windows.FrameworkElement.ContextMenu%2A?displayProperty=nameWithType> property of a control to be the new <xref:System.Windows.Controls.ContextMenu>.</span></span>  
  
 <span data-ttu-id="a1f0c-121">Im folgenden ist der einfache Handler-Code zum Ersetzen einer <xref:System.Windows.Controls.ContextMenu>.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-121">The following is the simple handler code for replacing a <xref:System.Windows.Controls.ContextMenu>.</span></span> <span data-ttu-id="a1f0c-122">Der Code verweist auf eine benutzerdefinierte `BuildMenu` -Methode, die getrennt ist, da sie aufgerufen wird von mehr als einer der Beispiel-Handler.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-122">The code references a custom `BuildMenu` method, which is separated out because it is called by more than one of the example handlers.</span></span>  
  
 [!code-csharp[ContextMenuOpeningHandlers#ReplaceNoReopen](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ContextMenuOpeningHandlers/CSharp/Pane1.xaml.cs#replacenoreopen)]  
  
 [!code-csharp[ContextMenuOpeningHandlers#BuildMenu](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ContextMenuOpeningHandlers/CSharp/Pane1.xaml.cs#buildmenu)]  
  
 <span data-ttu-id="a1f0c-123">Allerdings bei Verwendung von diese Art der Handler für <xref:System.Windows.FrameworkElement.ContextMenuOpening>, Sie können möglicherweise ein Problem der zeitlichen Steuerung bereitstellen, wenn das Objekt, das Sie, in dem Festlegen die <xref:System.Windows.Controls.ContextMenu> verfügt nicht über einen bereits vorhandenen Kontextmenü.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-123">However, if you use this style of handler for <xref:System.Windows.FrameworkElement.ContextMenuOpening>, you can potentially expose a timing issue if the object where you are setting the <xref:System.Windows.Controls.ContextMenu> does not have a preexisting context menu.</span></span> <span data-ttu-id="a1f0c-124">Wenn ein Benutzer ein Steuerelement, mit der rechten Maustaste <xref:System.Windows.FrameworkElement.ContextMenuOpening> wird ausgelöst, selbst wenn die vorhandene <xref:System.Windows.Controls.ContextMenu> ist leer oder null.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-124">When a user right-clicks a control, <xref:System.Windows.FrameworkElement.ContextMenuOpening> is raised even if the existing <xref:System.Windows.Controls.ContextMenu> is empty or null.</span></span> <span data-ttu-id="a1f0c-125">Aber in diesem Fall alle neuen <xref:System.Windows.Controls.ContextMenu> Sie festlegen, auf dem Quellcomputer Element zu spät empfangen, um angezeigt zu werden.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-125">But in this case, whatever new <xref:System.Windows.Controls.ContextMenu> you set on the source element arrives too late to be displayed.</span></span> <span data-ttu-id="a1f0c-126">Auch wenn der Benutzer wird der rechten Maustaste ein zweites Mal auf dieses Mal die neue <xref:System.Windows.Controls.ContextMenu> angezeigt wird, der Wert nicht Null ist, und Ihre Handler ordnungsgemäß ersetzen und klicken Sie im Menü angezeigt, wenn der Handler für ein zweites Mal ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-126">Also, if the user happens to right-click a second time, this time your new <xref:System.Windows.Controls.ContextMenu> appears, the value is non null, and your handler will properly replace and display the menu when the handler runs a second time.</span></span> <span data-ttu-id="a1f0c-127">Dies deutet darauf hin, zwei mögliche problemumgehungen:</span><span class="sxs-lookup"><span data-stu-id="a1f0c-127">This suggests two possible workarounds:</span></span>  
  
1.  <span data-ttu-id="a1f0c-128">Stellen Sie sicher, die <xref:System.Windows.FrameworkElement.ContextMenuOpening> Handler, die immer für Steuerelemente, die über mindestens einen Platzhalter ausführen <xref:System.Windows.Controls.ContextMenu> verfügbar ist, die mit dem Ereignishandlercode ersetzt werden sollen.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-128">Insure that <xref:System.Windows.FrameworkElement.ContextMenuOpening> handlers always run against controls that have at least a placeholder <xref:System.Windows.Controls.ContextMenu> available, which you intend to be replaced by the handler code.</span></span> <span data-ttu-id="a1f0c-129">In diesem Fall können Sie trotzdem den Handler, der im vorherigen Beispiel gezeigt verwenden, aber Sie möchten in der Regel weisen Sie einen Platzhalter <xref:System.Windows.Controls.ContextMenu> im anfänglichen Markup:</span><span class="sxs-lookup"><span data-stu-id="a1f0c-129">In this case, you can still use the handler shown in the previous example, but you typically want to assign a placeholder <xref:System.Windows.Controls.ContextMenu> in the initial markup:</span></span>  
  
     [!code-xaml[ContextMenuOpeningHandlers#XAMLWithInitCM](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ContextMenuOpeningHandlers/CSharp/Pane1.xaml#xamlwithinitcm)]  
  
2.  <span data-ttu-id="a1f0c-130">Vorausgesetzt, dass der ursprüngliche <xref:System.Windows.Controls.ContextMenu> Wert kann null sein, basierend auf einer vorläufigen Logik.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-130">Assume that the initial <xref:System.Windows.Controls.ContextMenu> value might be null, based on some preliminary logic.</span></span> <span data-ttu-id="a1f0c-131">Sie können entweder <xref:System.Windows.Controls.ContextMenu> für Null oder ein Flag in Ihrem Code zu überprüfen, ob der Handler wurde mindestens einmal ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-131">You could either check <xref:System.Windows.Controls.ContextMenu> for null, or use a flag in your code to check whether your handler has been run at least once.</span></span> <span data-ttu-id="a1f0c-132">Da Sie davon ausgehen, dass die <xref:System.Windows.Controls.ContextMenu> geht es um werden angezeigt, den Handler an und legt dann <xref:System.Windows.RoutedEventArgs.Handled%2A> zu `true` in den Ereignisdaten.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-132">Because you assume that the <xref:System.Windows.Controls.ContextMenu> is about to be displayed, your handler then sets <xref:System.Windows.RoutedEventArgs.Handled%2A> to `true` in the event data.</span></span> <span data-ttu-id="a1f0c-133">Auf der <xref:System.Windows.Controls.ContextMenuService> , die verantwortlich für die Anzeige im Menü Kontext ist eine `true` Wert für <xref:System.Windows.RoutedEventArgs.Handled%2A> in dieser Daten eine Anforderung zum Abbrechen der Anzeige für das Kontextmenü / zum Steuerelement-Kombination, die das Ereignis ausgelöst hat darstellt.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-133">To the <xref:System.Windows.Controls.ContextMenuService> that is responsible for context menu display, a `true` value for <xref:System.Windows.RoutedEventArgs.Handled%2A> in the event data represents a request to cancel the display for the context menu / control combination that raised the event.</span></span>  
  
 <span data-ttu-id="a1f0c-134">Nun, da Sie das Kontextmenü für die potenziell verdächtige unterdrückt haben, ist der nächste Schritt, geben Sie eine neue Methode, klicken Sie dann anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-134">Now that you have suppressed the potentially suspect context menu, the next step is to supply a new one, then display it.</span></span> <span data-ttu-id="a1f0c-135">Einrichten der neuen im Grunde identisch mit der vorherigen Handler: Sie erstellen ein neues <xref:System.Windows.Controls.ContextMenu> und legen Sie die Steuerelement-Quelle <xref:System.Windows.FrameworkElement.ContextMenu%2A?displayProperty=nameWithType> Eigenschaft mit.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-135">Setting the new one is basically the same as the previous handler: you build a new <xref:System.Windows.Controls.ContextMenu> and set the control source's <xref:System.Windows.FrameworkElement.ContextMenu%2A?displayProperty=nameWithType> property with it.</span></span> <span data-ttu-id="a1f0c-136">Der zusätzliche Schritt ist, dass Sie jetzt die Anzeige des Kontextmenüs, erzwingen müssen, da Sie beim ersten Versuch unterdrückt.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-136">The additional step is that you must now force the display of the context menu, because you suppressed the first attempt.</span></span> <span data-ttu-id="a1f0c-137">Um die Anzeige zu erzwingen, legen Sie die <xref:System.Windows.Controls.Primitives.Popup.IsOpen%2A?displayProperty=nameWithType> Eigenschaft `true` im Ereignishandler.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-137">To force the display, you set the <xref:System.Windows.Controls.Primitives.Popup.IsOpen%2A?displayProperty=nameWithType> property to `true` within the handler.</span></span> <span data-ttu-id="a1f0c-138">Seien Sie vorsichtig, wenn Sie dies tun, da löst aus, öffnen das Kontextmenü im Handler der <xref:System.Windows.FrameworkElement.ContextMenuOpening> Ereignis wird erneut.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-138">Be careful when you do this, because opening the context menu in the handler raises the <xref:System.Windows.FrameworkElement.ContextMenuOpening> event again.</span></span> <span data-ttu-id="a1f0c-139">Wenn Sie Ihren Handler erneut eingeben, wird er endlos rekursiv.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-139">If you reenter your handler, it becomes infinitely recursive.</span></span> <span data-ttu-id="a1f0c-140">Aus diesem Grund Sie immer zu prüfen müssen, ist `null` , oder verwenden Sie ein Flag, wenn Sie ein Kontextmenü öffnen, die sich innerhalb einer <xref:System.Windows.FrameworkElement.ContextMenuOpening> -Ereignishandler.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-140">This is why you always need to check for `null` or use a flag if you open a context menu from within a <xref:System.Windows.FrameworkElement.ContextMenuOpening> event handler.</span></span>  
  
## <a name="suppressing-any-existing-context-menu-and-displaying-no-context-menu"></a><span data-ttu-id="a1f0c-141">Unterdrücken vorhandenen Kontextmenü, und kein Kontextmenü angezeigt</span><span class="sxs-lookup"><span data-stu-id="a1f0c-141">Suppressing Any Existing Context Menu and Displaying No Context Menu</span></span>  
 <span data-ttu-id="a1f0c-142">Das letzte Szenario, schreiben einen Handler, der ein Menü völlig unterdrückt ist ungewöhnlich.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-142">The final scenario, writing a handler that suppresses a menu totally, is uncommon.</span></span> <span data-ttu-id="a1f0c-143">Wenn ein bestimmtes Steuerelement kein Kontextmenü angezeigt werden soll, sind wahrscheinlich besser Möglichkeiten zum gewährleisten dies durch das Menü unterdrücken, sondern nur, wenn ein Benutzer es anfordert.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-143">If a given control is not supposed to display a context menu, there are probably more appropriate ways to assure this than by suppressing the menu just when a user requests it.</span></span> <span data-ttu-id="a1f0c-144">Aber wenn Sie den Handler So unterdrücken ein Kontextmenü, und zeigen nichts verwenden möchten, legen Sie Ihr Handler sollte einfach <xref:System.Windows.RoutedEventArgs.Handled%2A> zu `true` in den Ereignisdaten.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-144">But if you want to use the handler to suppress a context menu and show nothing, then your handler should simply set <xref:System.Windows.RoutedEventArgs.Handled%2A> to `true` in the event data.</span></span> <span data-ttu-id="a1f0c-145">Die <xref:System.Windows.Controls.ContextMenuService> , verantwortlich ist, für das Anzeigen eines Kontextmenüs die Ereignisdaten des Ereignisses überprüft, es auf dem Steuerelement ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-145">The <xref:System.Windows.Controls.ContextMenuService> that is responsible for displaying a context menu will check the event data of the event it raised on the control.</span></span> <span data-ttu-id="a1f0c-146">Wenn das Ereignis markiert wurde <xref:System.Windows.RoutedEventArgs.Handled%2A> an einer beliebigen Stelle entlang der Route, klicken Sie dann die Aktion des Öffnens Kontextmenüs, die das Ereignis initiiert hat unterdrückt wird.</span><span class="sxs-lookup"><span data-stu-id="a1f0c-146">If the event was marked <xref:System.Windows.RoutedEventArgs.Handled%2A> anywhere along the route, then the context menu open action that initiated the event is suppressed.</span></span>  
  
 [!code-csharp[ContextMenuOpeningHandlers#ReplaceReopen](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ContextMenuOpeningHandlers/CSharp/Pane1.xaml.cs#replacereopen)]  
  
## <a name="see-also"></a><span data-ttu-id="a1f0c-147">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="a1f0c-147">See also</span></span>
- <xref:System.Windows.Controls.ContextMenu>
- <xref:System.Windows.FrameworkElement.ContextMenu%2A?displayProperty=nameWithType>
- [<span data-ttu-id="a1f0c-148">Übersicht über Basiselemente</span><span class="sxs-lookup"><span data-stu-id="a1f0c-148">Base Elements Overview</span></span>](../../../../docs/framework/wpf/advanced/base-elements-overview.md)
- [<span data-ttu-id="a1f0c-149">Übersicht über ContextMenu</span><span class="sxs-lookup"><span data-stu-id="a1f0c-149">ContextMenu Overview</span></span>](../../../../docs/framework/wpf/controls/contextmenu-overview.md)
