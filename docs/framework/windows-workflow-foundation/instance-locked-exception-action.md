---
title: Instance Locked Exception Action
ms.date: 03/30/2017
ms.assetid: 164a5419-315c-4987-ad72-54cbdb88d402
ms.openlocfilehash: 3554975589bb6d55cef3611320d25687d1ee9ba6
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 11/26/2020
ms.locfileid: "96279856"
---
# <a name="instance-locked-exception-action"></a><span data-ttu-id="033ef-102">Instance Locked Exception Action</span><span class="sxs-lookup"><span data-stu-id="033ef-102">Instance Locked Exception Action</span></span>

<span data-ttu-id="033ef-103">Mit der <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceLockedExceptionAction%2A>-Eigenschaft des SQL-Workflowinstanzspeichers können Sie angeben, welche Aktion der SQL-Persistenzanbieter ausführen soll, wenn er <xref:System.Runtime.DurableInstancing.InstanceLockedException> empfängt.</span><span class="sxs-lookup"><span data-stu-id="033ef-103">The <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceLockedExceptionAction%2A> property of the SQL Workflow Instance Store lets you specify what action the SQL persistence provider should take when it receives an <xref:System.Runtime.DurableInstancing.InstanceLockedException>.</span></span> <span data-ttu-id="033ef-104">Der Persistenzanbieter empfängt diese Ausnahme, wenn er versucht, eine Workflowdienstinstanz zu sperren, die von einem anderen Diensthost gesperrt wurde.</span><span class="sxs-lookup"><span data-stu-id="033ef-104">The persistence provider receives this exception when it tries to lock a workflow service instance that is currently locked by another service host.</span></span> <span data-ttu-id="033ef-105">Folgende Werte sind für diese Eigenschaft möglich: <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>, <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry> und <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>.</span><span class="sxs-lookup"><span data-stu-id="033ef-105">The values for this property are <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>, <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry>, and <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>.</span></span> <span data-ttu-id="033ef-106">Der Standardwert lautet <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>.</span><span class="sxs-lookup"><span data-stu-id="033ef-106">The default value is <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>.</span></span> <span data-ttu-id="033ef-107">In der folgenden Liste werden die drei Optionen beschrieben:</span><span class="sxs-lookup"><span data-stu-id="033ef-107">The following list describes the three options:</span></span>  
  
- <span data-ttu-id="033ef-108"><xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>.</span><span class="sxs-lookup"><span data-stu-id="033ef-108"><xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>.</span></span> <span data-ttu-id="033ef-109">Der Dienst Host versucht nicht, die Workflow Dienst Instanz zu sperren, und übergibt <xref:System.Runtime.DurableInstancing.InstanceLockedException> an den Aufrufer.</span><span class="sxs-lookup"><span data-stu-id="033ef-109">The service host does not attempt to lock the workflow service instance and passes the <xref:System.Runtime.DurableInstancing.InstanceLockedException> to the caller.</span></span>  <span data-ttu-id="033ef-110">Wenn Ihr Workflow für einen Zeitraum von mehr als 60 Sekunden im Arbeitsspeicher <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry> verbleibt, verwenden Sie als Wiederholungsversuch.</span><span class="sxs-lookup"><span data-stu-id="033ef-110">If your workflow stays in memory for a period exceeding 60 seconds, use <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry> as the retry.</span></span> <span data-ttu-id="033ef-111">Der Standardwert lautet <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>.</span><span class="sxs-lookup"><span data-stu-id="033ef-111">The default value is <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>.</span></span>  
  
- <span data-ttu-id="033ef-112"><xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry>.</span><span class="sxs-lookup"><span data-stu-id="033ef-112"><xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry>.</span></span> <span data-ttu-id="033ef-113">Der Diensthost versucht erneut, die Workflowdienstinstanz mit einem linearen Intervall zwischen Wiederholungsversuchen zu sperren, und übergibt am Ende der Sequenz <xref:System.Runtime.DurableInstancing.InstanceLockedException> an den Aufrufer.</span><span class="sxs-lookup"><span data-stu-id="033ef-113">The service host reattempts to lock the workflow service instance with a linear interval between retry attempts and passes the <xref:System.Runtime.DurableInstancing.InstanceLockedException> to the caller at the end of the sequence.</span></span> <span data-ttu-id="033ef-114">Wenn der Workflow etwa zwischen 5-60 Sekunden im Arbeitsspeicher verbleibt und Nachrichten in Batches empfangen werden, wobei es wahrscheinlicher ist, dass die Nachrichten an dieselbe Instanz auf demselben Host gesendet werden, um alle Nachrichten zu verarbeiten, bevor der Workflow entladen wird, verwenden Sie <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry>, um die beste Latenz zu erreichen, ohne Ressourcen zu vergeuden.</span><span class="sxs-lookup"><span data-stu-id="033ef-114">If you workflow stays in memory approximately between 5-60 seconds, and messages arrive in batches where it is more likely for messages being sent to the same instance on the same host to process all messages before unloading the workflow, use <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry> to achieve the best latency without wasting resources.</span></span>  
  
- <span data-ttu-id="033ef-115"><xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>.</span><span class="sxs-lookup"><span data-stu-id="033ef-115"><xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>.</span></span> <span data-ttu-id="033ef-116">Der Diensthost versucht erneut, die Workflowdienstinstanz mit einem exponentiellen Backoffintervall zwischen Wiederholungsversuchen zu sperren, und übergibt am Ende der Sequenz die Ausnahme an den Aufrufer.</span><span class="sxs-lookup"><span data-stu-id="033ef-116">The service host reattempts to lock the workflow service instance with an exponential backoff interval between retry attempts, and passes the exception to the caller at the end of the sequence.</span></span> <span data-ttu-id="033ef-117">Wenn der Workflow nur sehr kurze Zeit (weniger als 5 Sekunden) im Arbeitsspeicher verbleibt oder eine Webfarm umfangreich ist und die Wahrscheinlichkeit, dass demselben Host eine weitere Nachricht zugestellt wird, nicht sehr hoch ist, verwenden Sie <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>, um die beste Latenz zu erzielen.</span><span class="sxs-lookup"><span data-stu-id="033ef-117">If your workflow stays in memory for a very short time (less than 5 seconds), or a Web farm is large and the chance of another message being delivered to the same host is not very high, use <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry> to achieve the best latency.</span></span>  
  
 <span data-ttu-id="033ef-118">Die Funktion Instance Locked Exception Action unterstützt die folgenden Szenarios.</span><span class="sxs-lookup"><span data-stu-id="033ef-118">The Instance Locked Exception Action feature supports the following scenarios.</span></span> <span data-ttu-id="033ef-119">Für alle Szenarios gilt: Wenn die instanceLockedExceptionAction-Eigenschaft von SqlWorkflowInstanceStore auf <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry> oder <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry> festgelegt ist, versucht der Host in regelmäßigen Abständen und transparent erneut, die Sperre für die Instanzen durchzusetzen.</span><span class="sxs-lookup"><span data-stu-id="033ef-119">In all scenarios, if the instanceLockedExceptionAction property of the SqlWorkflowInstanceStore is set to <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry> or <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>, the host transparently retries to acquire the lock on instances periodically.</span></span>  
  
1. <span data-ttu-id="033ef-120">**Ordnungsgemäßes Herunterfahren und überlappende Wiederverwendung von Anwendungsdomänen.**</span><span class="sxs-lookup"><span data-stu-id="033ef-120">**Enabling graceful shutdown and overlapped recycling of application domains.**</span></span> <span data-ttu-id="033ef-121">Angenommen, eine **AppDomain** mit einem Dienst Host, der Workflow Dienst Instanzen ausführt, wird wieder verwendet, und es wird eine neue **AppDomain** hochgefahren, um neue Anforderungen parallel zu verarbeiten, während die alte **AppDomain** ordnungsgemäß heruntergefahren wird.</span><span class="sxs-lookup"><span data-stu-id="033ef-121">Suppose an **AppDomain** with a service host running workflow service instances is being recycled and a new **AppDomain** is brought up to handle new requests in parallel while the old **AppDomain** is brought down gracefully.</span></span> <span data-ttu-id="033ef-122">Mit dem Herunterfahren wird gewartet, bis die Workflowdienstinstanzen sich im Leerlauf befinden. Dann werden die Instanzen in den Persistenzspeicher verschoben und entladen.</span><span class="sxs-lookup"><span data-stu-id="033ef-122">The shutdown waits until workflow service instances are idle, and then persists and unloads the instances.</span></span> <span data-ttu-id="033ef-123">Alle Versuche von Hosts in der neuen **AppDomain** , eine Instanz zu sperren, führen zu einer <xref:System.Runtime.DurableInstancing.InstanceLockedException> .</span><span class="sxs-lookup"><span data-stu-id="033ef-123">Any attempts by hosts in the new **AppDomain** to lock an instance will cause an <xref:System.Runtime.DurableInstancing.InstanceLockedException>.</span></span>  
  
2. <span data-ttu-id="033ef-124">**Horizontale Skalierung permanenter Workflows in einer homogenen Serverfarm.**</span><span class="sxs-lookup"><span data-stu-id="033ef-124">**Horizontally scaling durable workflows across a homogeneous farm of servers.**</span></span> <span data-ttu-id="033ef-125">Nehmen Sie an, ein Knoten in einer Serverfarm, auf dem eine Workflowinstanz ausgeführt wird, stürzt ab, und der Workflowhost kann die Sperren der ausgeführten Instanz nicht aufheben.</span><span class="sxs-lookup"><span data-stu-id="033ef-125">Suppose a node of a server farm on which a workflow instance is running crashes and the workflow host cannot remove locks on the instance it is running.</span></span> <span data-ttu-id="033ef-126">Wenn an einem Diensthost, der auf einem anderen Knoten der Farm ausgeführt wird, eine Meldung für diese Workflowinstanz eingeht und dieser versucht, die Instanzen zu sperren, erhält er <xref:System.Runtime.DurableInstancing.InstanceLockedException>.</span><span class="sxs-lookup"><span data-stu-id="033ef-126">When a service host running on another node of the farm receives a message for that workflow instance, it tries to acquire locks on these instances it will receive the <xref:System.Runtime.DurableInstancing.InstanceLockedException>.</span></span> <span data-ttu-id="033ef-127">Die Sperren laufen nach einem gewissen Zeitraum ab, da der für die Erneuerung der Sperren zuständige Host nicht mehr vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="033ef-127">The locks will expire after some time because the host that was supposed to renew the lock no longer exists.</span></span>  
  
     <span data-ttu-id="033ef-128">**Horizontale Skalierung permanenter Workflows in einer homogenen Serverfarm.**</span><span class="sxs-lookup"><span data-stu-id="033ef-128">**Horizontally scaling durable workflows across a homogeneous farm of servers.**</span></span>  <span data-ttu-id="033ef-129"> Nehmen Sie an, Sie möchten einen permanenten Workflow mit mehreren Hosts horizontal skalieren, denen ein Netzwerklastenausgleich (Network Load Balancer, NLB) vorgeschaltet ist. Der Workflowhost, der auf einem Knoten der Farm ausgeführt wird, lädt eine Workflowinstanz und verarbeitet eine Meldung, und die nächste Meldung für die Instanz wird an einen Host weitergeleitet, der auf einem anderen Knoten ausgeführt wird, da der Netzwerklastenausgleich über keinen Routingalgorithmus zur Weiterleitung von Meldungen an den Host verfügt, der die Instanz bereits ausführt.</span><span class="sxs-lookup"><span data-stu-id="033ef-129">Suppose you want to horizontally scale a durable workflow using multiple hosts behind a NLB (Network Load Balancer), the workflow host running on one node of the farm loads a workflow instance and is processing a message, and the next message to the instance is routed to the host that is running on another node because the NLB does not have routing algorithm to deliver messages to the host that is already running the instance.</span></span> <span data-ttu-id="033ef-130">Bei Erhalt der Meldung versucht der zweite Host, die Workflowinstanz zu laden. Da diese jedoch durch den ersten Host gesperrt wurde, wird die <xref:System.Runtime.DurableInstancing.InstanceLockedException>-Ausnahme ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="033ef-130">Upon receiving the message, the second host attempts to load the workflow instance and receives the <xref:System.Runtime.DurableInstancing.InstanceLockedException> because the first host has a lock on the instance.</span></span> <span data-ttu-id="033ef-131">Der erste Host entsperrt die Instanz, wenn die Verarbeitung der ersten Meldung abgeschlossen ist, und der zweite Host kann die Instanz beim nächsten Versuch erfolgreich sperren, laden und die zweite Meldung verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="033ef-131">The first host unlocks the instance when it is finished with processing the first message and the second host acquires the lock when it retries the next time, loads the instance, and processes the second message.</span></span>
