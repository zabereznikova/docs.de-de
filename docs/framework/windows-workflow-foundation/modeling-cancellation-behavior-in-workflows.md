---
title: Modellieren des Abbruchverhaltens in Workflows
ms.date: 03/30/2017
ms.assetid: d48f6cf3-cdde-4dd3-8265-a665acf32a03
ms.openlocfilehash: 157bff0d24b00f293fd551dd52fe693d36dfad61
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 11/26/2020
ms.locfileid: "96242057"
---
# <a name="modeling-cancellation-behavior-in-workflows"></a><span data-ttu-id="df65c-102">Modellieren des Abbruchverhaltens in Workflows</span><span class="sxs-lookup"><span data-stu-id="df65c-102">Modeling Cancellation Behavior in Workflows</span></span>

<span data-ttu-id="df65c-103">Aktivitäten können innerhalb eines Workflows abgebrochen werden, z. B. durch eine <xref:System.Activities.Statements.Parallel>-Aktivität, die unvollständige Verzweigungen abbricht, wenn ihre <xref:System.Activities.Statements.Parallel.CompletionCondition%2A>`true` ergibt, oder von außerhalb des Workflows, wenn der Host <xref:System.Activities.WorkflowApplication.Cancel%2A> aufruft.</span><span class="sxs-lookup"><span data-stu-id="df65c-103">Activities can be canceled inside a workflow, for example by a <xref:System.Activities.Statements.Parallel> activity canceling incomplete branches when its <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> evaluates to `true`, or from outside the workflow, if the host calls <xref:System.Activities.WorkflowApplication.Cancel%2A>.</span></span> <span data-ttu-id="df65c-104">Workflowautoren können die Abbruchbehandlung mithilfe der <xref:System.Activities.Statements.CancellationScope>-Aktivität oder der <xref:System.Activities.Statements.CompensableActivity>-Aktivität bereitstellen oder können benutzerdefinierte Aktivitäten erstellen, die eine Abbruchlogik bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="df65c-104">To provide cancellation handling, workflow authors can use the <xref:System.Activities.Statements.CancellationScope> activity, the <xref:System.Activities.Statements.CompensableActivity> activity, or create custom activities that provide cancellation logic.</span></span> <span data-ttu-id="df65c-105">Dieses Thema bietet eine Übersicht über den Abbruch in Workflows.</span><span class="sxs-lookup"><span data-stu-id="df65c-105">This topic provides an overview of cancellation in workflows.</span></span>  
  
## <a name="cancellation-compensation-and-transactions"></a><span data-ttu-id="df65c-106">Abbruch, Kompensation und Transaktionen</span><span class="sxs-lookup"><span data-stu-id="df65c-106">Cancellation, Compensation, and Transactions</span></span>  

 <span data-ttu-id="df65c-107">Wenn Sie Transaktionen verwenden, kann Ihre Anwendung alle Änderungen zurücknehmen (Rollback), die innerhalb der Transaktion ausgeführt wurden, falls während des Transaktionsprozesses ein Fehler auftritt.</span><span class="sxs-lookup"><span data-stu-id="df65c-107">Transactions give your application the ability to abort (roll back) all changes executed within the transaction if any errors occur during any part of the transaction process.</span></span> <span data-ttu-id="df65c-108">Möglicherweise ist jedoch nicht die gesamte Arbeit, die abgebrochen oder rückgängig gemacht werden muss, für Transaktionen geeignet, beispielsweise Prozesse mit langer Laufzeit oder Aufgaben, die keine Transaktionsressourcen einschließen.</span><span class="sxs-lookup"><span data-stu-id="df65c-108">However, not all work that may need to be canceled or undone is appropriate for transactions, such as long-running work or work that does not involve transactional resources.</span></span> <span data-ttu-id="df65c-109">Die Kompensation stellt ein Modell zum Rückgängigmachen von zuvor abgeschlossenen, nicht transaktionalen Aufgaben bereit, wenn im Workflow ein nachfolgender Fehler auftritt.</span><span class="sxs-lookup"><span data-stu-id="df65c-109">Compensation provides a model for undoing previously completed non-transactional work if there is a subsequent failure in the workflow.</span></span> <span data-ttu-id="df65c-110">Der Abbruch stellt ein Modell für Workflow- und Aktivitätsautoren zum Behandeln von nicht transaktionalen Aufgaben bereit, die noch nicht abgeschlossen waren.</span><span class="sxs-lookup"><span data-stu-id="df65c-110">Cancellation provides a model for workflow and activity authors to handle non-transactional work that was not completed.</span></span> <span data-ttu-id="df65c-111">Wenn die Ausführung einer Aktivität nicht abgeschlossen war und abgebrochen wird, wird die Abbruchlogik aufgerufen, falls verfügbar.</span><span class="sxs-lookup"><span data-stu-id="df65c-111">If an activity has not completed its execution and it is canceled, its cancellation logic will be invoked if it is available.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="df65c-112">Weitere Informationen zu Transaktionen und Kompensierungen finden Sie unter [Transaktionen](workflow-transactions.md) und [Kompensierung](compensation.md).</span><span class="sxs-lookup"><span data-stu-id="df65c-112">For more information about transactions and compensation, see [Transactions](workflow-transactions.md) and [Compensation](compensation.md).</span></span>  
  
## <a name="using-cancellationscope"></a><span data-ttu-id="df65c-113">Verwenden von CancellationScope</span><span class="sxs-lookup"><span data-stu-id="df65c-113">Using CancellationScope</span></span>  

 <span data-ttu-id="df65c-114">Die <xref:System.Activities.Statements.CancellationScope>-Aktivität verfügt über zwei Abschnitte, die untergeordnete Aktivitäten enthalten können: <xref:System.Activities.Statements.CancellationScope.Body%2A> und <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>.</span><span class="sxs-lookup"><span data-stu-id="df65c-114">The <xref:System.Activities.Statements.CancellationScope> activity has two sections that can contain child activities: <xref:System.Activities.Statements.CancellationScope.Body%2A> and <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>.</span></span> <span data-ttu-id="df65c-115">Im <xref:System.Activities.Statements.CancellationScope.Body%2A> befinden sich die Aktivitäten, aus denen die Logik der Aktivität besteht, und im <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> befinden sich die Aktivitäten, die die Abbruchlogik für die Aktivität bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="df65c-115">The <xref:System.Activities.Statements.CancellationScope.Body%2A> is where the activities that make up the logic of the activity are placed, and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> is where the activities that provide cancellation logic for the activity are placed.</span></span> <span data-ttu-id="df65c-116">Eine Aktivität kann nur abgebrochen werden, wenn sie noch nicht abgeschlossen wurde.</span><span class="sxs-lookup"><span data-stu-id="df65c-116">An activity can be canceled only if it has not completed.</span></span> <span data-ttu-id="df65c-117">Im Fall der <xref:System.Activities.Statements.CancellationScope>-Aktivität verweist der Abschluss auf den Abschluss der Aktivitäten im <xref:System.Activities.Statements.CancellationScope.Body%2A>.</span><span class="sxs-lookup"><span data-stu-id="df65c-117">In the case of the <xref:System.Activities.Statements.CancellationScope> activity, completion refers to the completion of the activities in the <xref:System.Activities.Statements.CancellationScope.Body%2A>.</span></span> <span data-ttu-id="df65c-118">Wenn eine Abbruchanforderung geplant ist und die Aktivitäten im <xref:System.Activities.Statements.CancellationScope.Body%2A> nicht abgeschlossen wurden, dann wird der <xref:System.Activities.Statements.CancellationScope> als <xref:System.Activities.ActivityInstanceState.Canceled> markiert, und die <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>-Aktivitäten werden ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="df65c-118">If a cancellation request is scheduled and the activities in the <xref:System.Activities.Statements.CancellationScope.Body%2A> have not completed, then the <xref:System.Activities.Statements.CancellationScope> will be marked as <xref:System.Activities.ActivityInstanceState.Canceled> and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> activities will be executed.</span></span>  
  
### <a name="canceling-a-workflow-from-the-host"></a><span data-ttu-id="df65c-119">Abbrechen eines Workflows vom Host aus</span><span class="sxs-lookup"><span data-stu-id="df65c-119">Canceling a Workflow from the Host</span></span>  

 <span data-ttu-id="df65c-120">Ein Host kann einen Workflow abbrechen, indem er die <xref:System.Activities.WorkflowApplication.Cancel%2A>-Methode der <xref:System.Activities.WorkflowApplication>-Instanz aufruft, die den Workflow hostet.</span><span class="sxs-lookup"><span data-stu-id="df65c-120">A host can cancel a workflow by calling the <xref:System.Activities.WorkflowApplication.Cancel%2A> method of the <xref:System.Activities.WorkflowApplication> instance that is hosting the workflow.</span></span> <span data-ttu-id="df65c-121">Im folgenden Beispiel wird ein Workflow erstellt, der einen <xref:System.Activities.Statements.CancellationScope> aufweist.</span><span class="sxs-lookup"><span data-stu-id="df65c-121">In the following example a workflow is created that has a <xref:System.Activities.Statements.CancellationScope>.</span></span> <span data-ttu-id="df65c-122">Der Workflow wird aufgerufen und anschließend ruft der Host <xref:System.Activities.WorkflowApplication.Cancel%2A> auf.</span><span class="sxs-lookup"><span data-stu-id="df65c-122">The workflow is invoked, and then the host makes a call to <xref:System.Activities.WorkflowApplication.Cancel%2A>.</span></span> <span data-ttu-id="df65c-123">Die Hauptausführung des Workflows wird beendet, der <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> des <xref:System.Activities.Statements.CancellationScope> wird aufgerufen, und dann wird der Workflow mit einem Status von <xref:System.Activities.ActivityInstanceState.Canceled> abgeschlossen.</span><span class="sxs-lookup"><span data-stu-id="df65c-123">The main execution of the workflow is stopped, the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> of the <xref:System.Activities.Statements.CancellationScope> is invoked, and then the workflow completes with a status of <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#35](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#35)]  
  
 <span data-ttu-id="df65c-124">Wenn dieser Workflow aufgerufen wird, wird die folgende Ausgabe in der Konsole angezeigt.</span><span class="sxs-lookup"><span data-stu-id="df65c-124">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="df65c-125">**Starten des Workflows.**</span><span class="sxs-lookup"><span data-stu-id="df65c-125">**Starting the workflow.**</span></span>  
<span data-ttu-id="df65c-126">**Cancellationhandler aufgerufen.** 
 **Workflow b30ebb30-df46-4d90-a211-e31c38d8db3c abgebrochen.**</span><span class="sxs-lookup"><span data-stu-id="df65c-126">**CancellationHandler invoked.**
**Workflow b30ebb30-df46-4d90-a211-e31c38d8db3c Canceled.**</span></span>
> [!NOTE]
> <span data-ttu-id="df65c-127">Wenn eine <xref:System.Activities.Statements.CancellationScope>-Aktivität abgebrochen und der <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> aufgerufen wird, liegt es in der Verantwortung des Workflowautors, den Status der abgebrochenen Aktivität vor dem Abbruch zu bestimmen, um die entsprechende Abbruchlogik bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="df65c-127">When a <xref:System.Activities.Statements.CancellationScope> activity is canceled and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> invoked, it is the responsibility of the workflow author to determine the progress that the canceled activity made before it was canceled in order to provide the appropriate cancellation logic.</span></span> <span data-ttu-id="df65c-128">Der <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> stellt keine Informationen zum Status der abgebrochenen Aktivität bereit.</span><span class="sxs-lookup"><span data-stu-id="df65c-128">The <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> does not provide any information about the progress of the canceled activity.</span></span>  
  
 <span data-ttu-id="df65c-129">Ein Workflow kann auch vom Host abgebrochen werden, wenn eine nicht behandelte Ausnahme nach dem Stamm des Workflows ausgelöst wird und der <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A>-Handler <xref:System.Activities.UnhandledExceptionAction.Cancel> zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="df65c-129">A workflow can also be canceled from the host if an unhandled exception bubbles up past the root of the workflow and the <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> handler returns <xref:System.Activities.UnhandledExceptionAction.Cancel>.</span></span> <span data-ttu-id="df65c-130">In diesem Beispiel startet der Workflow und löst dann eine <xref:System.ApplicationException> aus.</span><span class="sxs-lookup"><span data-stu-id="df65c-130">In this example the workflow starts and then throws an <xref:System.ApplicationException>.</span></span> <span data-ttu-id="df65c-131">Diese Ausnahme wird vom Workflow nicht behandelt, daher wird der <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A>-Handler aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="df65c-131">This exception is unhandled by the workflow and so the <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> handler is invoked.</span></span> <span data-ttu-id="df65c-132">Der Handler weist die Laufzeit an, den Workflow abzubrechen, und der <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> der derzeit ausgeführten <xref:System.Activities.Statements.CancellationScope>-Aktivität wird aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="df65c-132">The handler instructs the runtime to cancel the workflow, and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> of the currently executing <xref:System.Activities.Statements.CancellationScope> activity is invoked.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#36](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#36)]  
  
 <span data-ttu-id="df65c-133">Wenn dieser Workflow aufgerufen wird, wird die folgende Ausgabe in der Konsole angezeigt.</span><span class="sxs-lookup"><span data-stu-id="df65c-133">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="df65c-134">**Starten des Workflows.**</span><span class="sxs-lookup"><span data-stu-id="df65c-134">**Starting the workflow.**</span></span>  
<span data-ttu-id="df65c-135">**Onunlenker dexception in Workflow 6bb2d5d6-f49a-4c6d-A988-478afb86dbe9** 
 Es **wurde eine ApplicationException ausgelöst.** 
 **Cancellationhandler aufgerufen.** 
 **Workflow 6bb2d5d6-f49a-4c6d-A988-478afb86dbe9 abgebrochen.**</span><span class="sxs-lookup"><span data-stu-id="df65c-135">**OnUnhandledException in Workflow 6bb2d5d6-f49a-4c6d-a988-478afb86dbe9**
**An ApplicationException was thrown.**
**CancellationHandler invoked.**
**Workflow 6bb2d5d6-f49a-4c6d-a988-478afb86dbe9 Canceled.**</span></span>

### <a name="canceling-an-activity-from-inside-a-workflow"></a><span data-ttu-id="df65c-136">Abbrechen einer Aktivität innerhalb eines Workflows</span><span class="sxs-lookup"><span data-stu-id="df65c-136">Canceling an Activity from Inside a Workflow</span></span>  

 <span data-ttu-id="df65c-137">Eine Aktivität kann auch von ihrem übergeordneten Element abgebrochen werden.</span><span class="sxs-lookup"><span data-stu-id="df65c-137">An activity can also be canceled by its parent.</span></span> <span data-ttu-id="df65c-138">Wenn eine <xref:System.Activities.Statements.Parallel>-Aktivität beispielsweise über mehrere ausgeführte Branches verfügt, und ihre <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> ergibt `true`, werden ihre unvollständigen Branches abgebrochen.</span><span class="sxs-lookup"><span data-stu-id="df65c-138">For example, if a <xref:System.Activities.Statements.Parallel> activity has multiple executing branches and its <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> evaluates to `true` then its incomplete branches will be canceled.</span></span> <span data-ttu-id="df65c-139">In diesem Beispiel wird eine <xref:System.Activities.Statements.Parallel>-Aktivität erstellt, das zwei Branches aufweist.</span><span class="sxs-lookup"><span data-stu-id="df65c-139">In this example a <xref:System.Activities.Statements.Parallel> activity is created that has two branches.</span></span> <span data-ttu-id="df65c-140">Ihre <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> ist auf `true` festgelegt, damit die <xref:System.Activities.Statements.Parallel> abgeschlossen wird, sobald der einzelne Branch abgeschlossen sind.</span><span class="sxs-lookup"><span data-stu-id="df65c-140">Its <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> is set to `true` so the <xref:System.Activities.Statements.Parallel> completes as soon as any one of its branches is completed.</span></span> <span data-ttu-id="df65c-141">In diesem Beispiel wird Branch 2 abgeschlossen, daher wird Branch 1 abgebrochen.</span><span class="sxs-lookup"><span data-stu-id="df65c-141">In this example branch 2 completes, and so branch 1 is canceled.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#37](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#37)]  
  
 <span data-ttu-id="df65c-142">Wenn dieser Workflow aufgerufen wird, wird die folgende Ausgabe in der Konsole angezeigt.</span><span class="sxs-lookup"><span data-stu-id="df65c-142">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="df65c-143">**Starten von Branch 1.**</span><span class="sxs-lookup"><span data-stu-id="df65c-143">**Branch 1 starting.**</span></span>  
<span data-ttu-id="df65c-144">**Branch 2 ist fertiggestellt.** 
 **Branch 1 wurde abgebrochen.** 
 **Workflow e0685e24-18ef-4A47-acf3-5c638732f3be abgeschlossen.**</span><span class="sxs-lookup"><span data-stu-id="df65c-144">**Branch 2 complete.**
**Branch 1 canceled.**
**Workflow e0685e24-18ef-4a47-acf3-5c638732f3be Completed.**</span></span>  <span data-ttu-id="df65c-145">Aktivitäten werden auch abgebrochen, wenn eine Ausnahme nach den Stamm der Aktivität ausgelöst wird, jedoch auf einer höheren Ebene im Workflow behandelt wird.</span><span class="sxs-lookup"><span data-stu-id="df65c-145">Activities are also canceled if an exception bubbles up past the root of the activity but is handled at a higher level in the workflow.</span></span> <span data-ttu-id="df65c-146">In diesem Beispiel besteht die Hauptlogik des Workflows aus einer <xref:System.Activities.Statements.Sequence>-Aktivität.</span><span class="sxs-lookup"><span data-stu-id="df65c-146">In this example, the main logic of the workflow consists of a <xref:System.Activities.Statements.Sequence> activity.</span></span> <span data-ttu-id="df65c-147">Die <xref:System.Activities.Statements.Sequence> wird als <xref:System.Activities.Statements.CancellationScope.Body%2A> einer <xref:System.Activities.Statements.CancellationScope>-Aktivität angegeben, die in einer <xref:System.Activities.Statements.TryCatch>-Aktivität enthalten ist.</span><span class="sxs-lookup"><span data-stu-id="df65c-147">The <xref:System.Activities.Statements.Sequence> is specified as the <xref:System.Activities.Statements.CancellationScope.Body%2A> of a <xref:System.Activities.Statements.CancellationScope> activity which is contained by a <xref:System.Activities.Statements.TryCatch> activity.</span></span> <span data-ttu-id="df65c-148">Aus dem Text der <xref:System.Activities.Statements.Sequence> wird eine Ausnahme ausgelöst, die von der übergeordneten <xref:System.Activities.Statements.TryCatch>-Aktivität behandelt wird, und die <xref:System.Activities.Statements.Sequence> wird abgebrochen.</span><span class="sxs-lookup"><span data-stu-id="df65c-148">An exception is thrown from the body of the <xref:System.Activities.Statements.Sequence>, is handled by the parent <xref:System.Activities.Statements.TryCatch> activity, and the <xref:System.Activities.Statements.Sequence> is canceled.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#39](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#39)]  
  
 <span data-ttu-id="df65c-149">Wenn dieser Workflow aufgerufen wird, wird die folgende Ausgabe in der Konsole angezeigt.</span><span class="sxs-lookup"><span data-stu-id="df65c-149">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="df65c-150">**Die Sequenz wird gestartet.**</span><span class="sxs-lookup"><span data-stu-id="df65c-150">**Sequence starting.**</span></span>  
<span data-ttu-id="df65c-151">**Sequenz abgebrochen.** 
 **Aufgefangene Ausnahme.** 
 **Workflow e3c18939-121E-4c43-af1c-ba1ce977ce55 abgeschlossen.**</span><span class="sxs-lookup"><span data-stu-id="df65c-151">**Sequence canceled.**
**Exception caught.**
**Workflow e3c18939-121e-4c43-af1c-ba1ce977ce55 Completed.**</span></span>

### <a name="throwing-exceptions-from-a-cancellationhandler"></a><span data-ttu-id="df65c-152">Auslösen von Ausnahmen von einem CancellationHandler aus</span><span class="sxs-lookup"><span data-stu-id="df65c-152">Throwing Exceptions from a CancellationHandler</span></span>  

 <span data-ttu-id="df65c-153">Alle vom <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> eines <xref:System.Activities.Statements.CancellationScope> ausgelösten Ausnahmen haben schwerwiegende Auswirkungen auf den Workflow.</span><span class="sxs-lookup"><span data-stu-id="df65c-153">Any exceptions thrown from the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> of a <xref:System.Activities.Statements.CancellationScope> are fatal to the workflow.</span></span> <span data-ttu-id="df65c-154">Wenn für Ausnahmen die Möglichkeit besteht, einen <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> zu umgehen, verwenden Sie im <xref:System.Activities.Statements.TryCatch><xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>, um diese Ausnahmen abzufangen und zu behandeln.</span><span class="sxs-lookup"><span data-stu-id="df65c-154">If there is a possibility of exceptions escaping from a <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>, use a <xref:System.Activities.Statements.TryCatch> in the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> to catch and handle these exceptions.</span></span>  
  
### <a name="cancellation-using-compensableactivity"></a><span data-ttu-id="df65c-155">Abbruch mithilfe von CompensableActivity</span><span class="sxs-lookup"><span data-stu-id="df65c-155">Cancellation using CompensableActivity</span></span>  

 <span data-ttu-id="df65c-156">Genau wie die <xref:System.Activities.Statements.CancellationScope>-Aktivität verfügt die <xref:System.Activities.Statements.CompensableActivity> über einen <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A>.</span><span class="sxs-lookup"><span data-stu-id="df65c-156">Like the <xref:System.Activities.Statements.CancellationScope> activity, the <xref:System.Activities.Statements.CompensableActivity> has a <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A>.</span></span> <span data-ttu-id="df65c-157">Wenn eine <xref:System.Activities.Statements.CompensableActivity> abgebrochen wird, werden alle Aktivitäten in ihrem <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A> aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="df65c-157">If a <xref:System.Activities.Statements.CompensableActivity> is canceled, any activities in its <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A> are invoked.</span></span> <span data-ttu-id="df65c-158">Dies kann nützlich für das Rückgängigmachen teilweise abgeschlossener Arbeit sein.</span><span class="sxs-lookup"><span data-stu-id="df65c-158">This can be useful for undoing partially completed compensable work.</span></span> <span data-ttu-id="df65c-159">Informationen zur Verwendung <xref:System.Activities.Statements.CompensableActivity> von für Kompensierung und Abbruch finden Sie unter [Kompensierung](compensation.md).</span><span class="sxs-lookup"><span data-stu-id="df65c-159">For information about how to use <xref:System.Activities.Statements.CompensableActivity> for compensation and cancellation, see [Compensation](compensation.md).</span></span>  
  
## <a name="cancellation-using-custom-activities"></a><span data-ttu-id="df65c-160">Abbruch mithilfe von benutzerdefinierten Aktivitäten</span><span class="sxs-lookup"><span data-stu-id="df65c-160">Cancellation using Custom Activities</span></span>  

 <span data-ttu-id="df65c-161">Für Autoren von benutzerdefinierten Aktivitäten gibt es mehrere Möglichkeiten, eine Abbruchlogik in ihre benutzerdefinierten Aktivitäten zu implementieren.</span><span class="sxs-lookup"><span data-stu-id="df65c-161">Custom activity authors can implement cancellation logic into their custom activities in several different ways.</span></span> <span data-ttu-id="df65c-162">Benutzerdefinierte Aktivitäten, die von <xref:System.Activities.Activity> abgeleitet werden, können Abbruchlogik implementieren, indem <xref:System.Activities.Statements.CancellationScope> oder eine andere benutzerdefinierte Aktivität, die Abbruchlogik enthält, in den Text der Aktivität eingefügt wird.</span><span class="sxs-lookup"><span data-stu-id="df65c-162">Custom activities that derive from <xref:System.Activities.Activity> can implement cancellation logic by placing a <xref:System.Activities.Statements.CancellationScope> or other custom activity that contains cancellation logic in the body of the activity.</span></span> <span data-ttu-id="df65c-163">Von <xref:System.Activities.AsyncCodeActivity> und <xref:System.Activities.NativeActivity> abgeleitete Aktivitäten können ihre jeweilige <xref:System.Activities.NativeActivity.Cancel%2A>-Methode überschreiben und an dieser Stelle eine Abbruchlogik bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="df65c-163"><xref:System.Activities.AsyncCodeActivity> and <xref:System.Activities.NativeActivity> derived activities can override their respective <xref:System.Activities.NativeActivity.Cancel%2A> method and provide cancellation logic there.</span></span> <span data-ttu-id="df65c-164">Von <xref:System.Activities.CodeActivity> abgeleitete Aktivitäten stellen keine Möglichkeit zum Abbruch dar, da die gesamte Arbeit in einer einzigen Ausführung ausgeführt wird, wenn die Laufzeit die <xref:System.Activities.CodeActivity.Execute%2A>-Methode aufruft.</span><span class="sxs-lookup"><span data-stu-id="df65c-164"><xref:System.Activities.CodeActivity> derived activities do not provide any provision for cancellation because all their work is performed in a single burst of execution when the runtime calls the <xref:System.Activities.CodeActivity.Execute%2A> method.</span></span> <span data-ttu-id="df65c-165">Wenn die execute-Methode noch nicht aufgerufen wurde und eine auf <xref:System.Activities.CodeActivity> basierende Aktivität abgebrochen wird, wird die Aktivität mit einem Status von <xref:System.Activities.ActivityInstanceState.Canceled> geschlossen, und die <xref:System.Activities.CodeActivity.Execute%2A>-Methode wird nicht aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="df65c-165">If the execute method has not yet been called and a <xref:System.Activities.CodeActivity> based activity is canceled, the activity closes with a status of <xref:System.Activities.ActivityInstanceState.Canceled> and the <xref:System.Activities.CodeActivity.Execute%2A> method is not called.</span></span>  
  
### <a name="cancellation-using-nativeactivity"></a><span data-ttu-id="df65c-166">Abbruch mithilfe von NativeActivity</span><span class="sxs-lookup"><span data-stu-id="df65c-166">Cancellation using NativeActivity</span></span>  

 <span data-ttu-id="df65c-167">Von <xref:System.Activities.NativeActivity> abgeleitete Aktivitäten können die <xref:System.Activities.NativeActivity.Cancel%2A>-Methode überschreiben, um eine benutzerdefinierte Abbruchlogik bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="df65c-167"><xref:System.Activities.NativeActivity> derived activities can override the <xref:System.Activities.NativeActivity.Cancel%2A> method to provide custom cancellation logic.</span></span> <span data-ttu-id="df65c-168">Wenn diese Methode nicht überschrieben wird, dann wird die standardmäßige Workflowabbruchlogik angewendet.</span><span class="sxs-lookup"><span data-stu-id="df65c-168">If this method is not overridden, then the default workflow cancellation logic is applied.</span></span> <span data-ttu-id="df65c-169">Der Standard Abbruch ist der Prozess, der für einen Auftritt <xref:System.Activities.NativeActivity> , der die-Methode nicht überschreibt <xref:System.Activities.NativeActivity.Cancel%2A> oder dessen- <xref:System.Activities.NativeActivity.Cancel%2A> Methode die-Basis <xref:System.Activities.NativeActivity> <xref:System.Activities.NativeActivity.Cancel%2A> Methode aufruft.</span><span class="sxs-lookup"><span data-stu-id="df65c-169">Default cancellation is the process that occurs for a <xref:System.Activities.NativeActivity> that does not override the <xref:System.Activities.NativeActivity.Cancel%2A> method or whose <xref:System.Activities.NativeActivity.Cancel%2A> method calls the base <xref:System.Activities.NativeActivity> <xref:System.Activities.NativeActivity.Cancel%2A> method.</span></span> <span data-ttu-id="df65c-170">Wenn eine Aktivität abgebrochen wird, kennzeichnet die Laufzeit die Aktivität für den Abbruch und behandelt automatisch eine bestimmte Bereinigung.</span><span class="sxs-lookup"><span data-stu-id="df65c-170">When an activity is canceled, the runtime flags the activity for cancellation and automatically handles certain cleanup.</span></span> <span data-ttu-id="df65c-171">Wenn die Aktivität nur über ausstehende Lesezeichen verfügt, werden die Lesezeichen entfernt, und die Aktivität wird als <xref:System.Activities.ActivityInstanceState.Canceled> markiert.</span><span class="sxs-lookup"><span data-stu-id="df65c-171">If the activity only has outstanding bookmarks, the bookmarks will be removed and the activity will be marked as <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span> <span data-ttu-id="df65c-172">Alle ausstehenden untergeordneten Aktivitäten in der abgebrochenen Aktivität werden dann abgebrochen.</span><span class="sxs-lookup"><span data-stu-id="df65c-172">Any outstanding child activities of the canceled activity will in turn be canceled.</span></span> <span data-ttu-id="df65c-173">Jeder Versuch zur Planung zusätzlicher untergeordneter Aktivitäten wird ignoriert wird, und die Aktivität wird als <xref:System.Activities.ActivityInstanceState.Canceled> markiert.</span><span class="sxs-lookup"><span data-stu-id="df65c-173">Any attempt to schedule additional child activities will result in the attempt being ignored and the activity will be marked as <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span> <span data-ttu-id="df65c-174">Wenn eine ausstehende untergeordnete Aktivität im Zustand <xref:System.Activities.ActivityInstanceState.Canceled> oder <xref:System.Activities.ActivityInstanceState.Faulted> abgeschlossen wird, wird die Aktivität als <xref:System.Activities.ActivityInstanceState.Canceled> markiert.</span><span class="sxs-lookup"><span data-stu-id="df65c-174">If any outstanding child activity completes in the <xref:System.Activities.ActivityInstanceState.Canceled> or <xref:System.Activities.ActivityInstanceState.Faulted> state, then the activity will be marked as <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span> <span data-ttu-id="df65c-175">Beachten Sie, dass eine Abbruchanforderung ignoriert werden kann.</span><span class="sxs-lookup"><span data-stu-id="df65c-175">Note that a cancellation request can be ignored.</span></span> <span data-ttu-id="df65c-176">Wenn eine Aktivität nicht über ausstehende Lesezeichen oder ausgeführte untergeordnete Aktivitäten verfügt und keine zusätzlichen Arbeitselemente plant, nachdem sie für einen Abbruch gekennzeichnet wurde, wird sie erfolgreich abgeschlossen.</span><span class="sxs-lookup"><span data-stu-id="df65c-176">If an activity does not have any outstanding bookmarks or executing child activities and does not schedule any additional work items after being flagged for cancellation, it will complete successfully.</span></span> <span data-ttu-id="df65c-177">Dieser standardmäßige Abbruch ist für viele Szenarien ausreichen, wenn jedoch eine zusätzliche Abbruchlogik erforderlich ist, können die integrierten Abbruchaktivitäten oder benutzerdefinierte Aktivitäten verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="df65c-177">This default cancellation suffices for many scenarios, but if additional cancellation logic is needed, then the built-in cancellation activities or custom activities can be used.</span></span>  
  
 <span data-ttu-id="df65c-178">Im folgenden Beispiel ist die <xref:System.Activities.NativeActivity.Cancel%2A>-Überschreibung einer auf <xref:System.Activities.NativeActivity> basierenden, benutzerdefinierten `ParallelForEach`-Aktivität definiert.</span><span class="sxs-lookup"><span data-stu-id="df65c-178">In the following example, the <xref:System.Activities.NativeActivity.Cancel%2A> override of a <xref:System.Activities.NativeActivity> based custom `ParallelForEach` activity is defined.</span></span> <span data-ttu-id="df65c-179">Wenn die Aktivität abgebrochen wird, behandelt diese Überschreibung die Abbruchlogik für die Aktivität.</span><span class="sxs-lookup"><span data-stu-id="df65c-179">When the activity is canceled, this override handles the cancellation logic for the activity.</span></span> <span data-ttu-id="df65c-180">Dieses Beispiel ist Teil der [nicht generischen ParallelForEach-](./samples/non-generic-parallelforeach.md) Stichprobe.</span><span class="sxs-lookup"><span data-stu-id="df65c-180">This example is part of the [Non-Generic ParallelForEach](./samples/non-generic-parallelforeach.md) sample.</span></span>  
  
```csharp  
protected override void Cancel(NativeActivityContext context)  
{  
    // If we do not have a completion condition then we can just  
    // use default logic.  
    if (this.CompletionCondition == null)  
    {  
        base.Cancel(context);  
    }  
    else  
    {  
        context.CancelChildren();  
    }  
}  
```  
  
 <span data-ttu-id="df65c-181">Von <xref:System.Activities.NativeActivity> abgeleitete Aktivitäten können bestimmen, ob ein Abbruch angefordert wurde, indem die <xref:System.Activities.NativeActivityContext.IsCancellationRequested%2A>-Eigenschaft überprüft wird und sie sich selbst als abgebrochen markieren, indem die <xref:System.Activities.NativeActivityContext.MarkCanceled%2A>-Methode aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="df65c-181"><xref:System.Activities.NativeActivity> derived activities can determine if cancellation has been requested by inspecting the <xref:System.Activities.NativeActivityContext.IsCancellationRequested%2A> property, and mark themselves as canceled by calling the <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> method.</span></span> <span data-ttu-id="df65c-182">Durch Aufrufen von <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> wird eine Aktivität nicht sofort abgeschlossen.</span><span class="sxs-lookup"><span data-stu-id="df65c-182">Calling <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> does not immediately complete the activity.</span></span> <span data-ttu-id="df65c-183">Wie üblich schließt die Laufzeit die Aktivität ab, wenn sie keine ausstehenden Aufgaben mehr aufweist; wenn jedoch <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> aufgerufen wird, ist der abschließende Zustand <xref:System.Activities.ActivityInstanceState.Canceled> anstelle von <xref:System.Activities.ActivityInstanceState.Closed>.</span><span class="sxs-lookup"><span data-stu-id="df65c-183">As usual, the runtime will complete the activity when it has no more outstanding work, but if <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> is called the final state will be <xref:System.Activities.ActivityInstanceState.Canceled> instead of <xref:System.Activities.ActivityInstanceState.Closed>.</span></span>  
  
### <a name="cancellation-using-asynccodeactivity"></a><span data-ttu-id="df65c-184">Abbruch mithilfe von AsyncCodeActivity</span><span class="sxs-lookup"><span data-stu-id="df65c-184">Cancellation using AsyncCodeActivity</span></span>  

 <span data-ttu-id="df65c-185">Auf <xref:System.Activities.AsyncCodeActivity> basierende Aktivitäten können auch eine benutzerdefinierte Abbruchlogik bereitstellen, indem die <xref:System.Activities.AsyncCodeActivity.Cancel%2A>-Methode überschrieben wird.</span><span class="sxs-lookup"><span data-stu-id="df65c-185"><xref:System.Activities.AsyncCodeActivity> based activities can also provide custom cancellation logic by overriding the <xref:System.Activities.AsyncCodeActivity.Cancel%2A> method.</span></span> <span data-ttu-id="df65c-186">Wenn diese Methode nicht überschrieben wird, wird keine Abbruchbehandlung ausgeführt, wenn die Aktivität abgebrochen wird.</span><span class="sxs-lookup"><span data-stu-id="df65c-186">If this method is not overridden, then no cancellation handling is performed if the activity is canceled.</span></span> <span data-ttu-id="df65c-187">Im folgenden Beispiel ist die <xref:System.Activities.AsyncCodeActivity.Cancel%2A>-Überschreibung einer auf <xref:System.Activities.AsyncCodeActivity> basierenden, benutzerdefinierten `ExecutePowerShell`-Aktivität definiert.</span><span class="sxs-lookup"><span data-stu-id="df65c-187">In the following example, the <xref:System.Activities.AsyncCodeActivity.Cancel%2A> override of an <xref:System.Activities.AsyncCodeActivity> based custom `ExecutePowerShell` activity is defined.</span></span> <span data-ttu-id="df65c-188">Wenn die Aktivität abgebrochen wird, wird das gewünschte Abbruchverhalten ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="df65c-188">When the activity is canceled, it performs the desired cancellation behavior.</span></span>
  
 [!code-csharp[CFX_WorkflowApplicationExample#1020](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#1020)]  
  
 <span data-ttu-id="df65c-189">Von <xref:System.Activities.AsyncCodeActivity> abgeleitete Aktivitäten können bestimmen, ob ein Abbruch angefordert wurde, indem die <xref:System.Activities.AsyncCodeActivityContext.IsCancellationRequested%2A>-Eigenschaft überprüft wird und sie sich selbst als abgebrochen markieren, indem die <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A>-Methode aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="df65c-189"><xref:System.Activities.AsyncCodeActivity> derived activities can determine if cancellation has been requested by inspecting the <xref:System.Activities.AsyncCodeActivityContext.IsCancellationRequested%2A> property, and mark themselves as canceled by calling the <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A> method.</span></span>
