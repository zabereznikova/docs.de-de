---
title: Erstellen von asynchronen Aktivitäten in WF
description: Erfahren Sie, wie Sie benutzerdefinierte asynchrone Aktivitäten mithilfe von AsyncCodeActivity erstellen, wodurch abgeleitete Aktivitäten asynchrone Ausführungs Logik implementieren können.
ms.date: 03/30/2017
ms.assetid: 497e81ed-5eef-460c-ba55-fae73c05824f
ms.openlocfilehash: a03fbde1ff27084cc36dffc3a1912220d9bbca7e
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 11/26/2020
ms.locfileid: "96242083"
---
# <a name="creating-asynchronous-activities-in-wf"></a><span data-ttu-id="8beb9-103">Erstellen von asynchronen Aktivitäten in WF</span><span class="sxs-lookup"><span data-stu-id="8beb9-103">Creating Asynchronous Activities in WF</span></span>

<span data-ttu-id="8beb9-104">Das <xref:System.Activities.AsyncCodeActivity>-Objekt stellt eine Basisklasse für Aktivitätsautoren bereit, mit der abgeleitete Aktivitäten asynchrone Ausführungslogik implementieren können.</span><span class="sxs-lookup"><span data-stu-id="8beb9-104"><xref:System.Activities.AsyncCodeActivity> provides activity authors a base class to use that enables derived activities to implement asynchronous execution logic.</span></span> <span data-ttu-id="8beb9-105">Dies ist nützlich bei benutzerdefinierten Aktivitäten, die asynchrone Aufgaben ausführen müssen, ohne dass der Workflowplanerthread angehalten und Aktivitäten, die parallel ausgeführt werden, bockiert werden.</span><span class="sxs-lookup"><span data-stu-id="8beb9-105">This is useful for custom activities that must perform asynchronous work without holding the workflow scheduler thread and blocking any activities that may be able to run in parallel.</span></span> <span data-ttu-id="8beb9-106">Dieses Thema enthält eine Übersicht zum Erstellen von benutzerdefinierten asynchronen Aktivitäten mit <xref:System.Activities.AsyncCodeActivity>.</span><span class="sxs-lookup"><span data-stu-id="8beb9-106">This topic provides an overview of how to create custom asynchronous activities using <xref:System.Activities.AsyncCodeActivity>.</span></span>  
  
## <a name="using-asynccodeactivity"></a><span data-ttu-id="8beb9-107">Verwenden von AsyncCodeActivity</span><span class="sxs-lookup"><span data-stu-id="8beb9-107">Using AsyncCodeActivity</span></span>  

 <span data-ttu-id="8beb9-108"><xref:System.Activities?displayProperty=nameWithType> bietet benutzerdefinierten Aktivitätsautoren verschiedene Basisklassen, mit denen auf die unterschiedlichen Anforderungen der Aktivitätserstellung eingegangen wird.</span><span class="sxs-lookup"><span data-stu-id="8beb9-108"><xref:System.Activities?displayProperty=nameWithType> provides custom activity authors with different base classes for different activity authoring requirements.</span></span> <span data-ttu-id="8beb9-109">Jede einzelne davon weist eine bestimmte Semantik auf und stellt einem Workflowautor (und der Aktivitätslaufzeit) einen entsprechenden Vertrag bereit.</span><span class="sxs-lookup"><span data-stu-id="8beb9-109">Each one carries a particular semantic and provides a workflow author (and the activity runtime) a corresponding contract.</span></span> <span data-ttu-id="8beb9-110">Ein Aktivität auf Grundlage des <xref:System.Activities.AsyncCodeActivity>-Objekts ist eine Aktivität, die Aufgaben asynchron in Verbindung mit dem Planerthread ausführt und deren Ausführungslogik in verwaltetem Code ausgedrückt wird.</span><span class="sxs-lookup"><span data-stu-id="8beb9-110">An <xref:System.Activities.AsyncCodeActivity> based activity is an activity that performs work asynchronously relative to the scheduler thread and whose execution logic is expressed in managed code.</span></span> <span data-ttu-id="8beb9-111">Als Ergebnis der Asynchronität kann ein <xref:System.Activities.AsyncCodeActivity>-Objekt möglicherweise während der Ausführung einen Leerlaufpunkt herbeiführen.</span><span class="sxs-lookup"><span data-stu-id="8beb9-111">As a result of going asynchronous, an <xref:System.Activities.AsyncCodeActivity> may induce an idle point during execution.</span></span> <span data-ttu-id="8beb9-112">Aufgrund der flüchtigen Art asynchroner Arbeit erstellt ein <xref:System.Activities.AsyncCodeActivity>-Objekt immer einen nicht persistenten Block für die Dauer der Ausführung der Aktivität.</span><span class="sxs-lookup"><span data-stu-id="8beb9-112">Due to the volatile nature of asynchronous work, an <xref:System.Activities.AsyncCodeActivity> always creates a no persist block for the duration of the activity’s execution.</span></span> <span data-ttu-id="8beb9-113">Dadurch wird verhindert, dass die Workflowlaufzeit die Workflowinstanz während der asynchronen Arbeit speichert oder die Workflowinstanz während der Ausführung von asynchronem Code entladen wird.</span><span class="sxs-lookup"><span data-stu-id="8beb9-113">This prevents the workflow runtime from persisting the workflow instance in the middle of the asynchronous work, and also prevents the workflow instance from unloading while the asynchronous code is executing.</span></span>  
  
### <a name="asynccodeactivity-methods"></a><span data-ttu-id="8beb9-114">AsyncCodeActivity-Methoden</span><span class="sxs-lookup"><span data-stu-id="8beb9-114">AsyncCodeActivity Methods</span></span>  

 <span data-ttu-id="8beb9-115">Aktivitäten, die vom <xref:System.Activities.AsyncCodeActivity>-Objekt ableiten, können asynchrone Ausführungslogik erstellen, indem sie die <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>-Methode und die <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>-Methode mit benutzerdefiniertem Code überschreiben.</span><span class="sxs-lookup"><span data-stu-id="8beb9-115">Activities that derive from <xref:System.Activities.AsyncCodeActivity> can create asynchronous execution logic by overriding the <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> methods with custom code.</span></span> <span data-ttu-id="8beb9-116">Wenn diese Methoden von der Laufzeit aufgerufen werden, wird <xref:System.Activities.AsyncCodeActivityContext> an sie übergeben.</span><span class="sxs-lookup"><span data-stu-id="8beb9-116">When called by the runtime, these methods are passed an <xref:System.Activities.AsyncCodeActivityContext>.</span></span> <span data-ttu-id="8beb9-117"><xref:System.Activities.AsyncCodeActivityContext>ermöglicht dem Aktivitäts Autor, den gemeinsam genutzten Zustand <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> /  <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> in der-Eigenschaft des Kontexts bereitzustellen <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> .</span><span class="sxs-lookup"><span data-stu-id="8beb9-117"><xref:System.Activities.AsyncCodeActivityContext> allows the activity author to provide shared state across <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>/ <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> in the context’s <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> property.</span></span> <span data-ttu-id="8beb9-118">Im folgenden Beispiel generiert eine `GenerateRandom`-Aktivität eine Zufallszahl auf asynchrone Weise.</span><span class="sxs-lookup"><span data-stu-id="8beb9-118">In the following example, a `GenerateRandom` activity generates a random number asynchronously.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#8](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#8)]  
  
 <span data-ttu-id="8beb9-119">Die vorangehende Beispielaktivität wird von <xref:System.Activities.AsyncCodeActivity%601> abgeleitet und verfügt über ein erhöhtes `OutArgument<int>` mit dem Namen `Result`.</span><span class="sxs-lookup"><span data-stu-id="8beb9-119">The previous example activity derives from <xref:System.Activities.AsyncCodeActivity%601>, and has an elevated `OutArgument<int>` named `Result`.</span></span> <span data-ttu-id="8beb9-120">Der von der `GetRandom`-Methode zurückgegebene Wert wird extrahiert und von der <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A>-Überschreibung zurückgegeben. Dieser Wert wird als `Result`-Wert festgelegt.</span><span class="sxs-lookup"><span data-stu-id="8beb9-120">The value returned by the `GetRandom` method is extracted and returned by the <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> override, and this value is set as the `Result` value.</span></span> <span data-ttu-id="8beb9-121">Asynchrone Aktivitäten, die kein Ergebnis zurückgeben, sollten von <xref:System.Activities.AsyncCodeActivity> abgeleitet werden.</span><span class="sxs-lookup"><span data-stu-id="8beb9-121">Asynchronous activities that do not return a result should derive from <xref:System.Activities.AsyncCodeActivity>.</span></span> <span data-ttu-id="8beb9-122">Im folgenden Beispiel wird eine `DisplayRandom`-Aktivität definiert, die von <xref:System.Activities.AsyncCodeActivity> abgeleitet wird.</span><span class="sxs-lookup"><span data-stu-id="8beb9-122">In the following example, a `DisplayRandom` activity is defined which derives from <xref:System.Activities.AsyncCodeActivity>.</span></span> <span data-ttu-id="8beb9-123">Diese Aktivität entspricht der `GetRandom`-Aktivität, aber statt ein Ergebnis zurückzugeben, wird eine Meldung in der Konsole angezeigt.</span><span class="sxs-lookup"><span data-stu-id="8beb9-123">This activity is like the `GetRandom` activity but instead of returning a result it displays a message to the console.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#11](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#11)]  
  
 <span data-ttu-id="8beb9-124">Da es keinen Rückgabewert gibt, verwendet `DisplayRandom` zum Aufrufen des zugehörigen Delegaten ein <xref:System.Action>-Element statt eines <xref:System.Func%602>-Elements, und der Delegat gibt keinen Wert zurück.</span><span class="sxs-lookup"><span data-stu-id="8beb9-124">Note that because there is no return value, `DisplayRandom` uses an <xref:System.Action> instead of a <xref:System.Func%602> to invoke its delegate, and the delegate returns no value.</span></span>  
  
 <span data-ttu-id="8beb9-125">Die <xref:System.Activities.AsyncCodeActivity> stellt außerdem eine <xref:System.Activities.AsyncCodeActivity.Cancel%2A>-Überschreibung bereit.</span><span class="sxs-lookup"><span data-stu-id="8beb9-125"><xref:System.Activities.AsyncCodeActivity> also provides a <xref:System.Activities.AsyncCodeActivity.Cancel%2A> override.</span></span> <span data-ttu-id="8beb9-126">Während <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> und <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> erforderliche Überschreibungen darstellen, ist <xref:System.Activities.AsyncCodeActivity.Cancel%2A> optional und kann überschrieben werden, damit die Aktivität ihren ausstehenden asynchronen Zustand bereinigen kann, wenn sie abgebrochen wird.</span><span class="sxs-lookup"><span data-stu-id="8beb9-126">While <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> are required overrides, <xref:System.Activities.AsyncCodeActivity.Cancel%2A> is optional, and can be overridden so the activity can clean up its outstanding asynchronous state when it is being canceled or aborted.</span></span> <span data-ttu-id="8beb9-127">Wenn eine Bereinigung möglich ist und `AsyncCodeActivity.ExecutingActivityInstance.IsCancellationRequested` auf `true` festgelegt ist, sollte die Aktivität <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A> aufrufen.</span><span class="sxs-lookup"><span data-stu-id="8beb9-127">If clean up is possible and `AsyncCodeActivity.ExecutingActivityInstance.IsCancellationRequested` is `true`, the activity should call <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A>.</span></span> <span data-ttu-id="8beb9-128">Alle von dieser Methode ausgelösten Ausnahmen wirken sich fatal auf die Workflowinstanz aus.</span><span class="sxs-lookup"><span data-stu-id="8beb9-128">Any exceptions thrown from this method are fatal to the workflow instance.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#10](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#10)]  
  
### <a name="invoking-asynchronous-methods-on-a-class"></a><span data-ttu-id="8beb9-129">Aufrufen von asynchronen Methoden für eine Klasse</span><span class="sxs-lookup"><span data-stu-id="8beb9-129">Invoking Asynchronous Methods on a Class</span></span>  

 <span data-ttu-id="8beb9-130">Viele der Klassen in der .NET Framework stellen asynchrone Funktionen bereit, und diese Funktionalität kann asynchron mit einer- <xref:System.Activities.AsyncCodeActivity> basierten Aktivität aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="8beb9-130">Many of the classes in the .NET Framework provide asynchronous functionality, and this functionality can be asynchronously invoked by using an <xref:System.Activities.AsyncCodeActivity> based activity.</span></span> <span data-ttu-id="8beb9-131">Im folgenden Beispiel wird eine-Aktivität erstellt, die mithilfe der-Klasse asynchron eine Datei erstellt <xref:System.IO.FileStream> .</span><span class="sxs-lookup"><span data-stu-id="8beb9-131">In the following example, an activity is created that asynchronously creates a file by using the <xref:System.IO.FileStream> class.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#12](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#12)]  
  
### <a name="sharing-state-between-the-beginexecute-and-endexecute-methods"></a><span data-ttu-id="8beb9-132">Gemeinsame Zustandsverwendung durch die BeginExecute-Methode und die EndExecute-Methode</span><span class="sxs-lookup"><span data-stu-id="8beb9-132">Sharing State Between the BeginExecute and EndExecute Methods</span></span>  

 <span data-ttu-id="8beb9-133">Im vorherigen Beispiel wurde auf das <xref:System.IO.FileStream>-Objekt, das in <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> erstellt wurde, in <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> zugegriffen.</span><span class="sxs-lookup"><span data-stu-id="8beb9-133">In the previous example, the <xref:System.IO.FileStream> object that was created in <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> was accessed in the <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span></span> <span data-ttu-id="8beb9-134">Dies ist möglich, weil die `file`-Variable in der <xref:System.Activities.AsyncCodeActivityContext.UserState%2A?displayProperty=nameWithType>-Eigenschaft in <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> übergeben wurde.</span><span class="sxs-lookup"><span data-stu-id="8beb9-134">This is possible because the `file` variable was passed in the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A?displayProperty=nameWithType> property in <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>.</span></span> <span data-ttu-id="8beb9-135">Dies ist die richtige Methode zum gemeinsamen Verwenden des Zustands zwischen <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> und <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="8beb9-135">This is the correct method for sharing state between <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span></span> <span data-ttu-id="8beb9-136">Es ist unzulässig, eine Membervariable in der abgeleiteten Klasse (in diesem Fall `FileWriter`) zu verwenden, um einen gemeinsamen Zustand für <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> und <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> zu verwenden, da auf das Aktivitätsobjekt von mehreren Aktivitätsinstanzen verwiesen werden kann.</span><span class="sxs-lookup"><span data-stu-id="8beb9-136">It is incorrect to use a member variable in the derived class (`FileWriter` in this case) to share state between <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> because the activity object may be referenced by multiple activity instances.</span></span> <span data-ttu-id="8beb9-137">Der Versuch, eine Membervariable zu verwenden, um einen Zustand gemeinsam zu verwenden, kann dazu führen, dass Werte einer <xref:System.Activities.ActivityInstance> Werte einer anderen <xref:System.Activities.ActivityInstance> überschreiben oder nutzen.</span><span class="sxs-lookup"><span data-stu-id="8beb9-137">Attempting to use a member variable to share state can result in values from one <xref:System.Activities.ActivityInstance> overwriting or consuming values from another <xref:System.Activities.ActivityInstance>.</span></span>  
  
### <a name="accessing-argument-values"></a><span data-ttu-id="8beb9-138">Zugreifen auf Argumentwerte</span><span class="sxs-lookup"><span data-stu-id="8beb9-138">Accessing Argument Values</span></span>  

 <span data-ttu-id="8beb9-139">Die Umgebung eines <xref:System.Activities.AsyncCodeActivity>-Objekts besteht aus den Argumenten, die für die Aktivität definiert sind.</span><span class="sxs-lookup"><span data-stu-id="8beb9-139">The environment of an <xref:System.Activities.AsyncCodeActivity> consists of the arguments defined on the activity.</span></span> <span data-ttu-id="8beb9-140">Auf diese Argumente kann über die außer Kraft setzungen <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> / <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> mithilfe des- <xref:System.Activities.AsyncCodeActivityContext> Parameters zugegriffen werden.</span><span class="sxs-lookup"><span data-stu-id="8beb9-140">These arguments can be accessed from the <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>/<xref:System.Activities.AsyncCodeActivity.EndExecute%2A> overrides using the <xref:System.Activities.AsyncCodeActivityContext> parameter.</span></span> <span data-ttu-id="8beb9-141">Im Delegaten kann nicht auf die Argumente zugegriffen werden. Die Argumentwerte oder andere gewünschte Daten können jedoch mithilfe seiner Parameter an den Delegaten übergeben werden.</span><span class="sxs-lookup"><span data-stu-id="8beb9-141">The arguments cannot be accessed in the delegate, but the argument values or any other desired data can be passed in to the delegate using its parameters.</span></span> <span data-ttu-id="8beb9-142">Im folgenden Beispiel wird eine Aktivität definiert, die Zufallszahlen generiert. Die Aktivität ruft ihre inklusive obere Begrenzung aus ihrem `Max`-Argument ab.</span><span class="sxs-lookup"><span data-stu-id="8beb9-142">In the following example, a random number-generating activity is defined that obtains the inclusive upper bound from its `Max` argument.</span></span> <span data-ttu-id="8beb9-143">Der Wert des Arguments wird an den asynchronen Code übergeben, sobald der Delegat aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="8beb9-143">The value of the argument is passed in to the asynchronous code when the delegate is invoked.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#9](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#9)]  
  
### <a name="scheduling-actions-or-child-activities-using-asynccodeactivity"></a><span data-ttu-id="8beb9-144">Planen von Aktionen oder untergeordneten Aktivitäten mithilfe von AsyncCodeActivity</span><span class="sxs-lookup"><span data-stu-id="8beb9-144">Scheduling Actions or Child Activities Using AsyncCodeActivity</span></span>  

 <span data-ttu-id="8beb9-145">Von <xref:System.Activities.AsyncCodeActivity> abgeleitete benutzerdefinierte Aktivitäten ermöglichen das asynchrone Arbeiten am Workflowthread, bieten aber keine Möglichkeit, untergeordnete Aktivitäten oder Aktionen zu planen.</span><span class="sxs-lookup"><span data-stu-id="8beb9-145"><xref:System.Activities.AsyncCodeActivity> derived custom activities  provide a method for performing work asynchronously with regard to the workflow thread, but do not provide the ability to schedule child activities or actions.</span></span> <span data-ttu-id="8beb9-146">Das asynchrone Verhalten kann jedoch integriert werden, indem untergeordnete Aktivitäten bei der Zusammensetzung geplant werden.</span><span class="sxs-lookup"><span data-stu-id="8beb9-146">However, asynchronous behavior can be incorporated with scheduling of child activities through composition.</span></span> <span data-ttu-id="8beb9-147">Eine asynchrone Aktivität kann erstellt und dann mit einer abgeleiteten <xref:System.Activities.Activity>-Aktivität oder <xref:System.Activities.NativeActivity>-Aktivität zusammengestellt werden, um Unterstützung für asynchrones Verhalten und die Planung untergeordneter Aktivitäten oder Aktionen bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="8beb9-147">An asynchronous activity can be created, and then composed with an <xref:System.Activities.Activity> or <xref:System.Activities.NativeActivity> derived activity to provide asynchronous behavior and scheduling of child activities or actions.</span></span> <span data-ttu-id="8beb9-148">Beispielsweise könnte eine Aktivität erstellt werden, die von <xref:System.Activities.Activity> abgeleitet ist und als Implementierung über <xref:System.Activities.Statements.Sequence> verfügt, die asynchrone Aktivität sowie die anderen Aktivitäten enthält, die die Logik der Aktivität implementieren.</span><span class="sxs-lookup"><span data-stu-id="8beb9-148">For example, an activity could be created that derives from <xref:System.Activities.Activity>, and has as its implementation a <xref:System.Activities.Statements.Sequence> containing the asynchronous activity as well the other activities that implement the logic of the activity.</span></span> <span data-ttu-id="8beb9-149">Weitere Beispiele zum Verfassen von Aktivitäten mit <xref:System.Activities.Activity> und <xref:System.Activities.NativeActivity> finden Sie unter Gewusst [wie: Erstellen von Aktivitäts](how-to-create-an-activity.md) -und Aktivitäts Erstellungs [Optionen](activity-authoring-options-in-wf.md).</span><span class="sxs-lookup"><span data-stu-id="8beb9-149">For more examples of composing activities using <xref:System.Activities.Activity> and <xref:System.Activities.NativeActivity>, see [How to: Create an Activity](how-to-create-an-activity.md) and [Activity Authoring Options](activity-authoring-options-in-wf.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="8beb9-150">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="8beb9-150">See also</span></span>

- <xref:System.Action>
- <xref:System.Func%602>
