---
title: Persistenzteilnehmer
ms.date: 03/30/2017
ms.assetid: f84d2d5d-1c1b-4f19-be45-65b552d3e9e3
ms.openlocfilehash: 0bff6cc8fafb1832dc4d0e33b754fe3adb81dcf6
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 11/26/2020
ms.locfileid: "96246107"
---
# <a name="persistence-participants"></a><span data-ttu-id="f6f0e-102">Persistenzteilnehmer</span><span class="sxs-lookup"><span data-stu-id="f6f0e-102">Persistence Participants</span></span>

<span data-ttu-id="f6f0e-103">Ein Persistenzteilnehmer kann an einem von einem Anwendungshost ausgelösten Persistenzvorgang (Speichern oder Laden) teilnehmen.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-103">A persistence participant can participate in a persistence operation (Save or Load) triggered by an application host.</span></span> <span data-ttu-id="f6f0e-104">Der [!INCLUDE[netfx_current_long](../../../includes/netfx-current-long-md.md)] wird mit zwei abstrakten Klassen, **persistenceteilnehmer** und **persistenceioparticipant**, ausgeliefert, die Sie zum Erstellen eines Dauerhaftigkeits Teilnehmers verwenden können.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-104">The [!INCLUDE[netfx_current_long](../../../includes/netfx-current-long-md.md)] ships with two abstract classes, **PersistenceParticipant** and **PersistenceIOParticipant**, which you can use to create a persistence participant.</span></span> <span data-ttu-id="f6f0e-105">Ein Persistenzteilnehmer leitet sich von einer dieser Klassen ab, implementiert die passenden Methoden und fügt dann der <xref:System.ServiceModel.Activities.WorkflowServiceHost.WorkflowExtensions%2A>-Auflistung im <xref:System.ServiceModel.Activities.WorkflowServiceHost> eine Instanz der Klasse hinzu.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-105">A persistence participant derives from one of these classes, implements the methods of interest, and then adds an instance of the class to the <xref:System.ServiceModel.Activities.WorkflowServiceHost.WorkflowExtensions%2A> collection on the <xref:System.ServiceModel.Activities.WorkflowServiceHost> .</span></span> <span data-ttu-id="f6f0e-106">Beim Beibehalten einer Workflowinstanz sucht der Anwendungshost möglicherweise nach Workflowerweiterungen dieser Art und ruft auf den Persistenzteilnehmern zur richtigen Zeit jeweils die entsprechenden Methoden auf.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-106">The application host may look for such workflow extensions when persisting a workflow instance and invoke appropriate methods on the persistence participants at appropriate times.</span></span>  
  
 <span data-ttu-id="f6f0e-107">In der folgenden Liste werden die Aufgaben beschrieben, die das Persistenzsubsystem in den einzelnen Phasen des Persistenzvorgangs (Speichern) ausführt.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-107">The following list describes the tasks performed by the persistence subsystem in different stages of the Persist (Save) operation.</span></span> <span data-ttu-id="f6f0e-108">Die Persistenzteilnehmer werden in der dritten und vierten Phase verwendet.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-108">The persistence participants are used in the third and fourth stages.</span></span> <span data-ttu-id="f6f0e-109">Wenn der Teilnehmer ein e/a-Teilnehmer ist (ein persistenzteilnehmer, der auch an e/a-Vorgängen teilnimmt), wird der Teilnehmer auch in der sechsten Phase verwendet.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-109">If the participant is an I/O participant (a persistence participant that also participates in I/O operations), the participant is also used in the sixth stage.</span></span>  
  
1. <span data-ttu-id="f6f0e-110">Erfasst integrierte Werte, einschließlich Workflowstatus, Lesezeichen, zugeordnete Variablen und Timestamps.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-110">Gathers built-in values, including workflow state, bookmarks, mapped variables, and timestamp.</span></span>  
  
2. <span data-ttu-id="f6f0e-111">Erfasst alle Persistenzteilnehmer, die der Erweiterungsauflistung mit Zuordnung zur Workflowinstanz hinzugefügt wurden.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-111">Gathers all persistence participants that were added to the extension collection associated with the workflow instance.</span></span>  
  
3. <span data-ttu-id="f6f0e-112">Ruft die <xref:System.Activities.Persistence.PersistenceParticipant.CollectValues%2A>-Methode auf, die von allen Persistenzteilnehmern implementiert wurde.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-112">Invokes the <xref:System.Activities.Persistence.PersistenceParticipant.CollectValues%2A> method implemented by all persistence participants.</span></span>  
  
4. <span data-ttu-id="f6f0e-113">Ruft die <xref:System.Activities.Persistence.PersistenceParticipant.MapValues%2A>-Methode auf, die von allen Persistenzteilnehmern implementiert wurde.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-113">Invokes the <xref:System.Activities.Persistence.PersistenceParticipant.MapValues%2A> method implemented by all persistence participants.</span></span>  
  
5. <span data-ttu-id="f6f0e-114">Beibehalten oder Speichern des Workflows im persistenten Speicher.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-114">Persist or save the workflow into the persistence store.</span></span>  
  
6. <span data-ttu-id="f6f0e-115">Ruft die- <xref:System.Activities.Persistence.PersistenceIOParticipant.BeginOnSave%2A> Methode für alle Persistenz-e/a-Teilnehmer auf.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-115">Invokes the <xref:System.Activities.Persistence.PersistenceIOParticipant.BeginOnSave%2A> method on all of the persistence I/O participants.</span></span> <span data-ttu-id="f6f0e-116">Wenn der Teilnehmer kein e/a-Teilnehmer ist, wird diese Aufgabe übersprungen.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-116">If the participant is not an I/O participant, this task is skipped.</span></span> <span data-ttu-id="f6f0e-117">Falls der Persistenzabschnitt transaktionsgebunden ist, wird die Transaktion in der Transaction.Current-Eigenschaft bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-117">If the persistence episode is transactional, the transaction is provided in Transaction.Current property.</span></span>  
  
7. <span data-ttu-id="f6f0e-118">Wartet, bis die Vorgänge aller Persistenzteilnehmer abgeschlossen sind.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-118">Waits for all persistence participants to complete.</span></span> <span data-ttu-id="f6f0e-119">Falls alle Teilnehmer das Beibehalten der Instanzdaten erfolgreich abschließen, wird für die Transaktion ein Commit ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-119">If all the participants succeed in persisting instance data, commits the transaction.</span></span>  
  
 <span data-ttu-id="f6f0e-120">Ein persistenzteilnehmer wird von der **PersistenceParticipants** -Klasse abgeleitet und kann die Methoden **CollectValues** und **mapvalues** implementieren.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-120">A persistence participant derives from the **PersistenceParticipant** class and may implement the **CollectValues** and **MapValues** methods.</span></span> <span data-ttu-id="f6f0e-121">Ein e/A-persistenzteilnehmer wird von der **persistenceioparticipant** -Klasse abgeleitet und kann die **beginonsave** -Methode zusätzlich zur Implementierung der Methoden **CollectValues** und **mapvalues** implementieren.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-121">A persistence I/O participant derives from the **PersistenceIOParticipant** class and may implement the **BeginOnSave** method in addition to implementing the **CollectValues** and **MapValues** methods.</span></span>  
  
 <span data-ttu-id="f6f0e-122">Jede Phase wird abgeschlossen, bevor die nächste Phase beginnt.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-122">Each stage is completed before the next stage begins.</span></span> <span data-ttu-id="f6f0e-123">Beispielsweise werden Werte von **allen** persistenzteilnehmern in der ersten Phase gesammelt.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-123">For example, values are collected from **all** persistence participants in the first stage.</span></span> <span data-ttu-id="f6f0e-124">Alle in der ersten Phase erfassten Werte werden in der zweiten Phase dann für alle Persistenzteilnehmer bereitgestellt, um die Zuordnung sicherzustellen.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-124">Then all the values collected in the first stage are provided to all persistence participants in the second stage for mapping.</span></span> <span data-ttu-id="f6f0e-125">Alle in der ersten und zweiten Phase erfassten Werte werden dann für alle Persistenzteilnehmer in der dritten Phase bereitgestellt usw.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-125">Then all the values collected and mapped in the first and second stages are provided to the persistence provider in the third stage, and so on.</span></span>  
  
 <span data-ttu-id="f6f0e-126">In der folgenden Liste werden die Aufgaben beschrieben, die das Persistenzsubsystem in den einzelnen Phasen des Ladevorgangs ausführt.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-126">The following list describes the tasks performed by the persistence subsystem in different stages of the Load operation.</span></span> <span data-ttu-id="f6f0e-127">Die Persistenzteilnehmer werden in der vierten Phase verwendet.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-127">The persistence participants are used in the fourth stage.</span></span> <span data-ttu-id="f6f0e-128">Die e/a-persistenzteilnehmer (persistenzteilnehmer, die auch an e/a-Vorgängen teilnehmen) werden auch in der dritten Phase verwendet.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-128">The persistence I/O participants (persistence participants that also participate in I/O operations) are also used in the third stage.</span></span>  
  
1. <span data-ttu-id="f6f0e-129">Erfasst alle Persistenzteilnehmer, die der Erweiterungsauflistung mit Zuordnung zur Workflowinstanz hinzugefügt wurden.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-129">Gathers all persistence participants that were added to the extension collection associated with the workflow instance.</span></span>  
  
2. <span data-ttu-id="f6f0e-130">Lädt den Workflow aus dem Persistenzspeicher.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-130">Loads the workflow from the persistence store.</span></span>  
  
3. <span data-ttu-id="f6f0e-131">Ruft den für <xref:System.Activities.Persistence.PersistenceIOParticipant.BeginOnLoad%2A> alle Persistenz-e/a-Teilnehmer auf und wartet darauf, dass alle persistenzteilnehmer beendet werden.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-131">Invokes the <xref:System.Activities.Persistence.PersistenceIOParticipant.BeginOnLoad%2A> on all persistence I/O participants and waits for all the persistence participants to complete.</span></span> <span data-ttu-id="f6f0e-132">Falls der Persistenzabschnitt transaktionsgebunden ist, wird die Transaktion in der Transaction.Current-Eigenschaft bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-132">If the persistence episode is transactional, the transaction is provided in Transaction.Current.</span></span>  
  
4. <span data-ttu-id="f6f0e-133">Lädt die Workflowinstanz basierend auf den aus dem Persistenzspeicher abgerufenen Daten in den Arbeitsspeicher.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-133">Loads the workflow instance in memory based on the data retrieved from the persistence store.</span></span>  
  
5. <span data-ttu-id="f6f0e-134">Ruft <xref:System.Activities.Persistence.PersistenceParticipant.PublishValues%2A> für jeden Persistenzteilnehmer auf.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-134">Invokes <xref:System.Activities.Persistence.PersistenceParticipant.PublishValues%2A> on each persistence participant.</span></span>  
  
 <span data-ttu-id="f6f0e-135">Ein persistenzteilnehmer wird von der **PersistenceParticipants** -Klasse abgeleitet und kann die **publishvalues** -Methode implementieren.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-135">A persistence participant derives from the **PersistenceParticipant** class and may implement the **PublishValues** method.</span></span> <span data-ttu-id="f6f0e-136">Ein e/A-persistenzteilnehmer wird von der **persistenceioparticipant** -Klasse abgeleitet und kann die **beginonload** -Methode zusätzlich zur Implementierung der **publishvalues** -Methode implementieren.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-136">A persistence I/O participant derives from the **PersistenceIOParticipant** class and may implement the **BeginOnLoad** method in addition to implementing the **PublishValues** method.</span></span>  
  
 <span data-ttu-id="f6f0e-137">Beim Laden einer Workflowinstanz erstellt der Persistenzanbieter eine Sperre für diese Instanz.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-137">When loading a workflow instance the persistence provider creates a lock on that instance.</span></span> <span data-ttu-id="f6f0e-138">Dadurch wird verhindert, dass die Instanz in einem Szenario mit mehreren Knoten von mehr als einem Host geladen wird.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-138">This prevents the instance from being loaded by more than one host in a multi-node scenario.</span></span> <span data-ttu-id="f6f0e-139">Wenn Sie versuchen, eine gesperrte Workflowinstanz zu laden, wird eine mit der folgenden vergleichbare Ausnahme angezeigt: Die Ausnahme " System.ServiceModel.Persistence.InstanceLockException: Der angeforderte Vorgang konnte nicht abgeschlossen werden, da die Sperre für die Instanz '00000000-0000-0000-0000-000000000000' nicht abgerufen werden konnte".</span><span class="sxs-lookup"><span data-stu-id="f6f0e-139">If you attempt to load a workflow instance that has been locked you will see an exception like the following: The exception " System.ServiceModel.Persistence.InstanceLockException: The requested operation could not complete because the lock for instance '00000000-0000-0000-0000-000000000000' could not be acquired".</span></span> <span data-ttu-id="f6f0e-140">Dieser Fehler tritt auf, wenn eine der folgenden Situationen vorliegt:</span><span class="sxs-lookup"><span data-stu-id="f6f0e-140">This error is caused when one of the following occurs:</span></span>  
  
- <span data-ttu-id="f6f0e-141">In einem Szenario mit mehreren Knoten wird die Instanz von einem anderen Host geladen.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-141">In a multi-node scenario the instance is loaded by another host.</span></span>  <span data-ttu-id="f6f0e-142">Es gibt mehrere Möglichkeiten, diese Art von Konflikten zu beheben: Leiten Sie die Verarbeitung an den Knoten weiter, der die Sperre besitzt, und wiederholen Sie den Vorgang, oder erzwingen Sie das Laden, wodurch der andere Host daran gehindert wird, die Arbeit zu speichern.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-142">There are a few different ways to resolve these types of conflicts: forward the processing to the node which owns the lock and retry, or force the load which will cause the other host to be unable to save their work.</span></span>  
  
- <span data-ttu-id="f6f0e-143">In einem Szenario mit einem einzelnen Knoten ist der Host abgestürzt.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-143">In a single-node scenario and the host crashed.</span></span>  <span data-ttu-id="f6f0e-144">Wenn der Host erneut gestartet wurde (durch die Wiederverwendung eines Prozesses oder die Erstellung einer neuen Persistenzanbieterfactory), versucht der neue Host, eine Instanz zu laden, die noch vom alten Host gesperrt ist, da die Sperre noch nicht abgelaufen ist.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-144">When the host starts up again (a process recycle or creating a new persistence provider factory) the new host attempts to load an instance which is still locked by the old host because the lock hasn't expired yet.</span></span>  
  
- <span data-ttu-id="f6f0e-145">In einem Szenario mit einem einzelnen Knoten wurde die betreffende Instanz zu einem bestimmten Zeitpunkt abgebrochen, und es wird eine neue Persistenzanbieterinstanz erstellt, die eine andere Host-ID aufweist.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-145">In a single-node scenario and the instance in question was aborted at some point and a new persistence provider instance is created which has a different host ID.</span></span>  
  
 <span data-ttu-id="f6f0e-146">Das Sperrtimeout hat einen Standardwert von 5 Minuten, Sie können beim Aufrufen von <xref:System.ServiceModel.Persistence.PersistenceProvider.Load%2A> einen anderen Timeoutwert angeben.</span><span class="sxs-lookup"><span data-stu-id="f6f0e-146">The lock timeout value has a default value of 5 minutes, you can specify a different timeout value when calling <xref:System.ServiceModel.Persistence.PersistenceProvider.Load%2A>.</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="f6f0e-147">In diesem Abschnitt</span><span class="sxs-lookup"><span data-stu-id="f6f0e-147">In This Section</span></span>  
  
- [<span data-ttu-id="f6f0e-148">Vorgehensweise: Erstellen eines benutzerdefinierten Persistenzteilnehmers</span><span class="sxs-lookup"><span data-stu-id="f6f0e-148">How to: Create a Custom Persistence Participant</span></span>](how-to-create-a-custom-persistence-participant.md)  
  
## <a name="see-also"></a><span data-ttu-id="f6f0e-149">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="f6f0e-149">See also</span></span>

- [<span data-ttu-id="f6f0e-150">Erweiterbarkeit des Speichers</span><span class="sxs-lookup"><span data-stu-id="f6f0e-150">Store Extensibility</span></span>](store-extensibility.md)
