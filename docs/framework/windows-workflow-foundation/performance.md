---
title: Windows Workflow Foundation 4 – Leistung
ms.date: 03/30/2017
ms.assetid: 67d2b3e8-3777-49f8-9084-abbb33b5a766
ms.openlocfilehash: 6e6669cd41795c356e4b7b30f19d93bd8dfa917a
ms.sourcegitcommit: 32a575bf4adccc901f00e264f92b759ced633379
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 12/04/2019
ms.locfileid: "74802647"
---
# <a name="windows-workflow-foundation-4-performance"></a><span data-ttu-id="8a891-102">Windows Workflow Foundation 4 – Leistung</span><span class="sxs-lookup"><span data-stu-id="8a891-102">Windows Workflow Foundation 4 Performance</span></span>

 <span data-ttu-id="8a891-103">.NET Framework 4 enthält eine wesentliche Revision des Windows Workflow Foundation (WF) mit hohen Investitionen in die Leistung.</span><span class="sxs-lookup"><span data-stu-id="8a891-103">.NET Framework 4 includes a major revision of the Windows Workflow Foundation (WF) with heavy investments in performance.</span></span> <span data-ttu-id="8a891-104">Diese neue Revision führt bedeutende Entwurfs Änderungen aus den früheren Versionen von [!INCLUDE[wf1](../../../includes/wf1-md.md)] ein, die als Teil von .NET Framework 3,0 und .NET Framework 3,5 ausgeliefert wurden.</span><span class="sxs-lookup"><span data-stu-id="8a891-104">This new revision introduces significant design changes from the previous versions of [!INCLUDE[wf1](../../../includes/wf1-md.md)] that shipped as part of .NET Framework 3.0 and .NET Framework 3.5.</span></span> <span data-ttu-id="8a891-105">Die Architektur wurde auf Grundlage von Programmiermodell, Laufzeit und Tools neu gestaltet, um Leistung und Benutzerfreundlichkeit erheblich zu verbessern.</span><span class="sxs-lookup"><span data-stu-id="8a891-105">It has been re-architected from the core of the programming model, runtime, and tooling to greatly improve performance and usability.</span></span> <span data-ttu-id="8a891-106">In diesem Thema werden die wichtigen Leistungsmerkmale dieser Revisionen gezeigt und mit denen der vorherigen Version verglichen.</span><span class="sxs-lookup"><span data-stu-id="8a891-106">This topic shows the important performance characteristics of these revisions and compares them against those of the previous version.</span></span>

 <span data-ttu-id="8a891-107">Die Leistung der einzelnen Workflowkomponenten wurde von WF3 zu WF4 um ein Vielfaches gesteigert.</span><span class="sxs-lookup"><span data-stu-id="8a891-107">Individual workflow component performance has increased by orders of magnitude between WF3 and WF4.</span></span>  <span data-ttu-id="8a891-108">Dadurch bleibt die Lücke zwischen dem Hand codierten Windows Communication Foundation (WCF)-Diensten und den WCF-Workflow Diensten sehr gering.</span><span class="sxs-lookup"><span data-stu-id="8a891-108">This leaves the gap between hand-coded Windows Communication Foundation (WCF) services and WCF workflow services to be quite small.</span></span>  <span data-ttu-id="8a891-109">Die Workflowlatenzzeit wurde in WF4 bedeutend verringert.</span><span class="sxs-lookup"><span data-stu-id="8a891-109">Workflow latency has been significantly reduced in WF4.</span></span>  <span data-ttu-id="8a891-110">Die Persistenzleistung wurde um den Faktor 2,5 bis 3,0 gesteigert.</span><span class="sxs-lookup"><span data-stu-id="8a891-110">Persistence performance has increased by a factor of 2.5 - 3.0.</span></span>  <span data-ttu-id="8a891-111">Der Mehraufwand für die Systemüberwachung mittels Workflownachverfolgung wurde bedeutend verringert.</span><span class="sxs-lookup"><span data-stu-id="8a891-111">Health monitoring by means of workflow tracking has significantly less overhead.</span></span>  <span data-ttu-id="8a891-112">Dies sind überzeugende Gründe für die Migration zu WF4 oder zur Verwendung dieser Technologie in Ihren Anwendungen.</span><span class="sxs-lookup"><span data-stu-id="8a891-112">These are compelling reasons to migrate to or adopt WF4 in your applications.</span></span>

## <a name="terminology"></a><span data-ttu-id="8a891-113">Terminologie</span><span class="sxs-lookup"><span data-stu-id="8a891-113">Terminology</span></span>

 <span data-ttu-id="8a891-114">Die Version von [!INCLUDE[wf1](../../../includes/wf1-md.md)], die in .NET Framework 4 eingeführt wurde, wird im weiteren Verlauf dieses Themas als WF4 bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="8a891-114">The version of [!INCLUDE[wf1](../../../includes/wf1-md.md)] introduced in .NET Framework 4 will be referred to as WF4 for the rest of this topic.</span></span> [!INCLUDE[wf1](../../../includes/wf1-md.md)] <span data-ttu-id="8a891-115">wurde in .NET Framework 3,0 eingeführt und enthielt einige geringfügige Revisionen durch .NET Framework 3,5 SP1.</span><span class="sxs-lookup"><span data-stu-id="8a891-115">was introduced in .NET Framework 3.0 and had a few minor revisions through .NET Framework 3.5 SP1.</span></span> <span data-ttu-id="8a891-116">Die .NET Framework 3,5-Version von Workflow Foundation wird im weiteren Verlauf dieses Themas als WF3 bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="8a891-116">The .NET Framework 3.5 version of Workflow Foundation will be referred to as WF3 for the rest of this topic.</span></span> <span data-ttu-id="8a891-117">WF3 wird in .NET Framework 4 nebeneinander mit WF4 ausgeliefert.</span><span class="sxs-lookup"><span data-stu-id="8a891-117">WF3 is shipped in .NET Framework 4 side-by-side with WF4.</span></span> <span data-ttu-id="8a891-118">Weitere Informationen zum Migrieren von WF3-Artefakten zu WF4 finden Sie im [Migrations Handbuch zu Windows Workflow Foundation 4](migration-guidance.md).</span><span class="sxs-lookup"><span data-stu-id="8a891-118">For more information about migrating WF3 artifacts to WF4 see: [Windows Workflow Foundation 4 Migration Guide](migration-guidance.md).</span></span>

 <span data-ttu-id="8a891-119">Windows Communication Foundation (WCF) ist das vereinheitlichte Programmiermodell von Microsoft zum entwickeln Dienst orientierter Anwendungen.</span><span class="sxs-lookup"><span data-stu-id="8a891-119">Windows Communication Foundation (WCF) is Microsoft’s unified programming model for building service-oriented applications.</span></span> <span data-ttu-id="8a891-120">Sie wurde zuerst als Teil von .NET 3,0 zusammen mit WF3 eingeführt und ist jetzt eine der Hauptkomponenten des .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="8a891-120">It was first introduced as part of .NET 3.0 together with WF3 and now is one of the key components of the .NET Framework.</span></span>

 <span data-ttu-id="8a891-121">Windows Server AppFabric ist eine Sammlung integrierter Technologien, die das Erstellen, Skalieren und Verwalten von Webanwendungen und kombinierten Anwendungen erleichtert, die unter IIS ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="8a891-121">Windows Server AppFabric is a set of integrated technologies that make it easier to build, scale and manage Web and composite applications that run on IIS.</span></span> <span data-ttu-id="8a891-122">Es stellt Tools zum Überwachen und Verwalten von Diensten und Workflows bereit.</span><span class="sxs-lookup"><span data-stu-id="8a891-122">It provides tools for monitoring and managing services and workflows.</span></span> <span data-ttu-id="8a891-123">Weitere Informationen finden Sie unter [Windows Server AppFabric 1,0](https://docs.microsoft.com/previous-versions/appfabric/ff384253(v=azure.10)).</span><span class="sxs-lookup"><span data-stu-id="8a891-123">For more information, see [Windows Server AppFabric 1.0](https://docs.microsoft.com/previous-versions/appfabric/ff384253(v=azure.10)).</span></span>

## <a name="goals"></a><span data-ttu-id="8a891-124">Ziele</span><span class="sxs-lookup"><span data-stu-id="8a891-124">Goals</span></span>
 <span data-ttu-id="8a891-125">In diesem Thema werden die Leistungsmerkmale von WF4 anhand von Daten gezeigt, die für unterschiedliche Szenarien gemessen wurden.</span><span class="sxs-lookup"><span data-stu-id="8a891-125">The goal of this topic is to show the performance characteristics of WF4 with data measured for different scenarios.</span></span> <span data-ttu-id="8a891-126">Außerdem werden ausführliche Vergleiche zwischen WF4 und WF3 bereitgestellt und so die Verbesserungen in dieser neuen Revision veranschaulicht.</span><span class="sxs-lookup"><span data-stu-id="8a891-126">It also provides detailed comparisons between WF4 and WF3, and thus shows the great improvements that have been made in this new revision.</span></span> <span data-ttu-id="8a891-127">Die Szenarien und Daten in diesem Artikel quantifizieren die zugrunde liegenden Kosten für verschiedene Aspekte von WF4 und WF3.</span><span class="sxs-lookup"><span data-stu-id="8a891-127">The scenarios and data presented in this article quantify the underlying cost of different aspects of WF4 and WF3.</span></span> <span data-ttu-id="8a891-128">Diese Daten sind nützlich, um die Leistungsmerkmale von WF4 zu verstehen, und können bei der Planung von Migrationen von WF3 zu WF4 oder beim Einsatz von WF4 in der Anwendungsentwicklung hilfreich sein.</span><span class="sxs-lookup"><span data-stu-id="8a891-128">This data is useful in understanding the performance characteristics of WF4 and can be helpful in planning migrations from WF3 to WF4 or using WF4 in application development.</span></span> <span data-ttu-id="8a891-129">Sie sollten jedoch vorsichtig sein, aus den in diesem Artikel präsentierten Daten Schlüsse zu ziehen.</span><span class="sxs-lookup"><span data-stu-id="8a891-129">However, care should be taken in the conclusions drawn from the data presented in this article.</span></span> <span data-ttu-id="8a891-130">Die Leistung einer zusammengesetzten Workflowanwendung hängt stark von der Art der Workflowimplementierung und der Integration der verschiedenen Komponenten ab.</span><span class="sxs-lookup"><span data-stu-id="8a891-130">The performance of a composite workflow application is highly dependent on how the workflow is implemented and how different components are integrated.</span></span> <span data-ttu-id="8a891-131">Jede Anwendung muss gemessen werden, um die Leistungsmerkmale dieser Anwendung zu bestimmen.</span><span class="sxs-lookup"><span data-stu-id="8a891-131">One must measure each application to determine the performance characteristics of that application.</span></span>

## <a name="overview-of-wf4-performance-enhancements"></a><span data-ttu-id="8a891-132">Übersicht über die Leistungsverbesserungen in WF4</span><span class="sxs-lookup"><span data-stu-id="8a891-132">Overview of WF4 Performance Enhancements</span></span>
 <span data-ttu-id="8a891-133">Bei der Entwicklung und Implementierung von WF4 wurde sorgfältig auf die hohe Leistungsfähigkeit und Skalierbarkeit geachtet, die in den folgenden Abschnitten beschrieben werden.</span><span class="sxs-lookup"><span data-stu-id="8a891-133">WF4 was carefully designed and implemented with high performance and scalability which are described in the following sections.</span></span>

### <a name="wf-runtime"></a><span data-ttu-id="8a891-134">WF-Laufzeit</span><span class="sxs-lookup"><span data-stu-id="8a891-134">WF Runtime</span></span>
 <span data-ttu-id="8a891-135">Die zentrale Komponente der [!INCLUDE[wf1](../../../includes/wf1-md.md)]-Laufzeit ist ein asynchroner Planer, der die Ausführung der Aktivitäten in einem Workflow steuert.</span><span class="sxs-lookup"><span data-stu-id="8a891-135">At the core of the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime is an asynchronous scheduler that drives the execution of the activities in a workflow.</span></span> <span data-ttu-id="8a891-136">Er stellt eine leistungsstarke, vorhersagbare Ausführungsumgebung für Aktivitäten zur Verfügung.</span><span class="sxs-lookup"><span data-stu-id="8a891-136">It provides a performant, predictable execution environment for activities.</span></span> <span data-ttu-id="8a891-137">Die Umgebung weist einen gut definierten Vertrag für Ausführung, Fortsetzung, Abschluss, Abbruch, Ausnahmen und ein vorhersagbares Threadingmodell auf.</span><span class="sxs-lookup"><span data-stu-id="8a891-137">The environment has a well-defined contract for execution, continuation, completion, cancellation, exceptions, and a predictable threading model.</span></span>

 <span data-ttu-id="8a891-138">Im Vergleich zu WF3 ist der Planer der WF4-Laufzeit effizienter.</span><span class="sxs-lookup"><span data-stu-id="8a891-138">In comparison to WF3, the WF4 runtime has a more efficient scheduler.</span></span> <span data-ttu-id="8a891-139">Er nutzt den gleichen e/a-Thread Pool, der für WCF verwendet wird. Dies ist bei der Ausführung von Arbeitsaufgaben im Batch Umfang sehr effizient.</span><span class="sxs-lookup"><span data-stu-id="8a891-139">It leverages the same I/O thread pool that is used for WCF, which is very efficient at executing batched work items.</span></span> <span data-ttu-id="8a891-140">Die interne Warteschlange des Arbeitsaufgabenplaners ist für die gängigsten Verwendungsmuster optimiert.</span><span class="sxs-lookup"><span data-stu-id="8a891-140">The internal work item scheduler queue is optimized for most common usage patterns.</span></span> <span data-ttu-id="8a891-141">Die WF4-Laufzeit verwaltet die Ausführungs Zustände ebenfalls sehr einfach mit minimaler Synchronisierungs-und Ereignis Behandlungs Logik, während WF3 von einer umfangreichen Ereignis Registrierung und einem Aufruf abhängig ist, um eine komplexe Synchronisierung für Zustandsübergänge auszuführen.</span><span class="sxs-lookup"><span data-stu-id="8a891-141">The WF4 runtime also manages the execution states in a very lightweight way with minimal synchronization and event handling logic, while WF3 depends on heavy-weight event registration and invocation to perform complex synchronization for state transitions.</span></span>

### <a name="data-storage-and-flow"></a><span data-ttu-id="8a891-142">Datenspeicherung und -fluss</span><span class="sxs-lookup"><span data-stu-id="8a891-142">Data Storage and Flow</span></span>
 <span data-ttu-id="8a891-143">In WF3 werden einer Aktivität zugeordnete Daten durch Abhängigkeitseigenschaften modelliert, die vom Typ <xref:System.Windows.DependencyProperty> implementiert werden.</span><span class="sxs-lookup"><span data-stu-id="8a891-143">In WF3, data associated with an activity is modeled through dependency properties implemented by the type <xref:System.Windows.DependencyProperty>.</span></span> <span data-ttu-id="8a891-144">Das Muster für die Abhängigkeits Eigenschaft wurde in Windows Presentation Foundation (WPF) eingeführt.</span><span class="sxs-lookup"><span data-stu-id="8a891-144">The dependency property pattern was introduced in Windows Presentation Foundation (WPF).</span></span> <span data-ttu-id="8a891-145">Im Allgemeinen ist dieses Muster sehr flexibel, sodass eine einfache Datenbindung und andere Benutzeroberflächenfunktionen unterstützt werden.</span><span class="sxs-lookup"><span data-stu-id="8a891-145">In general, this pattern is very flexible to support easy data binding and other UI features.</span></span> <span data-ttu-id="8a891-146">Für das Muster müssen jedoch die Eigenschaften als statische Felder in der Workflowdefinition definiert sein.</span><span class="sxs-lookup"><span data-stu-id="8a891-146">However, the pattern requires the properties to be defined as static fields in the workflow definition.</span></span> <span data-ttu-id="8a891-147">Jedes Mal, wenn die [!INCLUDE[wf1](../../../includes/wf1-md.md)]-Laufzeit die Eigenschaftswerte festlegt oder abruft, wird eine komplexe Suchlogik angewendet.</span><span class="sxs-lookup"><span data-stu-id="8a891-147">Whenever the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime sets or gets the property values, it involves heavily-weighted look-up logic.</span></span>

 <span data-ttu-id="8a891-148">WF4 verwendet eine Bewertungslogik mit Klartextdaten, um die Verarbeitung von Daten in einem Workflow erheblich zu verbessern.</span><span class="sxs-lookup"><span data-stu-id="8a891-148">WF4 uses clear data scoping logic to greatly improve how data is handled in a workflow.</span></span> <span data-ttu-id="8a891-149">Die in einer Aktivität gespeicherten Daten werden durch zwei verschiedene Konzepte (Variablen und Argumente) von den Daten getrennt, die über die Aktivitätsgrenzen fließen.</span><span class="sxs-lookup"><span data-stu-id="8a891-149">It separates the data stored in an activity from the data that is flowing across the activity boundaries by using two different concepts: variables and arguments.</span></span> <span data-ttu-id="8a891-150">Wenn ein eindeutiger hierarchischer Bereich für Variablen und "in/out-/INOUT"-Argumente verwendet wird, wird die Daten Verwendungs Komplexität für Aktivitäten drastisch reduziert, und die Lebensdauer der Daten wird ebenfalls automatisch festgelegt.</span><span class="sxs-lookup"><span data-stu-id="8a891-150">By using a clear hierarchical scope for variables and "In/Out/InOut" arguments, the data usage complexity for activities is dramatically reduced and the lifetime of the data is also automatically scoped.</span></span> <span data-ttu-id="8a891-151">Aktivitäten verfügen über eine gut definierte Signatur, die von ihren Argumenten beschrieben wird.</span><span class="sxs-lookup"><span data-stu-id="8a891-151">Activities have a well-defined signature described by its arguments.</span></span> <span data-ttu-id="8a891-152">Durch die einfache Überprüfung einer Aktivität können Sie bestimmen, welche Daten erwartet und welche Daten als Ausführungsergebnis erzeugt werden.</span><span class="sxs-lookup"><span data-stu-id="8a891-152">By simply inspecting an activity you can determine what data it expects to receive and what data will be produced by it as the result of its execution.</span></span>

 <span data-ttu-id="8a891-153">In WF3 wurden Aktivitäten bei der Erstellung eines Workflows initialisiert.</span><span class="sxs-lookup"><span data-stu-id="8a891-153">In WF3 activities were initialized when a workflow was created.</span></span> <span data-ttu-id="8a891-154">In WF4 werden Aktivitäten nur dann initialisiert, wenn die entsprechenden Aktivitäten ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="8a891-154">In WF 4 activities are initialized only when the corresponding activities are executing.</span></span> <span data-ttu-id="8a891-155">Dies ermöglicht einen einfacheren Aktivitätslebenszyklus ohne Vorgänge zum Initialisieren und zum Aufheben der Initialisierung, wenn eine neue Workflowinstanz erstellt wird. Somit wurde die Effizienz gesteigert.</span><span class="sxs-lookup"><span data-stu-id="8a891-155">This allows a simpler activity lifecycle without performing Initialize/Uninitialize operations when a new workflow instance is created, and thus has achieved more efficiency</span></span>

### <a name="control-flow"></a><span data-ttu-id="8a891-156">Ablaufsteuerung</span><span class="sxs-lookup"><span data-stu-id="8a891-156">Control Flow</span></span>
 <span data-ttu-id="8a891-157">Wie andere Programmiersprachen auch unterstützt [!INCLUDE[wf1](../../../includes/wf1-md.md)] Ablaufsteuerungen für Workflowdefinitionen. Hierzu wurde ein Satz von Ablaufsteuerungsaktivitäten für die Sequenzierung, die Ausführung als Schleife, das Verzweigen und andere Muster eingeführt.</span><span class="sxs-lookup"><span data-stu-id="8a891-157">Just as in any programming language, [!INCLUDE[wf1](../../../includes/wf1-md.md)] provides support for control flows for workflow definitions by introducing a set of control flow activities for sequencing, looping, branching and other patterns.</span></span> <span data-ttu-id="8a891-158">Wenn in WF3 dieselbe Aktivität erneut ausgeführt werden muss, wird ein neuer <xref:System.Workflow.ComponentModel.ActivityExecutionContext> erstellt und die Aktivität durch eine komplexe Serialisierungs- und eine Deserialisierungslogik auf Grundlage von <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter> geklont.</span><span class="sxs-lookup"><span data-stu-id="8a891-158">In WF3, when the same activity needs to be re-executed, a new <xref:System.Workflow.ComponentModel.ActivityExecutionContext> is created and the activity is cloned through a heavy-weight serialization and deserialization logic based on <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter>.</span></span> <span data-ttu-id="8a891-159">Normalerweise ist die Leistung bei iterativen Ablaufsteuerungen viel geringer als beim Ausführen einer Sequenz von Aktivitäten.</span><span class="sxs-lookup"><span data-stu-id="8a891-159">Usually the performance for iterative control flows is much slower than executing a sequence of activities.</span></span>

 <span data-ttu-id="8a891-160">WF4 behandelt diesen Vorgang anders.</span><span class="sxs-lookup"><span data-stu-id="8a891-160">WF4 handles this quite differently.</span></span> <span data-ttu-id="8a891-161">Es nimmt die Aktivitätsvorlage, erstellt ein neues ActivityInstance-Objekt und fügt es der Planerwarteschlange hinzu.</span><span class="sxs-lookup"><span data-stu-id="8a891-161">It takes the activity template, creates a new ActivityInstance object, and adds it to the scheduler queue.</span></span> <span data-ttu-id="8a891-162">Dieser gesamte Prozess umfasst nur explizite Objekt Erstellung und ist sehr einfach.</span><span class="sxs-lookup"><span data-stu-id="8a891-162">This whole process only involves explicit object creation and is very lightweight.</span></span>

### <a name="asynchronous-programming"></a><span data-ttu-id="8a891-163">Asynchrone Programmierung</span><span class="sxs-lookup"><span data-stu-id="8a891-163">Asynchronous Programming</span></span>
 <span data-ttu-id="8a891-164">Anwendungen weisen in der Regel bessere Leistung und Skalierbarkeit mit asynchroner Programmierung für lang ausgeführte blockierende Vorgänge auf, wie z. B. E/A oder verteilte Computervorgänge.</span><span class="sxs-lookup"><span data-stu-id="8a891-164">Applications usually have better performance and scalability with asynchronous programming for long running blocking operations such as I/O or distributed computing operations.</span></span> <span data-ttu-id="8a891-165">WF4 stellt asynchrone Unterstützung durch die Basisaktivitätstypen <xref:System.Activities.AsyncCodeActivity> und <xref:System.Activities.AsyncCodeActivity%601> bereit.</span><span class="sxs-lookup"><span data-stu-id="8a891-165">WF4 provides asynchronous support through base activity types <xref:System.Activities.AsyncCodeActivity>, <xref:System.Activities.AsyncCodeActivity%601>.</span></span> <span data-ttu-id="8a891-166">Die Laufzeit versteht asynchrone Aktivitäten systemintern und kann daher die Instanz automatisch in eine Zone ohne Persistenz verschieben, während die asynchrone Arbeit aussteht.</span><span class="sxs-lookup"><span data-stu-id="8a891-166">The runtime natively understands asynchronous activities and therefore can automatically put the instance in a no-persist zone while the asynchronous work is outstanding.</span></span> <span data-ttu-id="8a891-167">Benutzerdefinierte Aktivitäten können von diesen Typen abgeleitet werden, um asynchrone Aufgaben auszuführen, ohne dass der Workflowplanerthread angehalten und Aktivitäten, die möglicherweise parallel ausgeführt werden, blockiert werden.</span><span class="sxs-lookup"><span data-stu-id="8a891-167">Custom activities can derive from these types to perform asynchronous work without holding the workflow scheduler thread and blocking any activities that may be able to run in parallel.</span></span>

### <a name="messaging"></a><span data-ttu-id="8a891-168">Messaging</span><span class="sxs-lookup"><span data-stu-id="8a891-168">Messaging</span></span>
 <span data-ttu-id="8a891-169">Anfänglich hatte WF3 sehr beschränkte Messagingunterstützung über externe Ereignisse oder Webdienstaufrufe.</span><span class="sxs-lookup"><span data-stu-id="8a891-169">Initially WF3 had very limited messaging support through external events or web services invocations.</span></span> <span data-ttu-id="8a891-170">In .NET 3,5 können Workflows als WCF-Clients implementiert oder über <xref:System.Workflow.Activities.SendActivity> und <xref:System.Workflow.Activities.ReceiveActivity>als WCF-Dienste verfügbar gemacht werden.</span><span class="sxs-lookup"><span data-stu-id="8a891-170">In .NET 3.5, workflows could be implemented as WCF clients or exposed as WCF services through <xref:System.Workflow.Activities.SendActivity> and <xref:System.Workflow.Activities.ReceiveActivity>.</span></span> <span data-ttu-id="8a891-171">In WF4 wurde das Konzept der Workflow basierten Messaging Programmierung durch die enge Integration von WCF-Messaging Logik in WF weiter gestärkt.</span><span class="sxs-lookup"><span data-stu-id="8a891-171">In WF4, the concept of workflow-based messaging programming has been further strengthened through the tight integration of WCF messaging logic into WF.</span></span>

 <span data-ttu-id="8a891-172">Die vereinheitlichte Pipeline zur Nachrichtenverarbeitung in WCF in .NET 4 unterstützt WF4-Dienste bei einer deutlich besseren Leistung und Skalierbarkeit als bei WF3.</span><span class="sxs-lookup"><span data-stu-id="8a891-172">The unified message processing pipeline provided in WCF in .NET 4 helps WF4 services to have significantly better performance and scalability than WF3.</span></span> <span data-ttu-id="8a891-173">WF4 stellt außerdem eine umfangreichere Messagingprogrammierungsunterstützung bereit, die komplexe Nachrichtenaustauschmuster (MEPs) modellieren kann.</span><span class="sxs-lookup"><span data-stu-id="8a891-173">WF4 also provides richer messaging programming support that can model complex Message Exchange Patterns (MEPs).</span></span> <span data-ttu-id="8a891-174">Entwickler verwenden entweder typisierte Dienstverträge, um eine einfache Programmierung zu erreichen, oder nicht typisierte Dienstverträge, um bessere Leistung ohne Bezahlung von Serialisierungskosten zu erzielen.</span><span class="sxs-lookup"><span data-stu-id="8a891-174">Developers can use either typed service contracts to achieve easy programming or un-typed service contracts to achieve better performance without paying serialization costs.</span></span> <span data-ttu-id="8a891-175">Die clientseitige Channelzwischenspeicherunterstützung über die <xref:System.ServiceModel.Activities.SendMessageChannelCache>-Klasse in WF4 hilft Entwicklern beim Erstellen schneller Anwendungen mit minimalem Aufwand.</span><span class="sxs-lookup"><span data-stu-id="8a891-175">The client-side channel caching support through the <xref:System.ServiceModel.Activities.SendMessageChannelCache> class in WF4 helps developers build fast applications with minimal effort.</span></span> <span data-ttu-id="8a891-176">Weitere Informationen finden Sie unter [Ändern der Cache Freigabe Ebenen für Sendeaktivitäten](../wcf/feature-details/changing-the-cache-sharing-levels-for-send-activities.md).</span><span class="sxs-lookup"><span data-stu-id="8a891-176">For more information, see [Changing the Cache Sharing Levels for Send Activities](../wcf/feature-details/changing-the-cache-sharing-levels-for-send-activities.md).</span></span>

### <a name="declarative-programming"></a><span data-ttu-id="8a891-177">Deklarative Programmierung</span><span class="sxs-lookup"><span data-stu-id="8a891-177">Declarative Programming</span></span>
 <span data-ttu-id="8a891-178">WF4 stellt ein reines und einfaches, deklaratives Programmierframework bereit, um Geschäftsprozesse und -dienste zu modellieren.</span><span class="sxs-lookup"><span data-stu-id="8a891-178">WF4 provides a clean and simple declarative programming framework to model business processes and services.</span></span> <span data-ttu-id="8a891-179">Das Programmiermodell unterstützt die vollständig deklarative Komposition von Aktivitäten ohne Code-Beside, was die Workflowerstellung sehr vereinfacht.</span><span class="sxs-lookup"><span data-stu-id="8a891-179">The programming model supports fully declarative composition of activities, with no code-beside, greatly simplifying workflow authoring.</span></span> <span data-ttu-id="8a891-180">In .NET Framework 4 wurde das XAML-basierte deklarative Programmier Framework in der einzelnen Assembly System. XAML. dll vereinheitlicht, um sowohl WPF als auch WF zu unterstützen.</span><span class="sxs-lookup"><span data-stu-id="8a891-180">In .NET Framework 4, the XAML-based declarative programming framework has been unified into the single assembly System.Xaml.dll to support both WPF and WF.</span></span>

 <span data-ttu-id="8a891-181">In WF4 stellt XAML eine wirklich deklarative Erfahrung bereit und lässt die vollständige Definition des Workflows in XML-Markup zu, wobei auf Aktivitäten und Typen verwiesen wird, die mithilfe von .NET erstellt wurden.</span><span class="sxs-lookup"><span data-stu-id="8a891-181">In WF4, XAML provides a truly declarative experience and allows for the entire definition of the workflow to be defined in XML markup, referencing activities and types built using .NET.</span></span> <span data-ttu-id="8a891-182">Ohne Einbeziehen benutzerdefinierter Code-Behind-Logik war dies in WF3 mit dem XOML-Format schwierig.</span><span class="sxs-lookup"><span data-stu-id="8a891-182">This was difficult to do in WF3 with XOML format without involving custom code-behind logic.</span></span> <span data-ttu-id="8a891-183">Der neue XAML-Stapel in .NET 4 bietet eine viel bessere Leistung beim Serialisieren/Deserialisieren von Workflow Artefakten und macht die deklarative Programmierung ansprechender und stabiler.</span><span class="sxs-lookup"><span data-stu-id="8a891-183">The new XAML-stack in .NET 4 has much better performance in serializing/deserializing workflow artifacts and makes declarative programming more attractive and solid.</span></span>

### <a name="workflow-designer"></a><span data-ttu-id="8a891-184">Workflow-Designer</span><span class="sxs-lookup"><span data-stu-id="8a891-184">Workflow Designer</span></span>
 <span data-ttu-id="8a891-185">Eine vollständig deklarative Programmierungsunterstützung für WF4 stellt der Entwurfszeitleistung für große Workflows explizit höhere Anforderungen.</span><span class="sxs-lookup"><span data-stu-id="8a891-185">Fully declarative programming support for WF4 explicitly imposes higher requirements for design time performance for large workflows.</span></span> <span data-ttu-id="8a891-186">Der Workflow-Designer in WF4 weist eine viel bessere Skalierbarkeit für große Workflows als in WF3 auf.</span><span class="sxs-lookup"><span data-stu-id="8a891-186">The Workflow designer in WF4 has much better scalability for large workflows than that for WF3.</span></span> <span data-ttu-id="8a891-187">Dank der Unterstützung der Benutzeroberflächenvirtualisierung kann der Designer einen großen Workflow von 1000 Aktivitäten einfach in wenigen Sekunden laden, obwohl es beinahe unmöglich ist, einen Workflow von einigen hundert Aktivitäten mit dem WF3-Designer zu laden.</span><span class="sxs-lookup"><span data-stu-id="8a891-187">With UI virtualization support, the designer can easily load a large workflow of 1000 activities in a few seconds, while it is almost impossible to load a workflow of a few hundred activities with the WF3 designer.</span></span>

## <a name="component-level-performance-comparisons"></a><span data-ttu-id="8a891-188">Leistungsvergleiche auf Komponentenebene</span><span class="sxs-lookup"><span data-stu-id="8a891-188">Component-level Performance Comparisons</span></span>
 <span data-ttu-id="8a891-189">Dieser Abschnitt enthält Daten zu direkten Vergleichen zwischen einzelnen Aktivitäten in WF3-und WF4-Workflows.</span><span class="sxs-lookup"><span data-stu-id="8a891-189">This section contains data on direct comparisons between individual activities in WF3 and WF4 workflows.</span></span>  <span data-ttu-id="8a891-190">Hauptbereiche wie Persistenz haben tiefgründigere Auswirkungen auf die Leistung als die einzelnen Aktivitätskomponenten.</span><span class="sxs-lookup"><span data-stu-id="8a891-190">Key areas like persistence have a more profound impact on performance than the individual activity components.</span></span>  <span data-ttu-id="8a891-191">Die Leistungsverbesserungen an einzelnen Komponenten in WF4 sind dennoch wichtig, da die Komponenten jetzt schnell genug sind, um mit der handcodierten Orchestrierungslogik verglichen zu werden.</span><span class="sxs-lookup"><span data-stu-id="8a891-191">The performance improvements in individual components in WF4 are important though because the components are now fast enough to be compared against hand-coded orchestration logic.</span></span>  <span data-ttu-id="8a891-192">Ein Beispiel hierfür finden Sie im nächsten Abschnitt: "Dienst Kompositions Szenario".</span><span class="sxs-lookup"><span data-stu-id="8a891-192">An example of which is covered in the next section: "Service Composition Scenario."</span></span>

### <a name="environment-setup"></a><span data-ttu-id="8a891-193">Umgebungssetup</span><span class="sxs-lookup"><span data-stu-id="8a891-193">Environment Setup</span></span>
 ![Umgebungs Einrichtung für Workflow-Leistungsmessung](./media/performance/performance-test-environment.gif)

 <span data-ttu-id="8a891-195">Die oben erwähnte Abbildung zeigt die zur Leistungsmessung auf Komponentenebene verwendete Computerkonfiguration.</span><span class="sxs-lookup"><span data-stu-id="8a891-195">The above figure shows the machine configuration used for component-level performance measurement.</span></span> <span data-ttu-id="8a891-196">Ein einzelner Server und fünf Clients sind über eine 1-GBit/s-Ethernet-Netzwerkschnittstelle verbunden.</span><span class="sxs-lookup"><span data-stu-id="8a891-196">A single server and five clients connected over one 1-Gbps Ethernet network interface.</span></span> <span data-ttu-id="8a891-197">Zur einfacheren Messung ist der Server so konfiguriert, dass ein einzelner Kern eines Dual-Proc/Quad-Core-Servers verwendet wird, der unter Windows Server 2008 x86 ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="8a891-197">For easy measurements, the server is configured to use a single core of a dual-proc/quad-core server  running Windows Server 2008 x86.</span></span> <span data-ttu-id="8a891-198">Die CPU-Auslastung des Systems wird bei annähernd 100&#160;% gehalten.</span><span class="sxs-lookup"><span data-stu-id="8a891-198">The system CPU utilization is maintained at nearly 100%.</span></span>

### <a name="test-details"></a><span data-ttu-id="8a891-199">Testdetails</span><span class="sxs-lookup"><span data-stu-id="8a891-199">Test Details</span></span>
 <span data-ttu-id="8a891-200">Die WF3-<xref:System.Workflow.Activities.CodeActivity> ist wahrscheinlich die einfachste Aktivität, die in einem WF3-Workflow verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="8a891-200">The WF3 <xref:System.Workflow.Activities.CodeActivity> is likely the simplest activity that can be used in a WF3 workflow.</span></span>  <span data-ttu-id="8a891-201">Die Aktivität ruft eine Methode im Code-Behind auf, in die der Workflowprogrammierer benutzerdefinierten Code einfügen kann.</span><span class="sxs-lookup"><span data-stu-id="8a891-201">The activity calls a method in the code-behind that the workflow programmer can put custom code into.</span></span>  <span data-ttu-id="8a891-202">In WF4 gibt es kein direktes Pendant zur WF3-<xref:System.Workflow.Activities.CodeActivity>, die dieselbe Funktionalität bietet.</span><span class="sxs-lookup"><span data-stu-id="8a891-202">In WF4, there is no direct analog to the WF3 <xref:System.Workflow.Activities.CodeActivity> that provides the same functionality.</span></span>  <span data-ttu-id="8a891-203">Beachten Sie, dass es eine <xref:System.Activities.CodeActivity>-Basisklasse in WF4 gibt, die nicht mit der WF3-<xref:System.Workflow.Activities.CodeActivity> im Zusammenhang steht.</span><span class="sxs-lookup"><span data-stu-id="8a891-203">Note that there is a <xref:System.Activities.CodeActivity> base class in WF4 that is not related to the WF3 <xref:System.Workflow.Activities.CodeActivity>.</span></span>  <span data-ttu-id="8a891-204">Workflowautoren werden ermutigt, benutzerdefinierte Aktivitäten und Nur-XAML-Workflows zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="8a891-204">Workflow authors are encouraged to create custom activities and build XAML-only workflows.</span></span>  <span data-ttu-id="8a891-205">Unten in den Tests wird eine Aktivität mit der Bezeichnung `Comment` anstelle einer leeren <xref:System.Workflow.Activities.CodeActivity> in WF4-Workflows verwendet.</span><span class="sxs-lookup"><span data-stu-id="8a891-205">In the tests below, an activity called `Comment` is used in place of an empty <xref:System.Workflow.Activities.CodeActivity> in WF4 workflows.</span></span>  <span data-ttu-id="8a891-206">Der Code in der `Comment`-Aktivität lautet folgendermaßen:</span><span class="sxs-lookup"><span data-stu-id="8a891-206">The code in the `Comment` activity is as follows:</span></span>

```csharp
[ContentProperty("Body")]
    public sealed class Comment : CodeActivity
    {
        public Comment()
            : base()
        {
        }

        [DefaultValue(null)]
        public Activity Body
        {
            get;
            set;
        }

        protected override void Execute(CodeActivityContext context)
        {
        }
    }
```

### <a name="empty-workflow"></a><span data-ttu-id="8a891-207">Leerer Workflow</span><span class="sxs-lookup"><span data-stu-id="8a891-207">Empty Workflow</span></span>
 <span data-ttu-id="8a891-208">Dieser Test verwendet einen Sequenzworkflow ohne untergeordnete Aktivitäten.</span><span class="sxs-lookup"><span data-stu-id="8a891-208">This test uses a sequence workflow with no child activities.</span></span>

### <a name="single-activity"></a><span data-ttu-id="8a891-209">Einfache Aktivität</span><span class="sxs-lookup"><span data-stu-id="8a891-209">Single Activity</span></span>
 <span data-ttu-id="8a891-210">Der Workflow ist ein Sequenzworkflow, der eine untergeordnete Aktivität enthält.</span><span class="sxs-lookup"><span data-stu-id="8a891-210">The workflow is a sequence workflow containing one child activity.</span></span>  <span data-ttu-id="8a891-211">Bei der Aktivität handelt es sich um eine <xref:System.Workflow.Activities.CodeActivity> ohne Code in WF3 und um eine `Comment`-Aktivität in WF4.</span><span class="sxs-lookup"><span data-stu-id="8a891-211">The activity is a <xref:System.Workflow.Activities.CodeActivity> with no code in the WF3 case and a `Comment` activity in the WF4 case.</span></span>

### <a name="while-with-1000-iterations"></a><span data-ttu-id="8a891-212">Bei 1000 Iterationen</span><span class="sxs-lookup"><span data-stu-id="8a891-212">While with 1000 Iterations</span></span>
 <span data-ttu-id="8a891-213">Der Sequenzworkflow enthält eine <xref:System.Activities.Statements.While>-Aktivität mit einer untergeordneten Aktivität in der Schleife, die keine Arbeit ausführt.</span><span class="sxs-lookup"><span data-stu-id="8a891-213">The sequence workflow contains one <xref:System.Activities.Statements.While> activity with one child activity in the loop that does not perform any work.</span></span>

### <a name="replicator-compared-to-parallelforeach"></a><span data-ttu-id="8a891-214">Replikationsdienst im Vergleich zu ParallelForEach</span><span class="sxs-lookup"><span data-stu-id="8a891-214">Replicator compared to ParallelForEach</span></span>
 <span data-ttu-id="8a891-215"><xref:System.Workflow.Activities.ReplicatorActivity> in WF3 weist sequenzielle und parallele Ausführungsmodi auf.</span><span class="sxs-lookup"><span data-stu-id="8a891-215"><xref:System.Workflow.Activities.ReplicatorActivity> in WF3 has sequential and parallel execution modes.</span></span>  <span data-ttu-id="8a891-216">Im sequenziellen Modus entspricht die Leistung der Aktivität in etwa der der <xref:System.Workflow.Activities.WhileActivity>.</span><span class="sxs-lookup"><span data-stu-id="8a891-216">In sequential mode, the activity’s performance is similar to the <xref:System.Workflow.Activities.WhileActivity>.</span></span>  <span data-ttu-id="8a891-217">Die <xref:System.Workflow.Activities.ReplicatorActivity> ist für die parallele Ausführung äußerst nützlich.</span><span class="sxs-lookup"><span data-stu-id="8a891-217">The <xref:System.Workflow.Activities.ReplicatorActivity> is most useful for parallel execution.</span></span>  <span data-ttu-id="8a891-218">Das Pendant dafür in WF4 ist die <xref:System.Activities.Statements.ParallelForEach%601>-Aktivität.</span><span class="sxs-lookup"><span data-stu-id="8a891-218">The WF4 analog for this is the <xref:System.Activities.Statements.ParallelForEach%601> activity.</span></span>

 <span data-ttu-id="8a891-219">Das folgende Diagramm zeigt die für diesen Test verwendeten Workflows.</span><span class="sxs-lookup"><span data-stu-id="8a891-219">The following diagram shows the workflows used for this test.</span></span> <span data-ttu-id="8a891-220">Der WF3-Workflow befindet sich links, der WF4-Workflow rechts.</span><span class="sxs-lookup"><span data-stu-id="8a891-220">The WF3 workflow is on the left and the WF4 workflow is on the right.</span></span>

 ![WF3-ReplicatorActivity und WF4-ParallelForEach](./media/performance/replicator-parallel-wf3-wf4.gif)

### <a name="sequential-workflow-with-five-activities"></a><span data-ttu-id="8a891-222">Sequenzieller Workflow mit fünf Aktivitäten</span><span class="sxs-lookup"><span data-stu-id="8a891-222">Sequential Workflow with Five Activities</span></span>
 <span data-ttu-id="8a891-223">Dieser Test ist dafür vorgesehen, den Effekt des Ausführens mehrerer Aktivitäten nacheinander zu zeigen.</span><span class="sxs-lookup"><span data-stu-id="8a891-223">This test is meant to show the effect of having several activities execute in sequence.</span></span>  <span data-ttu-id="8a891-224">Die Sequenz enthält fünf Aktivitäten.</span><span class="sxs-lookup"><span data-stu-id="8a891-224">There are five activities in the sequence.</span></span>

### <a name="transaction-scope"></a><span data-ttu-id="8a891-225">Transaktionsbereich</span><span class="sxs-lookup"><span data-stu-id="8a891-225">Transaction Scope</span></span>
 <span data-ttu-id="8a891-226">Der Transaktionsbereichstest unterscheidet sich insofern minimal von den anderen Tests, da nicht für jede Iteration eine neue Workflowinstanz erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="8a891-226">The transaction scope test differs from the other tests slightly in that a new workflow instance is not created for every iteration.</span></span>  <span data-ttu-id="8a891-227">Stattdessen wird der Workflow mit einer while-Schleife strukturiert, die eine <xref:System.Activities.Statements.TransactionScope>-Aktivität enthält, die eine einzelne Aktivität enthält, die keine Arbeit ausführt.</span><span class="sxs-lookup"><span data-stu-id="8a891-227">Instead, the workflow is structured with a while loop containing a <xref:System.Activities.Statements.TransactionScope> activity containing a single activity that does no work.</span></span>  <span data-ttu-id="8a891-228">Jede einzelne Ausführung eines Batches von 50 Iterationen über die while-Schleife wird als einzelner Vorgang betrachtet.</span><span class="sxs-lookup"><span data-stu-id="8a891-228">Each run of a batch of 50 iterations through the while loop is counted as a single operation.</span></span>

### <a name="compensation"></a><span data-ttu-id="8a891-229">Kompensierung</span><span class="sxs-lookup"><span data-stu-id="8a891-229">Compensation</span></span>
 <span data-ttu-id="8a891-230">Der WF3-Workflow verfügt über eine einzelne kompensierbare Aktivität mit der Bezeichnung `WorkScope`.</span><span class="sxs-lookup"><span data-stu-id="8a891-230">The WF3 workflow has a single compensatable activity named `WorkScope`.</span></span>  <span data-ttu-id="8a891-231">Die Aktivität implementiert einfach die <xref:System.Workflow.ComponentModel.ICompensatableActivity>-Schnittstelle:</span><span class="sxs-lookup"><span data-stu-id="8a891-231">The activity simply implements the <xref:System.Workflow.ComponentModel.ICompensatableActivity> interface:</span></span>

```csharp
class WorkScope :
        CompositeActivity, ICompensatableActivity
    {
        public WorkScope() : base() { }

        public WorkScope(string name)
        {
            this.Name = name;
        }

        public ActivityExecutionStatus Compensate(
            ActivityExecutionContext executionContext)
        {
            return ActivityExecutionStatus.Closed;
        }
    }
```

 <span data-ttu-id="8a891-232">Der Fehlerhandler ist für die `WorkScope` Aktivität vorgesehen.</span><span class="sxs-lookup"><span data-stu-id="8a891-232">The fault handler targets the `WorkScope` activity.</span></span> <span data-ttu-id="8a891-233">Der WF4-Workflow ist gleichermaßen einfach.</span><span class="sxs-lookup"><span data-stu-id="8a891-233">The WF4 workflow is equally simplistic.</span></span>  <span data-ttu-id="8a891-234">Eine <xref:System.Activities.Statements.CompensableActivity> verfügt über einen Textkörper und einen Kompensierungshandler.</span><span class="sxs-lookup"><span data-stu-id="8a891-234">A <xref:System.Activities.Statements.CompensableActivity> has a body and a compensation handler.</span></span>  <span data-ttu-id="8a891-235">Als Nächstes folgt eine explizite Kompensierung in der Sequenz.</span><span class="sxs-lookup"><span data-stu-id="8a891-235">An explicit compensate is next in the sequence.</span></span>  <span data-ttu-id="8a891-236">Die Textkörperaktivität und die Kompensationshandleraktivität sind jeweils leere Implementierungen:</span><span class="sxs-lookup"><span data-stu-id="8a891-236">The body activity and compensation handler activity are both empty implementations:</span></span>

```csharp
public sealed class CompensableActivityEmptyCompensation : CodeActivity
    {
        public CompensableActivityEmptyCompensation()
            : base() { }

        public Activity Body { get; set; }

        protected override void Execute(CodeActivityContext context) { }
    }
    public sealed class CompensableActivityEmptyBody : CodeActivity
    {
        public CompensableActivityEmptyBody()
            : base() { }

        public Activity Body { get; set; }

        protected override void Execute(CodeActivityContext context) { }
    }
```

<span data-ttu-id="8a891-237">Im folgenden Diagramm wird der grundlegende Kompensations Workflow gezeigt.</span><span class="sxs-lookup"><span data-stu-id="8a891-237">The following diagram shows the basic compensation workflow.</span></span> <span data-ttu-id="8a891-238">Der WF3-Workflow befindet sich links, der WF4-Workflow rechts.</span><span class="sxs-lookup"><span data-stu-id="8a891-238">The WF3 workflow is on the left and the WF4 workflow is on the right.</span></span>

![Grundlegende Kompensations Workflows für WF3 und WF4](./media/performance/basic-compensation-workflows-wf3-wf4.gif)

### <a name="performance-test-results"></a><span data-ttu-id="8a891-240">Ergebnisse des Leistungstests</span><span class="sxs-lookup"><span data-stu-id="8a891-240">Performance Test Results</span></span>

 ![Tabelle mit Leistungstest-Ergebnisdaten](./media/performance/performance-test-data.gif)

 ![Säulendiagramm Vergleichen von WF3-und WF4-Leistungstest Daten](./media/performance/performance-test-chart.gif)

 <span data-ttu-id="8a891-243">Alle Tests werden mit Ausnahme des Transaktionsbereichstests in Workflows pro Sekunde gemessen.</span><span class="sxs-lookup"><span data-stu-id="8a891-243">All tests are measured in workflows per second with the exception of the transaction scope test.</span></span>  <span data-ttu-id="8a891-244">Wie oben angezeigt, wurde die Leistung der [!INCLUDE[wf1](../../../includes/wf1-md.md)]-Laufzeit im gesamten System verbessert, insbesondere in Bereichen, die mehrere Ausführungen derselben Aktivität erfordern wie etwa die while-Schleife.</span><span class="sxs-lookup"><span data-stu-id="8a891-244">As can be seen above, the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime performance has improved across the board, especially in areas that require multiple executions of the same activity like the while loop.</span></span>

## <a name="service-composition-scenario"></a><span data-ttu-id="8a891-245">Dienstkompositionsszenario</span><span class="sxs-lookup"><span data-stu-id="8a891-245">Service Composition Scenario</span></span>
 <span data-ttu-id="8a891-246">Wie im vorherigen Abschnitt "Leistungsvergleiche auf Komponentenebene" gezeigt, wurde der Aufwand zwischen WF3 und WF4 erheblich reduziert.</span><span class="sxs-lookup"><span data-stu-id="8a891-246">As is shown in the previous section, "Component-level Performance Comparisons," there has been a significant reduction in overhead between WF3 and WF4.</span></span>  <span data-ttu-id="8a891-247">WCF-Workflow Dienste können jetzt fast mit der Leistung von Hand codierten WCF-Diensten verglichen werden, haben jedoch weiterhin alle Vorteile der [!INCLUDE[wf1](../../../includes/wf1-md.md)] Laufzeit.</span><span class="sxs-lookup"><span data-stu-id="8a891-247">WCF workflow services can now almost match the performance of hand-coded WCF services but still have all the benefits of the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime.</span></span>  <span data-ttu-id="8a891-248">Dieses Testszenario vergleicht einen WCF-Dienst mit einem WCF-Workflow Dienst in WF4.</span><span class="sxs-lookup"><span data-stu-id="8a891-248">This test scenario compares a WCF service against a WCF workflow service in WF4.</span></span>

### <a name="online-store-service"></a><span data-ttu-id="8a891-249">Onlineshopdienst</span><span class="sxs-lookup"><span data-stu-id="8a891-249">Online Store Service</span></span>
 <span data-ttu-id="8a891-250">Eine der Stärken von Windows Workflow Foundation ist die Möglichkeit, Prozesse mithilfe mehrerer Dienste zu verfassen.</span><span class="sxs-lookup"><span data-stu-id="8a891-250">One of the strengths of Windows Workflow Foundation is the ability to compose processes using several services.</span></span>  <span data-ttu-id="8a891-251">Für dieses Beispiel gibt es einen Onlineshopdienst, der zwei Dienstaufrufe orchestriert, um eine Bestellung abzuwickeln.</span><span class="sxs-lookup"><span data-stu-id="8a891-251">For this example, there is an online store service that orchestrates two service calls to purchase an order.</span></span>  <span data-ttu-id="8a891-252">Der erste Schritt besteht darin, die Bestellung mithilfe eines Bestellungsvalidierungsdiensts zu validieren.</span><span class="sxs-lookup"><span data-stu-id="8a891-252">The first step is to validate the order using an Order Validating Service.</span></span>  <span data-ttu-id="8a891-253">Der zweite Schritt besteht darin, die Bestellung mithilfe eines Warehouse-Diensts auszufüllen.</span><span class="sxs-lookup"><span data-stu-id="8a891-253">The second step is to fill the order using a Warehouse Service.</span></span>

 <span data-ttu-id="8a891-254">Die zwei Back-End-Dienste, Bestellungsvalidierungsdienst und Warehouse-Dienst, bleiben für beide Tests gleich.</span><span class="sxs-lookup"><span data-stu-id="8a891-254">The two backend services, Order Validating Service and Warehouse Service, remain the same for both tests.</span></span>  <span data-ttu-id="8a891-255">Der Teil, der sich ändert, ist der Onlineshopdienst, von dem die Orchestrierung ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="8a891-255">The part that changes is the Online Store Service that performs the orchestration.</span></span>  <span data-ttu-id="8a891-256">In einem Fall ist der Dienst handcodiert als WCF-Dienst.</span><span class="sxs-lookup"><span data-stu-id="8a891-256">In one case, the service is hand-coded as a WCF service.</span></span>  <span data-ttu-id="8a891-257">Im anderen Fall wird der Dienst als WCF-Workflow Dienst in WF4 geschrieben.</span><span class="sxs-lookup"><span data-stu-id="8a891-257">For the other case, the service is written as a WCF workflow service in WF4.</span></span> [!INCLUDE[wf1](../../../includes/wf1-md.md)]<span data-ttu-id="8a891-258">-spezifische Funktionen wie Nachverfolgen und Persistenz sind für diesen Test deaktiviert.</span><span class="sxs-lookup"><span data-stu-id="8a891-258">-specific features like tracking and persistence are turned off for this test.</span></span>

### <a name="environment"></a><span data-ttu-id="8a891-259">-Umgebung</span><span class="sxs-lookup"><span data-stu-id="8a891-259">Environment</span></span>
![Einrichten der Umgebung für die Leistungsmessung](./media/performance/performance-test-environment.gif)

 <span data-ttu-id="8a891-261">Clientanforderungen werden dem Onlineshopdienst über HTTP von mehreren Computern gestellt.</span><span class="sxs-lookup"><span data-stu-id="8a891-261">Client requests are made to the Online Store Service via HTTP from multiple computers.</span></span>  <span data-ttu-id="8a891-262">Ein einzelner Computer hostet alle drei Dienste.</span><span class="sxs-lookup"><span data-stu-id="8a891-262">A single computer hosts all three services.</span></span>  <span data-ttu-id="8a891-263">Die Transportebene zwischen dem Onlineshopdienst und den Back-End-Diensten ist TCP oder HTTP.</span><span class="sxs-lookup"><span data-stu-id="8a891-263">The transport layer between the Online Store Service and the backend services is TCP or HTTP.</span></span>  <span data-ttu-id="8a891-264">Die Messung der Vorgänge pro Sekunde basiert auf der Anzahl der beim Onlineshopdienst eingegangenen `PurchaseOrder`-Aufrufe.</span><span class="sxs-lookup"><span data-stu-id="8a891-264">The measurement of operations/second is based on the number of completed `PurchaseOrder` calls made to the Online Store Service.</span></span>  <span data-ttu-id="8a891-265">Channelpooling ist eine neue, in WF4 verfügbare Funktion.</span><span class="sxs-lookup"><span data-stu-id="8a891-265">Channel pooling is a new feature available in WF4.</span></span>  <span data-ttu-id="8a891-266">Im WCF-Teil dieses Test Kanal-Pooling wird nicht standardmäßig bereitgestellt, sodass eine Hand codierte Implementierung einer einfachen Pooling-Technik im Online Store-Dienst verwendet wurde.</span><span class="sxs-lookup"><span data-stu-id="8a891-266">In the WCF portion of this test channel pooling is not provided out of the box so a hand-coded implementation of a simple pooling technique was used in the Online Store Service.</span></span>

### <a name="performance"></a><span data-ttu-id="8a891-267">Leistung</span><span class="sxs-lookup"><span data-stu-id="8a891-267">Performance</span></span>
![Säulendiagramm mit der Leistung des Online Store-Dienstanbieter](./media/performance/online-store-performance-graph.gif)

 <span data-ttu-id="8a891-269">Beim Herstellen einer Verbindung zu Back-End-TCP-Diensten ohne Channelpooling weist der [!INCLUDE[wf1](../../../includes/wf1-md.md)]-Dienst Auswirkungen von 17,2 % auf den Durchsatz auf.</span><span class="sxs-lookup"><span data-stu-id="8a891-269">Connecting to backend TCP services without channel pooling, the [!INCLUDE[wf1](../../../includes/wf1-md.md)] service has a 17.2% impact on throughput.</span></span>  <span data-ttu-id="8a891-270">Mit Channelpooling beträgt der Abzug etwa 23,8 %.</span><span class="sxs-lookup"><span data-stu-id="8a891-270">With channel pooling, the penalty is about 23.8%.</span></span>  <span data-ttu-id="8a891-271">Bei HTTP sind die Auswirkungen viel weniger: 4,3 % ohne Pooling und 8,1 % mit Pooling.</span><span class="sxs-lookup"><span data-stu-id="8a891-271">For HTTP, the impact is much less: 4.3% without pooling and 8.1% with pooling.</span></span>  <span data-ttu-id="8a891-272">Zudem muss beachtet werden, dass bei Verwendung von HTTP das Channelpooling sehr wenig Vorteile bietet.</span><span class="sxs-lookup"><span data-stu-id="8a891-272">It is also important to note that the channel pooling provides very little benefit when using HTTP.</span></span>

 <span data-ttu-id="8a891-273">Obwohl der Aufwand von der WF4-Laufzeit im Vergleich zu einem Hand codierten WCF-Dienst in diesem Test erfolgt, könnte dies als ungünstigste Szenario angesehen werden.</span><span class="sxs-lookup"><span data-stu-id="8a891-273">While there is overhead from the WF4 runtime compared with a hand-coded WCF service in this test, it could be considered a worst-case scenario.</span></span>  <span data-ttu-id="8a891-274">Die zwei Back-End-Dienste in diesem Test erledigen sehr wenig Arbeit.</span><span class="sxs-lookup"><span data-stu-id="8a891-274">The two backend services in this test do very little work.</span></span>  <span data-ttu-id="8a891-275">In einem echten End-to-End-Szenario würden diese Dienste aufwendigere Vorgänge wie Datenbankaufrufe ausführen und so die Auswirkungen auf die Leistung der Transportebene reduzieren.</span><span class="sxs-lookup"><span data-stu-id="8a891-275">In a real end-to-end scenario, these services would perform more expensive operations like database calls, making the performance impact of the transport layer less important.</span></span>  <span data-ttu-id="8a891-276">Dieses Argument sowie die Vorteile der in WF4 verfügbaren Funktionen machen Workflow Foundation zu einer brauchbaren Lösung beim Erstellen von Orchestrierungsdiensten.</span><span class="sxs-lookup"><span data-stu-id="8a891-276">This plus the benefits of the features available in WF4 makes Workflow Foundation a viable choice for creating orchestration services.</span></span>

## <a name="key-performance-considerations"></a><span data-ttu-id="8a891-277">Wichtige Überlegungen zur Leistung</span><span class="sxs-lookup"><span data-stu-id="8a891-277">Key Performance Considerations</span></span>
 <span data-ttu-id="8a891-278">Die Funktionsbereiche in diesem Abschnitt haben sich mit Ausnahme von Interop zwischen WF3 und WF4 dramatisch verändert.</span><span class="sxs-lookup"><span data-stu-id="8a891-278">The feature areas in this section, with the exception of interop, have dramatically changed between WF3 and WF4.</span></span>  <span data-ttu-id="8a891-279">Dies wirkt sich auf das Design von Workflowanwendungen sowie die Leistung aus.</span><span class="sxs-lookup"><span data-stu-id="8a891-279">This affects the design of workflow applications as well as the performance.</span></span>

#### <a name="workflow-activation-latency"></a><span data-ttu-id="8a891-280">Workflowaktivierungslatenzzeit</span><span class="sxs-lookup"><span data-stu-id="8a891-280">Workflow Activation Latency</span></span>
 <span data-ttu-id="8a891-281">In einer WCF-Workflow Dienst Anwendung ist die Latenzzeit für das Starten eines neuen Workflows oder das Laden eines vorhandenen Workflows wichtig, da er blockiert werden kann.</span><span class="sxs-lookup"><span data-stu-id="8a891-281">In a WCF workflow service application, the latency for starting a new workflow or loading an existing workflow is important as it can be blocking.</span></span>  <span data-ttu-id="8a891-282">Dieser Testfall misst einen WF3-XOML-Host in einem typischen Szenario im Vergleich zu einem WF4-XAMLX-Host.</span><span class="sxs-lookup"><span data-stu-id="8a891-282">This test case measures a WF3 XOML host against a WF4 XAMLX host in a typical scenario.</span></span>

##### <a name="environment-setup"></a><span data-ttu-id="8a891-283">Umgebungssetup</span><span class="sxs-lookup"><span data-stu-id="8a891-283">Environment Setup</span></span>
 ![Umgebungseinstellungen für Latenz- und Durchsatztests](./media/performance/latency-throughput-environment-setup.gif)

##### <a name="test-setup"></a><span data-ttu-id="8a891-285">Testsetup</span><span class="sxs-lookup"><span data-stu-id="8a891-285">Test Setup</span></span>
 <span data-ttu-id="8a891-286">In diesem Szenario kontaktiert ein Client Computer mithilfe einer kontextbasierten Korrelation einen WCF-Workflow Dienst.</span><span class="sxs-lookup"><span data-stu-id="8a891-286">In the scenario, a client computer contacts a WCF workflow service using context-based correlation.</span></span>  <span data-ttu-id="8a891-287">Kontextkorrelation erfordert eine besondere Kontextbindung und verwendet einen Kontextheader oder ein Cookie, um Meldungen mit der richtigen Workflowinstanz zu verknüpfen.</span><span class="sxs-lookup"><span data-stu-id="8a891-287">Context correlation requires a special context binding and uses a context header or cookie to relate messages to the correct workflow instance.</span></span>  <span data-ttu-id="8a891-288">Ein Leistungsvorteil besteht darin, dass sich die Korrelations-ID im Nachrichtenheader befindet, damit der Nachrichtentext nicht analysiert werden muss.</span><span class="sxs-lookup"><span data-stu-id="8a891-288">It has a performance benefit in that the correlation Id is located in the message header so the message body does not need to be parsed.</span></span>

 <span data-ttu-id="8a891-289">Der Dienst erstellt einen neuen Workflow mit der Anforderung und sendet eine sofortige Antwort, damit bei der Messung der Latenzzeit die Zeit für die Ausführung des Workflows nicht einbezogen wird.</span><span class="sxs-lookup"><span data-stu-id="8a891-289">The service will create a new workflow with the request and send an immediate response so that the measurement of latency does not include the time spent running the workflow.</span></span>  <span data-ttu-id="8a891-290">Der WF3-Workflow basiert auf XOML mit Code-Behind, und der WF4-Workflow basiert vollständig auf XAML.</span><span class="sxs-lookup"><span data-stu-id="8a891-290">The WF3 workflow is XOML with a code-behind and the WF4 workflow is entirely XAML.</span></span>  <span data-ttu-id="8a891-291">Der WF4-Workflow sieht folgendermaßen aus:</span><span class="sxs-lookup"><span data-stu-id="8a891-291">The WF4 workflow looks like this:</span></span>

 ![WF4-Korrelations Bereich-Workflow](./media/performance/wf4-correlationscope-workflow.gif)

 <span data-ttu-id="8a891-293">Die <xref:System.ServiceModel.Activities.Receive>-Aktivität erstellt die Workflowinstanz.</span><span class="sxs-lookup"><span data-stu-id="8a891-293">The <xref:System.ServiceModel.Activities.Receive> activity creates the workflow instance.</span></span>  <span data-ttu-id="8a891-294">Ein in der empfangenen Meldung übergebener Wert wird in der Antwortnachricht wiederholt.</span><span class="sxs-lookup"><span data-stu-id="8a891-294">A value passed in the received message is echoed in the reply message.</span></span>  <span data-ttu-id="8a891-295">Eine Sequenz, die der Antwort folgt, enthält den Rest des Workflows.</span><span class="sxs-lookup"><span data-stu-id="8a891-295">A sequence following the reply contains the rest of the workflow.</span></span>  <span data-ttu-id="8a891-296">Im oben erwähnten Fall wird nur eine Kommentaraktivität angezeigt.</span><span class="sxs-lookup"><span data-stu-id="8a891-296">In the above case, only one comment activity is shown.</span></span>  <span data-ttu-id="8a891-297">Die Anzahl der Kommentaraktivitäten wird geändert, um Workflowkomplexität zu simulieren.</span><span class="sxs-lookup"><span data-stu-id="8a891-297">The number of comment activities is changed to simulate workflow complexity.</span></span>  <span data-ttu-id="8a891-298">Eine Kommentaraktivität entspricht einer WF3-<xref:System.Workflow.Activities.CodeActivity>, die keine Arbeit erledigt.</span><span class="sxs-lookup"><span data-stu-id="8a891-298">A comment activity is equivalent to a WF3 <xref:System.Workflow.Activities.CodeActivity> that performs no work.</span></span> <span data-ttu-id="8a891-299">Weitere Informationen zur Kommentar Aktivität finden Sie im Abschnitt "Leistungsvergleiche auf Komponentenebene" weiter oben in diesem Artikel.</span><span class="sxs-lookup"><span data-stu-id="8a891-299">For more information about the comment activity, see the "Component-level Performance Comparison" section earlier in this article.</span></span>

##### <a name="test-results"></a><span data-ttu-id="8a891-300">Testergebnisse</span><span class="sxs-lookup"><span data-stu-id="8a891-300">Test Results</span></span>

 <span data-ttu-id="8a891-301">Kalte und warme Latenz für WCF-Workflow Dienste:</span><span class="sxs-lookup"><span data-stu-id="8a891-301">Cold and warm latency for WCF workflow services:</span></span>

 ![Säulendiagramm mit kalter und warmer Latenz für WCF-Workflow Dienste mit WF3 und WF4](./media/performance/latency-results-graph.gif)

 <span data-ttu-id="8a891-303">Im vorherigen Diagramm bezieht sich "kalt" auf den Fall, dass für den angegebenen Workflow keine <xref:System.ServiceModel.WorkflowServiceHost> vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="8a891-303">In the previous chart, cold refers to the case where there is not an existing <xref:System.ServiceModel.WorkflowServiceHost> for the given workflow.</span></span>  <span data-ttu-id="8a891-304">Anders ausgedrückt bedeutet kalte Wartezeit, wenn der Workflow zum ersten Mal verwendet wird und XOML oder XAML kompiliert werden muss.</span><span class="sxs-lookup"><span data-stu-id="8a891-304">In other words, cold latency is when the workflow is being used for the first time and the XOML or XAML needs to be compiled.</span></span>  <span data-ttu-id="8a891-305">Warme Wartezeit ist die Zeit zum Erstellen einer neuen Workflowinstanz, wenn der Workflowtyp bereits kompiliert wurde.</span><span class="sxs-lookup"><span data-stu-id="8a891-305">Warm latency is the time to create a new workflow instance when the workflow type has already been compiled.</span></span>  <span data-ttu-id="8a891-306">Die Komplexität des Workflows macht im Fall von WF4 nur einen geringen Unterschied, weist allerdings in WF3 linearen Fortschritt auf.</span><span class="sxs-lookup"><span data-stu-id="8a891-306">The complexity of the workflow makes very little difference in the WF4 case but has a linear progression in the WF3 case.</span></span>

#### <a name="correlation-throughput"></a><span data-ttu-id="8a891-307">Korrelationsdurchsatz</span><span class="sxs-lookup"><span data-stu-id="8a891-307">Correlation Throughput</span></span>
 <span data-ttu-id="8a891-308">WF4 führt eine neue inhaltsbasierte Korrelationsfunktion ein.</span><span class="sxs-lookup"><span data-stu-id="8a891-308">WF4 introduces a new content-based correlation feature.</span></span>  <span data-ttu-id="8a891-309">WF3 bot nur kontextbasierte Korrelation.</span><span class="sxs-lookup"><span data-stu-id="8a891-309">WF3 provided only context-based correlation.</span></span>  <span data-ttu-id="8a891-310">Die kontextbasierte Korrelation konnte nur über bestimmte WCF-Kanal Bindungen durchgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="8a891-310">Context-based correlation could only be done over specific WCF channel bindings.</span></span>  <span data-ttu-id="8a891-311">Beim Verwenden dieser Bindungen wird die Workflow-ID in den Nachrichtenheader eingefügt.</span><span class="sxs-lookup"><span data-stu-id="8a891-311">The workflow Id is inserted into the message header when using these bindings.</span></span>  <span data-ttu-id="8a891-312">Die WF3-Laufzeit konnte einen Workflow nur anhand seiner ID identifizieren.  Mit Inhalts basierter Korrelation kann der Workflow Autor aus einem relevanten Datenelement wie einer Kontonummer oder einer Kunden-ID einen Korrelations Schlüssel erstellen.</span><span class="sxs-lookup"><span data-stu-id="8a891-312">The WF3 runtime could only identify a workflow by its Id.  With content-based correlation, the workflow author can create a correlation key out of a relevant piece of data like an account number or customer Id.</span></span>

 <span data-ttu-id="8a891-313">Kontextbasierte Korrelation weist einen Leistungsvorteil auf, da sich der Korrelationsschlüssel im Nachrichtenheader befindet.</span><span class="sxs-lookup"><span data-stu-id="8a891-313">Context-based correlation has a performance advantage in that the correlation key is located in the message header.</span></span>  <span data-ttu-id="8a891-314">Der Schlüssel kann ohne Deserialisierung/Kopieren der Meldung von der Meldung gelesen werden.</span><span class="sxs-lookup"><span data-stu-id="8a891-314">The key can be read from the message without de-serialization/message-copying.</span></span>  <span data-ttu-id="8a891-315">Bei der inhaltsbasierten Korrelation wird der Korrelationsschlüssel im Nachrichtentext gespeichert.</span><span class="sxs-lookup"><span data-stu-id="8a891-315">In content-based correlation, the correlation key is stored in the message body.</span></span>  <span data-ttu-id="8a891-316">Ein XPath-Ausdruck wird verwendet, um den Schlüssel zu suchen.</span><span class="sxs-lookup"><span data-stu-id="8a891-316">An XPath expression is used to locate the key.</span></span>  <span data-ttu-id="8a891-317">Die Kosten für diese zusätzliche Verarbeitung hängen von der Größe der Meldung, Tiefe des Schlüssels im Text und der Anzahl der Schlüssel ab.</span><span class="sxs-lookup"><span data-stu-id="8a891-317">The cost of this extra processing depends on the size of the message, depth of the key in the body, and the number of keys.</span></span>  <span data-ttu-id="8a891-318">Dieser Test vergleicht die kontext - und inhaltsbasierte Korrelation und zeigt zudem den Leistungsabfall beim Verwenden mehrerer Schlüssel.</span><span class="sxs-lookup"><span data-stu-id="8a891-318">This test compares context- and content-based correlation and also shows the performance degradation when using multiple keys.</span></span>

#### <a name="environment-setup"></a><span data-ttu-id="8a891-319">Umgebungssetup</span><span class="sxs-lookup"><span data-stu-id="8a891-319">Environment Setup</span></span>
![Umgebungs Einrichtung für Workflow Leistungstest](./media/performance/performance-test-environment.gif)

#### <a name="test-setup"></a><span data-ttu-id="8a891-321">Testsetup</span><span class="sxs-lookup"><span data-stu-id="8a891-321">Test Setup</span></span>
<span data-ttu-id="8a891-322">![Workflow Test für Korrelations Durchsatz](./media/performance/correlation-throughput-workflow.gif "Workflow Test-Setup für Korrelations Durchsatz")</span><span class="sxs-lookup"><span data-stu-id="8a891-322">![Correlation Throughput Workflow Test](./media/performance/correlation-throughput-workflow.gif "Correlation throughput workflow test setup")</span></span>

 <span data-ttu-id="8a891-323">Der vorherige Workflow ist derselbe Workflow, der im [persistenzabschnitt](#persistence) verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="8a891-323">The previous workflow is the same one used in the [Persistence](#persistence) section.</span></span> <span data-ttu-id="8a891-324">Bei Korrelationstests ohne Persistenz ist kein Persistenzanbieter in der Laufzeit installiert.</span><span class="sxs-lookup"><span data-stu-id="8a891-324">For the correlation tests without persistence, there is no persistence provider installed in the runtime.</span></span> <span data-ttu-id="8a891-325">Korrelation tritt an zwei Stellen auf: CreateOrder und CompleteOrder.</span><span class="sxs-lookup"><span data-stu-id="8a891-325">Correlation occurs in two places: CreateOrder and CompleteOrder.</span></span>

#### <a name="test-results"></a><span data-ttu-id="8a891-326">Testergebnisse</span><span class="sxs-lookup"><span data-stu-id="8a891-326">Test Results</span></span>
<span data-ttu-id="8a891-327">![Korrelations Durchsatz](./media/performance/correlation-throughput-graph.gif "Korrelations Durchsatz Diagramm")</span><span class="sxs-lookup"><span data-stu-id="8a891-327">![Correlation Throughput](./media/performance/correlation-throughput-graph.gif "Correlation throughput graph")</span></span>

 <span data-ttu-id="8a891-328">Dieses Diagramm zeigt eine Leistungsabnahme als Anzahl der in inhaltsbasierten Korrelationszunahmen verwendeten Schlüssel an.</span><span class="sxs-lookup"><span data-stu-id="8a891-328">This graph shows a decrease in performance as the number of keys used in content-based correlation increases.</span></span>  <span data-ttu-id="8a891-329">Die Ähnlichkeit der Kurven zwischen TCP und HTTP gibt den Aufwand an, der diesen Protokollen zugeordnet wurde.</span><span class="sxs-lookup"><span data-stu-id="8a891-329">The similarity in the curves between TCP and HTTP indicates the overhead associated with these protocols.</span></span>

#### <a name="correlation-with-persistence"></a><span data-ttu-id="8a891-330">Korrelation mit Persistenz</span><span class="sxs-lookup"><span data-stu-id="8a891-330">Correlation with Persistence</span></span>
 <span data-ttu-id="8a891-331">Bei einem persistenten Workflow wird der CPU-Druck von der inhaltsbasierten Korrelation von der Workflowlaufzeit auf die SQL-Datenbank umgestellt.</span><span class="sxs-lookup"><span data-stu-id="8a891-331">With a persisted workflow, the CPU pressure from content-based correlation shifts from the workflow runtime to the SQL database.</span></span>  <span data-ttu-id="8a891-332">Die gespeicherten Prozeduren im SQL-Persistenzanbieter passen die Schlüssel an, um den entsprechenden Workflow zu finden.</span><span class="sxs-lookup"><span data-stu-id="8a891-332">The stored procedures in the SQL persistence provider do the work of matching the keys to locate the appropriate workflow.</span></span>

 ![Liniendiagramm mit Korrelations-und persistenzergebnissen](./media/performance/correlation-persistence-graph.gif)

 <span data-ttu-id="8a891-334">Die kontextbasierte Korrelation ist immer noch schneller als die inhaltsbasierte Korrelation.</span><span class="sxs-lookup"><span data-stu-id="8a891-334">Context-based correlation is still faster than content-based correlation.</span></span>  <span data-ttu-id="8a891-335">Der Unterschied ist jedoch weniger deutlich, da die Persistenz mehr Auswirkungen auf die Leistung als die Korrelation hat.</span><span class="sxs-lookup"><span data-stu-id="8a891-335">However, the difference is less pronounced as persistence has more impact on performance than correlation.</span></span>

### <a name="complex-workflow-throughput"></a><span data-ttu-id="8a891-336">Komplexer Workflowdurchsatz</span><span class="sxs-lookup"><span data-stu-id="8a891-336">Complex Workflow Throughput</span></span>
 <span data-ttu-id="8a891-337">Die Komplexität eines Workflows wird nicht nur an der Anzahl der Aktivitäten gemessen.</span><span class="sxs-lookup"><span data-stu-id="8a891-337">The complexity of a workflow is not measured only by the number of activities.</span></span>  <span data-ttu-id="8a891-338">Zusammengesetzte Aktivitäten können viele untergeordnete Elemente enthalten, und bei diesen untergeordneten Elementen kann es sich auch um zusammengesetzte Aktivitäten handeln.</span><span class="sxs-lookup"><span data-stu-id="8a891-338">Composite activities can contain many children and those children can also be composite activities.</span></span>  <span data-ttu-id="8a891-339">Mit der Anzahl der Schachtelungsebenen steigt auch die Anzahl der Aktivitäten, die derzeit den Status "Wird ausgeführt" aufweisen, sowie die Anzahl der Variablen, die diesen Status besitzen können.</span><span class="sxs-lookup"><span data-stu-id="8a891-339">As the number of levels of nesting increases, so does the number of activities that can be currently in the executing state and the number of variables that can be in state.</span></span>  <span data-ttu-id="8a891-340">Dieser Test vergleicht den Durchsatz von WF3 und WF4 beim Ausführen von komplexen Workflows.</span><span class="sxs-lookup"><span data-stu-id="8a891-340">This test compares throughput between WF3 and WF4 when executing complex workflows.</span></span>

### <a name="test-setup"></a><span data-ttu-id="8a891-341">Testsetup</span><span class="sxs-lookup"><span data-stu-id="8a891-341">Test Setup</span></span>
 <span data-ttu-id="8a891-342">Diese Tests wurden auf einem Intel Xeon X5355 mit 2,66 GHz (4-Prozessoren) sowie 4 GB RAM unter Windows Server 2008 x64 durchgeführt.</span><span class="sxs-lookup"><span data-stu-id="8a891-342">These tests were executed on an Intel Xeon X5355 @ 2.66GHz 4-way computer with 4GB RAM running Windows Server 2008 x64.</span></span>  <span data-ttu-id="8a891-343">Der Testcode wird in einem einzelnen Prozess mit einem Thread pro Kern ausgeführt, um 100% CPU-Auslastung zu erreichen.</span><span class="sxs-lookup"><span data-stu-id="8a891-343">The test code runs in a single process with one thread per core to reach 100% CPU utilization.</span></span>

 <span data-ttu-id="8a891-344">Die für diesen Test generierten Workflows verfügen über zwei Hauptvariablen: Tiefe und Anzahl der Aktivitäten in jeder Sequenz.</span><span class="sxs-lookup"><span data-stu-id="8a891-344">The workflows generated for this test have two main variables: depth and number of activities in each sequence.</span></span>  <span data-ttu-id="8a891-345">Jede Tiefenebene enthält eine parallele Aktivität, while-Schleife, Entscheidungen, Zuweisungen und Sequenzen.</span><span class="sxs-lookup"><span data-stu-id="8a891-345">Each depth level includes a parallel activity, while loop, decisions, assignments, and sequences.</span></span>  <span data-ttu-id="8a891-346">Der unten abgebildeten WF4-Designer zeigt das Flussdiagramm der obersten Ebene.</span><span class="sxs-lookup"><span data-stu-id="8a891-346">In the WF4 designer pictured below, the top-level flow chart is pictured.</span></span>  <span data-ttu-id="8a891-347">Jede Flussdiagrammaktivität ähnelt dem Hauptflussdiagramm.</span><span class="sxs-lookup"><span data-stu-id="8a891-347">Each flowchart activity resembles the main flowchart.</span></span>  <span data-ttu-id="8a891-348">Bei der Abbildung dieses Workflows, in dem die Tiefe auf die Parameter des Tests beschränkt ist, hilft es möglicherweise, an ein Fraktal zu denken.</span><span class="sxs-lookup"><span data-stu-id="8a891-348">It may be helpful to think of a fractal when picturing this workflow, where the depth is limited to the parameters of the test.</span></span>

 <span data-ttu-id="8a891-349">Die Anzahl der Aktivitäten in einem bestimmten Test wird anhand der Tiefe und der Anzahl der Aktivitäten pro Sequenz bestimmt.</span><span class="sxs-lookup"><span data-stu-id="8a891-349">The number of activities in a given test is determined by the depth and number of activities per sequence.</span></span>  <span data-ttu-id="8a891-350">Die folgende Formel berechnet die Anzahl der Aktivitäten im WF4-Test:</span><span class="sxs-lookup"><span data-stu-id="8a891-350">The following equation computes the number of activities in the WF4 test:</span></span>

 ![Formel zur Berechnung der Anzahl der Aktivitäten](./media/performance/number-activities-equation.gif)

 <span data-ttu-id="8a891-352">Die Anzahl der Aktivitäten im WF3-Test kann aufgrund einer zusätzlichen Sequenz mit einer etwas anderen Formel berechnet werden:</span><span class="sxs-lookup"><span data-stu-id="8a891-352">The WF3 test’s activity count can be computed with a slightly different equation due to an extra sequence:</span></span>

 ![Gleichung zur Berechnung der Anzahl von WF3-Aktivitäten](./media/performance/wf3-number-activities-equation.gif)

 <span data-ttu-id="8a891-354">d entspricht der Tiefe, a der Anzahl der Aktivitäten pro Sequenz.</span><span class="sxs-lookup"><span data-stu-id="8a891-354">Where d is the depth and a is the number of activities per sequence.</span></span>  <span data-ttu-id="8a891-355">Die Logik hinter diesen Formeln: Das Produkt aus der ersten Konstante und a entspricht der Anzahl der Sequenzen, die zweite Konstante entspricht der statischen Anzahl der Aktivitäten in der aktuellen Ebene.</span><span class="sxs-lookup"><span data-stu-id="8a891-355">The logic behind these equations is that the first constant, multiplied by a, is the number of sequences and the second constant is the static number of activities in the current level.</span></span>  <span data-ttu-id="8a891-356">In jedem Flussdiagramm sind drei untergeordnete Flussdiagrammaktivitäten vorhanden.</span><span class="sxs-lookup"><span data-stu-id="8a891-356">There are three flowchart child activities in each flowchart.</span></span>  <span data-ttu-id="8a891-357">Auf der untersten Ebene sind diese Flussdiagramme leer, aber auf den anderen Ebenen sind sie Kopien des Hauptflussdiagramms.</span><span class="sxs-lookup"><span data-stu-id="8a891-357">At the bottom depth level, these flowcharts are empty but at the other levels they are copies of the main flowchart.</span></span>  <span data-ttu-id="8a891-358">Die Anzahl der Aktivitäten in der Workflowdefinition der jeweiligen Testvariation ist in der folgenden Tabelle angegeben:</span><span class="sxs-lookup"><span data-stu-id="8a891-358">The number of activities in each test variation’s workflow definition is indicated in the following table:</span></span>

 ![Eine Tabelle, die die Anzahl der in jedem Test verwendeten Aktivitäten anzeigt.](./media/performance/workflow-variation-compare-table.gif)

 <span data-ttu-id="8a891-360">Die Anzahl der Aktivitäten in der Workflowdefinition nimmt scharf mit jeder Tiefenebene zu.</span><span class="sxs-lookup"><span data-stu-id="8a891-360">The number of activities in the workflow definition increases sharply with each depth level.</span></span>  <span data-ttu-id="8a891-361">In einer angegebenen Workflowinstanz wird jedoch nur ein Pfad pro Entscheidungspunkt ausgeführt, sodass nur eine kleine Teilmenge der tatsächlichen Aktivitäten ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="8a891-361">But only one path per decision point is executed in a given workflow instance, so only a small subset of the actual activities are executed.</span></span>

 ![Flussdiagramm des Workflows für den komplexen Durchsatz](./media/performance/complex-workflow-throughput-workflow.gif)

 <span data-ttu-id="8a891-363">Ein entsprechender Workflow wurde für WF3 erstellt.</span><span class="sxs-lookup"><span data-stu-id="8a891-363">An equivalent workflow was created for WF3.</span></span> <span data-ttu-id="8a891-364">Der WF3-Designer zeigt den ganzen Workflow im Entwurfsbereich anstelle der Schachtelung an. Er ist daher für eine Anzeige in diesem Thema zu groß.</span><span class="sxs-lookup"><span data-stu-id="8a891-364">The WF3 designer shows the entire workflow in the design area instead of nesting, therefore it is too big to display in this topic.</span></span> <span data-ttu-id="8a891-365">Ein Ausschnitt des Workflows wird unten dargestellt.</span><span class="sxs-lookup"><span data-stu-id="8a891-365">A snippet of the workflow is shown below.</span></span>

 ![Flussdiagramm Ausschnitt des WF3-Workflows](./media/performance/wf3-workflow-snippet.gif)

 <span data-ttu-id="8a891-367">Ein anderer Workflow, der Teil dieses Tests ist, verwendet 100 geschachtelte Sequenzen, um die Schachtelung im Extremfall zu üben.</span><span class="sxs-lookup"><span data-stu-id="8a891-367">To exercise nesting in an extreme case, another workflow that is part of this test uses 100 nested sequences.</span></span>  <span data-ttu-id="8a891-368">In der innersten Sequenz befindet sich ein einzelner `Comment` oder eine einzelne <xref:System.Workflow.Activities.CodeActivity>.</span><span class="sxs-lookup"><span data-stu-id="8a891-368">In the innermost sequence is a single `Comment` or <xref:System.Workflow.Activities.CodeActivity>.</span></span>

 ![Flussdiagramm einer in einem Netz stehenden Reihenfolge](./media/performance/nested-sequence-workflow.gif)

 <span data-ttu-id="8a891-370">Nachverfolgung und Persistenz werden nicht als Teil dieses Tests verwendet.</span><span class="sxs-lookup"><span data-stu-id="8a891-370">Tracking and persistence are not used as part of this test.</span></span>

### <a name="test-results"></a><span data-ttu-id="8a891-371">Testergebnisse</span><span class="sxs-lookup"><span data-stu-id="8a891-371">Test Results</span></span>
 ![Säulendiagramm mit Leistungsergebnissen für den Durchsatz](./media/performance/throughput-performance-results.gif)

 <span data-ttu-id="8a891-373">Sogar mit komplexen Workflows mit viel Tiefe und einer hohen Anzahl Aktivitäten sind die Leistungsergebnisse mit anderen, weiter oben in diesem Artikel angezeigten Durchsatzzahlen konsistent.</span><span class="sxs-lookup"><span data-stu-id="8a891-373">Even with complex workflows with lots of depth and a high number of activities, the performance results are consistent with other throughput numbers shown earlier in this article.</span></span>  <span data-ttu-id="8a891-374">Der Durchsatz von WF4 ist größer und muss auf einer logarithmischen Skala verglichen werden.</span><span class="sxs-lookup"><span data-stu-id="8a891-374">WF4’s throughput is orders of magnitude faster and has to be compared on a logarithmic scale.</span></span>

### <a name="memory"></a><span data-ttu-id="8a891-375">Arbeitsspeicher</span><span class="sxs-lookup"><span data-stu-id="8a891-375">Memory</span></span>
 <span data-ttu-id="8a891-376">Der Arbeitsspeicheraufwand von Windows Workflow Foundation wird in zwei Hauptbereichen gemessen: Workflowkomplexität und Anzahl von Workflowdefinitionen.</span><span class="sxs-lookup"><span data-stu-id="8a891-376">The memory overhead of Windows Workflow Foundation is measured in two key areas: workflow complexity and number of workflow definitions.</span></span>  <span data-ttu-id="8a891-377">Arbeitsspeichermessungen wurden auf einem Windows 7-64-Bit-PC vorgenommen.</span><span class="sxs-lookup"><span data-stu-id="8a891-377">Memory measurements were taken on a Windows 7 64-bit workstation.</span></span>  <span data-ttu-id="8a891-378">Es gibt viele Möglichkeiten, die Größe der Workingsetgröße zu ermitteln, wie z. b. das Überwachen von Leistungsindikatoren, der Abruf Umgebung. WorkingSet oder die Verwendung eines Tools wie VMMap, das in [VMMap](/sysinternals/downloads/vmmap)verfügbar ist</span><span class="sxs-lookup"><span data-stu-id="8a891-378">There are many ways to obtain the measurement of working set size such as monitoring performance counters, polling Environment.WorkingSet, or using a tool like VMMap available from [VMMap](/sysinternals/downloads/vmmap).</span></span> <span data-ttu-id="8a891-379">Eine Kombination von Methoden wurde verwendet, um die Ergebnisse aller Tests abzurufen und zu überprüfen.</span><span class="sxs-lookup"><span data-stu-id="8a891-379">A combination of methods was used to obtain and verify the results of each test.</span></span>

### <a name="workflow-complexity-test"></a><span data-ttu-id="8a891-380">Workflowkomplexitätstest</span><span class="sxs-lookup"><span data-stu-id="8a891-380">Workflow Complexity Test</span></span>
 <span data-ttu-id="8a891-381">Der Workflowkomplexitätstest misst den Workingsetunterschied auf Grundlage der Komplexität des Workflows.</span><span class="sxs-lookup"><span data-stu-id="8a891-381">The workflow complexity test measures the working set difference based on the complexity of the workflow.</span></span>  <span data-ttu-id="8a891-382">Zusätzlich zu den komplexen, im vorherigen Abschnitt verwendeten Workflows werden neue Variationen hinzugefügt, die zwei grundlegende Fälle abdecken: ein einzelner Aktivitätsworkflow und eine Sequenz mit 1000 Aktivitäten.</span><span class="sxs-lookup"><span data-stu-id="8a891-382">In addition to the complex workflows used in the previous section, new variations are added to cover two basic cases: a single activity workflow and a sequence with 1000 activities.</span></span>  <span data-ttu-id="8a891-383">Für diese Tests werden die Workflows initialisiert und zum Abschluss eine Minute lang in einer einzelnen seriellen Schleife ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="8a891-383">For these tests the workflows are initialized and executed to completion in a single serial loop for a period of one minute.</span></span>  <span data-ttu-id="8a891-384">Jede Testvariation wird dreimal ausgeführt, und die aufgezeichneten Daten sind der Durchschnitt dieser drei Ausführungen.</span><span class="sxs-lookup"><span data-stu-id="8a891-384">Each test variation is run three times and the data recorded is the average of those three runs.</span></span>

 <span data-ttu-id="8a891-385">Die zwei neuen grundlegenden Tests weisen Workflows auf, die wie die im Folgenden angezeigten aussehen:</span><span class="sxs-lookup"><span data-stu-id="8a891-385">The two new basic tests have workflows that look like those shown below:</span></span>

 ![Komplexer Workflow für WF3 und WF4](./media/performance/complex-workflow-wf3-wf4.gif)

 <span data-ttu-id="8a891-387">Im oben angezeigten WF3-Workflow werden leere <xref:System.Workflow.Activities.CodeActivity>-Aktivitäten verwendet.</span><span class="sxs-lookup"><span data-stu-id="8a891-387">In the WF3 workflow shown above, empty <xref:System.Workflow.Activities.CodeActivity> activities are used.</span></span>  <span data-ttu-id="8a891-388">Der WF4-Workflow oben verwendet `Comment`-Aktivitäten.</span><span class="sxs-lookup"><span data-stu-id="8a891-388">The WF4 workflow above uses `Comment` activities.</span></span>  <span data-ttu-id="8a891-389">Die `Comment`-Aktivität wurde weiter oben in diesem Artikel im Abschnitt "Leistungsvergleiche auf Komponentenebene" beschrieben.</span><span class="sxs-lookup"><span data-stu-id="8a891-389">The `Comment` activity was described in the Component-level Performance Comparisons section earlier in this article.</span></span>

 ![Säulendiagramm, das eine komplexe Workflow Speicherauslastung für WF3-und WF4-Workflows anzeigt](./media/performance/complex-memory-usage-wf3-wf4.gif)

 <span data-ttu-id="8a891-391">Einer der klaren Trends in diesem Diagramm ist, dass die Schachtelung relativ geringe Auswirkungen auf die Speicherauslastung in WF3 und WF4 hat.</span><span class="sxs-lookup"><span data-stu-id="8a891-391">One of the clear trends to notice in this graph is that nesting has relatively minimal impact on memory usage in both WF3 and WF4.</span></span>  <span data-ttu-id="8a891-392">Die bedeutendsten Arbeitsspeicherauswirkungen in einem bestimmten Workflow resultieren aus der Anzahl der Aktivitäten.</span><span class="sxs-lookup"><span data-stu-id="8a891-392">The most significant memory impact comes from the number of activities in a given workflow.</span></span>  <span data-ttu-id="8a891-393">Gegeben sind die Daten aus folgenden Variationen: Sequenz 1000, komplexe Tiefe 5 Sequenz 5 und komplexe Tiefe 7 Sequenz 1. Wenn die Anzahl der Aktivitäten 1000 überschreitet, ist es daher klar, dass die Zunahme der Speicherauslastung beträchtlicher wird.</span><span class="sxs-lookup"><span data-stu-id="8a891-393">Given the data from the sequence 1000, complex depth 5 sequence 5, and complex depth 7 sequence 1 variations, it is clear that as the number of activities enters the thousands, the memory usage increase becomes more noticeable.</span></span>  <span data-ttu-id="8a891-394">Im Extremfall (Tiefe 7 Sequenz 1) mit ~ 29.000 Aktivitäten verwendet WF4 fast 79 % weniger Arbeitsspeicher als WF3.</span><span class="sxs-lookup"><span data-stu-id="8a891-394">In the extreme case (depth 7 sequence 1) where there are ~29K activities, WF4 is using almost 79% less memory than WF3.</span></span>

### <a name="multiple-workflow-definitions-test"></a><span data-ttu-id="8a891-395">Test mehrerer Workflowdefinitionen</span><span class="sxs-lookup"><span data-stu-id="8a891-395">Multiple Workflow Definitions Test</span></span>
 <span data-ttu-id="8a891-396">Das Messen des Arbeitsspeichers pro Workflowdefinition ist wegen der verfügbaren Optionen zum Hosten von Workflows in WF3 und WF4 in zwei verschiedene Tests unterteilt.</span><span class="sxs-lookup"><span data-stu-id="8a891-396">Measuring memory per workflow definition is divided into two different tests because of the available options for hosting workflows in WF3 and WF4.</span></span>  <span data-ttu-id="8a891-397">Die Tests werden auf eine andere Weise als der Workflowkomplexitätstest ausgeführt, da ein angegebener Workflow als Beispiel angeführt und pro Definition nur einmal ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="8a891-397">The tests are run in a different manner than the workflow complexity test in that a given workflow is instanced and executed only once per definition.</span></span>  <span data-ttu-id="8a891-398">Das liegt daran, dass die Workflowdefinition und ihr Host die gesamte Lebensdauer der AppDomain lang im Arbeitsspeicher bleiben.</span><span class="sxs-lookup"><span data-stu-id="8a891-398">This is because the workflow definition and its host remain in memory for the lifetime of the AppDomain.</span></span>  <span data-ttu-id="8a891-399">Der Arbeitsspeicher, der für die Ausführung einer angegebenen Workflowinstanz verwendet wurde, sollte während der automatischen Speicherbereinigung bereinigt werden.</span><span class="sxs-lookup"><span data-stu-id="8a891-399">The memory used by running a given workflow instance should be cleaned up during garbage collection.</span></span>  <span data-ttu-id="8a891-400">Die Migrationsanleitung für WF4 enthält detaillierte Informationen zu den Hostingoptionen.</span><span class="sxs-lookup"><span data-stu-id="8a891-400">The migration guidance for WF4 contains more detailed information on the hosting options.</span></span> <span data-ttu-id="8a891-401">Weitere Informationen finden Sie unter [Cookbook zur WF-Migration: Workflow Hosting](migration-guidance.md).</span><span class="sxs-lookup"><span data-stu-id="8a891-401">For more information, see [WF Migration Cookbook: Workflow Hosting](migration-guidance.md).</span></span>

 <span data-ttu-id="8a891-402">Das Erstellen vieler Workflowdefinitionen für einen Workflowdefinitionstest kann auf mehrere Arten erfolgen.</span><span class="sxs-lookup"><span data-stu-id="8a891-402">Creating many workflow definitions for a workflow definition test can be done in several ways.</span></span>  <span data-ttu-id="8a891-403">Sie können beispielsweise die Codegenerierung verwenden, um einen Satz von 1000 Workflows zu erstellen, die mit Ausnahme des Namens identisch sind, und jeden einzelnen dieser Workflows davon in separaten Dateien speichern.</span><span class="sxs-lookup"><span data-stu-id="8a891-403">For instance, one could use code generation to create a set of 1000 workflows that are identical except in name and save each of those workflows into separate files.</span></span>  <span data-ttu-id="8a891-404">Dieser Ansatz wurde für den konsolengehosteten Test gewählt.</span><span class="sxs-lookup"><span data-stu-id="8a891-404">This approach was taken for the console-hosted test.</span></span>  <span data-ttu-id="8a891-405">In WF3 wurde die <xref:System.Workflow.Runtime.WorkflowRuntime>-Klasse verwendet, um die Workflowdefinitionen auszuführen.</span><span class="sxs-lookup"><span data-stu-id="8a891-405">In WF3, the <xref:System.Workflow.Runtime.WorkflowRuntime> class was used to run the workflow definitions.</span></span>  <span data-ttu-id="8a891-406">WF4 kann entweder <xref:System.Activities.WorkflowApplication> zum Erstellen einer einzelnen Workflowinstanz oder, ähnlich einem Methodenaufruf, <xref:System.Activities.WorkflowInvoker> zum direkten Ausführen der Aktivität verwenden.</span><span class="sxs-lookup"><span data-stu-id="8a891-406">WF4 can either use <xref:System.Activities.WorkflowApplication> to create a single workflow instance or directly use <xref:System.Activities.WorkflowInvoker> to run the activity as if it were a method call.</span></span>  <span data-ttu-id="8a891-407"><xref:System.Activities.WorkflowApplication> ist ein Host einer einzelnen Workflowinstanz, weist engere Funktionsparität zu <xref:System.Workflow.Runtime.WorkflowRuntime> auf und wurde daher in diesem Test verwendet.</span><span class="sxs-lookup"><span data-stu-id="8a891-407"><xref:System.Activities.WorkflowApplication> is a host of a single workflow instance and has closer feature parity to <xref:System.Workflow.Runtime.WorkflowRuntime> so that was used in this test.</span></span>

 <span data-ttu-id="8a891-408">Beim Hosten von Workflows in IIS kann ein <xref:System.Web.Hosting.VirtualPathProvider> zum Erstellen eines neuen <xref:System.ServiceModel.WorkflowServiceHost> verwendet werden, statt alle XAMLX- oder XOML-Dateien zu generieren.</span><span class="sxs-lookup"><span data-stu-id="8a891-408">When hosting workflows in IIS it is possible to use a <xref:System.Web.Hosting.VirtualPathProvider> to create a new <xref:System.ServiceModel.WorkflowServiceHost> instead of generating all of the XAMLX or XOML files.</span></span>  <span data-ttu-id="8a891-409">Der <xref:System.Web.Hosting.VirtualPathProvider> verarbeitet die eingehende Anforderung und antwortet mit einer "virtuellen Datei", die aus einer Datenbank geladen oder in diesem Fall dynamisch generiert werden kann.</span><span class="sxs-lookup"><span data-stu-id="8a891-409">The <xref:System.Web.Hosting.VirtualPathProvider> handles the incoming request and responds with a "virtual file" that can be loaded from a database or, in this case, generated on the fly.</span></span>  <span data-ttu-id="8a891-410">Daher ist es nicht erforderlich, 1000 physische Dateien zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="8a891-410">It is therefore unnecessary to create 1000 physical files.</span></span>

 <span data-ttu-id="8a891-411">Die im Konsolentest verwendeten Workflowdefinitionen waren einfache sequenzielle Workflows mit einer einzelnen Aktivität.</span><span class="sxs-lookup"><span data-stu-id="8a891-411">The workflow definitions used in the console test were simple sequential workflows with a single activity.</span></span>  <span data-ttu-id="8a891-412">Die einzelne Aktivität war eine leere <xref:System.Workflow.Activities.CodeActivity> für WF3 und eine `Comment`-Aktivität für WF4.</span><span class="sxs-lookup"><span data-stu-id="8a891-412">The single activity was an empty <xref:System.Workflow.Activities.CodeActivity> for the WF3 case and a `Comment` activity for the WF4 case.</span></span>  <span data-ttu-id="8a891-413">Im von IIS gehosteten Fall wurden Workflows verwendet, die mit dem Empfang einer Meldung beginnen und mit dem Senden einer Antwort enden:</span><span class="sxs-lookup"><span data-stu-id="8a891-413">The IIS-hosted case used workflows that start on receiving a message and end on sending a reply:</span></span>

<span data-ttu-id="8a891-414">Die folgende Abbildung zeigt einen WF3-Workflow mit ReceiveActivity und einen WF4-Workflow mit Anforderungs-/Antwort-Muster:</span><span class="sxs-lookup"><span data-stu-id="8a891-414">The following image shows a WF3 workflow with ReceiveActivity and a WF4 workflow with request/response pattern:</span></span>

 ![Workflowdienste in WF3 und WF4](./media/performance/workflow-receive-activity.gif)

 <span data-ttu-id="8a891-416">In der folgenden Tabelle wird das Delta des Workingsets zwischen einer einzelnen Workflow Definition und 1001 Definitionen angezeigt:</span><span class="sxs-lookup"><span data-stu-id="8a891-416">The following table shows the delta in working set between a single workflow definition and 1001 definitions:</span></span>

|<span data-ttu-id="8a891-417">Hostingoptionen</span><span class="sxs-lookup"><span data-stu-id="8a891-417">Hosting Options</span></span>|<span data-ttu-id="8a891-418">WF3-Workingset-Differenz</span><span class="sxs-lookup"><span data-stu-id="8a891-418">WF3 Working Set Delta</span></span>|<span data-ttu-id="8a891-419">WF4-Workingset-Differenz</span><span class="sxs-lookup"><span data-stu-id="8a891-419">WF4 Working Set Delta</span></span>|
|---------------------|---------------------------|---------------------------|
|<span data-ttu-id="8a891-420">Von der Konsolenanwendung gehostete Workflows</span><span class="sxs-lookup"><span data-stu-id="8a891-420">Console Application Hosted Workflows</span></span>|<span data-ttu-id="8a891-421">18 MB</span><span class="sxs-lookup"><span data-stu-id="8a891-421">18 MB</span></span>|<span data-ttu-id="8a891-422">9 MB</span><span class="sxs-lookup"><span data-stu-id="8a891-422">9 MB</span></span>|
|<span data-ttu-id="8a891-423">Von IIS gehostete Workflowdienste</span><span class="sxs-lookup"><span data-stu-id="8a891-423">IIS Hosted Workflow Services</span></span>|<span data-ttu-id="8a891-424">446 MB</span><span class="sxs-lookup"><span data-stu-id="8a891-424">446 MB</span></span>|<span data-ttu-id="8a891-425">364 MB</span><span class="sxs-lookup"><span data-stu-id="8a891-425">364 MB</span></span>|

 <span data-ttu-id="8a891-426">Das Hosten von Workflow Definitionen in IIS beansprucht aufgrund der <xref:System.ServiceModel.WorkflowServiceHost>, ausführlicher WCF-Dienst Artefakte und der dem Host zugeordneten Nachrichten Verarbeitungslogik viel mehr Arbeitsspeicher.</span><span class="sxs-lookup"><span data-stu-id="8a891-426">Hosting workflow definitions in IIS consumes much more memory due to the <xref:System.ServiceModel.WorkflowServiceHost>, detailed WCF service artifacts, and the message processing logic associated with the host.</span></span>

 <span data-ttu-id="8a891-427">Beim Konsolenhosting in WF3 wurden die Workflows in Code anstelle von XOML implementiert.</span><span class="sxs-lookup"><span data-stu-id="8a891-427">For console hosting in WF3 the workflows were implemented in code instead of XOML.</span></span>  <span data-ttu-id="8a891-428">In WF4 wird standardmäßig XAML verwendet.</span><span class="sxs-lookup"><span data-stu-id="8a891-428">In WF4 the default is to use XAML.</span></span>  <span data-ttu-id="8a891-429">Das XAML wird als eingebettete Ressource in der Assembly gespeichert und während der Laufzeit kompiliert, um die Implementierung des Workflows bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="8a891-429">The XAML is stored as an embedded resource in the assembly and compiled during runtime to provide the implementation of the workflow.</span></span>  <span data-ttu-id="8a891-430">Dieser Prozess erfordert etwas zusätzlichen Aufwand.</span><span class="sxs-lookup"><span data-stu-id="8a891-430">There is some overhead associated with this process.</span></span>  <span data-ttu-id="8a891-431">Um einen fairen Vergleich zwischen WF3 und WF4 zu erhalten, wurden anstelle von XAML codierte Workflows verwendet.</span><span class="sxs-lookup"><span data-stu-id="8a891-431">In order to make a fair comparison between WF3 and WF4, coded workflows were used instead of XAML.</span></span>  <span data-ttu-id="8a891-432">Unten wird ein Beispiel für einen der WF4-Workflows aufgeführt:</span><span class="sxs-lookup"><span data-stu-id="8a891-432">An example of one of the WF4 workflows is shown below:</span></span>

```csharp
public class Workflow1 : Activity
{
    protected override Func<Activity> Implementation
    {
        get
        {
            return new Func<Activity>(() =>
            {
                return new Sequence
                {
                    Activities = {
                        new Comment()
                    }
                };
            });
        }
        set
        {
            base.Implementation = value;
        }
    }
}
```

 <span data-ttu-id="8a891-433">Es gibt viele andere Faktoren, die sich auf den Speicherverbrauch auswirken können.</span><span class="sxs-lookup"><span data-stu-id="8a891-433">There are many other factors that can affect memory consumption.</span></span> <span data-ttu-id="8a891-434">Derselbe Rat für alle verwalteten Programme trifft auch hier zu.</span><span class="sxs-lookup"><span data-stu-id="8a891-434">The same advice for all managed programs still applies.</span></span>  <span data-ttu-id="8a891-435">In von IIS gehosteten Umgebungen bleibt das für eine Workflowdefinition erstellte <xref:System.ServiceModel.WorkflowServiceHost>-Objekt im Arbeitsspeicher, bis der Anwendungspool wiederverwendet wird.</span><span class="sxs-lookup"><span data-stu-id="8a891-435">In IIS-hosted environments, the <xref:System.ServiceModel.WorkflowServiceHost> object created for a workflow definition stays in memory until the application pool is recycled.</span></span>  <span data-ttu-id="8a891-436">Dies sollte beim Schreiben von Erweiterungen bedacht werden.</span><span class="sxs-lookup"><span data-stu-id="8a891-436">This should be kept in mind when writing extensions.</span></span>  <span data-ttu-id="8a891-437">Außerdem empfiehlt es sich, globale Variablen (Variablen, die für den gesamten Workflow gelten) zu vermeiden und den Bereich von Variablen nach Möglichkeit einzuschränken.</span><span class="sxs-lookup"><span data-stu-id="8a891-437">Also, it is best to avoid "global" variables (variables scoped to the whole workflow) and limit the scope of variables wherever possible.</span></span>

## <a name="workflow-runtime-services"></a><span data-ttu-id="8a891-438">Workflowlaufzeitdienste</span><span class="sxs-lookup"><span data-stu-id="8a891-438">Workflow Runtime Services</span></span>

### <a name="persistence"></a><span data-ttu-id="8a891-439">Persistenz</span><span class="sxs-lookup"><span data-stu-id="8a891-439">Persistence</span></span>
 <span data-ttu-id="8a891-440">WF3 und WF4 werden jeweils mit einem SQL-Persistenzanbieter bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="8a891-440">WF3 and WF4 both ship with a SQL persistence provider.</span></span>  <span data-ttu-id="8a891-441">Der WF3-SQL-Persistenzanbieter ist eine einfache Implementierung, die die Workflowinstanz serialisiert und in einem BLOB speichert.</span><span class="sxs-lookup"><span data-stu-id="8a891-441">The WF3 SQL persistence provider is a simple implementation that serializes the workflow instance and stores it in a blob.</span></span>  <span data-ttu-id="8a891-442">Daher hängt die Leistung dieses Anbieters stark von der Größe der Workflowinstanz ab.</span><span class="sxs-lookup"><span data-stu-id="8a891-442">For this reason, the performance of this provider depends heavily on the size of the workflow instance.</span></span>  <span data-ttu-id="8a891-443">In WF3 konnte die Instanzgröße aus vielen Gründen zunehmen, wie bereits weiter oben in diesem Artikel erläutert.</span><span class="sxs-lookup"><span data-stu-id="8a891-443">In WF3, the instance size could increase for many reasons, as is discussed previously in this paper.</span></span>  <span data-ttu-id="8a891-444">Viele Kunden verwenden den Standard-SQL-Persistenzanbieter nicht, da das Speichern einer serialisierten Instanz in einer Datenbank keinen Einblick in den Status des Workflows erlaubt.</span><span class="sxs-lookup"><span data-stu-id="8a891-444">Many customers choose not to use the default SQL persistence provider because storing a serialized instance in a database gives no visibility into the state of the workflow.</span></span>  <span data-ttu-id="8a891-445">Zur Suche nach einem bestimmten Workflow ohne Kenntnis der Workflow-ID müssten Sie jede beibehaltene Instanz deserialisieren und ihren Inhalt untersuchen.</span><span class="sxs-lookup"><span data-stu-id="8a891-445">In order to find a particular workflow without knowing the workflow id, one would have to deserialize each persisted instance and examine the contents.</span></span>  <span data-ttu-id="8a891-446">Viele Entwickler bevorzugen das Verfassen eigener Persistenzanbieter, um dieses Hindernis zu umgehen.</span><span class="sxs-lookup"><span data-stu-id="8a891-446">Many developers prefer to write their own persistence providers to overcome this obstacle.</span></span>

 <span data-ttu-id="8a891-447">Im WF4-SQL-Persistenzanbieter wird versucht, einige dieser Probleme zu behandeln.</span><span class="sxs-lookup"><span data-stu-id="8a891-447">The WF4 SQL persistence provider has tried to address some of these concerns.</span></span>  <span data-ttu-id="8a891-448">In den Persistenztabellen stehen bestimmte Informationen, wie z. B. die aktiven Lesezeichen und heraufstufbare Eigenschaften, zur Verfügung.</span><span class="sxs-lookup"><span data-stu-id="8a891-448">The persistence tables expose certain information such as the active bookmarks and promotable properties.</span></span>  <span data-ttu-id="8a891-449">Die Ausführung der neuen, inhaltsbasierten Korrelationsfunktion in WF4 funktionierte nicht gut mit dem WF3-SQL-Persistenzansatz, was zu einer Änderung in der Organisation der persistenten Workflowinstanz führte.</span><span class="sxs-lookup"><span data-stu-id="8a891-449">The new content-based correlation feature in WF4 would not perform well using the WF3 SQL persistence approach, which has driven some change in the organization of the persisted workflow instance.</span></span>  <span data-ttu-id="8a891-450">Dadurch wird der Auftrag des Persistenzanbieters komplexer, was zu einer zusätzlichen Belastung der Datenbank führt.</span><span class="sxs-lookup"><span data-stu-id="8a891-450">This makes the job of the persistence provider more complex and puts extra stress on the database.</span></span>

### <a name="environment-setup"></a><span data-ttu-id="8a891-451">Umgebungssetup</span><span class="sxs-lookup"><span data-stu-id="8a891-451">Environment Setup</span></span>
![Umgebungs Einrichtung für Workflow Leistungstest](./media/performance/performance-test-environment.gif)

### <a name="test-setup"></a><span data-ttu-id="8a891-453">Testsetup</span><span class="sxs-lookup"><span data-stu-id="8a891-453">Test Setup</span></span>
 <span data-ttu-id="8a891-454">Trotz verbesserten Funktionsumfangs und besserer Parallelitätsbehandlung ist der SQL-Persistenzanbieter in WF4 schneller als der Anbieter in WF3.</span><span class="sxs-lookup"><span data-stu-id="8a891-454">Even with an improved feature set and better concurrency handling, the SQL persistence provider in WF4 is faster than the provider in WF3.</span></span>  <span data-ttu-id="8a891-455">Zur Veranschaulichung werden nachfolgend zwei Workflows verglichen, die prinzipiell dieselben Vorgänge in WF3 und WF4 ausführen.</span><span class="sxs-lookup"><span data-stu-id="8a891-455">To showcase this, two workflows that perform essentially the same operations in WF3 and WF4 are compared below.</span></span>

 ![Persistenzworkflow in WF3 on left und WF4 on right](./media/performance/persist-workflow-wf3-wf4.gif)

 <span data-ttu-id="8a891-457">Die beiden Workflows wurden anhand einer empfangenen Meldung erstellt.</span><span class="sxs-lookup"><span data-stu-id="8a891-457">The two workflows are both created by a received message.</span></span>  <span data-ttu-id="8a891-458">Der Workflow wird beibehalten, nachdem eine erste Antwort gesendet wurde.</span><span class="sxs-lookup"><span data-stu-id="8a891-458">After sending an initial reply, the workflow is persisted.</span></span>  <span data-ttu-id="8a891-459">In WF3 wird eine leere <xref:System.Workflow.ComponentModel.TransactionScopeActivity> verwendet, um die Persistenz zu initiieren.</span><span class="sxs-lookup"><span data-stu-id="8a891-459">In the WF3 case, an empty <xref:System.Workflow.ComponentModel.TransactionScopeActivity> is used to initiate the persistence.</span></span>  <span data-ttu-id="8a891-460">Dasselbe kann in WF3 erreicht werden, indem eine Aktivität als "beim Schließen beibehalten" markiert wird.</span><span class="sxs-lookup"><span data-stu-id="8a891-460">The same could be achieved in WF3 by marking an activity as "persist on close."</span></span>  <span data-ttu-id="8a891-461">Eine zweite, korrelierte Meldung schließt den Workflow ab.</span><span class="sxs-lookup"><span data-stu-id="8a891-461">A second, correlated message completes the workflow.</span></span>  <span data-ttu-id="8a891-462">Die Workflows werden beibehalten, aber nicht entladen.</span><span class="sxs-lookup"><span data-stu-id="8a891-462">The workflows are persisted but not unloaded.</span></span>

### <a name="test-results"></a><span data-ttu-id="8a891-463">Testergebnisse</span><span class="sxs-lookup"><span data-stu-id="8a891-463">Test Results</span></span>
 ![Säulendiagramm mit Durchsatz Persistenz](./media/performance/throughput-persistence-graph.gif)

 <span data-ttu-id="8a891-465">Wenn der Transport zwischen Client und mittlerer Ebene über HTTP erfolgt, steigt die Persistenz in WF4 um das 2,6-Fache.</span><span class="sxs-lookup"><span data-stu-id="8a891-465">When the transport between client and middle tier is HTTP, persistence in WF4 shows an improvement of 2.6 times.</span></span>  <span data-ttu-id="8a891-466">Beim TCP-Transport wird dieser Faktor um das 3-Fache erhöht.</span><span class="sxs-lookup"><span data-stu-id="8a891-466">The TCP transport increases that factor to 3.0 times.</span></span>  <span data-ttu-id="8a891-467">In allen Fällen beträgt die CPU-Auslastung auf der mittleren Ebene mindestens 98 %.</span><span class="sxs-lookup"><span data-stu-id="8a891-467">In all cases, CPU utilization on the middle tier is 98% or higher.</span></span>  <span data-ttu-id="8a891-468">Der Grund für den höheren WF4-Durchsatz ist die schnellere Workflowlaufzeit.</span><span class="sxs-lookup"><span data-stu-id="8a891-468">The reason that WF4 throughput is greater is due to the faster workflow runtime.</span></span>  <span data-ttu-id="8a891-469">Die Größe der serialisierten Instanz ist in beiden Fällen gering und in dieser Situation nicht entscheidend.</span><span class="sxs-lookup"><span data-stu-id="8a891-469">The size of the serialized instance is low for both cases and is not a major contributing element in this situation.</span></span>

 <span data-ttu-id="8a891-470">Die Workflows in WF3 und WF4 verwenden in diesem Test eine Aktivität, um den Zeitpunkt der Persistenz explizit anzugeben.</span><span class="sxs-lookup"><span data-stu-id="8a891-470">Both the WF3 and WF4 workflows in this test use an activity to explicitly indicate when persistence should occur.</span></span>  <span data-ttu-id="8a891-471">Dies hat den Vorteil, dass der Workflow ohne Entladen beibehalten wird.</span><span class="sxs-lookup"><span data-stu-id="8a891-471">This has the benefit of persisting the workflow without unloading it.</span></span>  <span data-ttu-id="8a891-472">In WF3 ist Persistenz auch mithilfe der <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A>-Funktion möglich. Dabei wird allerdings die Workflowinstanz über den Arbeitsspeicher entladen.</span><span class="sxs-lookup"><span data-stu-id="8a891-472">In WF3, it is also possible to persist using the <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> feature, but this unloads the workflow instance from memory.</span></span>  <span data-ttu-id="8a891-473">Wenn ein Entwickler, der WF3 verwendet, Persistenz eines Workflows an bestimmten Punkten sicherstellen möchte, muss er entweder die Workflowdefinition ändern oder die Kosten für das Entladen und erneute Laden der Workflowinstanz zahlen.</span><span class="sxs-lookup"><span data-stu-id="8a891-473">If a developer using WF3 wants to make sure a workflow persists at certain points, they either have to alter the workflow definition or pay the cost for unloading and re-loading the workflow instance.</span></span>  <span data-ttu-id="8a891-474">Eine neue Funktion in WF4 ermöglicht Persistenz ohne Entladung: <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A>.</span><span class="sxs-lookup"><span data-stu-id="8a891-474">A new feature in WF4 makes it possible to persist without unloading: <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A>.</span></span>  <span data-ttu-id="8a891-475">Diese Funktion erlaubt das Beibehalten der Workflowinstanz im Leerlauf. Diese bleibt jedoch im Arbeitsspeicher, bis der <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A>-Schwellenwert übertroffen oder die Ausführung fortgesetzt wird.</span><span class="sxs-lookup"><span data-stu-id="8a891-475">This feature allows the workflow instance to be persisted on idle but stay in memory until the <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> threshold is met or execution is resumed.</span></span>

 <span data-ttu-id="8a891-476">Beachten Sie, dass der WF4-SQL-Persistenzanbieter weitere Aufgaben in der Datenbankebene ausführt.</span><span class="sxs-lookup"><span data-stu-id="8a891-476">Note that the WF4 SQL persistence provider performs more work in the database tier.</span></span>  <span data-ttu-id="8a891-477">Die SQL-Datenbank kann zu einem Engpass führen. Daher ist die Überwachung der CPU und Datenträgerverwendung in diesem Fall von Bedeutung.</span><span class="sxs-lookup"><span data-stu-id="8a891-477">The SQL database can become a bottleneck so it is important to monitor the CPU and disk usage there.</span></span>  <span data-ttu-id="8a891-478">Nehmen Sie die folgenden Leistungsindikatoren aus der SQL-Datenbank bei den Leistungstests von Workflowanwendungen auf:</span><span class="sxs-lookup"><span data-stu-id="8a891-478">Be sure to include the following performance counters from the SQL database when performance testing workflow applications:</span></span>

- <span data-ttu-id="8a891-479">PhysicalDisk\\% Datenträger-Lese Zeit</span><span class="sxs-lookup"><span data-stu-id="8a891-479">PhysicalDisk\\%Disk Read Time</span></span>

- <span data-ttu-id="8a891-480">PhysicalDisk\\% Datenträger Zeit</span><span class="sxs-lookup"><span data-stu-id="8a891-480">PhysicalDisk\\% Disk Time</span></span>

- <span data-ttu-id="8a891-481">PhysicalDisk\\% Schreibzeit (%)</span><span class="sxs-lookup"><span data-stu-id="8a891-481">PhysicalDisk\\% Disk Write Time</span></span>

- <span data-ttu-id="8a891-482">PhysicalDisk\\% Durchschnittl. Warteschlangen Länge des Datenträgers</span><span class="sxs-lookup"><span data-stu-id="8a891-482">PhysicalDisk\\% Avg. Disk Queue Length</span></span>

- <span data-ttu-id="8a891-483">Physikalischer Datenträger \ Durchschnittl. Warteschlangen Länge des Datenträgers</span><span class="sxs-lookup"><span data-stu-id="8a891-483">PhysicalDisk\Avg. Disk Read Queue Length</span></span>

- <span data-ttu-id="8a891-484">Physischer Datenträger\Durchschnittl. Warteschlangenlänge der Datenträger-Schreibvorgänge</span><span class="sxs-lookup"><span data-stu-id="8a891-484">PhysicalDisk\Avg. Disk Write Queue Length</span></span>

- <span data-ttu-id="8a891-485">Physischer Datenträger\Aktuelle Warteschlangenlänge</span><span class="sxs-lookup"><span data-stu-id="8a891-485">PhysicalDisk\Current Disk Queue Length</span></span>

- <span data-ttu-id="8a891-486">Prozessor Informationen\\Prozessorzeit (%)</span><span class="sxs-lookup"><span data-stu-id="8a891-486">Processor Information\\% Processor Time</span></span>

- <span data-ttu-id="8a891-487">SQLServer:Latches\Durchschnittliche Latchwartezeit (ms)</span><span class="sxs-lookup"><span data-stu-id="8a891-487">SQLServer:Latches\Average Latch Wait Time (ms)</span></span>

- <span data-ttu-id="8a891-488">SQLServer:Latches\Latchwartezeiten/s</span><span class="sxs-lookup"><span data-stu-id="8a891-488">SQLServer:Latches\Latch Waits/sec</span></span>

### <a name="tracking"></a><span data-ttu-id="8a891-489">Nachverfolgung</span><span class="sxs-lookup"><span data-stu-id="8a891-489">Tracking</span></span>
 <span data-ttu-id="8a891-490">Die Workflownachverfolgung kann verwendet werden, um den Status eines Workflows nachzuverfolgen.</span><span class="sxs-lookup"><span data-stu-id="8a891-490">Workflow tracking can be used to track the progress of a workflow.</span></span>  <span data-ttu-id="8a891-491">Die Informationen, die in den Nachverfolgungsereignissen enthalten sind, werden von einem Nachverfolgungsprofil bestimmt.</span><span class="sxs-lookup"><span data-stu-id="8a891-491">The information that is included in the tracking events is determined by a tracking profile.</span></span>  <span data-ttu-id="8a891-492">Mit der Komplexität des Nachverfolgungsprofils steigt der Aufwand für die Nachverfolgung.</span><span class="sxs-lookup"><span data-stu-id="8a891-492">The more complex the tracking profile, the more expensive tracking becomes.</span></span>

 <span data-ttu-id="8a891-493">WF3 wurde mit einem auf SQL-basierenden Nachverfolgungsdienst geliefert.</span><span class="sxs-lookup"><span data-stu-id="8a891-493">WF3 shipped with a SQL-based tracking service.</span></span>  <span data-ttu-id="8a891-494">Dieser Dienst funktionierte im Batchmodus und in Nicht-Batch-Modi.</span><span class="sxs-lookup"><span data-stu-id="8a891-494">This service could work in batched and non-batched modes.</span></span>  <span data-ttu-id="8a891-495">Im Nicht-Batch-Modus werden Nachverfolgungsereignisse direkt in die Datenbank geschrieben.</span><span class="sxs-lookup"><span data-stu-id="8a891-495">In non-batched mode, tracking events are written directly to the database.</span></span>  <span data-ttu-id="8a891-496">Im Batchmodus werden Nachverfolgungsereignisse im selben Batch wie der Workflowinstanzzustand gesammelt.</span><span class="sxs-lookup"><span data-stu-id="8a891-496">In batched mode, tracking events are collected into the same batch as the workflow instance state.</span></span>  <span data-ttu-id="8a891-497">Der Batchmodus weist für den größten Bereich von Workflowentwürfen die beste Leistung auf.</span><span class="sxs-lookup"><span data-stu-id="8a891-497">The batched mode has the best performance for the widest range of workflow designs.</span></span>  <span data-ttu-id="8a891-498">Die Batchverarbeitung kann jedoch negative Auswirkungen auf die Leistung haben, wenn der Workflow viele Aktivitäten ohne Persistenz ausführt und diese Aktivitäten nachverfolgt werden.</span><span class="sxs-lookup"><span data-stu-id="8a891-498">However, batching can have a negative performance impact if the workflow runs many activities without persisting and those activities are tracked.</span></span>  <span data-ttu-id="8a891-499">Dies trat am häufigsten in Schleifen auf. Dieses Szenario wird am besten vermieden, indem große Schleifen entworfen werden, die einen Persistenzpunkt enthalten.</span><span class="sxs-lookup"><span data-stu-id="8a891-499">This would commonly happen in loops and the best way to avoid this scenario is to design large loops to contain a persistence point.</span></span>  <span data-ttu-id="8a891-500">Das Einfügen eines Persistenzpunkts in eine Schleife kann negative Auswirkungen auf die Leistung haben. Daher müssen sich die jeweiligen Kosten gegeneinander aufwiegen.</span><span class="sxs-lookup"><span data-stu-id="8a891-500">Introducing a persistence point into a loop can negatively affect performance as well so it is important to measure the costs of each and come up with a balance.</span></span>

 <span data-ttu-id="8a891-501">WF4 wird nicht mit einem SQL-Nachverfolgungsdienst bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="8a891-501">WF4 is not shipped with a SQL tracking service.</span></span>  <span data-ttu-id="8a891-502">Das Aufzeichnen von Überwachungsinformationen in einer SQL-Datenbank kann besser von einem Anwendungsserver verarbeitet werden, anstatt in den .NET Framework integriert zu werden.</span><span class="sxs-lookup"><span data-stu-id="8a891-502">Recording tracking information to a SQL database can be handled better from an application server rather than built into the .NET Framework.</span></span> <span data-ttu-id="8a891-503">Daher wird die SQL-Nachverfolgung jetzt von AppFabric abgewickelt.</span><span class="sxs-lookup"><span data-stu-id="8a891-503">Therefore SQL tracking is now handled by AppFabric.</span></span>  <span data-ttu-id="8a891-504">Der Standardnachverfolgungsanbieter in WF4 basiert auf der Ereignisablaufverfolgung für Windows (ETW).</span><span class="sxs-lookup"><span data-stu-id="8a891-504">The out-of-the-box tracking provider in WF4 is based on Event Tracing for Windows (ETW).</span></span>

 <span data-ttu-id="8a891-505">ETW ist ein in Windows integriertes Ereignissystem mit niedriger Latenzzeit auf Kernelebene.</span><span class="sxs-lookup"><span data-stu-id="8a891-505">ETW is a kernel-level, low-latency event system built into Windows.</span></span>  <span data-ttu-id="8a891-506">Es verwendet ein Anbieter-/Consumermodell, das ermöglicht, dass die Strafe für die Ereignisablaufverfolgung nur übernommen wird, wenn tatsächlich ein Consumer vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="8a891-506">It uses a provider/consumer model that makes it possible to only incur the penalty for event tracing when there is actually a consumer.</span></span>  <span data-ttu-id="8a891-507">Zusätzlich zu Kernel-Ereignissen, wie z. B. Prozessor, Datenträger, Arbeitsspeicher und Netzwerkverwendung, nutzen auch viele Anwendungen ETW.</span><span class="sxs-lookup"><span data-stu-id="8a891-507">In addition to kernel events such as processor, disk, memory, and network usage, many applications leverage ETW as well.</span></span>  <span data-ttu-id="8a891-508">ETW-Ereignisse sind insofern leistungsstärker als Leistungsindikatoren, da Ereignisse an die Anwendung angepasst werden können.</span><span class="sxs-lookup"><span data-stu-id="8a891-508">ETW events are more powerful than performance counters in that events can be customized to the application.</span></span>  <span data-ttu-id="8a891-509">Ein Ereignis kann Text enthalten, wie z. B. eine Workflow-ID oder eine Informationsmeldung.</span><span class="sxs-lookup"><span data-stu-id="8a891-509">An event can contain text such as a workflow ID or an informational message.</span></span>  <span data-ttu-id="8a891-510">Zudem werden Ereignisse mit Bitmasken kategorisiert, da die Verarbeitung einer bestimmten Teilmenge von Ereignissen geringere Auswirkungen auf die Leistung als das Erfassen sämtlicher Ereignisse hat.</span><span class="sxs-lookup"><span data-stu-id="8a891-510">Also, events are categorized with bitmasks so that consuming a certain subset of events will have less performance impact than capturing all events.</span></span>

 <span data-ttu-id="8a891-511">Vorteile des Ansatzes der Verwendung von ETW zur Nachverfolgung anstelle von SQL:</span><span class="sxs-lookup"><span data-stu-id="8a891-511">Benefits to the approach of using ETW for tracking instead of SQL include:</span></span>

- <span data-ttu-id="8a891-512">Eine Auflistung von Nachverfolgungsereignissen kann in einem anderen Prozess abgetrennt werden.</span><span class="sxs-lookup"><span data-stu-id="8a891-512">Collection of tracking events can be separated to another process.</span></span>  <span data-ttu-id="8a891-513">Dies ermöglicht höhere Flexibilität beim Aufzeichnen der Ereignisse.</span><span class="sxs-lookup"><span data-stu-id="8a891-513">This gives greater flexibility in how the events are recorded.</span></span>

- <span data-ttu-id="8a891-514">Etw-nach Verfolgungs Ereignisse können problemlos mit den WCF ETW-Ereignissen oder anderen etw-Anbietern kombiniert werden, wie z. b. ein SQL Server oder ein Kernel Anbieter</span><span class="sxs-lookup"><span data-stu-id="8a891-514">ETW tracking events are easily combined with the WCF ETW events or other ETW providers such as a SQL Server or kernel provider.</span></span>

- <span data-ttu-id="8a891-515">Workflowautoren müssen keinen Workflow ändern, damit er besser mit einer bestimmten Nachverfolgungsimplementierung funktioniert, wie z. B. dem Batchmodus des WF3-SQL-Überwachungsdiensts.</span><span class="sxs-lookup"><span data-stu-id="8a891-515">Workflow authors do not need to alter a workflow to work better with a particular tracking implementation, such as the WF3 SQL tracking service’s batch mode.</span></span>

- <span data-ttu-id="8a891-516">Ein Administrator kann die Nachverfolgung aktivieren oder deaktivieren, ohne den Hostprozess wiederzuverwenden.</span><span class="sxs-lookup"><span data-stu-id="8a891-516">An administrator can turn tracking on or off without recycling the host process.</span></span>

 <span data-ttu-id="8a891-517">Die Leistungsvorteile der ETW-Nachverfolgung haben auch einen Nachteil.</span><span class="sxs-lookup"><span data-stu-id="8a891-517">The performance benefits to ETW tracking come with a drawback.</span></span>  <span data-ttu-id="8a891-518">ETW-Ereignisse können unter intensivem Ressourcendruck auf das System verloren gehen.</span><span class="sxs-lookup"><span data-stu-id="8a891-518">ETW events can be lost if the system is under intense resource pressure.</span></span>  <span data-ttu-id="8a891-519">Die Verarbeitung von Ereignissen soll die normale Programmausführung nicht blockieren. Daher wird nicht garantiert, dass alle ETW-Ereignisse an ihre Abonnenten übertragen werden.</span><span class="sxs-lookup"><span data-stu-id="8a891-519">The processing of events is not meant to block normal program execution and therefore it is not guaranteed that all ETW events will be broadcast to their subscribers.</span></span>  <span data-ttu-id="8a891-520">Daher eignet sich die ETW-Nachverfolgung hervorragend zum Systemmonitoring, ist aber nicht für das Auditing geeignet.</span><span class="sxs-lookup"><span data-stu-id="8a891-520">This makes ETW tracking great for health monitoring but not suitable for auditing.</span></span>

 <span data-ttu-id="8a891-521">WF4 verfügt über keinen SQL-Nachverfolgungsanbieter, AppFabric jedoch schon.</span><span class="sxs-lookup"><span data-stu-id="8a891-521">While WF4 does not have a SQL tracking provider, AppFabric does.</span></span>  <span data-ttu-id="8a891-522">Der SQL-Nachverfolgungsansatz von AppFabric ist, ETW-Ereignisse mit einem Windows-Dienst zu abonnieren, der die Ereignisse stapelweise verarbeitet und sie in eine SQL-Tabelle schreibt, die für schnelle Einfügungen entworfen wurde.</span><span class="sxs-lookup"><span data-stu-id="8a891-522">AppFabric’s SQL tracking approach is to subscribe to ETW events with a Windows Service that batches the events and writes them to a SQL table designed for quick inserts.</span></span>  <span data-ttu-id="8a891-523">Ein separater Auftrag entnimmt die Daten aus dieser Tabelle und ordnet sie in Berichtstabellen neu an, die auf dem AppFabric-Dashboard angezeigt werden können.</span><span class="sxs-lookup"><span data-stu-id="8a891-523">A separate job drains the data from this table and reforms it into reporting tables that can be viewed on the AppFabric dashboard.</span></span>  <span data-ttu-id="8a891-524">Dies bedeutet, dass ein Batch von Nachverfolgungsereignissen unabhängig vom Workflow behandelt wird, von dem er stammt, und daher vor dem Aufzeichnen nicht auf einen Persistenzpunkt warten muss.</span><span class="sxs-lookup"><span data-stu-id="8a891-524">This means that a batch of tracking events is handled independent of the workflow it came from and therefore does not have to wait for a persistence point before being recorded.</span></span>

 <span data-ttu-id="8a891-525">ETW-Ereignisse können mit Tools, wie z. B. logman oder xperf, aufgezeichnet werden.</span><span class="sxs-lookup"><span data-stu-id="8a891-525">ETW events can be recorded with tools such as logman or xperf.</span></span>  <span data-ttu-id="8a891-526">Die kompakte ETL-Datei kann mit einem Tool wie xperfview angezeigt oder mit tracerpt in ein besser lesbares Format, wie z. B. XML, konvertiert werden.</span><span class="sxs-lookup"><span data-stu-id="8a891-526">The compact ETL file can be viewed with a tool like xperfview or converted to a more readable format, such as XML, with tracerpt.</span></span>  <span data-ttu-id="8a891-527">In WF3 ist die einzige Option zum Abrufen von Nachverfolgungsereignissen ohne SQL-Datenbank das Erstellen eines benutzerdefinierten Überwachungsdiensts.</span><span class="sxs-lookup"><span data-stu-id="8a891-527">In WF3, the only option for getting tracking events without a SQL database is to create a custom tracking service.</span></span> <span data-ttu-id="8a891-528">Weitere Informationen zu etw finden Sie unter [WCF-Dienste und Ereignis Ablauf Verfolgung für Windows](../wcf/samples/wcf-services-and-event-tracing-for-windows.md) und [Ereignis Ablauf Verfolgung-Windows-Anwendungen](/windows/desktop/etw/event-tracing-portal).</span><span class="sxs-lookup"><span data-stu-id="8a891-528">For more information about ETW, see [WCF Services and Event Tracing for Windows](../wcf/samples/wcf-services-and-event-tracing-for-windows.md) and [Event Tracing - Windows applications](/windows/desktop/etw/event-tracing-portal).</span></span>

 <span data-ttu-id="8a891-529">Die Aktivierung der Workflownachverfolgung wirkt sich unterschiedlich auf die Leistung aus.</span><span class="sxs-lookup"><span data-stu-id="8a891-529">Enabling workflow tracking will impact performance in varying degrees.</span></span>  <span data-ttu-id="8a891-530">Der folgende Vergleichstest verwendet das logman-Tool, um die ETW-Nachverfolgungsereignisse zu verarbeiten und sie in einer ETL-Datei aufzuzeichnen.</span><span class="sxs-lookup"><span data-stu-id="8a891-530">The benchmark below uses the logman tool to consume the ETW tracking events and record them to an ETL file.</span></span>  <span data-ttu-id="8a891-531">Die Kosten für die SQL-Nachverfolgung in AppFabric liegen außerhalb des Rahmens dieses Artikels.</span><span class="sxs-lookup"><span data-stu-id="8a891-531">The cost of the SQL tracking in AppFabric is not in the scope of this article.</span></span>  <span data-ttu-id="8a891-532">Das grundlegende Nachverfolgungsprofil, das auch in AppFabric verwendet wurde, wird in diesem Vergleichstest angezeigt.</span><span class="sxs-lookup"><span data-stu-id="8a891-532">The basic tracking profile, also used in AppFabric, is shown in this benchmark.</span></span>  <span data-ttu-id="8a891-533">Ebenfalls enthalten sind die Kosten für die Nachverfolgung von Systemüberwachungsereignissen.</span><span class="sxs-lookup"><span data-stu-id="8a891-533">Also included is the cost of tracking only health monitoring events.</span></span>  <span data-ttu-id="8a891-534">Diese Ereignisse sind für das Beheben von Problemen und Bestimmen des durchschnittlichen Durchsatzes des Systems hilfreich.</span><span class="sxs-lookup"><span data-stu-id="8a891-534">These events are useful for troubleshooting problems and determining the average throughput of the system.</span></span>

### <a name="environment-setup"></a><span data-ttu-id="8a891-535">Umgebungssetup</span><span class="sxs-lookup"><span data-stu-id="8a891-535">Environment Setup</span></span>
 ![Umgebungs Einrichtung für Workflow Leistungstest](./media/performance/performance-test-environment.gif)

### <a name="test-results"></a><span data-ttu-id="8a891-537">Testergebnisse</span><span class="sxs-lookup"><span data-stu-id="8a891-537">Test Results</span></span>

 ![Säulendiagramm mit den Kosten für die Workflow Nachverfolgung](./media/performance/workflow-tracking-costs.gif)

 <span data-ttu-id="8a891-539">Die Systemüberwachung wirkt sich in etwa zu 3 % auf den Durchsatz aus.</span><span class="sxs-lookup"><span data-stu-id="8a891-539">Health monitoring has roughly a 3% impact on throughput.</span></span>  <span data-ttu-id="8a891-540">Die Kosten des grundlegenden Profils liegen bei etwa 8 %.</span><span class="sxs-lookup"><span data-stu-id="8a891-540">The basic profile’s cost is around 8%.</span></span>

## <a name="interop"></a><span data-ttu-id="8a891-541">Interop</span><span class="sxs-lookup"><span data-stu-id="8a891-541">Interop</span></span>
 <span data-ttu-id="8a891-542">WF4 ist eine fast vollständig neue Version von [!INCLUDE[wf1](../../../includes/wf1-md.md)]. Daher sind WF3-Workflows und Aktivitäten nicht direkt mit WF4 kompatibel.</span><span class="sxs-lookup"><span data-stu-id="8a891-542">WF4 is almost a complete rewrite of [!INCLUDE[wf1](../../../includes/wf1-md.md)] and therefore WF3 workflows and activities are not directly compatible with WF4.</span></span>  <span data-ttu-id="8a891-543">Viele Kunden, die Windows Workflow Foundation früh übernommen haben, verfügen über interne Workflow Definitionen oder Workflow Definitionen von Drittanbietern und benutzerdefinierte Aktivitäten für WF3.</span><span class="sxs-lookup"><span data-stu-id="8a891-543">Many customers that adopted Windows Workflow Foundation early will have in-house or third-party workflow definitions and custom activities for WF3.</span></span>  <span data-ttu-id="8a891-544">Eine Möglichkeit, den Übergang zu WF4 zu vereinfachen, ist die Verwendung der Interop-Aktivität, mit der WF3-Aktivitäten in WF4-Workflows ausgeführt werden können.</span><span class="sxs-lookup"><span data-stu-id="8a891-544">One way to ease the transition to WF4 is to use the Interop activity, which can execute WF3 activities from within a WF4 workflow.</span></span>  <span data-ttu-id="8a891-545">Es wird empfohlen, die <xref:System.Activities.Statements.Interop>-Aktivität nur bei Bedarf zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="8a891-545">It is recommended that the <xref:System.Activities.Statements.Interop> activity only be used when necessary.</span></span> <span data-ttu-id="8a891-546">Weitere Informationen zum Migrieren zu WF4 finden Sie in der [WF4-Migrations Anleitung](migration-guidance.md).</span><span class="sxs-lookup"><span data-stu-id="8a891-546">For more information about migrating to WF4 check out the [WF4 Migration Guidance](migration-guidance.md).</span></span>

### <a name="environment-setup"></a><span data-ttu-id="8a891-547">Umgebungssetup</span><span class="sxs-lookup"><span data-stu-id="8a891-547">Environment Setup</span></span>
 ![Umgebungs Einrichtung für Workflow Leistungstest](./media/performance/performance-test-environment.gif)

### <a name="test-results"></a><span data-ttu-id="8a891-549">Testergebnisse</span><span class="sxs-lookup"><span data-stu-id="8a891-549">Test Results</span></span>
 
<span data-ttu-id="8a891-550">Die folgende Tabelle zeigt die Ergebnisse der Ausführung eines Workflows, der fünf Aktivitäten in einer Sequenz in verschiedenen Konfigurationen enthält.</span><span class="sxs-lookup"><span data-stu-id="8a891-550">The following table shows the results of running a workflow containing five activities in a sequence in various configurations.</span></span>

|<span data-ttu-id="8a891-551">Testen</span><span class="sxs-lookup"><span data-stu-id="8a891-551">Test</span></span>|<span data-ttu-id="8a891-552">Durchsatz (Workflows/Sek)</span><span class="sxs-lookup"><span data-stu-id="8a891-552">Throughput (workflows/sec)</span></span>|
|----------|-----------------------------------|
|<span data-ttu-id="8a891-553">WF3-Sequenz in WF3-Laufzeit</span><span class="sxs-lookup"><span data-stu-id="8a891-553">WF3 Sequence in WF3 runtime</span></span>|<span data-ttu-id="8a891-554">1,576</span><span class="sxs-lookup"><span data-stu-id="8a891-554">1,576</span></span>|
|<span data-ttu-id="8a891-555">WF3-Sequenz in WF4-Laufzeit mit Interop</span><span class="sxs-lookup"><span data-stu-id="8a891-555">WF3 Sequence in WF4 runtime using Interop</span></span>|<span data-ttu-id="8a891-556">2,745</span><span class="sxs-lookup"><span data-stu-id="8a891-556">2,745</span></span>|
|<span data-ttu-id="8a891-557">WF4-Sequenz</span><span class="sxs-lookup"><span data-stu-id="8a891-557">WF4 Sequence</span></span>|<span data-ttu-id="8a891-558">153,582</span><span class="sxs-lookup"><span data-stu-id="8a891-558">153,582</span></span>|

 <span data-ttu-id="8a891-559">Bei der Verwendung von Interop ist eine enorme Leistungszunahme im Vergleich zur alleinigen Verwendung von WF3 zu verzeichnen.</span><span class="sxs-lookup"><span data-stu-id="8a891-559">There is a notable performance increase to using Interop over straight WF3.</span></span>  <span data-ttu-id="8a891-560">Beim Vergleich mit WF4-Aktivitäten ist die Zunahme jedoch vernachlässigbar.</span><span class="sxs-lookup"><span data-stu-id="8a891-560">However, when compared against WF4 activities, the increase is negligible.</span></span>

## <a name="summary"></a><span data-ttu-id="8a891-561">Summary</span><span class="sxs-lookup"><span data-stu-id="8a891-561">Summary</span></span>
 <span data-ttu-id="8a891-562">Hohe Investitionen in die Leistung von WF4 haben sich in vielen entscheidenden Bereichen ausgezahlt.</span><span class="sxs-lookup"><span data-stu-id="8a891-562">Heavy investments in performance for WF4 have paid off in many crucial areas.</span></span>  <span data-ttu-id="8a891-563">Die Leistung einzelner Workflowkomponenten ist in einigen Fällen aufgrund einer schlankeren [!INCLUDE[wf1](../../../includes/wf1-md.md)]-Laufzeit in WF4 Hunderte Male besser als in WF3.</span><span class="sxs-lookup"><span data-stu-id="8a891-563">Individual workflow component performance is in some cases hundreds of times faster in WF4 compared to WF3 due to a leaner [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime.</span></span>  <span data-ttu-id="8a891-564">Die Latenzzeiten sind ebenfalls bedeutend besser.</span><span class="sxs-lookup"><span data-stu-id="8a891-564">Latency numbers are significantly better as well.</span></span>  <span data-ttu-id="8a891-565">Dies bedeutet, dass die Leistungseinbußen bei der Verwendung von [!INCLUDE[wf1](../../../includes/wf1-md.md)] im Gegensatz zum Hand Codieren der WCF-Orchestrierungs Dienste sehr klein sind und die zusätzlichen Vorteile der Verwendung von [!INCLUDE[wf1](../../../includes/wf1-md.md)]berücksichtigen.</span><span class="sxs-lookup"><span data-stu-id="8a891-565">This means the performance penalty for using [!INCLUDE[wf1](../../../includes/wf1-md.md)] as opposed to hand-coding WCF orchestration services is very small considering the added benefits of using [!INCLUDE[wf1](../../../includes/wf1-md.md)].</span></span>  <span data-ttu-id="8a891-566">Die Persistenzleistung wurde um den Faktor 2,5 bis 3,0 gesteigert.</span><span class="sxs-lookup"><span data-stu-id="8a891-566">Persistence performance has increased by a factor of 2.5 - 3.0.</span></span>  <span data-ttu-id="8a891-567">Die Systemüberwachung mittels der Workflownachverfolgung erfordert nun äußerst wenig Aufwand.</span><span class="sxs-lookup"><span data-stu-id="8a891-567">Health monitoring by means of workflow tracking now has very little overhead.</span></span>  <span data-ttu-id="8a891-568">Ein umfassender Satz Migrationshandbücher ist für Benutzer verfügbar, die einen Wechsel von WF3 zu WF4 erwägen.</span><span class="sxs-lookup"><span data-stu-id="8a891-568">A comprehensive set of migration guides are available for those that are considering moving from WF3 to WF4.</span></span>  <span data-ttu-id="8a891-569">All diese Vorteile machen WF4 zu einer attraktiven Option für das Erstellen komplexer Anwendungen.</span><span class="sxs-lookup"><span data-stu-id="8a891-569">All of this should make WF4 an attractive option for writing complex applications.</span></span>
