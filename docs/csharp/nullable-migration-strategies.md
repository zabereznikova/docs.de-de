---
title: Aktualisieren der Codebasis zur Verwendung von Nullable-Verweistypen
description: Wählen Sie die beste Strategie für ein Upgrade der Codebasis zur Verwendung von Nullable-Verweistypen.
ms.technology: csharp-null-safety
ms.date: 07/31/2019
ms.openlocfilehash: ab0970247c7e3f3c20d7fdb40ef035c4ba1d8b01
ms.sourcegitcommit: 30e9e11dfd90112b8eec6406186ba3533f21eba1
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 11/21/2020
ms.locfileid: "97866821"
---
# <a name="update-libraries-to-use-nullable-reference-types-and-communicate-nullable-rules-to-callers"></a><span data-ttu-id="74014-103">Aktualisieren von Bibliotheken zur Verwendung von Nullable-Verweistypen sowie zur Übermittlung von Regeln zum Zulassen von Nullwerten an Aufrufer</span><span class="sxs-lookup"><span data-stu-id="74014-103">Update libraries to use nullable reference types and communicate nullable rules to callers</span></span>

<span data-ttu-id="74014-104">Die zusätzliche Verwendung von [Nullable-Verweistypen](nullable-references.md) bedeutet, dass Sie für jede Variable deklarieren können, ob ein `null`-Wert zulässig ist bzw. erwartet wird oder nicht.</span><span class="sxs-lookup"><span data-stu-id="74014-104">The addition of [nullable reference types](nullable-references.md) means you can declare whether or not a `null` value is allowed or expected for every variable.</span></span> <span data-ttu-id="74014-105">Darüber hinaus können Sie eine Reihe von Attributen anwenden (`AllowNull`, `DisallowNull`, `MaybeNull`, `NotNull`, `NotNullWhen`, `MaybeNullWhen` und `NotNullIfNotNull`), um die NULL-Status von Argument- und Rückgabewerten umfassend zu beschreiben.</span><span class="sxs-lookup"><span data-stu-id="74014-105">In addition, you can apply a number of attributes: `AllowNull`, `DisallowNull`, `MaybeNull`, `NotNull`, `NotNullWhen`, `MaybeNullWhen`, and `NotNullIfNotNull` to completely describe the null states of argument and return values.</span></span> <span data-ttu-id="74014-106">Dies ist beim Schreiben von Code ideal.</span><span class="sxs-lookup"><span data-stu-id="74014-106">That provides a great experience as you write code.</span></span> <span data-ttu-id="74014-107">Sie erhalten Warnungen, wenn eine Non-Nullable-Variable auf `null` festgelegt werden kann.</span><span class="sxs-lookup"><span data-stu-id="74014-107">You get warnings if a non-nullable variable might be set to `null`.</span></span> <span data-ttu-id="74014-108">Sie erhalten Warnungen, wenn eine Nullable-Variable vor dem Dereferenzieren nicht auf NULL überprüft wurde.</span><span class="sxs-lookup"><span data-stu-id="74014-108">You get warnings if a nullable variable isn't null-checked before you dereference it.</span></span> <span data-ttu-id="74014-109">Die Aktualisierung Ihrer Bibliotheken kann einige Zeit in Anspruch nehmen, aber es lohnt sich.</span><span class="sxs-lookup"><span data-stu-id="74014-109">Updating your libraries can take time, but the payoffs are worth it.</span></span> <span data-ttu-id="74014-110">Je mehr Informationen Sie dem Compiler darüber bereitstellen, *wann* ein `null`-Wert zulässig oder unzulässig ist, umso besser werden die Warnungen für die Benutzer Ihrer API.</span><span class="sxs-lookup"><span data-stu-id="74014-110">The more information you provide to the compiler about *when* a `null` value is allowed or prohibited, the better warnings users of your API will get.</span></span> <span data-ttu-id="74014-111">Beginnen wir mit einem bekannten Beispiel.</span><span class="sxs-lookup"><span data-stu-id="74014-111">Let's start with a familiar example.</span></span> <span data-ttu-id="74014-112">Angenommen, Ihre Bibliothek verfügt über die folgende API zum Abrufen einer Ressourcenzeichenfolge:</span><span class="sxs-lookup"><span data-stu-id="74014-112">Imagine your library has the following API to retrieve a resource string:</span></span>

```csharp
bool TryGetMessage(string key, out string message)
```

<span data-ttu-id="74014-113">Das vorstehende Beispiel folgt dem bekannten `Try*`-Muster in .NET.</span><span class="sxs-lookup"><span data-stu-id="74014-113">The preceding example follows the familiar `Try*` pattern in .NET.</span></span> <span data-ttu-id="74014-114">Es sind zwei Verweisargumente für diese API vorhanden: die Parameter `key` und `message`.</span><span class="sxs-lookup"><span data-stu-id="74014-114">There are two reference arguments for this API: the `key` and the `message` parameter.</span></span> <span data-ttu-id="74014-115">Diese API umfasst die folgenden Regeln in Bezug auf die NULL-Zulässigkeit dieser Argumente:</span><span class="sxs-lookup"><span data-stu-id="74014-115">This API has the following rules relating to the nullness of these arguments:</span></span>

- <span data-ttu-id="74014-116">Aufrufer dürfen nicht `null` als Argument für `key` übergeben.</span><span class="sxs-lookup"><span data-stu-id="74014-116">Callers shouldn't pass `null` as the argument for `key`.</span></span>
- <span data-ttu-id="74014-117">Aufrufer können eine Variable übergeben, deren Wert `null` als Argument für `message` lautet.</span><span class="sxs-lookup"><span data-stu-id="74014-117">Callers can pass a variable whose value is `null` as the argument for `message`.</span></span>
- <span data-ttu-id="74014-118">Wenn die Methode `TryGetMessage` den Wert `true` zurückgibt, ist der Wert von `message` ungleich NULL.</span><span class="sxs-lookup"><span data-stu-id="74014-118">If the `TryGetMessage` method returns `true`, the value of `message` isn't null.</span></span> <span data-ttu-id="74014-119">Wenn der Rückgabewert `false,` lautet, ist der Wert von `message` (und der zugehörige NULL-Zustand) NULL.</span><span class="sxs-lookup"><span data-stu-id="74014-119">If the return value is `false,` the value of `message` (and its null state) is null.</span></span>

<span data-ttu-id="74014-120">Die Regel für `key` kann durch den Variablentyp umfassend ausgedrückt werden: `key` muss ein Non-Nullable-Verweistyp sein.</span><span class="sxs-lookup"><span data-stu-id="74014-120">The rule for `key` can be completely expressed by the variable type: `key` should be a non-nullable reference type.</span></span> <span data-ttu-id="74014-121">Der Parameter `message` ist komplexer.</span><span class="sxs-lookup"><span data-stu-id="74014-121">The `message` parameter is more complex.</span></span> <span data-ttu-id="74014-122">Er lässt `null` als Argument zu, aber garantiert bei einem erfolgreichen Vorgang, dass das `out`-Argument nicht NULL ist.</span><span class="sxs-lookup"><span data-stu-id="74014-122">It allows `null` as the argument, but guarantees that, on success, that `out` argument isn't null.</span></span> <span data-ttu-id="74014-123">Für diese Szenarien ist ein umfangreicheres Vokabular zum Beschreiben der Erwartungen erforderlich.</span><span class="sxs-lookup"><span data-stu-id="74014-123">For these scenarios, you need a richer vocabulary to describe the expectations.</span></span>

<span data-ttu-id="74014-124">Die Aktualisierung der Bibliothek für Nullable-Verweise erfordert mehr als die Verteilung von `?` in einigen Variablen und Typnamen.</span><span class="sxs-lookup"><span data-stu-id="74014-124">Updating your library for nullable references requires more than sprinkling `?` on some of the variables and type names.</span></span> <span data-ttu-id="74014-125">Wie das vorangehende Beispiel zeigt, müssen Sie Ihre APIs untersuchen und Ihre Erwartungen für jedes Eingabeargument überprüfen.</span><span class="sxs-lookup"><span data-stu-id="74014-125">The preceding example shows that you need to examine your APIs and consider your expectations for each input argument.</span></span> <span data-ttu-id="74014-126">Berücksichtigen Sie die Garantien für die Rückgabewerte und alle `out`- oder `ref`-Argumente bei der Rückgabe der Methode.</span><span class="sxs-lookup"><span data-stu-id="74014-126">Consider the guarantees for the return value, and any `out` or `ref` arguments upon the method's return.</span></span> <span data-ttu-id="74014-127">Übermitteln Sie diese Regeln an den Compiler, der dann Warnungen ausgibt, wenn Aufrufer diese Regeln nicht einhalten.</span><span class="sxs-lookup"><span data-stu-id="74014-127">Then communicate those rules to the compiler, and the compiler will provide warnings when callers don't abide by those rules.</span></span>

<span data-ttu-id="74014-128">Diese Aufgabe nimmt einige Zeit in Anspruch.</span><span class="sxs-lookup"><span data-stu-id="74014-128">This work takes time.</span></span> <span data-ttu-id="74014-129">Beginnen wir mit Strategien, mit denen Ihre Bibliothek oder Anwendung Nullable-fähig gemacht wird und gleichzeitig andere Anforderungen ausgeglichen werden.</span><span class="sxs-lookup"><span data-stu-id="74014-129">Let's start with strategies to make your library or application nullable-aware, while balancing other requirements.</span></span> <span data-ttu-id="74014-130">Hier erfahren Sie, wie Sie die fortlaufende Entwicklung anpassen können, indem Sie Nullable-Verweistypen zulassen.</span><span class="sxs-lookup"><span data-stu-id="74014-130">You'll see how to balance ongoing development enabling nullable reference types.</span></span> <span data-ttu-id="74014-131">Sie lernen Herausforderungen für generische Typdefinitionen kennen.</span><span class="sxs-lookup"><span data-stu-id="74014-131">You'll learn challenges for generic type definitions.</span></span> <span data-ttu-id="74014-132">Sie erfahren, wie Sie Attribute anwenden, um Vor- und Nachbedingungen einzelner APIs zu beschreiben.</span><span class="sxs-lookup"><span data-stu-id="74014-132">You'll learn to apply attributes to describe pre- and post-conditions on individual APIs.</span></span>

## <a name="choose-a-strategy-for-nullable-reference-types"></a><span data-ttu-id="74014-133">Auswählen einer Strategie für Nullable-Verweistypen</span><span class="sxs-lookup"><span data-stu-id="74014-133">Choose a strategy for nullable reference types</span></span>

<span data-ttu-id="74014-134">Zunächst einmal muss festgelegt werden,ob Nullable-Verweistypen standardmäßig aktiviert oder deaktiviert sein sollen.</span><span class="sxs-lookup"><span data-stu-id="74014-134">The first choice is whether nullable reference types should be on or off by default.</span></span> <span data-ttu-id="74014-135">Es gibt zwei Strategien:</span><span class="sxs-lookup"><span data-stu-id="74014-135">You have two strategies:</span></span>

- <span data-ttu-id="74014-136">Aktivieren Sie Nullable-Verweistypen für das gesamte Projekt, und deaktivieren Sie sie in Code, der noch nicht fertig ist.</span><span class="sxs-lookup"><span data-stu-id="74014-136">Enable nullable reference types for the entire project, and disable it in code that's not ready.</span></span>
- <span data-ttu-id="74014-137">Aktivieren Sie Nullable-Verweistypen nur für Code, der für Nullable-Verweistypen kommentiert wurde.</span><span class="sxs-lookup"><span data-stu-id="74014-137">Only enable nullable reference types for code that's been annotated for nullable reference types.</span></span>

<span data-ttu-id="74014-138">Die erste Strategie funktioniert am besten, wenn Sie der Bibliothek beim Aktualisieren für Nullable-Verweistypen weitere Features hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="74014-138">The first strategy works best when you're adding other features to the library as you update it for nullable reference types.</span></span> <span data-ttu-id="74014-139">Alle neuen Entwicklungen sind Nullable-fähig.</span><span class="sxs-lookup"><span data-stu-id="74014-139">All new development is nullable aware.</span></span> <span data-ttu-id="74014-140">Wenn Sie vorhandenen Code aktualisieren, aktivieren Sie in diesen Klassen Nullable-Verweistypen.</span><span class="sxs-lookup"><span data-stu-id="74014-140">As you update existing code, you enable nullable reference types in those classes.</span></span>

<span data-ttu-id="74014-141">Führen Sie nach dieser ersten Strategie die folgenden Schritte aus:</span><span class="sxs-lookup"><span data-stu-id="74014-141">Following this first strategy, you do the following steps:</span></span>

1. <span data-ttu-id="74014-142">Aktivieren Sie Nullable-Verweistypen für das gesamte Projekt, indem Sie Ihren *CSPROJ*-Dateien das `<Nullable>enable</Nullable>`-Element hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="74014-142">Enable nullable reference types for the entire project by adding the `<Nullable>enable</Nullable>` element to your *csproj* files.</span></span>
1. <span data-ttu-id="74014-143">Fügen Sie allen Quelldateien in Ihrem Projekt das `#nullable disable`-Pragma hinzu.</span><span class="sxs-lookup"><span data-stu-id="74014-143">Add the `#nullable disable` pragma to every source file in your project.</span></span>
1. <span data-ttu-id="74014-144">Entfernen Sie bei der Bearbeitung der einzelnen Dateien das Pragma und kümmern Sie sich ggf. um Warnungen.</span><span class="sxs-lookup"><span data-stu-id="74014-144">As you work on each file, remove the pragma and address any warnings.</span></span>

<span data-ttu-id="74014-145">Diese erste Strategie ist im Vorfeld mit mehr Arbeit verbunden, da das Pragma allen Dateien hinzugefügt werden muss.</span><span class="sxs-lookup"><span data-stu-id="74014-145">This first strategy has more up-front work to add the pragma to every file.</span></span> <span data-ttu-id="74014-146">Sie hat jedoch den Vorteil, dass jede neue Codedatei, die dem Projekt hinzugefügt wird, Nullable-fähig ist.</span><span class="sxs-lookup"><span data-stu-id="74014-146">The advantage is that every new code file added to the project will be nullable enabled.</span></span> <span data-ttu-id="74014-147">Jede neue Arbeit ist Nullable-fähig. Nur bereits vorhandener Code muss aktualisiert werden.</span><span class="sxs-lookup"><span data-stu-id="74014-147">Any new work will be nullable aware; only existing code must be updated.</span></span>

<span data-ttu-id="74014-148">Die zweite Strategie funktioniert besser, wenn die Bibliothek stabil ist und das Hauptaugenmerk der Entwicklung auf der Einführung von Nullable-Verweistypen liegt.</span><span class="sxs-lookup"><span data-stu-id="74014-148">The second strategy works better if the library is stable, and the main focus of the development is to adopt nullable reference types.</span></span> <span data-ttu-id="74014-149">Aktivieren Sie Nullable-Verweistypen beim Kommentieren von APIs.</span><span class="sxs-lookup"><span data-stu-id="74014-149">You turn on nullable reference types as you annotate APIs.</span></span> <span data-ttu-id="74014-150">Aktivieren Sie anschließend Nullable-Verweistypen für das gesamte Projekt.</span><span class="sxs-lookup"><span data-stu-id="74014-150">When you've finished, you enable nullable reference types for the entire project.</span></span>

<span data-ttu-id="74014-151">Führen Sie nach dieser zweiten Strategie die folgenden Schritte aus:</span><span class="sxs-lookup"><span data-stu-id="74014-151">Following this second strategy you do the following steps:</span></span>

1. <span data-ttu-id="74014-152">Fügen Sie das `#nullable enable`-Pragma der Datei hinzu, die Sie Nullable-fähig machen möchten.</span><span class="sxs-lookup"><span data-stu-id="74014-152">Add the `#nullable enable` pragma to the file you want to make nullable aware.</span></span>
1. <span data-ttu-id="74014-153">Kümmern Sie sich um Warnungen.</span><span class="sxs-lookup"><span data-stu-id="74014-153">Address any warnings.</span></span>
1. <span data-ttu-id="74014-154">Führen Sie die ersten beiden Schritte aus, bis die gesamte Bibliothek Nullable-fähig ist.</span><span class="sxs-lookup"><span data-stu-id="74014-154">Continue these first two steps until you've made the entire library nullable aware.</span></span>
1. <span data-ttu-id="74014-155">Aktivieren Sie Nullable-Typen für das gesamte Projekt, indem Sie Ihren *CSPROJ*-Dateien das `<Nullable>enable</Nullable>`-Element hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="74014-155">Enable nullable types for the entire project by adding the `<Nullable>enable</Nullable>` element to your *csproj* files.</span></span>
1. <span data-ttu-id="74014-156">Entfernen Sie die `#nullable enable`-Pragmas, da sie nicht mehr benötigt werden.</span><span class="sxs-lookup"><span data-stu-id="74014-156">Remove the `#nullable enable` pragmas, as they're no longer needed.</span></span>

<span data-ttu-id="74014-157">Diese zweite Strategie ist im Vorfeld mit weniger Arbeit verbunden.</span><span class="sxs-lookup"><span data-stu-id="74014-157">This second strategy has less work up-front.</span></span> <span data-ttu-id="74014-158">Sie hat jedoch den Nachteil, dass beim Erstellen einer neuen Datei immer zuerst das Pragma hinzugefügt und Nullable-fähig gemacht werden muss.</span><span class="sxs-lookup"><span data-stu-id="74014-158">The tradeoff is that the first task when you create a new file is to add the pragma and make it nullable aware.</span></span> <span data-ttu-id="74014-159">Wenn Entwickler in Ihrem Team das vergessen, ist dieser neue Code nun im Arbeitsrückstand, da der gesamte Code Nullable-fähig gemacht werden muss.</span><span class="sxs-lookup"><span data-stu-id="74014-159">If any developers on your team forget, that new code is now in the backlog of work to make all code nullable aware.</span></span>

<span data-ttu-id="74014-160">Für welche Strategie Sie sich entscheiden, hängt davon ab, wie viel aktive Entwicklung in Ihrem Projekt stattfindet.</span><span class="sxs-lookup"><span data-stu-id="74014-160">Which of these strategies you pick depends on how much active development is taking place in your project.</span></span> <span data-ttu-id="74014-161">Je ausgereifter und stabiler Ihr Projekt ist, umso besser eignet sich die zweite Strategie.</span><span class="sxs-lookup"><span data-stu-id="74014-161">The more mature and stable your project, the better the second strategy.</span></span> <span data-ttu-id="74014-162">Je mehr Features entwickelt werden, umso besser eignet sich die erste Strategie.</span><span class="sxs-lookup"><span data-stu-id="74014-162">The more features being developed, the better the first strategy.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="74014-163">Der globale Nullable-Kontext gilt nicht für generierte Codedateien.</span><span class="sxs-lookup"><span data-stu-id="74014-163">The global nullable context does not apply for generated code files.</span></span> <span data-ttu-id="74014-164">Der Nullable-Kontext ist unabhängig von der Strategie für alle als generiert gekennzeichneten Quelldateien *deaktiviert*.</span><span class="sxs-lookup"><span data-stu-id="74014-164">Under either strategy, the nullable context is *disabled* for any source file marked as generated.</span></span> <span data-ttu-id="74014-165">Das bedeutet, dass alle in generierten Dateien enthaltenen APIs nicht mit Anmerkungen versehen werden.</span><span class="sxs-lookup"><span data-stu-id="74014-165">This means any APIs in generated files are not annotated.</span></span> <span data-ttu-id="74014-166">Es gibt viel Möglichkeiten, eine Datei als generiert zu markieren:</span><span class="sxs-lookup"><span data-stu-id="74014-166">There are four ways a file is marked as generated:</span></span>
>
> 1. <span data-ttu-id="74014-167">Geben Sie in der EDITORCONFIG-Datei `generated_code = true` in einem Abschnitt an, der für diese Datei gilt.</span><span class="sxs-lookup"><span data-stu-id="74014-167">In the .editorconfig, specify `generated_code = true` in a section that applies to that file.</span></span>
> 1. <span data-ttu-id="74014-168">Fügen Sie `<auto-generated>` oder `<auto-generated/>` ganz oben in der Datei in einem Kommentar ein.</span><span class="sxs-lookup"><span data-stu-id="74014-168">Put `<auto-generated>` or `<auto-generated/>` in a comment at the top of the file.</span></span> <span data-ttu-id="74014-169">Dabei kann es sich um eine beliebige Zeile des Kommentars handeln, jedoch muss es sich beim Kommentarblock um das erste Element in der Datei handeln.</span><span class="sxs-lookup"><span data-stu-id="74014-169">It can be on any line in that comment, but the comment block must be the first element in the file.</span></span>
> 1. <span data-ttu-id="74014-170">Beginnen Sie den Dateinamen mit *TemporaryGeneratedFile_* .</span><span class="sxs-lookup"><span data-stu-id="74014-170">Start the file name with *TemporaryGeneratedFile_*</span></span>
> 1. <span data-ttu-id="74014-171">Enden Sie den Dateinamen mit *.designer.cs*, *.generated.cs*, *.g.cs* oder *.g.i.cs*.</span><span class="sxs-lookup"><span data-stu-id="74014-171">End the file name with *.designer.cs*, *.generated.cs*, *.g.cs*, or *.g.i.cs*.</span></span>
>
> <span data-ttu-id="74014-172">Generatoren können die Präprozessoranweisung [`#nullable`](language-reference/preprocessor-directives/preprocessor-nullable.md) verwenden.</span><span class="sxs-lookup"><span data-stu-id="74014-172">Generators can opt-in using the [`#nullable`](language-reference/preprocessor-directives/preprocessor-nullable.md) preprocessor directive.</span></span>

## <a name="should-nullable-warnings-introduce-breaking-changes"></a><span data-ttu-id="74014-173">Sollten mit Nullable-Warnungen Breaking Changes eingeführt werden?</span><span class="sxs-lookup"><span data-stu-id="74014-173">Should nullable warnings introduce breaking changes?</span></span>

<span data-ttu-id="74014-174">Vor dem Aktivieren von Nullable-Verweistypen wird bei Variablen die *Nullable-Eigenschaft ignoriert*.</span><span class="sxs-lookup"><span data-stu-id="74014-174">Before you enable nullable reference types, variables are considered *nullable oblivious*.</span></span> <span data-ttu-id="74014-175">Nach dem Aktivieren von Nullable-Verweistypen sind diese Variablen alle *Non-Nullable-Variablen*.</span><span class="sxs-lookup"><span data-stu-id="74014-175">Once you enable nullable reference types, all those variables are *non-nullable*.</span></span> <span data-ttu-id="74014-176">Der Compiler gibt Warnungen aus, wenn diese Variablen nicht mit Werten ungleich NULL initialisiert werden.</span><span class="sxs-lookup"><span data-stu-id="74014-176">The compiler will issue warnings if those variables aren't initialized to non-null values.</span></span>

<span data-ttu-id="74014-177">Eine weitere wahrscheinliche Quelle für Warnungen sind Rückgabewerte, wenn der Wert nicht initialisiert wurde.</span><span class="sxs-lookup"><span data-stu-id="74014-177">Another likely source of warnings is return values when the value hasn't been initialized.</span></span>

<span data-ttu-id="74014-178">Der erste Schritt bei der Behandlung von Compilerwarnungen besteht darin, `?`-Anmerkungen für Parameter- und Rückgabetypen zu verwenden, um anzugeben, wann Argumente oder Rückgabewerte NULL sein können.</span><span class="sxs-lookup"><span data-stu-id="74014-178">The first step in addressing the compiler warnings is to use `?` annotations on parameter and return types to indicate when arguments or return values may be null.</span></span> <span data-ttu-id="74014-179">Wenn Verweisvariablen nicht NULL sein dürfen, ist die ursprüngliche Deklaration richtig.</span><span class="sxs-lookup"><span data-stu-id="74014-179">When reference variables must not be null, the original declaration is correct.</span></span> <span data-ttu-id="74014-180">Bei dieser Aufgabe geht es nicht nur darum, Warnungen zu behandeln.</span><span class="sxs-lookup"><span data-stu-id="74014-180">As you do this task, your goal isn't just to fix warnings.</span></span> <span data-ttu-id="74014-181">Vielmehr geht es darum, dafür zu sorgen, dass der Compiler versteht, warum NULL-Werte verwendet werden sollen.</span><span class="sxs-lookup"><span data-stu-id="74014-181">The more important goal is to make the compiler understand your intent for potential null values.</span></span> <span data-ttu-id="74014-182">Bei der Untersuchung der Warnungen kommen Sie zur nächsten wichtigen Entscheidung für Ihre Bibliothek.</span><span class="sxs-lookup"><span data-stu-id="74014-182">As you examine the warnings, you reach your next major decision for your library.</span></span> <span data-ttu-id="74014-183">Möchten Sie eine Änderung der API-Signaturen in Betracht ziehen, um Ihre Entwurfsabsicht klarer zu kommunizieren?</span><span class="sxs-lookup"><span data-stu-id="74014-183">Do you want to consider modifying API signatures to more clearly communicate your design intent?</span></span> <span data-ttu-id="74014-184">Eine bessere API-Signatur für die zuvor untersuchte `TryGetMessage`-Methode könnte wie folgt lauten:</span><span class="sxs-lookup"><span data-stu-id="74014-184">A better API signature for the `TryGetMessage` method examined earlier could be:</span></span>

```csharp
string? TryGetMessage(string key);
```

<span data-ttu-id="74014-185">Der Rückgabewert gibt an, ob der Vorgang erfolgreich oder fehlerhaft war, und enthält den Wert, sofern er gefunden wurde.</span><span class="sxs-lookup"><span data-stu-id="74014-185">The return value indicates success or failure, and carries the value if the value was found.</span></span> <span data-ttu-id="74014-186">Häufig lässt sich die Kommunikation von NULL-Werten durch Ändern der API-Signaturen verbessern.</span><span class="sxs-lookup"><span data-stu-id="74014-186">In many cases, changing API signatures can improve how they communicate null values.</span></span>

<span data-ttu-id="74014-187">Bei öffentlichen Bibliotheken oder Bibliotheken mit einer großen Benutzerbasis ist es jedoch möglicherweise besser, an API-Signaturen keine Änderungen vorzunehmen.</span><span class="sxs-lookup"><span data-stu-id="74014-187">However, for public libraries, or libraries with large user bases, you may prefer not introducing any API signature changes.</span></span> <span data-ttu-id="74014-188">In diesen Fällen oder bei anderen gängigen Mustern können Sie Attribute anwenden, um klarer zu definieren, wann ein Argument oder Rückgabewert `null` sein darf.</span><span class="sxs-lookup"><span data-stu-id="74014-188">For those cases, and other common patterns, you can apply attributes to more clearly define when an argument or return value may be `null`.</span></span> <span data-ttu-id="74014-189">Unabhängig davon, ob Sie eine Änderung der Oberfläche Ihrer API in Betracht ziehen oder nicht, werden Sie wahrscheinlich feststellen, dass Typanmerkungen allein nicht ausreichen, um `null`-Werte für Argumente oder Rückgabewerte zu beschreiben.</span><span class="sxs-lookup"><span data-stu-id="74014-189">Whether or not you consider changing the surface of your API, you'll likely find that type annotations alone aren't sufficient for describing `null` values for arguments or return values.</span></span> <span data-ttu-id="74014-190">In diesen Fällen können Sie Attribute anwenden, um eine API deutlicher zu beschreiben.</span><span class="sxs-lookup"><span data-stu-id="74014-190">In those instances, you can apply attributes to more clearly describe an API.</span></span>

## <a name="attributes-extend-type-annotations"></a><span data-ttu-id="74014-191">Attribute erweitern Typanmerkungen</span><span class="sxs-lookup"><span data-stu-id="74014-191">Attributes extend type annotations</span></span>

<span data-ttu-id="74014-192">Es wurden mehrere Attribute hinzugefügt, um zusätzliche Informationen über den NULL-Zustand von Variablen auszudrücken.</span><span class="sxs-lookup"><span data-stu-id="74014-192">Several attributes have been added to express additional information about the null state of variables.</span></span> <span data-ttu-id="74014-193">In jeglichem Code, der vor C# 8.0 und der Einführung von Nullable-Verweistypen geschrieben wurde, wurden *NULL-Werte nicht beachtet*.</span><span class="sxs-lookup"><span data-stu-id="74014-193">All code you wrote before C# 8 introduced nullable reference types was *null oblivious*.</span></span> <span data-ttu-id="74014-194">Dies bedeutet, dass eine Verweistypvariable NULL sein konnte, aber NULL-Überprüfungen nicht erforderlich waren.</span><span class="sxs-lookup"><span data-stu-id="74014-194">That means any reference type variable may be null, but null checks aren't required.</span></span> <span data-ttu-id="74014-195">Sobald Ihr Code *Nullable-fähig* ist, ändern sich diese Regeln.</span><span class="sxs-lookup"><span data-stu-id="74014-195">Once your code is *nullable aware*, those rules change.</span></span> <span data-ttu-id="74014-196">Verweistypen dürfen nie den Wert `null` aufweisen, und Nullable-Verweistypen müssen auf `null` überprüft werden, bevor sie dereferenziert werden können.</span><span class="sxs-lookup"><span data-stu-id="74014-196">Reference types should never be the `null` value, and nullable reference types must be checked against `null` before being dereferenced.</span></span>

<span data-ttu-id="74014-197">Die Regeln für Ihre APIs sind wahrscheinlich komplizierter, wie im `TryGetValue`-API-Szenario deutlich geworden ist.</span><span class="sxs-lookup"><span data-stu-id="74014-197">The rules for your APIs are likely more complicated, as you saw with the `TryGetValue` API scenario.</span></span> <span data-ttu-id="74014-198">Viele Ihrer APIs umfassen komplexere Regeln in Bezug darauf, wann Variablen den Wert `null` annehmen können oder nicht.</span><span class="sxs-lookup"><span data-stu-id="74014-198">Many of your APIs have more complex rules for when variables can or can't be `null`.</span></span> <span data-ttu-id="74014-199">In diesen Fällen verwenden Sie Attribute, um diese Regeln auszudrücken.</span><span class="sxs-lookup"><span data-stu-id="74014-199">In these cases, you'll use attributes to express those rules.</span></span> <span data-ttu-id="74014-200">Die Attribute, mit der Sie die Semantik Ihrer API beschreiben können, finden Sie im Artikel über [Attribute, die sich auf die Nullable-Analyse auswirken](./language-reference/attributes/nullable-analysis.md).</span><span class="sxs-lookup"><span data-stu-id="74014-200">The attributes that describe the semantics of your API are found in the article on [Attributes that impact nullable analysis](./language-reference/attributes/nullable-analysis.md).</span></span>

## <a name="generic-definitions-and-nullability"></a><span data-ttu-id="74014-201">Generische Definitionen und NULL-Zulässigkeit</span><span class="sxs-lookup"><span data-stu-id="74014-201">Generic definitions and nullability</span></span>

<span data-ttu-id="74014-202">Die korrekte Kommunikation des NULL-Status von generischen Typen und generischen Methoden erfordert besondere Sorgfalt.</span><span class="sxs-lookup"><span data-stu-id="74014-202">Correctly communicating the null state of generic types and generic methods requires special care.</span></span> <span data-ttu-id="74014-203">Die besondere Sorgfalt ist deshalb erforderlich, weil sich Nullable-Werttypen und Nullable-Verweistypen grundlegend voneinander unterscheiden.</span><span class="sxs-lookup"><span data-stu-id="74014-203">The extra care stems from the fact that a nullable value type and a nullable reference type are fundamentally different.</span></span> <span data-ttu-id="74014-204">`int?` ist ein Synonym für `Nullable<int>`, während `string?` ein `string` mit einem vom Compiler hinzugefügten Attribut ist.</span><span class="sxs-lookup"><span data-stu-id="74014-204">An `int?` is a synonym for `Nullable<int>`, whereas `string?` is `string` with an attribute added by the compiler.</span></span> <span data-ttu-id="74014-205">Das führt dazu, dass der Compiler für `T?` nur dann den richtigen Code generieren kann, wenn er weiß, ob `T` eine `class`- oder `struct`-Einschränkung ist.</span><span class="sxs-lookup"><span data-stu-id="74014-205">The result is that the compiler can't generate correct code for `T?` without knowing if `T` is a `class` or a `struct`.</span></span>

<span data-ttu-id="74014-206">Das bedeutet nicht, dass Sie keinen Nullable-Typ (Werttyp oder Verweistyp) als Typargument für einen geschlossenen generischen Typ verwenden können.</span><span class="sxs-lookup"><span data-stu-id="74014-206">This fact doesn't mean you can't use a nullable type (either value type or reference type) as the type argument for a closed generic type.</span></span> <span data-ttu-id="74014-207">Sowohl `List<string?>` als auch `List<int?>` sind gültige Instanziierungen von `List<T>`.</span><span class="sxs-lookup"><span data-stu-id="74014-207">Both `List<string?>` and `List<int?>` are valid instantiations of `List<T>`.</span></span>

<span data-ttu-id="74014-208">Vielmehr bedeutet das, dass Sie `T?` in einer generischen Klassen- oder Methodendeklaration nur mit Einschränkungen verwenden können.</span><span class="sxs-lookup"><span data-stu-id="74014-208">What it does mean is that you can't use `T?` in a generic class or method declaration without constraints.</span></span> <span data-ttu-id="74014-209"><xref:System.Linq.Enumerable.FirstOrDefault%60%601(System.Collections.Generic.IEnumerable%7B%60%600%7D)?displayProperty=nameWithType> wird beispielsweise für die Rückgabe von `T?` nicht geändert.</span><span class="sxs-lookup"><span data-stu-id="74014-209">For example, <xref:System.Linq.Enumerable.FirstOrDefault%60%601(System.Collections.Generic.IEnumerable%7B%60%600%7D)?displayProperty=nameWithType> won't be changed to return `T?`.</span></span> <span data-ttu-id="74014-210">Sie können diese Einschränkung umgehen, indem Sie entweder die `struct`- oder die `class`-Einschränkung hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="74014-210">You can overcome this limitation by adding either the `struct` or `class` constraint.</span></span> <span data-ttu-id="74014-211">Bei beiden Einschränkungen weiß der Compiler, wie Code für `T` und `T?`generiert werden kann.</span><span class="sxs-lookup"><span data-stu-id="74014-211">With either of those constraints, the compiler knows how to generate code for both `T` and `T?`.</span></span>

<span data-ttu-id="74014-212">Sie sollten die für ein generisches Typargument verwendeten Typen auf Non-Nullable-Typen beschränken.</span><span class="sxs-lookup"><span data-stu-id="74014-212">You may want to restrict the types used for a generic type argument to be non-nullable types.</span></span> <span data-ttu-id="74014-213">Hierzu fügen Sie für dieses Typargument die `notnull`-Einschränkung hinzu.</span><span class="sxs-lookup"><span data-stu-id="74014-213">You can do that by adding the `notnull` constraint on that type argument.</span></span> <span data-ttu-id="74014-214">Wenn diese Einschränkung angewendet wird, darf das Typargument kein Nullable-Typ sein.</span><span class="sxs-lookup"><span data-stu-id="74014-214">When that constraint is applied, the type argument must not be a nullable type.</span></span>

## <a name="late-initialized-properties-data-transfer-objects-and-nullability"></a><span data-ttu-id="74014-215">Spät initialisierte Eigenschaften, Datenübertragungsobjekte und NULL-Zulässigkeit</span><span class="sxs-lookup"><span data-stu-id="74014-215">Late-initialized properties, Data Transfer Objects, and nullability</span></span>

<span data-ttu-id="74014-216">Wenn Sie die NULL-Zulässigkeit von Eigenschaften angeben, die spät initialisiert, d. h. nach der Konstruktion festgelegt werden, ist möglicherweise eine besondere Überlegung erforderlich, um sicherzustellen, dass Ihre Klasse die ursprüngliche Entwurfsabsicht weiterhin korrekt zum Ausdruck bringt.</span><span class="sxs-lookup"><span data-stu-id="74014-216">Indicating the nullability of properties that are late-initialized, meaning set after construction, may require special consideration to ensure that your class continues to correctly express the original design intent.</span></span>

<span data-ttu-id="74014-217">Typen, die spät initialisierte Eigenschaften wie Datenübertragungsobjekte (Data Transfer Objects, DTOs) enthalten, werden häufig durch eine externe Bibliothek wie etwa durch einen Datenbank-ORM (Object Relational Mapper), ein Deserialisierungsprogramm oder eine andere Komponente instanziiert, die Eigenschaften automatisch aus einer anderen Quelle auffüllt.</span><span class="sxs-lookup"><span data-stu-id="74014-217">Types that contain late-initialized properties, such as Data Transfer Objects (DTOs), are often instantiated by an external library, like a database ORM (Object Relational Mapper), a deserializer, or some other component that automatically populates properties from another source.</span></span>

<span data-ttu-id="74014-218">Betrachten Sie die folgende DTO-Klasse, die einen Kursteilnehmer darstellt, bevor Nullable-Verweistypen aktiviert werden:</span><span class="sxs-lookup"><span data-stu-id="74014-218">Consider the following DTO class, prior to enabling nullable reference types, that represents a student:</span></span>

```csharp
class Student
{
    [Required]
    public string FirstName { get; set; }

    [Required]
    public string LastName { get; set; }

    public string VehicleRegistration { get; set; }
}
```

<span data-ttu-id="74014-219">Die Entwurfsabsicht (in diesem Fall durch das `Required`-Attribut angegeben) deutet darauf hin, dass in diesem System die Eigenschaften `FirstName` und `LastName` **obligatorisch** und somit nicht NULL sind.</span><span class="sxs-lookup"><span data-stu-id="74014-219">The design intent (indicated in this case by the `Required` attribute) suggests that in this system, the `FirstName` and `LastName` properties are **mandatory**, and therefore not null.</span></span>

<span data-ttu-id="74014-220">Die `VehicleRegistration`-Eigenschaft ist **nicht obligatorisch**, kann daher NULL sein.</span><span class="sxs-lookup"><span data-stu-id="74014-220">The `VehicleRegistration` property is **not mandatory**, so may be null.</span></span>

<span data-ttu-id="74014-221">Beim Aktivieren von Nullable-Verweistypen sollten Sie angeben, welche Eigenschaften in Ihrem DTO entsprechend Ihrer ursprünglichen Entwurfsabsicht Nullwerte zulassen sollen:</span><span class="sxs-lookup"><span data-stu-id="74014-221">When you enable nullable reference types, you want to indicate which properties on your DTO may be nullable, consistent with your original intent:</span></span>

```csharp
class Student
{
    [Required]
    public string FirstName { get; set; }

    [Required]
    public string LastName { get; set; }

    public string? VehicleRegistration { get; set; }
}
```

<span data-ttu-id="74014-222">Bei diesem DTO ist ``VehicleRegistration`` die einzige Eigenschaft, die NULL sein darf.</span><span class="sxs-lookup"><span data-stu-id="74014-222">For this DTO, the only property that may be null is ``VehicleRegistration``.</span></span>

<span data-ttu-id="74014-223">Der Compiler löst jedoch sowohl für `FirstName` als auch für `LastName` `CS8618`-Warnungen aus, was darauf hindeutet, dass die Non-Nullable-Eigenschaften nicht initialisiert wurden.</span><span class="sxs-lookup"><span data-stu-id="74014-223">However, the compiler raises `CS8618` warnings for both `FirstName` and `LastName`, indicating the non-nullable properties are uninitialized.</span></span>

<span data-ttu-id="74014-224">Es gibt drei Möglichkeiten, mit denen die Compilerwarnungen so aufgelöst werden können, dass die ursprüngliche Absicht erhalten bleibt.</span><span class="sxs-lookup"><span data-stu-id="74014-224">There are three options available to you that resolve the compiler warnings in a way that maintains the original intent.</span></span> <span data-ttu-id="74014-225">Jede dieser drei Möglichkeiten ist zulässig. Sie sollten diejenige auswählen, die am besten zu Ihrem Codierungsstil und zu Ihren Entwurfsanforderungen passt.</span><span class="sxs-lookup"><span data-stu-id="74014-225">Any of these options are valid; you should choose the one that best suits your coding style and design requirements.</span></span>

### <a name="initialize-in-the-constructor"></a><span data-ttu-id="74014-226">Initialisieren im Konstruktor</span><span class="sxs-lookup"><span data-stu-id="74014-226">Initialize in the constructor</span></span>

<span data-ttu-id="74014-227">Warnungen zu nicht initialisierten Eigenschaften lassen sich am besten durch Initialisieren der Eigenschaften im Konstruktor auflösen:</span><span class="sxs-lookup"><span data-stu-id="74014-227">The ideal way to resolve the uninitialized warnings is to initialize the properties in the constructor:</span></span>

```csharp
class Student
{
    public Student(string firstName, string lastName)
    {
        FirstName = firstName;
        LastName = lastName;
    }

    [Required]
    public string FirstName { get; set; }

    [Required]
    public string LastName { get; set; }

    public string? VehicleRegistration { get; set; }
}
```

<span data-ttu-id="74014-228">Dieser Ansatz funktioniert nur, wenn die Bibliothek, die Sie zum Instanziieren der Klasse verwenden, die Übergabe von Parametern im Konstruktor unterstützt.</span><span class="sxs-lookup"><span data-stu-id="74014-228">This approach only works if the library that you use to instantiate the class supports passing parameters in the constructor.</span></span>

<span data-ttu-id="74014-229">Eine Bibliothek unterstützt möglicherweise die Übergabe von *einigen*, aber nicht von allen Eigenschaften im Konstruktor.</span><span class="sxs-lookup"><span data-stu-id="74014-229">A library may support passing *some* properties in the constructor, but not all.</span></span> <span data-ttu-id="74014-230">EF Core unterstützt beispielsweise die [Konstruktorbindung](/ef/core/modeling/constructors) für normale Spalteneigenschaften, Navigationseigenschaften werden dagegen nicht unterstützt.</span><span class="sxs-lookup"><span data-stu-id="74014-230">For example, EF Core supports [constructor binding](/ef/core/modeling/constructors) for normal column properties, but not navigation properties.</span></span>

<span data-ttu-id="74014-231">In der Dokumentation zu der Bibliothek, die Ihre Klasse instanziiert, finden Sie Informationen dazu, in welchem Umfang die Konstruktorbindung unterstützt wird.</span><span class="sxs-lookup"><span data-stu-id="74014-231">Check the documentation on the library that instantiates your class, to understand the extent to which it supports constructor binding.</span></span>

### <a name="property-with-nullable-backing-field"></a><span data-ttu-id="74014-232">Eigenschaft mit Nullable-Unterstützungsfeld</span><span class="sxs-lookup"><span data-stu-id="74014-232">Property with nullable backing field</span></span>

<span data-ttu-id="74014-233">Wenn Sie die Konstruktorbindung nicht verwenden können, können Sie dieses Problem mithilfe einer Non-Nullable-Eigenschaft mit einem Nullable-Unterstützungsfeld beheben:</span><span class="sxs-lookup"><span data-stu-id="74014-233">If constructor binding won't work for you, one way to deal with this problem is to have a non-nullable property with a nullable backing field:</span></span>

```csharp
private string? _firstName;

[Required]
public string FirstName
{
    set => _firstName = value;
    get => _firstName
           ?? throw new InvalidOperationException("Uninitialized " + nameof(FirstName))
}
```

<span data-ttu-id="74014-234">Wenn in diesem Szenario auf die `FirstName`-Eigenschaft zugegriffen wird, bevor sie initialisiert wurde, löst der Code eine `InvalidOperationException` aus, da dies nicht dem API-Vertrag entspricht.</span><span class="sxs-lookup"><span data-stu-id="74014-234">In this scenario, if the `FirstName` property is accessed before it has been initialized, then the code throws an `InvalidOperationException`, because the API contract has been used incorrectly.</span></span>

<span data-ttu-id="74014-235">Beachten Sie, dass bei einigen Bibliotheken bei der Verwendung von Unterstützungsfeldern bestimmte Aspekte berücksichtigt werden müssen.</span><span class="sxs-lookup"><span data-stu-id="74014-235">Consider that some libraries may have special considerations when using backing fields.</span></span> <span data-ttu-id="74014-236">So muss EF Core beispielsweise für die richtige Verwendung von [Unterstützungsfeldern](/ef/core/modeling/backing-field) konfiguriert werden.</span><span class="sxs-lookup"><span data-stu-id="74014-236">For example, EF Core may need to be configured to use [backing fields](/ef/core/modeling/backing-field) correctly.</span></span>

### <a name="initialize-the-property-to-null"></a><span data-ttu-id="74014-237">Initialisieren der Eigenschaft mit NULL</span><span class="sxs-lookup"><span data-stu-id="74014-237">Initialize the property to null</span></span>

<span data-ttu-id="74014-238">Als kürzere Alternative zur Verwendung eines Nullable-Unterstützungsfelds oder für den Fall, dass die Bibliothek, die Ihre Klasse instanziiert, mit diesem Ansatz nicht kompatibel ist, können Sie die Eigenschaft mithilfe des NULL-toleranten Operators (`!`) direkt mit `null` initialisieren:</span><span class="sxs-lookup"><span data-stu-id="74014-238">As a terser alternative to using a nullable backing field, or if the library that instantiates your class isn't compatible with that approach, you can initialize the property to `null` directly, with the help of the null-forgiving operator (`!`):</span></span>

```csharp
[Required]
public string FirstName { get; set; } = null!;

[Required]
public string LastName { get; set; } = null!;

public string? VehicleRegistration { get; set; }
```

<span data-ttu-id="74014-239">Sie werden keinen tatsächlichen NULL-Wert zur Laufzeit beobachten, außer aufgrund eines Programmierfehlers, indem Sie auf die Eigenschaft zugreifen, bevor sie ordnungsgemäß initialisiert wurde.</span><span class="sxs-lookup"><span data-stu-id="74014-239">You'll never observe an actual null value at runtime except as a result of a programming bug, by accessing the property before it has been properly initialized.</span></span>

## <a name="see-also"></a><span data-ttu-id="74014-240">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="74014-240">See also</span></span>

- [<span data-ttu-id="74014-241">Tutorial: Migrieren vorhandenen Codes mit Verweistypen, die NULL-Werte zulassen</span><span class="sxs-lookup"><span data-stu-id="74014-241">Migrate an existing codebase to nullable references</span></span>](tutorials/upgrade-to-nullable-references.md)
- [<span data-ttu-id="74014-242">Verwenden von Nullable-Verweistypen in EF Core</span><span class="sxs-lookup"><span data-stu-id="74014-242">Working with Nullable Reference Types in EF Core</span></span>](/ef/core/miscellaneous/nullable-reference-types)
