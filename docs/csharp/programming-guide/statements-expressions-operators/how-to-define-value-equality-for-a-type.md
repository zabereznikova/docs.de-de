---
title: 'Vorgehensweise: Definieren von Wertgleichheit für einen Typ (C#-Programmierleitfaden)'
description: Erfahren Sie, wie Sie Wertgleichheit für einen Typ definieren. Hier finden Sie Codebeispiele und zusätzliche verfügbare Ressourcen.
ms.date: 07/20/2015
helpviewer_keywords:
- overriding Equals method [C#]
- object equivalence [C#]
- Equals method [C#], overriding
- value equality [C#]
- equivalence [C#]
ms.assetid: 4084581e-b931-498b-9534-cf7ef5b68690
ms.openlocfilehash: 9523ba99f877fde7207042ecb8d28548168a68cb
ms.sourcegitcommit: ff5a4eb5cffbcac9521bc44a907a118cd7e8638d
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 10/17/2020
ms.locfileid: "92162725"
---
# <a name="how-to-define-value-equality-for-a-type-c-programming-guide"></a><span data-ttu-id="c4f53-104">Vorgehensweise: Definieren von Wertgleichheit für einen Typ (C#-Programmierleitfaden)</span><span class="sxs-lookup"><span data-stu-id="c4f53-104">How to define value equality for a type (C# Programming Guide)</span></span>

<span data-ttu-id="c4f53-105">Wenn Sie eine Klasse oder Struktur definieren, entscheiden Sie, ob es sinnvoll ist, eine benutzerdefinierte Definition der Wertgleichheit (oder Äquivalenz) für den Typ zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="c4f53-105">When you define a class or struct, you decide whether it makes sense to create a custom definition of value equality (or equivalence) for the type.</span></span> <span data-ttu-id="c4f53-106">In der Regel implementieren Sie Wertgleichheit, wenn Objekte des Typs zu einer Auflistung hinzugefügt werden sollen oder wenn ihr Hauptzweck im Speichern einer Reihe von Feldern oder Eigenschaften besteht.</span><span class="sxs-lookup"><span data-stu-id="c4f53-106">Typically, you implement value equality when objects of the type are expected to be added to a collection of some sort, or when their primary purpose is to store a set of fields or properties.</span></span> <span data-ttu-id="c4f53-107">Sie können die Definition der Wertgleichheit auf einem Vergleich aller Felder und Eigenschaften im Typ oder auf einer Teilmenge aufbauen.</span><span class="sxs-lookup"><span data-stu-id="c4f53-107">You can base your definition of value equality on a comparison of all the fields and properties in the type, or you can base the definition on a subset.</span></span>

<span data-ttu-id="c4f53-108">In beiden Fällen und in beiden Klassen und Strukturen sollte Ihre Implementierung den fünf Garantien der Äquivalenz folgen (für die folgenden Regeln wird angenommen, dass `x`, `y` und `z` nicht NULL sind):</span><span class="sxs-lookup"><span data-stu-id="c4f53-108">In either case, and in both classes and structs, your implementation should follow the five guarantees of equivalence (For the following rules, assume that `x`, `y` and `z` are not null):</span></span>  
  
1. <span data-ttu-id="c4f53-109">`x.Equals(x)` gibt `true` zurück.</span><span class="sxs-lookup"><span data-stu-id="c4f53-109">`x.Equals(x)` returns `true`.</span></span> <span data-ttu-id="c4f53-110">Dies wird als reflexive Eigenschaft bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="c4f53-110">This is called the reflexive property.</span></span>  
  
2. <span data-ttu-id="c4f53-111">`x.Equals(y)` gibt denselben Wert zurück wie `y.Equals(x)`.</span><span class="sxs-lookup"><span data-stu-id="c4f53-111">`x.Equals(y)` returns the same value as `y.Equals(x)`.</span></span> <span data-ttu-id="c4f53-112">Die wird als symmetrische Eigenschaft bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="c4f53-112">This is called the symmetric property.</span></span>  
  
3. <span data-ttu-id="c4f53-113">Wenn `true` von `(x.Equals(y) && y.Equals(z))` zurückgegeben wird, wird `true` von `x.Equals(z)` zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="c4f53-113">if `(x.Equals(y) && y.Equals(z))` returns `true`, then `x.Equals(z)` returns `true`.</span></span> <span data-ttu-id="c4f53-114">Dies wird als transitive Eigenschaft bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="c4f53-114">This is called the transitive property.</span></span>  
  
4. <span data-ttu-id="c4f53-115">Aufeinander folgende Aufrufe von `x.Equals(y)` geben immer denselben Wert zurück, es sei denn, die Objekte, auf die x und y verweisen, werden geändert.</span><span class="sxs-lookup"><span data-stu-id="c4f53-115">Successive invocations of `x.Equals(y)` return the same value as long as the objects referenced by x and y are not modified.</span></span>  
  
5. <span data-ttu-id="c4f53-116">Ein nicht-NULL-Wert ist ungleich NULL.</span><span class="sxs-lookup"><span data-stu-id="c4f53-116">Any non-null value is not equal to null.</span></span> <span data-ttu-id="c4f53-117">Die CLR prüft jedoch bei allen Methodenaufrufen auf NULL und löst eine `NullReferenceException` aus, wenn der `this`-Verweis NULL ist.</span><span class="sxs-lookup"><span data-stu-id="c4f53-117">However, the CLR checks for null on all method calls and throws a `NullReferenceException` if the `this` reference would be null.</span></span> <span data-ttu-id="c4f53-118">Daher löst `x.Equals(y)` eine Ausnahme aus, wenn `x` NULL ist.</span><span class="sxs-lookup"><span data-stu-id="c4f53-118">Therefore, `x.Equals(y)` throws an exception when `x` is null.</span></span> <span data-ttu-id="c4f53-119">Dadurch wird Regel 1 oder 2 gebrochen, abhängig vom Argument für `Equals`.</span><span class="sxs-lookup"><span data-stu-id="c4f53-119">That breaks rules 1 or 2, depending on the argument to `Equals`.</span></span>

<span data-ttu-id="c4f53-120">Jede Struktur, die Sie definieren, besitzt bereits eine Standardimplementierung der Wertgleichheit, die von der <xref:System.ValueType?displayProperty=nameWithType>-Außerkraftsetzung der <xref:System.Object.Equals%28System.Object%29?displayProperty=nameWithType>-Methode geerbt wurde.</span><span class="sxs-lookup"><span data-stu-id="c4f53-120">Any struct that you define already has a default implementation of value equality that it inherits from the <xref:System.ValueType?displayProperty=nameWithType> override of the <xref:System.Object.Equals%28System.Object%29?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="c4f53-121">Diese Implementierung verwendet Reflektion, um alle Felder und Eigenschaften im Typ zu untersuchen.</span><span class="sxs-lookup"><span data-stu-id="c4f53-121">This implementation uses reflection to examine all the fields and properties in the type.</span></span> <span data-ttu-id="c4f53-122">Obwohl diese Implementierung richtige Ergebnisse produziert, ist sie relativ langsam im Vergleich zu einer benutzerdefinierten Implementierung, die Sie speziell für den Typ schreiben.</span><span class="sxs-lookup"><span data-stu-id="c4f53-122">Although this implementation produces correct results, it is relatively slow compared to a custom implementation that you write specifically for the type.</span></span>  
  
<span data-ttu-id="c4f53-123">Die Implementierungsdetails für Wertgleichheit unterscheiden sich für Klassen und Strukturen.</span><span class="sxs-lookup"><span data-stu-id="c4f53-123">The implementation details for value equality are different for classes and structs.</span></span> <span data-ttu-id="c4f53-124">Sowohl Klassen als auch Strukturen erfordern dieselben grundlegenden Schritte zur Implementierung der Gleichheit:</span><span class="sxs-lookup"><span data-stu-id="c4f53-124">However, both classes and structs require the same basic steps for implementing equality:</span></span>  
  
1. <span data-ttu-id="c4f53-125">Überschreiben Sie die [virtuelle](../../language-reference/keywords/virtual.md) Methode <xref:System.Object.Equals%28System.Object%29?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="c4f53-125">Override the [virtual](../../language-reference/keywords/virtual.md) <xref:System.Object.Equals%28System.Object%29?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="c4f53-126">In den meisten Fällen sollte Ihre Implementierung von `bool Equals( object obj )` nur die typspezifische `Equals`-Methode aufrufen, die die Implementierung der Schnittstelle <xref:System.IEquatable%601?displayProperty=nameWithType> darstellt.</span><span class="sxs-lookup"><span data-stu-id="c4f53-126">In most cases, your implementation of `bool Equals( object obj )` should just call into the type-specific `Equals` method that is the implementation of the <xref:System.IEquatable%601?displayProperty=nameWithType> interface.</span></span> <span data-ttu-id="c4f53-127">(Siehe Schritt 2)</span><span class="sxs-lookup"><span data-stu-id="c4f53-127">(See step 2.)</span></span>  
  
2. <span data-ttu-id="c4f53-128">Implementieren Sie die Schnittstelle <xref:System.IEquatable%601?displayProperty=nameWithType>, indem Sie eine typspezifische `Equals`-Methode bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="c4f53-128">Implement the <xref:System.IEquatable%601?displayProperty=nameWithType> interface by providing a type-specific `Equals` method.</span></span> <span data-ttu-id="c4f53-129">An dieser Stelle wird der eigentliche Äquivalenzvergleich ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="c4f53-129">This is where the actual equivalence comparison is performed.</span></span> <span data-ttu-id="c4f53-130">Sie könnten Gleichheit z.B. nur über den Vergleich von ein oder zwei Feldern in Ihrem Typ definieren.</span><span class="sxs-lookup"><span data-stu-id="c4f53-130">For example, you might decide to define equality by comparing only one or two fields in your type.</span></span> <span data-ttu-id="c4f53-131">Lösen Sie keine Ausnahmen aus `Equals` aus.</span><span class="sxs-lookup"><span data-stu-id="c4f53-131">Do not throw exceptions from `Equals`.</span></span> <span data-ttu-id="c4f53-132">Nur für Klassen: Diese Methode sollte nur Felder prüfen, die in der Klasse deklariert sind.</span><span class="sxs-lookup"><span data-stu-id="c4f53-132">For classes only: This method should examine only fields that are declared in the class.</span></span> <span data-ttu-id="c4f53-133">Sie sollte `base.Equals` aufrufen, um Felder in der Basisklasse zu prüfen.</span><span class="sxs-lookup"><span data-stu-id="c4f53-133">It should call `base.Equals` to examine fields that are in the base class.</span></span> <span data-ttu-id="c4f53-134">(Tun Sie dies nicht, wenn der Typ direkt von <xref:System.Object> erbt, da die <xref:System.Object>-Implementierung von <xref:System.Object.Equals%28System.Object%29?displayProperty=nameWithType> eine Überprüfung der Verweisgleichheit durchführt.)</span><span class="sxs-lookup"><span data-stu-id="c4f53-134">(Do not do this if the type inherits directly from <xref:System.Object>, because the <xref:System.Object> implementation of <xref:System.Object.Equals%28System.Object%29?displayProperty=nameWithType> performs a reference equality check.)</span></span>  
  
3. <span data-ttu-id="c4f53-135">Optional, aber empfohlen: Überladen Sie die Operatoren [==](../../language-reference/operators/equality-operators.md#equality-operator-) und [!=](../../language-reference/operators/equality-operators.md#inequality-operator-).</span><span class="sxs-lookup"><span data-stu-id="c4f53-135">Optional but recommended: Overload the [==](../../language-reference/operators/equality-operators.md#equality-operator-) and [!=](../../language-reference/operators/equality-operators.md#inequality-operator-) operators.</span></span>  
  
4. <span data-ttu-id="c4f53-136">Überschreiben Sie <xref:System.Object.GetHashCode%2A?displayProperty=nameWithType>, damit zwei Objekte, die Wertgleichheit besitzen, den gleichen Hashcode erzeugen.</span><span class="sxs-lookup"><span data-stu-id="c4f53-136">Override <xref:System.Object.GetHashCode%2A?displayProperty=nameWithType> so that two objects that have value equality produce the same hash code.</span></span>  
  
5. <span data-ttu-id="c4f53-137">Optional: Implementieren Sie zur Unterstützung von Definitionen für „größer als“ oder „kleiner als“ die Schnittstelle <xref:System.IComparable%601> für Ihren Typ, und überladen Sie auch die Operatoren [<=](../../language-reference/operators/comparison-operators.md#less-than-or-equal-operator-) und [>=](../../language-reference/operators/comparison-operators.md#greater-than-or-equal-operator-).</span><span class="sxs-lookup"><span data-stu-id="c4f53-137">Optional: To support definitions for "greater than" or "less than," implement the <xref:System.IComparable%601> interface for your type, and also overload the [<=](../../language-reference/operators/comparison-operators.md#less-than-or-equal-operator-) and [>=](../../language-reference/operators/comparison-operators.md#greater-than-or-equal-operator-) operators.</span></span>  

> [!NOTE]
> <span data-ttu-id="c4f53-138">Ab C# 9.0 können Sie Datensätze verwenden, um ohne unnötige Codebausteine eine Semantik mit Wertgleichheit zu erzielen.</span><span class="sxs-lookup"><span data-stu-id="c4f53-138">Starting in C# 9.0, you can use records to get value equality semantics without any unnecessary boilerplate code.</span></span>

## <a name="class-example"></a><span data-ttu-id="c4f53-139">Klassenbeispiel</span><span class="sxs-lookup"><span data-stu-id="c4f53-139">Class example</span></span>

<span data-ttu-id="c4f53-140">Im folgenden Beispiel wird veranschaulicht, wie Sie Wertgleichheit in einer Klasse (Referenztyp) implementieren.</span><span class="sxs-lookup"><span data-stu-id="c4f53-140">The following example shows how to implement value equality in a class (reference type).</span></span>

[!code-csharp[csProgGuideStatements#19](~/samples/snippets/csharp/VS_Snippets_VBCSharp/csProgGuideStatements/CS/Statements.cs#19)]

<span data-ttu-id="c4f53-141">Die standardmäßige Implementierung beider <xref:System.Object.Equals%28System.Object%29?displayProperty=nameWithType>-Methoden führt bei Klassen (Referenztypen) einen Verweisgleichheitsvergleich, keine Wertgleichheitsprüfung aus.</span><span class="sxs-lookup"><span data-stu-id="c4f53-141">On classes (reference types), the default implementation of both <xref:System.Object.Equals%28System.Object%29?displayProperty=nameWithType> methods performs a reference equality comparison, not a value equality check.</span></span> <span data-ttu-id="c4f53-142">Wenn eine Implementierer die virtuelle Methode überschreibt, dient dies dazu, ihr Wertgleichheitssemantik zu verleihen.</span><span class="sxs-lookup"><span data-stu-id="c4f53-142">When an implementer overrides the virtual method, the purpose is to give it value equality semantics.</span></span>

<span data-ttu-id="c4f53-143">Die Operatoren `==` und `!=` können mit Klassen verwendet werden, selbst wenn die Klasse sie nicht überlädt.</span><span class="sxs-lookup"><span data-stu-id="c4f53-143">The `==` and `!=` operators can be used with classes even if the class does not overload them.</span></span> <span data-ttu-id="c4f53-144">Allerdings ist das Standardverhalten eine Ausführung einer Verweisgleichheitsprüfung.</span><span class="sxs-lookup"><span data-stu-id="c4f53-144">However, the default behavior is to perform a reference equality check.</span></span> <span data-ttu-id="c4f53-145">Wenn Sie die `Equals`-Methode in einer Klasse überladen, sollten Sie die Operatoren `==` und `!=` überladen, obwohl dies nicht erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="c4f53-145">In a class, if you overload the `Equals` method, you should overload the `==` and `!=` operators, but it is not required.</span></span>

## <a name="struct-example"></a><span data-ttu-id="c4f53-146">Strukturbeispiel</span><span class="sxs-lookup"><span data-stu-id="c4f53-146">Struct example</span></span>

<span data-ttu-id="c4f53-147">Im folgenden Beispiel wird veranschaulicht, wie Sie Wertgleichheit in einer Struktur (Werttyp) implementieren:</span><span class="sxs-lookup"><span data-stu-id="c4f53-147">The following example shows how to implement value equality in a struct (value type):</span></span>

[!code-csharp[csProgGuideStatements#20](~/samples/snippets/csharp/VS_Snippets_VBCSharp/csProgGuideStatements/CS/Statements.cs#20)]
  
<span data-ttu-id="c4f53-148">Für Strukturen führt die Standardimplementierung von <xref:System.Object.Equals%28System.Object%29?displayProperty=nameWithType> (was die außer Kraft gesetzte Version in <xref:System.ValueType?displayProperty=nameWithType> ist) eine Überprüfung der Wertgleichheit durch, indem sie Reflektion zum Vergleichen der Werte jedes Felds im Typ verwendet.</span><span class="sxs-lookup"><span data-stu-id="c4f53-148">For structs, the default implementation of <xref:System.Object.Equals%28System.Object%29?displayProperty=nameWithType> (which is the overridden version in <xref:System.ValueType?displayProperty=nameWithType>) performs a value equality check by using reflection to compare the values of every field in the type.</span></span> <span data-ttu-id="c4f53-149">Wenn ein Implementierer die virtuelle `Equals`-Methode in einer Struktur überschreibt, dient dies der Bereitstellung effizienterer Mittel für die Ausführung der Wertgleichheitsprüfung und optional dazu, den Vergleich auf einer Teilmenge des Felds oder der Eigenschaften der Struktur zu basieren.</span><span class="sxs-lookup"><span data-stu-id="c4f53-149">When an implementer overrides the virtual `Equals` method in a struct, the purpose is to provide a more efficient means of performing the value equality check and optionally to base the comparison on some subset of the struct's field or properties.</span></span>
  
<span data-ttu-id="c4f53-150">Die Operatoren [==](../../language-reference/operators/equality-operators.md#equality-operator-) und [!=](../../language-reference/operators/equality-operators.md#inequality-operator-) können nicht auf Strukturen operieren, es sei denn, die Struktur überlädt sie explizit.</span><span class="sxs-lookup"><span data-stu-id="c4f53-150">The [==](../../language-reference/operators/equality-operators.md#equality-operator-) and [!=](../../language-reference/operators/equality-operators.md#inequality-operator-) operators cannot operate on a struct unless the struct explicitly overloads them.</span></span>

## <a name="see-also"></a><span data-ttu-id="c4f53-151">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="c4f53-151">See also</span></span>

- [<span data-ttu-id="c4f53-152">Übereinstimmungsvergleiche</span><span class="sxs-lookup"><span data-stu-id="c4f53-152">Equality comparisons</span></span>](equality-comparisons.md)
- [<span data-ttu-id="c4f53-153">C#-Programmierhandbuch</span><span class="sxs-lookup"><span data-stu-id="c4f53-153">C# programming guide</span></span>](../index.md)
