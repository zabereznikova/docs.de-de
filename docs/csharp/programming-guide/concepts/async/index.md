---
title: Asynchrone Programmierung in C#
description: Ein Überblick über die C#-Sprachunterstützung für asynchrone Programmierung mit async, await, Task und Task<T>
ms.date: 05/26/2020
ms.openlocfilehash: 703392ca6ba4e6fb08dd8a88817babc167394788
ms.sourcegitcommit: 03fec33630b46e78d5e81e91b40518f32c4bd7b5
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 05/27/2020
ms.locfileid: "84007961"
---
# <a name="asynchronous-programming-with-async-and-await"></a><span data-ttu-id="61bfe-103">Asynchrone Programmierung mit async und await</span><span class="sxs-lookup"><span data-stu-id="61bfe-103">Asynchronous programming with async and await</span></span>

<span data-ttu-id="61bfe-104">Das [aufgabenbasierte asynchrone Programmiermodell](task-asynchronous-programming-model.md) stellt eine Abstraktion über asynchronen Code bereit.</span><span class="sxs-lookup"><span data-stu-id="61bfe-104">The [Task asynchronous programming model (TAP)](task-asynchronous-programming-model.md) provides an abstraction over asynchronous code.</span></span> <span data-ttu-id="61bfe-105">Sie können Code in gewohnter Weise als eine Folge von Anweisungen schreiben.</span><span class="sxs-lookup"><span data-stu-id="61bfe-105">You write code as a sequence of statements, just like always.</span></span> <span data-ttu-id="61bfe-106">Sie können diesen Code so lesen, als ob jede Anweisung abgeschlossen wäre, bevor die nächste Anweisung beginnt.</span><span class="sxs-lookup"><span data-stu-id="61bfe-106">You can read that code as though each statement completes before the next begins.</span></span> <span data-ttu-id="61bfe-107">Der Compiler führt eine Reihe von Transformationen durch, da möglicherweise einige dieser Anweisungen gestartet werden und eine <xref:System.Threading.Tasks.Task> zurückgeben, die die derzeit ausgeführte Arbeit darstellt.</span><span class="sxs-lookup"><span data-stu-id="61bfe-107">The compiler performs a number of transformations because some of those statements may start work and return a <xref:System.Threading.Tasks.Task> that represents the ongoing work.</span></span>

<span data-ttu-id="61bfe-108">Dies ist das Ziel dieser Syntax: Code zu aktivieren, der sich wie eine Folge von Anweisungen liest, aber in einer deutlich komplizierteren Reihenfolge ausgeführt wird, die auf einer externen Ressourcenzuordnung und dem Abschluss von Aufgaben basiert.</span><span class="sxs-lookup"><span data-stu-id="61bfe-108">That's the goal of this syntax: enable code that reads like a sequence of statements, but executes in a much more complicated order based on external resource allocation and when tasks complete.</span></span> <span data-ttu-id="61bfe-109">Vergleichbar ist dies mit der Art und Weise, wie Menschen Anweisungen für Prozesse erteilen, die asynchrone Aufgaben enthalten.</span><span class="sxs-lookup"><span data-stu-id="61bfe-109">It's analogous to how people give instructions for processes that include asynchronous tasks.</span></span> <span data-ttu-id="61bfe-110">In diesem Artikel verwenden Sie als Beispiel Anweisungen für die Zubereitung eines Frühstücks, um zu lernen, wie die Schlüsselwörter `async` und `await` die Analyse von Code erleichtern, der eine Reihe asynchroner Anweisungen enthält.</span><span class="sxs-lookup"><span data-stu-id="61bfe-110">Throughout this article, you'll use an example of instructions for making a breakfast to see how the `async` and `await` keywords make it easier to reason about code, that includes a series of asynchronous instructions.</span></span> <span data-ttu-id="61bfe-111">Um die Zubereitung eines Frühstücks zu erläutern, würden Sie Anweisungen schreiben, und Ihre Liste sähe ungefähr so aus:</span><span class="sxs-lookup"><span data-stu-id="61bfe-111">You'd write the instructions something like the following list to explain how to make a breakfast:</span></span>

1. <span data-ttu-id="61bfe-112">Schenken Sie sich eine Tasse Kaffee ein.</span><span class="sxs-lookup"><span data-stu-id="61bfe-112">Pour a cup of coffee.</span></span>
1. <span data-ttu-id="61bfe-113">Erhitzen Sie eine Pfanne, und braten Sie darin zwei Eier.</span><span class="sxs-lookup"><span data-stu-id="61bfe-113">Heat up a pan, then fry two eggs.</span></span>
1. <span data-ttu-id="61bfe-114">Braten Sie drei Scheiben Frühstücksspeck.</span><span class="sxs-lookup"><span data-stu-id="61bfe-114">Fry three slices of bacon.</span></span>
1. <span data-ttu-id="61bfe-115">Toasten Sie zwei Scheiben Brot.</span><span class="sxs-lookup"><span data-stu-id="61bfe-115">Toast two pieces of bread.</span></span>
1. <span data-ttu-id="61bfe-116">Bestreichen Sie das getoastete Brot mit Butter und Marmelade.</span><span class="sxs-lookup"><span data-stu-id="61bfe-116">Add butter and jam to the toast.</span></span>
1. <span data-ttu-id="61bfe-117">Schenken Sie sich ein Glas Orangensaft ein.</span><span class="sxs-lookup"><span data-stu-id="61bfe-117">Pour a glass of orange juice.</span></span>

<span data-ttu-id="61bfe-118">Wenn Sie über Erfahrung im Kochen verfügen, würden Sie diese Anweisungen **asynchron** ausführen.</span><span class="sxs-lookup"><span data-stu-id="61bfe-118">If you have experience with cooking, you'd execute those instructions **asynchronously**.</span></span> <span data-ttu-id="61bfe-119">Sie würden zunächst die Pfanne für die Eier erhitzen und dann mit dem Frühstücksspeck beginnen.</span><span class="sxs-lookup"><span data-stu-id="61bfe-119">You'd start warming the pan for eggs, then start the bacon.</span></span> <span data-ttu-id="61bfe-120">Sie würden das Brot in den Toaster stecken und danach mit den Eiern beginnen.</span><span class="sxs-lookup"><span data-stu-id="61bfe-120">You'd put the bread in the toaster, then start the eggs.</span></span> <span data-ttu-id="61bfe-121">Bei jedem Schritt des Prozesses würden Sie eine Aufgabe starten und dann Ihre Aufmerksamkeit auf Aufgaben lenken, die für Ihre Aufmerksamkeit bereit sind.</span><span class="sxs-lookup"><span data-stu-id="61bfe-121">At each step of the process, you'd start a task, then turn your attention to tasks that are ready for your attention.</span></span>

<span data-ttu-id="61bfe-122">Die Zubereitung eines Frühstücks ist ein gutes Beispiel für asynchrone Arbeiten, die nicht parallel ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="61bfe-122">Cooking breakfast is a good example of asynchronous work that isn't parallel.</span></span> <span data-ttu-id="61bfe-123">Eine Person (oder ein Thread) kann alle diese Aufgaben erledigen.</span><span class="sxs-lookup"><span data-stu-id="61bfe-123">One person (or thread) can handle all these tasks.</span></span> <span data-ttu-id="61bfe-124">Um beim Beispiel des Frühstücks zu bleiben: Eine Person kann das Frühstück asynchron zubereiten, indem sie die nächste Aufgabe startet, bevor die erste Aufgabe abgeschlossen ist.</span><span class="sxs-lookup"><span data-stu-id="61bfe-124">Continuing the breakfast analogy, one person can make breakfast asynchronously by starting the next task before the first completes.</span></span> <span data-ttu-id="61bfe-125">Die Zubereitung schreitet voran, und zwar unabhängig davon, ob jemand eine Auge darauf hat oder nicht.</span><span class="sxs-lookup"><span data-stu-id="61bfe-125">The cooking progresses whether or not someone is watching it.</span></span> <span data-ttu-id="61bfe-126">Sobald Sie damit beginnen, die Pfanne für die Eier zu erhitzen, können Sie mit dem Braten des Frühstücksspecks beginnen.</span><span class="sxs-lookup"><span data-stu-id="61bfe-126">As soon as you start warming the pan for the eggs, you can begin frying the bacon.</span></span> <span data-ttu-id="61bfe-127">Nachdem Sie das Braten des Frühstücksspecks begonnen haben, können Sie das Brot in den Toaster stecken.</span><span class="sxs-lookup"><span data-stu-id="61bfe-127">Once the bacon starts, you can put the bread into the toaster.</span></span>

<span data-ttu-id="61bfe-128">Für einen parallelen Algorithmus bräuchten Sie mehrere Köche (bzw. Threads).</span><span class="sxs-lookup"><span data-stu-id="61bfe-128">For a parallel algorithm, you'd need multiple cooks (or threads).</span></span> <span data-ttu-id="61bfe-129">Ein Koch würde sich um die Eier kümmern, ein weiterer um den Frühstücksspeck usw.</span><span class="sxs-lookup"><span data-stu-id="61bfe-129">One would make the eggs, one the bacon, and so on.</span></span> <span data-ttu-id="61bfe-130">Jeder Koch würde sich nur auf diese eine Aufgabe konzentrieren.</span><span class="sxs-lookup"><span data-stu-id="61bfe-130">Each one would be focused on just that one task.</span></span> <span data-ttu-id="61bfe-131">Jeder Koch (bzw. Thread) würde synchron blockiert, während er darauf wartet, dass der Frühstücksspeck gewendet werden muss oder der Toaster das Brot auswirft.</span><span class="sxs-lookup"><span data-stu-id="61bfe-131">Each cook (or thread) would be blocked synchronously waiting for bacon to be ready to flip, or the toast to pop.</span></span>

<span data-ttu-id="61bfe-132">Sehen Sie sich nun dieselben Anweisungen als C#-Anweisungen an:</span><span class="sxs-lookup"><span data-stu-id="61bfe-132">Now, consider those same instructions written as C# statements:</span></span>

:::code language="csharp" source="snippets/index/AsyncBreakfast-starter/Program.cs" highlight="8-27":::

> [!NOTE]
> <span data-ttu-id="61bfe-133">Die Klassen `Coffee`, `Egg`, `Bacon`, `Toast` und `Juice` sind leer.</span><span class="sxs-lookup"><span data-stu-id="61bfe-133">The `Coffee`, `Egg`, `Bacon`, `Toast`, and `Juice` classes are empty.</span></span> <span data-ttu-id="61bfe-134">Sie sind lediglich Markerklassen für Demonstrationszwecke und enthalten keine Eigenschaften.</span><span class="sxs-lookup"><span data-stu-id="61bfe-134">They are simply marker classes for the purpose of demonstration, contain no properties, and serve no other purpose.</span></span>

<span data-ttu-id="61bfe-135">Computer interpretieren diese Anweisungen anders als Menschen.</span><span class="sxs-lookup"><span data-stu-id="61bfe-135">Computers don't interpret those instructions the same way people do.</span></span> <span data-ttu-id="61bfe-136">Nach jeder Anweisung blockiert der Computer das weitere Vorgehen, bis die Arbeit abgeschlossen ist. Erst danach fährt er mit der nächsten Anweisung fort.</span><span class="sxs-lookup"><span data-stu-id="61bfe-136">The computer will block on each statement until the work is complete before moving on to the next statement.</span></span> <span data-ttu-id="61bfe-137">So käme kein schmackhaftes Frühstück zustande.</span><span class="sxs-lookup"><span data-stu-id="61bfe-137">That creates an unsatisfying breakfast.</span></span> <span data-ttu-id="61bfe-138">Die späteren Aufgaben würden erst gestartet, wenn die früheren Aufgaben abgeschlossen sind.</span><span class="sxs-lookup"><span data-stu-id="61bfe-138">The later tasks wouldn't be started until the earlier tasks had completed.</span></span> <span data-ttu-id="61bfe-139">Die Zubereitung des Frühstücks würde wesentlich länger dauern, und einige Komponenten wären bereits wieder kalt, bis sie serviert werden.</span><span class="sxs-lookup"><span data-stu-id="61bfe-139">It would take much longer to create the breakfast, and some items would have gotten cold before being served.</span></span>

<span data-ttu-id="61bfe-140">Wenn der Computer die obigen Anweisungen asynchron ausführen soll, müssen Sie asynchronen Code schreiben.</span><span class="sxs-lookup"><span data-stu-id="61bfe-140">If you want the computer to execute the above instructions asynchronously, you must write asynchronous code.</span></span>

<span data-ttu-id="61bfe-141">Diese Überlegungen sind wichtig für die Programme, die Sie heutzutage schreiben.</span><span class="sxs-lookup"><span data-stu-id="61bfe-141">These concerns are important for the programs you write today.</span></span> <span data-ttu-id="61bfe-142">Wenn Sie Client-Programme schreiben, möchten Sie, dass die Benutzeroberfläche auf Benutzereingaben reagiert.</span><span class="sxs-lookup"><span data-stu-id="61bfe-142">When you write client programs, you want the UI to be responsive to user input.</span></span> <span data-ttu-id="61bfe-143">Ihre Anwendung sollte nicht den Eindruck erwecken, dass sich das Smartphone aufgehängt hat, während es Daten aus dem Web herunterlädt.</span><span class="sxs-lookup"><span data-stu-id="61bfe-143">Your application shouldn't make a phone appear frozen while it's downloading data from the web.</span></span> <span data-ttu-id="61bfe-144">Wenn Sie Serverprogramme schreiben, möchten Sie nicht, dass Threads blockiert werden.</span><span class="sxs-lookup"><span data-stu-id="61bfe-144">When you write server programs, you don't want threads blocked.</span></span> <span data-ttu-id="61bfe-145">Diese Threads könnten für andere Anforderungen benötigt werden.</span><span class="sxs-lookup"><span data-stu-id="61bfe-145">Those threads could be serving other requests.</span></span> <span data-ttu-id="61bfe-146">Die Verwendung von synchronem Code, wenn asynchrone Alternativen vorhanden sind, beeinträchtigt Ihre Möglichkeiten für günstigere Erweiterungen.</span><span class="sxs-lookup"><span data-stu-id="61bfe-146">Using synchronous code when asynchronous alternatives exist hurts your ability to scale out less expensively.</span></span> <span data-ttu-id="61bfe-147">Sie bezahlen für die blockierten Threads.</span><span class="sxs-lookup"><span data-stu-id="61bfe-147">You pay for those blocked threads.</span></span>

<span data-ttu-id="61bfe-148">Erfolgreiche moderne Anwendungen erfordern asynchronen Code.</span><span class="sxs-lookup"><span data-stu-id="61bfe-148">Successful modern applications require asynchronous code.</span></span> <span data-ttu-id="61bfe-149">Ohne Sprachunterstützung erforderte das Schreiben von asynchronem Code Rückrufe, Abschlussereignisse oder andere Methoden, die die ursprüngliche Absicht des Codes verdeckten.</span><span class="sxs-lookup"><span data-stu-id="61bfe-149">Without language support, writing asynchronous code required callbacks, completion events, or other means that obscured the original intent of the code.</span></span> <span data-ttu-id="61bfe-150">Synchroner Code hat den Vorteil, dass er einfach zu verstehen ist.</span><span class="sxs-lookup"><span data-stu-id="61bfe-150">The advantage of the synchronous code is that it's easy to understand.</span></span> <span data-ttu-id="61bfe-151">Dank der schrittweise durchgeführten Aktionen lässt sich der Code leicht überprüfen und nachvollziehen.</span><span class="sxs-lookup"><span data-stu-id="61bfe-151">The step-by-step actions make it easy to scan and understand.</span></span> <span data-ttu-id="61bfe-152">Bei traditionellen asynchronen Modellen mussten Sie sich auf die asynchronen Eigenschaften des Codes und nicht auf die grundlegenden Aktionen des Codes konzentrieren.</span><span class="sxs-lookup"><span data-stu-id="61bfe-152">Traditional asynchronous models forced you to focus on the asynchronous nature of the code, not on the fundamental actions of the code.</span></span>

## <a name="dont-block-await-instead"></a><span data-ttu-id="61bfe-153">Nicht blockieren, stattdessen „await“ verwenden</span><span class="sxs-lookup"><span data-stu-id="61bfe-153">Don't block, await instead</span></span>

<span data-ttu-id="61bfe-154">Der obige Code zeigt eine schlechte Praxis: das Erstellen von synchronem Code zum Ausführen asynchroner Vorgänge.</span><span class="sxs-lookup"><span data-stu-id="61bfe-154">The preceding code demonstrates a bad practice: constructing synchronous code to perform asynchronous operations.</span></span> <span data-ttu-id="61bfe-155">In der vorliegenden Form hindert dieser Code den Thread an der Ausführung aller anderen Arbeiten.</span><span class="sxs-lookup"><span data-stu-id="61bfe-155">As written, this code blocks the thread executing it from doing any other work.</span></span> <span data-ttu-id="61bfe-156">Es wird nicht unterbrochen, während eine der anderen Aufgaben ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="61bfe-156">It won't be interrupted while any of the tasks are in progress.</span></span> <span data-ttu-id="61bfe-157">Dies wäre so, als würden Sie den Toaster anstarren, nachdem Sie das Brot hineingesteckt haben.</span><span class="sxs-lookup"><span data-stu-id="61bfe-157">It would be as though you stared at the toaster after putting the bread in.</span></span> <span data-ttu-id="61bfe-158">Sie wären so lange für niemanden ansprechbar, bis das getoastete Brot ausgeworfen wurde.</span><span class="sxs-lookup"><span data-stu-id="61bfe-158">You'd ignore anyone talking to you until the toast popped.</span></span>

<span data-ttu-id="61bfe-159">Aktualisieren wir also diesen Code so, dass der Thread nicht blockiert wird, während Aufgaben ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="61bfe-159">Let's start by updating this code so that the thread doesn't block while tasks are running.</span></span> <span data-ttu-id="61bfe-160">Das Schlüsselwort `await` bietet die Möglichkeit, eine Aufgabe zu starten und dann die Ausführung fortzusetzen, wenn diese Aufgabe abgeschlossen ist, ohne dass es dabei zu einer Blockierung kommt.</span><span class="sxs-lookup"><span data-stu-id="61bfe-160">The `await` keyword provides a non-blocking way to start a task, then continue execution when that task completes.</span></span> <span data-ttu-id="61bfe-161">Eine einfache asynchrone Version des Codes für die Frühstückszubereitung sähe daher wie der folgende Codeausschnitt aus:</span><span class="sxs-lookup"><span data-stu-id="61bfe-161">A simple asynchronous version of the make a breakfast code would look like the following snippet:</span></span>

:::code language="csharp" source="snippets/index/AsyncBreakfast-V2/Program.cs" id="SnippetMain":::

> [!TIP]
> <span data-ttu-id="61bfe-162">Die Methodenkörper von `FryEggsAsync`, `FryBaconAsync` und `ToastBreadAsync` wurden aktualisiert, sodass sie jetzt `Task<Egg>`, `Task<Bacon>` und `Task<Toast>` zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="61bfe-162">The method bodies of the `FryEggsAsync`, `FryBaconAsync`, and `ToastBreadAsync` have all been updated to return `Task<Egg>`, `Task<Bacon>`, and `Task<Toast>` respectively.</span></span> <span data-ttu-id="61bfe-163">Die Methoden werden umbenannt und enthalten dann das Suffix „Async“.</span><span class="sxs-lookup"><span data-stu-id="61bfe-163">The methods are renamed from their original version to include the "Async" suffix.</span></span> <span data-ttu-id="61bfe-164">Ihre Implementierungen werden als Teil der [endgültigen Version](#final-version) weiter unten in diesem Artikel gezeigt.</span><span class="sxs-lookup"><span data-stu-id="61bfe-164">Their implementations are shown as part of the [final version](#final-version) later in this article.</span></span>

<span data-ttu-id="61bfe-165">Dieser Code verursacht keine Blockierung, während die Eier oder der Frühstücksspeck gebraten werden.</span><span class="sxs-lookup"><span data-stu-id="61bfe-165">This code doesn't block while the eggs or the bacon are cooking.</span></span> <span data-ttu-id="61bfe-166">Dieser Code startet jedoch keine anderen Aufgaben.</span><span class="sxs-lookup"><span data-stu-id="61bfe-166">This code won't start any other tasks though.</span></span> <span data-ttu-id="61bfe-167">Sie würden weiterhin das Brot in den Toaster stecken und das Gerät so lange anstarren, bis das Brot ausgeworfen wird.</span><span class="sxs-lookup"><span data-stu-id="61bfe-167">You'd still put the toast in the toaster and stare at it until it pops.</span></span> <span data-ttu-id="61bfe-168">Aber Sie wären zumindest für andere Personen ansprechbar, die Ihre Aufmerksamkeit wünschen.</span><span class="sxs-lookup"><span data-stu-id="61bfe-168">But at least, you'd respond to anyone that wanted your attention.</span></span> <span data-ttu-id="61bfe-169">In einem Restaurant, in dem mehrere Bestellungen aufgegeben werden, könnte der Koch mit der Zubereitung eines weiteren Frühstücks beginnen, während das erste Frühstück zubereitet wird.</span><span class="sxs-lookup"><span data-stu-id="61bfe-169">In a restaurant where multiple orders are placed, the cook could start another breakfast while the first is cooking.</span></span>

<span data-ttu-id="61bfe-170">Jetzt wird der Thread für die Frühstückszubereitung nicht blockiert, während er auf gestartete Aufgaben wartet, die noch nicht abgeschlossen sind.</span><span class="sxs-lookup"><span data-stu-id="61bfe-170">Now, the thread working on the breakfast isn't blocked while awaiting any started task that hasn't yet finished.</span></span> <span data-ttu-id="61bfe-171">Bei einigen Anwendungen reicht diese Änderung bereits aus.</span><span class="sxs-lookup"><span data-stu-id="61bfe-171">For some applications, this change is all that's needed.</span></span> <span data-ttu-id="61bfe-172">Alleine diese Änderung führt bereits dazu, dass eine GUI-Anwendung weiterhin auf den Benutzer reagiert.</span><span class="sxs-lookup"><span data-stu-id="61bfe-172">A GUI application still responds to the user with just this change.</span></span> <span data-ttu-id="61bfe-173">In diesem Szenario möchten Sie jedoch mehr.</span><span class="sxs-lookup"><span data-stu-id="61bfe-173">However, for this scenario, you want more.</span></span> <span data-ttu-id="61bfe-174">Die einzelnen Komponenten bzw. Aufgaben sollen nicht sequenziell ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="61bfe-174">You don't want each of the component tasks to be executed sequentially.</span></span> <span data-ttu-id="61bfe-175">Es ist besser, die einzelnen Komponenten/Aufgaben zu starten, ohne auf den Abschluss der vorherigen Aufgabe zu warten.</span><span class="sxs-lookup"><span data-stu-id="61bfe-175">It's better to start each of the component tasks before awaiting the previous task's completion.</span></span>

## <a name="start-tasks-concurrently"></a><span data-ttu-id="61bfe-176">Aufgaben gleichzeitig starten</span><span class="sxs-lookup"><span data-stu-id="61bfe-176">Start tasks concurrently</span></span>

<span data-ttu-id="61bfe-177">In vielen Szenarios möchten Sie mehrere voneinander unabhängige Aufgaben unverzüglich starten.</span><span class="sxs-lookup"><span data-stu-id="61bfe-177">In many scenarios, you want to start several independent tasks immediately.</span></span> <span data-ttu-id="61bfe-178">Sobald eine der Aufgabe abgeschlossen ist, können Sie dann andere Aufgaben fortsetzen, die bereit sind.</span><span class="sxs-lookup"><span data-stu-id="61bfe-178">Then, as each task finishes, you can continue other work that's ready.</span></span> <span data-ttu-id="61bfe-179">Um beim Beispiel des Frühstücks zu bleiben, würden Sie dieses sehr viel schneller zubereiten können.</span><span class="sxs-lookup"><span data-stu-id="61bfe-179">In the breakfast analogy, that's how you get breakfast done more quickly.</span></span> <span data-ttu-id="61bfe-180">Außerdem können Sie alle Aufgaben nahezu gleichzeitig fertigstellen.</span><span class="sxs-lookup"><span data-stu-id="61bfe-180">You also get everything done close to the same time.</span></span> <span data-ttu-id="61bfe-181">Und erhalten so ein warmes Frühstück.</span><span class="sxs-lookup"><span data-stu-id="61bfe-181">You'll get a hot breakfast.</span></span>

<span data-ttu-id="61bfe-182"><xref:System.Threading.Tasks.Task?displayProperty=nameWithType> und verwandte Typen sind Klassen, mit denen Sie Aufgaben analysieren können, die gerade ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="61bfe-182">The <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> and related types are classes you can use to reason about tasks that are in progress.</span></span> <span data-ttu-id="61bfe-183">So können Sie Code schreiben, der sehr viel stärker der Art und Weise ähnelt, wie Sie wirklich ein Frühstück zubereiten.</span><span class="sxs-lookup"><span data-stu-id="61bfe-183">That enables you to write code that more closely resembles the way you'd actually create breakfast.</span></span> <span data-ttu-id="61bfe-184">Sie würden gleichzeitig mit der Zubereitung von Eiern, Frühstücksspeck und Toast beginnen.</span><span class="sxs-lookup"><span data-stu-id="61bfe-184">You'd start cooking the eggs, bacon, and toast at the same time.</span></span> <span data-ttu-id="61bfe-185">Da hierfür jeweils eine Aktion erforderlich ist, würden Sie Ihre Aufmerksamkeit auf diese Aufgabe lenken, sich um die nächste Aktion kümmern und dann auf etwas anderes warten, das Ihre Aufmerksamkeit erfordert.</span><span class="sxs-lookup"><span data-stu-id="61bfe-185">As each requires action, you'd turn your attention to that task, take care of the next action, then await for something else that requires your attention.</span></span>

<span data-ttu-id="61bfe-186">Sie starten eine Aufgabe und behalten dann das <xref:System.Threading.Tasks.Task>-Objekt bei, das die Arbeit repräsentiert.</span><span class="sxs-lookup"><span data-stu-id="61bfe-186">You start a task and hold on to the <xref:System.Threading.Tasks.Task> object that represents the work.</span></span> <span data-ttu-id="61bfe-187">Sie warten jede Aufgabe ab („`await`“), bevor Sie mit ihrem Ergebnis arbeiten.</span><span class="sxs-lookup"><span data-stu-id="61bfe-187">You'll `await` each task before working with its result.</span></span>

<span data-ttu-id="61bfe-188">Lassen Sie uns nun die entsprechenden Änderungen an dem Code für das Frühstück vornehmen.</span><span class="sxs-lookup"><span data-stu-id="61bfe-188">Let's make these changes to the breakfast code.</span></span> <span data-ttu-id="61bfe-189">Der erste Schritt besteht darin, die Aufgaben für Vorgänge bei deren Start zu speichern, anstatt auf sie zu warten:</span><span class="sxs-lookup"><span data-stu-id="61bfe-189">The first step is to store the tasks for operations when they start, rather than awaiting them:</span></span>

```csharp
Coffee cup = PourCoffee();
Console.WriteLine("coffee is ready");

Task<Egg> eggsTask = FryEggsAsync(2);
Egg eggs = await eggsTask;
Console.WriteLine("eggs are ready");

Task<Bacon> baconTask = FryBaconAsync(3);
Bacon bacon = await baconTask;
Console.WriteLine("bacon is ready");

Task<Toast> toastTask = ToastBreadAsync(2);
Toast toast = await toastTask;
ApplyButter(toast);
ApplyJam(toast);
Console.WriteLine("toast is ready");

Juice oj = PourOJ();
Console.WriteLine("oj is ready");
Console.WriteLine("Breakfast is ready!");
```

<span data-ttu-id="61bfe-190">Als Nächstes können Sie die `await`-Anweisungen für den Frühstücksspeck und die Eier an das Ende der Methode, vor dem Servieren des Frühstücks, verschieben:</span><span class="sxs-lookup"><span data-stu-id="61bfe-190">Next, you can move the `await` statements for the bacon and eggs to the end of the method, before serving breakfast:</span></span>

```csharp
Coffee cup = PourCoffee();
Console.WriteLine("coffee is ready");

Task<Egg> eggsTask = FryEggsAsync(2);
Task<Bacon> baconTask = FryBaconAsync(3);
Task<Toast> toastTask = ToastBreadAsync(2);

Toast toast = await toastTask;
ApplyButter(toast);
ApplyJam(toast);
Console.WriteLine("toast is ready");
Juice oj = PourOJ();
Console.WriteLine("oj is ready");

Egg eggs = await eggsTask;
Console.WriteLine("eggs are ready");
Bacon bacon = await baconTask;
Console.WriteLine("bacon is ready");

Console.WriteLine("Breakfast is ready!");
```

<span data-ttu-id="61bfe-191">Der obige Code funktioniert besser.</span><span class="sxs-lookup"><span data-stu-id="61bfe-191">The preceding code works better.</span></span> <span data-ttu-id="61bfe-192">Sie starten alle asynchronen Aufgaben gleichzeitig.</span><span class="sxs-lookup"><span data-stu-id="61bfe-192">You start all the asynchronous tasks at once.</span></span> <span data-ttu-id="61bfe-193">Sie verwenden „await“ nur für Aufgaben, wenn Sie deren Ergebnisse benötigen.</span><span class="sxs-lookup"><span data-stu-id="61bfe-193">You await each task only when you need the results.</span></span> <span data-ttu-id="61bfe-194">Der obige Code ähnelt beispielsweise Code in einer Webanwendung, die verschiedene Microservices anfordert und dann die Ergebnisse auf einer einzigen Seite zusammenfasst.</span><span class="sxs-lookup"><span data-stu-id="61bfe-194">The preceding code may be similar to code in a web application that makes requests of different microservices, then combines the results into a single page.</span></span> <span data-ttu-id="61bfe-195">Sie führen alle Anforderungen sofort aus, warten dann aber mit `await` auf alle diese Aufgaben und stellen die Webseite zusammen.</span><span class="sxs-lookup"><span data-stu-id="61bfe-195">You'll make all the requests immediately, then `await` all those tasks and compose the web page.</span></span>

## <a name="composition-with-tasks"></a><span data-ttu-id="61bfe-196">Kombination mit Aufgaben</span><span class="sxs-lookup"><span data-stu-id="61bfe-196">Composition with tasks</span></span>

 <span data-ttu-id="61bfe-197">Sie haben alles, was zum Frühstück benötigt wird, gleichzeitig fertig, mit Ausnahme des Toasts.</span><span class="sxs-lookup"><span data-stu-id="61bfe-197">You have everything ready for breakfast at the same time except the toast.</span></span> <span data-ttu-id="61bfe-198">Die Zubereitung des Toasts ist eine Kombination aus einem asynchronen Vorgang (das Toasten des Brotes) und synchronen Vorgängen (das Bestreichen mit Butter und Marmelade).</span><span class="sxs-lookup"><span data-stu-id="61bfe-198">Making the toast is the composition of an asynchronous operation (toasting the bread), and synchronous operations (adding the butter and the jam).</span></span> <span data-ttu-id="61bfe-199">Die Aktualisierung dieses Codes veranschaulicht ein wichtiges Konzept:</span><span class="sxs-lookup"><span data-stu-id="61bfe-199">Updating this code illustrates an important concept:</span></span>

> [!IMPORTANT]
> <span data-ttu-id="61bfe-200">Die Kombination aus einem asynchronen Vorgang gefolgt von einer synchronen Tätigkeit ergibt einen asynchronen Vorgang.</span><span class="sxs-lookup"><span data-stu-id="61bfe-200">The composition of an asynchronous operation followed by synchronous work is an asynchronous operation.</span></span> <span data-ttu-id="61bfe-201">Mit anderen Worten: Wenn ein Teil eines Vorgangs asynchron ist, ist der gesamte Vorgang asynchron.</span><span class="sxs-lookup"><span data-stu-id="61bfe-201">Stated another way, if any portion of an operation is asynchronous, the entire operation is asynchronous.</span></span>

<span data-ttu-id="61bfe-202">Der obige Code zeigt, dass Sie <xref:System.Threading.Tasks.Task>- oder <xref:System.Threading.Tasks.Task%601>-Objekte verwenden können, um laufende Aufgaben beizubehalten.</span><span class="sxs-lookup"><span data-stu-id="61bfe-202">The preceding code showed you that you can use <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601> objects to hold running tasks.</span></span> <span data-ttu-id="61bfe-203">Sie warten mit „`await`“ auf jede Aufgabe, bevor Sie deren Ergebnis verwenden.</span><span class="sxs-lookup"><span data-stu-id="61bfe-203">You `await` each task before using its result.</span></span> <span data-ttu-id="61bfe-204">Der nächste Schritt besteht im Erstellen von Methoden, die die Kombination anderer Tätigkeiten darstellen.</span><span class="sxs-lookup"><span data-stu-id="61bfe-204">The next step is to create methods that represent the combination of other work.</span></span> <span data-ttu-id="61bfe-205">Bevor Sie das Frühstück servieren, möchten Sie auf die Aufgabe warten, die für das Toasten des Brotes steht, bevor Sie das getoastete Brot mit Butter und Marmelade bestreichen.</span><span class="sxs-lookup"><span data-stu-id="61bfe-205">Before serving breakfast, you want to await the task that represents toasting the bread before adding butter and jam.</span></span> <span data-ttu-id="61bfe-206">Dies können Sie mit dem folgenden Code darstellen:</span><span class="sxs-lookup"><span data-stu-id="61bfe-206">You can represent that work with the following code:</span></span>

:::code language="csharp" source="snippets/index/AsyncBreakfast-V3/Program.cs" id="SnippetComposeToastTask":::

<span data-ttu-id="61bfe-207">Die obige Methode verfügt in ihrer Signatur über den Modifizierer `async`.</span><span class="sxs-lookup"><span data-stu-id="61bfe-207">The preceding method has the `async` modifier in its signature.</span></span> <span data-ttu-id="61bfe-208">Dies signalisiert dem Compiler, dass diese Methode eine `await`-Anweisung enthält. Sie enthält also asynchrone Vorgänge.</span><span class="sxs-lookup"><span data-stu-id="61bfe-208">That signals to the compiler that this method contains an `await` statement; it contains asynchronous operations.</span></span> <span data-ttu-id="61bfe-209">Diese Methode steht für die Aufgabe, bei der das Brot getoastet und dann mit Butter und Marmelade bestrichen wird.</span><span class="sxs-lookup"><span data-stu-id="61bfe-209">This method represents the task that toasts the bread, then adds butter and jam.</span></span> <span data-ttu-id="61bfe-210">Diese Methode gibt das Ergebnis <xref:System.Threading.Tasks.Task%601> aus, d. h. die Kombination dieser drei Vorgänge.</span><span class="sxs-lookup"><span data-stu-id="61bfe-210">This method returns a <xref:System.Threading.Tasks.Task%601> that represents the composition of those three operations.</span></span> <span data-ttu-id="61bfe-211">Der Hauptcodeblock sieht jetzt wie folgt aus:</span><span class="sxs-lookup"><span data-stu-id="61bfe-211">The main block of code now becomes:</span></span>

:::code language="csharp" source="snippets/index/AsyncBreakfast-V3/Program.cs" id="SnippetMain":::

<span data-ttu-id="61bfe-212">Die obige Änderung veranschaulicht eine wichtige Technik für das Arbeiten mit asynchronem Code.</span><span class="sxs-lookup"><span data-stu-id="61bfe-212">The previous change illustrated an important technique for working with asynchronous code.</span></span> <span data-ttu-id="61bfe-213">Sie erstellen Aufgaben, indem Sie die Vorgänge in eine neue Methode unterteilen, die eine Aufgabe zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="61bfe-213">You compose tasks by separating the operations into a new method that returns a task.</span></span> <span data-ttu-id="61bfe-214">Sie können entscheiden, wann auf diese Aufgabe gewartet werden soll.</span><span class="sxs-lookup"><span data-stu-id="61bfe-214">You can choose when to await that task.</span></span> <span data-ttu-id="61bfe-215">Sie können andere Aufgaben gleichzeitig starten.</span><span class="sxs-lookup"><span data-stu-id="61bfe-215">You can start other tasks concurrently.</span></span>

## <a name="await-tasks-efficiently"></a><span data-ttu-id="61bfe-216">Effizient auf Aufgaben warten</span><span class="sxs-lookup"><span data-stu-id="61bfe-216">Await tasks efficiently</span></span>

<span data-ttu-id="61bfe-217">Die Reihe der `await`-Anweisungen am Ende des obigen Codes kann mithilfe der Methoden der `Task`-Klasse verbessert werden.</span><span class="sxs-lookup"><span data-stu-id="61bfe-217">The series of `await` statements at the end of the preceding code can be improved by using methods of the `Task` class.</span></span> <span data-ttu-id="61bfe-218">Eine dieser APIs ist <xref:System.Threading.Tasks.Task.WhenAll%2A>, sie gibt eine <xref:System.Threading.Tasks.Task> zurück, die abgeschlossen wird, wenn alle Aufgaben in ihrer Argumentenliste abgeschlossen sind. Dies zeigt der folgende Code:</span><span class="sxs-lookup"><span data-stu-id="61bfe-218">One of those APIs is <xref:System.Threading.Tasks.Task.WhenAll%2A>, which returns a <xref:System.Threading.Tasks.Task> that completes when all the tasks in its argument list have completed, as shown in the following code:</span></span>

```csharp
await Task.WhenAll(eggsTask, baconTask, toastTask);
Console.WriteLine("eggs are ready");
Console.WriteLine("bacon is ready");
Console.WriteLine("toast is ready");
Console.WriteLine("Breakfast is ready!");
```

<span data-ttu-id="61bfe-219">Eine weitere Möglichkeit ist die Verwendung von <xref:System.Threading.Tasks.Task.WhenAny%2A>. Dies gibt eine `Task<Task>` zurück, die abgeschlossen wird, wenn eines ihrer Argumente abgeschlossen wird.</span><span class="sxs-lookup"><span data-stu-id="61bfe-219">Another option is to use <xref:System.Threading.Tasks.Task.WhenAny%2A>, which returns a `Task<Task>` that completes when any of its arguments completes.</span></span> <span data-ttu-id="61bfe-220">Sie können mit „await“ auf die zurückgegebene Aufgabe warten – in dem Wissen, dass sie bereits abgeschlossen ist.</span><span class="sxs-lookup"><span data-stu-id="61bfe-220">You can await the returned task, knowing that it has already finished.</span></span> <span data-ttu-id="61bfe-221">Der folgende Code zeigt, wie Sie <xref:System.Threading.Tasks.Task.WhenAny%2A> verwenden können, um mit „await“ auf den Abschluss der ersten Aufgabe zu warten und dann deren Ergebnis zu verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="61bfe-221">The following code shows how you could use <xref:System.Threading.Tasks.Task.WhenAny%2A> to await the first task to finish and then process its result.</span></span> <span data-ttu-id="61bfe-222">Nach dem Verarbeiten des Ergebnisses der abgeschlossenen Aufgabe können Sie diese abgeschlossene Aufgabe aus der Liste der an `WhenAny` übergebenen Aufgaben entfernen.</span><span class="sxs-lookup"><span data-stu-id="61bfe-222">After processing the result from the completed task, you remove that completed task from the list of tasks passed to `WhenAny`.</span></span>

```csharp
var breakfastTasks = new List<Task> { eggsTask, baconTask, toastTask };
while (breakfastTasks.Count > 0)
{
    Task finishedTask = await Task.WhenAny(breakfastTasks);
    if (finishedTask == eggsTask)
    {
        Console.WriteLine("eggs are ready");
    }
    else if (finishedTask == baconTask)
    {
        Console.WriteLine("bacon is ready");
    }
    else if (finishedTask == toastTask)
    {
        Console.WriteLine("toast is ready");
    }
    breakfastTasks.Remove(finishedTask);
}
```

<span data-ttu-id="61bfe-223">Nach allen diesen Änderungen sieht der endgültige Code folgendermaßen aus: <a id="final-version"></a></span><span class="sxs-lookup"><span data-stu-id="61bfe-223">After all those changes, the final version of the code looks like this: <a id="final-version"></a></span></span>
:::code language="csharp" source="snippets/index/AsyncBreakfast-final/Program.cs" highlight="9-40":::

<span data-ttu-id="61bfe-224">Dieser letzte Code ist asynchron.</span><span class="sxs-lookup"><span data-stu-id="61bfe-224">This final code is asynchronous.</span></span> <span data-ttu-id="61bfe-225">Er spiegelt genauer wieder, wie ein Mensch ein Frühstück zubereiten würde.</span><span class="sxs-lookup"><span data-stu-id="61bfe-225">It more accurately reflects how a person would cook a breakfast.</span></span> <span data-ttu-id="61bfe-226">Vergleichen Sie den obigen Code mit dem ersten Codebeispiel in diesem Artikel.</span><span class="sxs-lookup"><span data-stu-id="61bfe-226">Compare the preceding code with the first code sample in this article.</span></span> <span data-ttu-id="61bfe-227">Die Kernaktionen sind beim Lesen des Codes noch immer deutlich erkennbar.</span><span class="sxs-lookup"><span data-stu-id="61bfe-227">The core actions are still clear from reading the code.</span></span> <span data-ttu-id="61bfe-228">Sie können diesen Code in derselben Weise lesen wie die Anweisungen für die Zubereitung eines Frühstücks am Anfang dieses Artikels.</span><span class="sxs-lookup"><span data-stu-id="61bfe-228">You can read this code the same way you'd read those instructions for making a breakfast at the beginning of this article.</span></span> <span data-ttu-id="61bfe-229">Die Sprachfunktionen für `async` und `await` stellen die Übersetzung bereit, die jede Person vornimmt, um diese schriftlichen Anweisungen zu befolgen: Starten Sie Aufgaben, sobald Sie dies können, und blockieren Sie nicht den weiteren Fortgang, indem Sie auf den Abschluss von Aufgaben warten.</span><span class="sxs-lookup"><span data-stu-id="61bfe-229">The language features for `async` and `await` provide the translation every person makes to follow those written instructions: start tasks as you can and don't block waiting for tasks to complete.</span></span>

## <a name="next-steps"></a><span data-ttu-id="61bfe-230">Nächste Schritte</span><span class="sxs-lookup"><span data-stu-id="61bfe-230">Next steps</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="61bfe-231">Informationen zum aufgabenbasierten Programmiermodell</span><span class="sxs-lookup"><span data-stu-id="61bfe-231">Learn about the task asynchronous programming model</span></span>](task-asynchronous-programming-model.md)
