---
title: 'CA2007: nicht direkt auf eine Aufgabe warten (Code Analyse)'
description: 'Weitere Informationen zur Code Analyse Regel CA2007: nicht direkt auf eine Aufgabe warten'
ms.date: 03/08/2019
ms.topic: reference
f1_keywords:
- CA2007
- DoNotDirectlyAwaitATaskAnalyzer
helpviewer_keywords:
- CA2007
author: gewarren
ms.author: gewarren
dev_langs:
- CSharp
ms.openlocfilehash: 3a0ae8035b897562d1d50a6d006fc8937f5bb315
ms.sourcegitcommit: 636af37170ae75a11c4f7d1ecd770820e7dfe7bd
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 10/07/2020
ms.locfileid: "96591765"
---
# <a name="ca2007-do-not-directly-await-a-task"></a><span data-ttu-id="a8258-103">CA2007: Eine Aufgabe nicht direkt abwarten</span><span class="sxs-lookup"><span data-stu-id="a8258-103">CA2007: Do not directly await a Task</span></span>

| | <span data-ttu-id="a8258-104">Wert</span><span class="sxs-lookup"><span data-stu-id="a8258-104">Value</span></span> |
|-|-|
| <span data-ttu-id="a8258-105">**Regel-ID**</span><span class="sxs-lookup"><span data-stu-id="a8258-105">**Rule ID**</span></span> |<span data-ttu-id="a8258-106">CA2007</span><span class="sxs-lookup"><span data-stu-id="a8258-106">CA2007</span></span>|
| <span data-ttu-id="a8258-107">**Kategorie**</span><span class="sxs-lookup"><span data-stu-id="a8258-107">**Category**</span></span> |<span data-ttu-id="a8258-108">Microsoft.Reliability</span><span class="sxs-lookup"><span data-stu-id="a8258-108">Microsoft.Reliability</span></span>|
| <span data-ttu-id="a8258-109">**Behebung ist unterbrechend oder nicht unterbrechend**</span><span class="sxs-lookup"><span data-stu-id="a8258-109">**Fix is breaking or non-breaking**</span></span> |<span data-ttu-id="a8258-110">Nicht unterbrechend</span><span class="sxs-lookup"><span data-stu-id="a8258-110">Non-breaking</span></span>|

## <a name="cause"></a><span data-ttu-id="a8258-111">Ursache</span><span class="sxs-lookup"><span data-stu-id="a8258-111">Cause</span></span>

<span data-ttu-id="a8258-112">Eine asynchrone Methode [erwartet](../../../csharp/language-reference/operators/await.md) <xref:System.Threading.Tasks.Task> direkt ein.</span><span class="sxs-lookup"><span data-stu-id="a8258-112">An asynchronous method [awaits](../../../csharp/language-reference/operators/await.md) a <xref:System.Threading.Tasks.Task> directly.</span></span>

## <a name="rule-description"></a><span data-ttu-id="a8258-113">Regelbeschreibung</span><span class="sxs-lookup"><span data-stu-id="a8258-113">Rule description</span></span>

<span data-ttu-id="a8258-114">Wenn eine asynchrone Methode <xref:System.Threading.Tasks.Task> direkt auf einen wartet, erfolgt die Fortsetzung in der Regel in dem Thread, der die Aufgabe erstellt hat, abhängig vom asynchronen Kontext.</span><span class="sxs-lookup"><span data-stu-id="a8258-114">When an asynchronous method awaits a <xref:System.Threading.Tasks.Task> directly, continuation usually occurs in the same thread that created the task, depending on the async context.</span></span> <span data-ttu-id="a8258-115">Dieses Verhalten kann sich in Bezug auf die Leistung als kostspielig erweisen und kann zu einem Deadlock im UI-Thread führen.</span><span class="sxs-lookup"><span data-stu-id="a8258-115">This behavior can be costly in terms of performance and can result in a deadlock on the UI thread.</span></span> <span data-ttu-id="a8258-116">Rufen <xref:System.Threading.Tasks.Task.ConfigureAwait(System.Boolean)?displayProperty=nameWithType> Sie auf, um ihre Absicht für die Fortsetzung zu signalisieren.</span><span class="sxs-lookup"><span data-stu-id="a8258-116">Consider calling <xref:System.Threading.Tasks.Task.ConfigureAwait(System.Boolean)?displayProperty=nameWithType> to signal your intention for continuation.</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="a8258-117">Behandeln von Verstößen</span><span class="sxs-lookup"><span data-stu-id="a8258-117">How to fix violations</span></span>

<span data-ttu-id="a8258-118">Um Verstöße zu beheben, wenden Sie <xref:System.Threading.Tasks.Task.ConfigureAwait%2A> auf den erwarteten an <xref:System.Threading.Tasks.Task> .</span><span class="sxs-lookup"><span data-stu-id="a8258-118">To fix violations, call <xref:System.Threading.Tasks.Task.ConfigureAwait%2A> on the awaited <xref:System.Threading.Tasks.Task>.</span></span> <span data-ttu-id="a8258-119">Sie können entweder `true` oder `false` für den- `continueOnCapturedContext` Parameter übergeben.</span><span class="sxs-lookup"><span data-stu-id="a8258-119">You can pass either `true` or `false` for the `continueOnCapturedContext` parameter.</span></span>

- <span data-ttu-id="a8258-120">`ConfigureAwait(true)`Das Aufrufen von für die Aufgabe hat das gleiche Verhalten wie das explizite Aufrufen von <xref:System.Threading.Tasks.Task.ConfigureAwait%2A> .</span><span class="sxs-lookup"><span data-stu-id="a8258-120">Calling `ConfigureAwait(true)` on the task has the same behavior as not explicitly calling <xref:System.Threading.Tasks.Task.ConfigureAwait%2A>.</span></span> <span data-ttu-id="a8258-121">Wenn Sie diese Methode explizit aufrufen, können Sie den Lesern mitteilen, dass Sie absichtlich die Fortsetzung im ursprünglichen Synchronisierungs Kontext ausführen möchten.</span><span class="sxs-lookup"><span data-stu-id="a8258-121">By explicitly calling this method, you're letting readers know you intentionally want to perform the continuation on the original synchronization context.</span></span>

- <span data-ttu-id="a8258-122">Ruft `ConfigureAwait(false)` für den Task auf, um Fortsetzungen für den Thread Pool zu planen und so einen Deadlock im UI-Thread zu vermeiden.</span><span class="sxs-lookup"><span data-stu-id="a8258-122">Call `ConfigureAwait(false)` on the task to schedule continuations to the thread pool, thereby avoiding a deadlock on the UI thread.</span></span> <span data-ttu-id="a8258-123">Die Übergabe `false` ist eine gute Option für App-unabhängige Bibliotheken.</span><span class="sxs-lookup"><span data-stu-id="a8258-123">Passing `false` is a good option for app-independent libraries.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="a8258-124">Wann sollten Warnungen unterdrückt werden?</span><span class="sxs-lookup"><span data-stu-id="a8258-124">When to suppress warnings</span></span>

<span data-ttu-id="a8258-125">Diese Warnung ist für Bibliotheken gedacht, in denen der Code in beliebigen Umgebungen ausgeführt werden kann und der Code keine Annahmen über die Umgebung treffen sollte oder wie der Aufrufer der Methode ihn aufrufen oder darauf warten kann.</span><span class="sxs-lookup"><span data-stu-id="a8258-125">This warning is intended for libraries, where the code may be executed in arbitrary environments and where code shouldn't make assumptions about the environment or how the caller of the method may be invoking or waiting on it.</span></span> <span data-ttu-id="a8258-126">Es ist in der Regel angebracht, die Warnung vollständig für Projekte zu unterdrücken, die anstelle von Bibliotheks Code Anwendungscode darstellen. das Ausführen dieses Analyzers für Anwendungscode (z. b. Schaltflächen Klick-Ereignishandler in einem WinForms-oder WPF-Projekt) führt wahrscheinlich dazu, dass falsche Aktionen ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="a8258-126">It is generally appropriate to suppress the warning entirely for projects that represent application code rather than library code; in fact, running this analyzer on application code (for example, button click event handlers in a WinForms or WPF project) is likely to lead to the wrong actions being taken.</span></span>

<span data-ttu-id="a8258-127">Sie können diese Warnung in jeder Situation unterdrücken, in der entweder die Fortsetzung wieder in den ursprünglichen Kontext zurückgesetzt werden soll oder wenn kein solcher Kontext vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="a8258-127">You can suppress this warning in any situation where either the continuation should be scheduled back to the original context or where there is no such context in place.</span></span> <span data-ttu-id="a8258-128">Wenn Sie z. b. Code in einem Schaltflächen-Click-Ereignishandler in einer WinForms-oder WPF-Anwendung schreiben, sollte in der Regel die Fortsetzung von einem warte Vorgang im UI-Thread ausgeführt werden, sodass das Standardverhalten der Fortsetzung zurück zum Ursprungs Kontext wünschenswert ist.</span><span class="sxs-lookup"><span data-stu-id="a8258-128">For example, when writing code in a button click event handler in a WinForms or WPF application, in general the continuation from an await should run on the UI thread, and thus the default behavior of scheduling the continuation back to the originating context is desirable.</span></span> <span data-ttu-id="a8258-129">Ein weiteres Beispiel ist, dass beim Schreiben von Code in einer ASP.net Core Anwendung standardmäßig weder <xref:System.Threading.SynchronizationContext> noch vorhanden ist <xref:System.Threading.Tasks.TaskScheduler> . aus diesem Grund würde ein- `ConfigureAwait` Verhalten eigentlich nicht geändert werden.</span><span class="sxs-lookup"><span data-stu-id="a8258-129">As another example, when writing code in an ASP.NET Core application, by default there is no <xref:System.Threading.SynchronizationContext> or <xref:System.Threading.Tasks.TaskScheduler>, for which reason a `ConfigureAwait` wouldn't actually change any behavior.</span></span>

## <a name="example"></a><span data-ttu-id="a8258-130">Beispiel</span><span class="sxs-lookup"><span data-stu-id="a8258-130">Example</span></span>

<span data-ttu-id="a8258-131">Der folgende Code Ausschnitt generiert die Warnung:</span><span class="sxs-lookup"><span data-stu-id="a8258-131">The following code snippet generates the warning:</span></span>

```csharp
public async Task Execute()
{
    Task task = null;
    await task;
}
```

<span data-ttu-id="a8258-132">Um die Verletzung zu beheben, wenden Sie <xref:System.Threading.Tasks.Task.ConfigureAwait%2A> auf den erwarteten an <xref:System.Threading.Tasks.Task> :</span><span class="sxs-lookup"><span data-stu-id="a8258-132">To fix the violation, call <xref:System.Threading.Tasks.Task.ConfigureAwait%2A> on the awaited <xref:System.Threading.Tasks.Task>:</span></span>

```csharp
public async Task Execute()
{
    Task task = null;
    await task.ConfigureAwait(false);
}
```

## <a name="configurability"></a><span data-ttu-id="a8258-133">Konfigurierbarkeit</span><span class="sxs-lookup"><span data-stu-id="a8258-133">Configurability</span></span>

<span data-ttu-id="a8258-134">Sie können konfigurieren, ob Sie asynchrone Methoden ausschließen möchten, die keinen Wert aus dieser Regel zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="a8258-134">You can configure whether you want to exclude asynchronous methods that don't return a value from this rule.</span></span> <span data-ttu-id="a8258-135">Fügen Sie das folgende Schlüssel-Wert-Paar in eine *editorconfig* -Datei in Ihrem Projekt ein, um diese Arten von Methoden auszuschließen:</span><span class="sxs-lookup"><span data-stu-id="a8258-135">To exclude these kinds of methods, add the following key-value pair to an *.editorconfig* file in your project:</span></span>

```ini
# Package version 2.9.0 and later
dotnet_code_quality.CA2007.exclude_async_void_methods = true

# Package version 2.6.3 and earlier
dotnet_code_quality.CA2007.skip_async_void_methods = true
```

<span data-ttu-id="a8258-136">Sie können auch konfigurieren, auf welche ausgabeassemblyarten diese Regel angewendet werden soll.</span><span class="sxs-lookup"><span data-stu-id="a8258-136">You can also configure which output assembly kinds to apply this rule to.</span></span> <span data-ttu-id="a8258-137">Fügen Sie z. b. das folgende Schlüssel-Wert-Paar zu einer *Editor config* -Datei in Ihrem Projekt hinzu, um diese Regel nur auf Code anzuwenden, der eine Konsolenanwendung oder eine dynamisch verknüpfte Bibliothek erstellt (d. h. keine UI-APP):</span><span class="sxs-lookup"><span data-stu-id="a8258-137">For example, to only apply this rule to code that produces a console application or a dynamically linked library (that is, not a UI app), add the following key-value pair to an *.editorconfig* file in your project:</span></span>

```ini
dotnet_code_quality.CA2007.output_kind = ConsoleApplication, DynamicallyLinkedLibrary
```

<span data-ttu-id="a8258-138">Weitere Informationen finden Sie unter [Konfigurationsoptionen für die Code Qualitäts Regel](../code-quality-rule-options.md).</span><span class="sxs-lookup"><span data-stu-id="a8258-138">For more information, see [Code quality rule configuration options](../code-quality-rule-options.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="a8258-139">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="a8258-139">See also</span></span>

- [<span data-ttu-id="a8258-140">Häufig gestellte Fragen zur Konfiguration</span><span class="sxs-lookup"><span data-stu-id="a8258-140">ConfigureAwait FAQ</span></span>](https://devblogs.microsoft.com/dotnet/configureawait-faq/)
- [<span data-ttu-id="a8258-141">Sollte ich auf eine Aufgabe mit "Konfigurieren" (falsch) warten?</span><span class="sxs-lookup"><span data-stu-id="a8258-141">Should I await a task with ConfigureAwait(false)?</span></span>](https://github.com/Microsoft/vs-threading/blob/master/doc/cookbook_vs.md#should-i-await-a-task-with-configureawaitfalse)
- [<span data-ttu-id="a8258-142">CA2008: Keine Tasks ohne Übergabe eines TaskSchedulers erstellen</span><span class="sxs-lookup"><span data-stu-id="a8258-142">CA2008: Do not create tasks without passing a TaskScheduler</span></span>](ca2008.md)
- [<span data-ttu-id="a8258-143">Zuverlässigkeitsregeln</span><span class="sxs-lookup"><span data-stu-id="a8258-143">Reliability rules</span></span>](reliability-warnings.md)
