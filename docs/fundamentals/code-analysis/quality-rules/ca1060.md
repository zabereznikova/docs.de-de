---
title: 'CA1060: Move P-ruft in die NativeMethods-Klasse auf (Code Analyse)'
description: 'Weitere Informationen zur Code Analyse Regel CA1060: Verschieben von P-aufrufen in die NativeMethods-Klasse'
ms.date: 11/04/2016
ms.topic: reference
f1_keywords:
- MovePInvokesToNativeMethodsClass
- CA1060
helpviewer_keywords:
- MovePInvokesToNativeMethodsClass
- CA1060
author: gewarren
ms.author: gewarren
dev_langs:
- CSharp
- VB
ms.openlocfilehash: bc96c1b2d463a95ff5c5f61fc4642411cc6bca3b
ms.sourcegitcommit: a6bd4cad438fe479cbd112eae10f2cd449f06e40
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 10/08/2020
ms.locfileid: "96591838"
---
# <a name="ca1060-move-pinvokes-to-nativemethods-class"></a><span data-ttu-id="82a85-103">CA1060: P/Invokes in NativeMethods-Klasse verschieben</span><span class="sxs-lookup"><span data-stu-id="82a85-103">CA1060: Move P/Invokes to NativeMethods class</span></span>

| | <span data-ttu-id="82a85-104">Wert</span><span class="sxs-lookup"><span data-stu-id="82a85-104">Value</span></span> |
|-|-|
| <span data-ttu-id="82a85-105">**Regel-ID**</span><span class="sxs-lookup"><span data-stu-id="82a85-105">**Rule ID**</span></span> |<span data-ttu-id="82a85-106">CA1060</span><span class="sxs-lookup"><span data-stu-id="82a85-106">CA1060</span></span>|
| <span data-ttu-id="82a85-107">**Kategorie**</span><span class="sxs-lookup"><span data-stu-id="82a85-107">**Category**</span></span> |<span data-ttu-id="82a85-108">Microsoft. Design</span><span class="sxs-lookup"><span data-stu-id="82a85-108">Microsoft.Design</span></span>|
| <span data-ttu-id="82a85-109">**Behebung ist unterbrechend oder nicht unterbrechend**</span><span class="sxs-lookup"><span data-stu-id="82a85-109">**Fix is breaking or non-breaking**</span></span> |<span data-ttu-id="82a85-110">Breaking</span><span class="sxs-lookup"><span data-stu-id="82a85-110">Breaking</span></span>|

## <a name="cause"></a><span data-ttu-id="82a85-111">Ursache</span><span class="sxs-lookup"><span data-stu-id="82a85-111">Cause</span></span>

<span data-ttu-id="82a85-112">Eine Methode verwendet Platt Form Aufruf Dienste für den Zugriff auf nicht verwalteten Code und ist nicht Mitglied einer der **NativeMethods** -Klassen.</span><span class="sxs-lookup"><span data-stu-id="82a85-112">A method uses Platform Invocation Services to access unmanaged code and is not a member of one of the **NativeMethods** classes.</span></span>

## <a name="rule-description"></a><span data-ttu-id="82a85-113">Regelbeschreibung</span><span class="sxs-lookup"><span data-stu-id="82a85-113">Rule description</span></span>

<span data-ttu-id="82a85-114">Platt Form Aufruf Methoden, z. b. solche, die mit dem-Attribut markiert sind <xref:System.Runtime.InteropServices.DllImportAttribute?displayProperty=fullName> , oder Methoden, die mit dem- `Declare` Schlüsselwort in Visual Basic definiert werden, greifen auf nicht verwalteten Code zu.</span><span class="sxs-lookup"><span data-stu-id="82a85-114">Platform Invocation methods, such as those that are marked by using the <xref:System.Runtime.InteropServices.DllImportAttribute?displayProperty=fullName> attribute, or methods that are defined by using the `Declare` keyword in Visual Basic, access unmanaged code.</span></span> <span data-ttu-id="82a85-115">Diese Methoden sollten einer der folgenden Klassen unterliegen:</span><span class="sxs-lookup"><span data-stu-id="82a85-115">These methods should be in one of the following classes:</span></span>

- <span data-ttu-id="82a85-116">**NativeMethods** : Diese Klasse unterdrückt keine Stapel Spaziergänge für die Berechtigung "nicht verwalteter Code".</span><span class="sxs-lookup"><span data-stu-id="82a85-116">**NativeMethods** - This class does not suppress stack walks for unmanaged code permission.</span></span> <span data-ttu-id="82a85-117">( <xref:System.Security.SuppressUnmanagedCodeSecurityAttribute?displayProperty=fullName> darf nicht auf diese Klasse angewendet werden.) Diese Klasse eignet sich für Methoden, die überall verwendet werden können, da ein Stackwalk ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="82a85-117">(<xref:System.Security.SuppressUnmanagedCodeSecurityAttribute?displayProperty=fullName> must not be applied to this class.) This class is for methods that can be used anywhere because a stack walk will be performed.</span></span>

- <span data-ttu-id="82a85-118">**Safsativemethods** : Diese Klasse unterdrückt Stapel Spaziergänge für die Berechtigung für nicht verwalteten Code.</span><span class="sxs-lookup"><span data-stu-id="82a85-118">**SafeNativeMethods** - This class suppresses stack walks for unmanaged code permission.</span></span> <span data-ttu-id="82a85-119">( <xref:System.Security.SuppressUnmanagedCodeSecurityAttribute?displayProperty=fullName> wird auf diese Klasse angewendet.) Diese Klasse eignet sich für Methoden, die für jeden aufzurufenden Benutzer sicher sind.</span><span class="sxs-lookup"><span data-stu-id="82a85-119">(<xref:System.Security.SuppressUnmanagedCodeSecurityAttribute?displayProperty=fullName> is applied to this class.) This class is for methods that are safe for anyone to call.</span></span> <span data-ttu-id="82a85-120">Aufrufer dieser Methoden müssen keine vollständige Sicherheitsüberprüfung durchführen, um sicherzustellen, dass die Verwendung sicher ist, da die Methoden für jeden Aufrufer harmlos sind.</span><span class="sxs-lookup"><span data-stu-id="82a85-120">Callers of these methods are not required to perform a full security review to make sure that the usage is secure because the methods are harmless for any caller.</span></span>

- <span data-ttu-id="82a85-121">**Unsaftenativemethods** : Diese Klasse unterdrückt Stapel Spaziergänge für die Berechtigung für nicht verwalteten Code.</span><span class="sxs-lookup"><span data-stu-id="82a85-121">**UnsafeNativeMethods** - This class suppresses stack walks for unmanaged code permission.</span></span> <span data-ttu-id="82a85-122">( <xref:System.Security.SuppressUnmanagedCodeSecurityAttribute?displayProperty=fullName> wird auf diese Klasse angewendet.) Diese Klasse ist für Methoden, die potenziell gefährlich sind.</span><span class="sxs-lookup"><span data-stu-id="82a85-122">(<xref:System.Security.SuppressUnmanagedCodeSecurityAttribute?displayProperty=fullName> is applied to this class.) This class is for methods that are potentially dangerous.</span></span> <span data-ttu-id="82a85-123">Alle Aufrufer dieser Methoden müssen eine vollständige Sicherheitsüberprüfung durchführen, um sicherzustellen, dass die Nutzung sicher ist, da keine Stapelausführung durchgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="82a85-123">Any caller of these methods must perform a full security review to make sure that the usage is secure because no stack walk will be performed.</span></span>

<span data-ttu-id="82a85-124">Diese Klassen werden als `internal` ( `Friend` in Visual Basic) deklariert und deklarieren einen privaten Konstruktor, um zu verhindern, dass neue Instanzen erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="82a85-124">These classes are declared as `internal` (`Friend` in Visual Basic) and declare a private constructor to prevent new instances from being created.</span></span> <span data-ttu-id="82a85-125">Die Methoden in diesen Klassen sollten `static` und `internal` ( `Shared` und `Friend` in Visual Basic) sein.</span><span class="sxs-lookup"><span data-stu-id="82a85-125">The methods in these classes should be `static` and `internal` (`Shared` and `Friend` in Visual Basic).</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="82a85-126">Behandeln von Verstößen</span><span class="sxs-lookup"><span data-stu-id="82a85-126">How to fix violations</span></span>

<span data-ttu-id="82a85-127">Um einen Verstoß gegen diese Regel zu beheben, verschieben Sie die Methode in die entsprechende **NativeMethods** -Klasse.</span><span class="sxs-lookup"><span data-stu-id="82a85-127">To fix a violation of this rule, move the method to the appropriate **NativeMethods** class.</span></span> <span data-ttu-id="82a85-128">Bei den meisten Anwendungen ist das Verschieben von P/aufrufen in eine neue Klasse mit dem Namen **NativeMethods** ausreichend.</span><span class="sxs-lookup"><span data-stu-id="82a85-128">For most applications, moving P/Invokes to a new class that is named **NativeMethods** is enough.</span></span>

<span data-ttu-id="82a85-129">Wenn Sie jedoch Bibliotheken für die Verwendung in anderen Anwendungen entwickeln, sollten Sie zwei andere Klassen definieren, die als **SafeNativeMethods** und **UnsafeNativeMethods** bezeichnet werden.</span><span class="sxs-lookup"><span data-stu-id="82a85-129">However, if you are developing libraries for use in other applications, you should consider defining two other classes that are called **SafeNativeMethods** and **UnsafeNativeMethods**.</span></span> <span data-ttu-id="82a85-130">Diese Klassen ähneln der **NativeMethods** -Klasse. Sie werden jedoch mit einem speziellen Attribut namens **SuppressUnmanagedCodeSecurityAttribute** markiert.</span><span class="sxs-lookup"><span data-stu-id="82a85-130">These classes resemble the **NativeMethods** class; however, they are marked by using a special attribute called **SuppressUnmanagedCodeSecurityAttribute**.</span></span> <span data-ttu-id="82a85-131">Wenn dieses Attribut angewendet wird, führt die Laufzeit keinen vollständigen Stapel Durchlauf aus, um sicherzustellen, dass alle Aufrufer über die **UnmanagedCode** -Berechtigung verfügen.</span><span class="sxs-lookup"><span data-stu-id="82a85-131">When this attribute is applied, the runtime does not perform a full stack walk to make sure that all callers have the **UnmanagedCode** permission.</span></span> <span data-ttu-id="82a85-132">Die Laufzeit prüft diese Berechtigung normalerweise beim Start.</span><span class="sxs-lookup"><span data-stu-id="82a85-132">The runtime ordinarily checks for this permission at startup.</span></span> <span data-ttu-id="82a85-133">Da die Überprüfung nicht durchgeführt wird, kann Sie die Leistung für Aufrufe dieser nicht verwalteten Methoden erheblich verbessern. Sie ermöglicht auch Code mit eingeschränkten Berechtigungen zum Aufrufen dieser Methoden.</span><span class="sxs-lookup"><span data-stu-id="82a85-133">Because the check is not performed, it can greatly improve performance for calls to these unmanaged methods, It also enables code that has limited permissions to call these methods.</span></span>

<span data-ttu-id="82a85-134">Sie sollten dieses Attribut jedoch sehr sorgfältig verwenden.</span><span class="sxs-lookup"><span data-stu-id="82a85-134">However, you should use this attribute with great care.</span></span> <span data-ttu-id="82a85-135">Dies kann schwerwiegende Auswirkungen auf die Sicherheit haben, wenn es nicht ordnungsgemäß implementiert wird.</span><span class="sxs-lookup"><span data-stu-id="82a85-135">It can have serious security implications if it is implemented incorrectly..</span></span>

<span data-ttu-id="82a85-136">Weitere Informationen zum Implementieren der Methoden finden Sie in den Beispielen für **NativeMethods** , **SafeNativeMethods** und **UnsafeNativeMethods** .</span><span class="sxs-lookup"><span data-stu-id="82a85-136">For information about how to implement the methods, see the **NativeMethods** example, **SafeNativeMethods** example, and **UnsafeNativeMethods** example.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="82a85-137">Wann sollten Warnungen unterdrückt werden?</span><span class="sxs-lookup"><span data-stu-id="82a85-137">When to suppress warnings</span></span>

<span data-ttu-id="82a85-138">Unterdrücken Sie keine Warnung dieser Regel.</span><span class="sxs-lookup"><span data-stu-id="82a85-138">Do not suppress a warning from this rule.</span></span>

## <a name="example"></a><span data-ttu-id="82a85-139">Beispiel</span><span class="sxs-lookup"><span data-stu-id="82a85-139">Example</span></span>

<span data-ttu-id="82a85-140">Im folgenden Beispiel wird eine Methode deklariert, die gegen diese Regel verstößt.</span><span class="sxs-lookup"><span data-stu-id="82a85-140">The following example declares a method that violates this rule.</span></span> <span data-ttu-id="82a85-141">Um die Verletzung zu beheben, sollte das **RemoveDirectory** -P/-aufrufen in eine geeignete Klasse verschoben werden, die nur P/Aufrufe enthalten soll.</span><span class="sxs-lookup"><span data-stu-id="82a85-141">To correct the violation, the **RemoveDirectory** P/Invoke should be moved to an appropriate class that is designed to hold only P/Invokes.</span></span>

:::code language="vb" source="snippets/vb/all-rules/ca1060-move-p-invokes-to-nativemethods-class_1.vb" id="snippet1":::

:::code language="csharp" source="snippets/csharp/all-rules/ca1060.cs" id="snippet1":::

## <a name="nativemethods-example"></a><span data-ttu-id="82a85-142">NativeMethods-Beispiel</span><span class="sxs-lookup"><span data-stu-id="82a85-142">NativeMethods example</span></span>

<span data-ttu-id="82a85-143">Da die **NativeMethods** -Klasse nicht mithilfe von **SuppressUnmanagedCodeSecurityAttribute** gekennzeichnet werden sollte, benötigen Sie die **UnmanagedCode** -Berechtigung.</span><span class="sxs-lookup"><span data-stu-id="82a85-143">Because the **NativeMethods** class should not be marked by using **SuppressUnmanagedCodeSecurityAttribute**, P/Invokes that are put in it will require **UnmanagedCode** permission.</span></span> <span data-ttu-id="82a85-144">Da die meisten Anwendungen auf dem lokalen Computer ausgeführt werden und mit voller Vertrauenswürdigkeit ausgeführt werden, ist dies in der Regel kein Problem.</span><span class="sxs-lookup"><span data-stu-id="82a85-144">Because most applications run from the local computer and run together with full trust, this is usually not a problem.</span></span> <span data-ttu-id="82a85-145">Wenn Sie jedoch wiederverwendbare Bibliotheken entwickeln, sollten Sie die Definition einer **safeativemethods** -Klasse oder einer **unsafsativemethods** -Klasse in Erwägung gezogen.</span><span class="sxs-lookup"><span data-stu-id="82a85-145">However, if you are developing reusable libraries, you should consider defining a **SafeNativeMethods** or **UnsafeNativeMethods** class.</span></span>

<span data-ttu-id="82a85-146">Das folgende Beispiel zeigt eine **Interaktion. Beep** -Methode, die die **MessageBeep** -Funktion von user32.dll umschließt.</span><span class="sxs-lookup"><span data-stu-id="82a85-146">The following example shows an **Interaction.Beep** method that wraps the **MessageBeep** function from user32.dll.</span></span> <span data-ttu-id="82a85-147">Der **MessageBeep** -P/-Aufruf wird in die **NativeMethods** -Klasse eingefügt.</span><span class="sxs-lookup"><span data-stu-id="82a85-147">The **MessageBeep** P/Invoke is put in the **NativeMethods** class.</span></span>

:::code language="vb" source="snippets/vb/all-rules/ca1060-move-p-invokes-to-nativemethods-class_1.vb" id="snippet2":::

:::code language="csharp" source="snippets/csharp/all-rules/ca1060.cs" id="snippet2":::

## <a name="safenativemethods-example"></a><span data-ttu-id="82a85-148">Safumativemethods-Beispiel</span><span class="sxs-lookup"><span data-stu-id="82a85-148">SafeNativeMethods example</span></span>

<span data-ttu-id="82a85-149">P/Aufrufen von Methoden, die auf sichere Weise für jede Anwendung verfügbar gemacht werden können und die keine Nebeneffekte haben, sollten in einer Klasse mit dem Namen **SafeNativeMethods** abgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="82a85-149">P/Invoke methods that can be safely exposed to any application and that do not have any side effects should be put in a class that is named **SafeNativeMethods**.</span></span> <span data-ttu-id="82a85-150">Sie müssen keine Berechtigungen anfordern, und Sie müssen nicht mehr darauf achten, wo Sie von aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="82a85-150">You do not have to demand permissions and you do not have to pay much attention to where they are called from.</span></span>

<span data-ttu-id="82a85-151">Das folgende Beispiel zeigt eine **Environment. TickCount** -Eigenschaft, die die **GetTickCount** -Funktion von kernel32.dll umschließt.</span><span class="sxs-lookup"><span data-stu-id="82a85-151">The following example shows an **Environment.TickCount** property that wraps the **GetTickCount** function from kernel32.dll.</span></span>

:::code language="vb" source="snippets/vb/all-rules/ca1060-move-p-invokes-to-nativemethods-class_1.vb" id="snippet3":::

:::code language="csharp" source="snippets/csharp/all-rules/ca1060.cs" id="snippet3":::

## <a name="unsafenativemethods-example"></a><span data-ttu-id="82a85-152">Unsafumativemethods-Beispiel</span><span class="sxs-lookup"><span data-stu-id="82a85-152">UnsafeNativeMethods example</span></span>

<span data-ttu-id="82a85-153">P/Aufrufen von Methoden, die nicht sicher aufgerufen werden können und die Nebeneffekte verursachen könnten, sollten in einer Klasse mit dem Namen **unsafdenativemethods** abgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="82a85-153">P/Invoke methods that cannot be safely called and that could cause side effects should be put in a class that is named **UnsafeNativeMethods**.</span></span> <span data-ttu-id="82a85-154">Diese Methoden sollten streng geprüft werden, um sicherzustellen, dass Sie nicht versehentlich für den Benutzer verfügbar gemacht werden.</span><span class="sxs-lookup"><span data-stu-id="82a85-154">These methods should be rigorously checked to make sure that they are not exposed to the user unintentionally.</span></span> <span data-ttu-id="82a85-155">Alternativ dazu sollten die Methoden eine andere Berechtigung aufweisen, die anstelle von **UnmanagedCode** angefordert wird, wenn Sie Sie verwenden.</span><span class="sxs-lookup"><span data-stu-id="82a85-155">Alternatively, the methods should have another permission that is demanded instead of **UnmanagedCode** when they use them.</span></span>

<span data-ttu-id="82a85-156">Das folgende Beispiel zeigt eine **Cursor. Hide** -Methode, die die **ShowCursor** -Funktion von user32.dll umschließt.</span><span class="sxs-lookup"><span data-stu-id="82a85-156">The following example shows a **Cursor.Hide** method that wraps the **ShowCursor** function from user32.dll.</span></span>

:::code language="vb" source="snippets/vb/all-rules/ca1060-move-p-invokes-to-nativemethods-class_1.vb" id="snippet4":::

:::code language="csharp" source="snippets/csharp/all-rules/ca1060.cs" id="snippet4":::

## <a name="see-also"></a><span data-ttu-id="82a85-157">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="82a85-157">See also</span></span>

- [<span data-ttu-id="82a85-158">Entwurfsregeln</span><span class="sxs-lookup"><span data-stu-id="82a85-158">Design rules</span></span>](design-warnings.md)
