---
title: 'CA2000: Objekte vor dem Verlust des Bereichs verwerfen (Code Analyse)'
description: 'Weitere Informationen zur Code Analyse Regel CA2000: Verwerfen von Objekten vor dem Verlust des Bereichs'
ms.date: 05/14/2019
ms.topic: reference
f1_keywords:
- CA2000
- Dispose objects before losing scope
- DisposeObjectsBeforeLosingScope
helpviewer_keywords:
- CA2000
- DisposeObjectsBeforeLosingScope
author: gewarren
ms.author: gewarren
dev_langs:
- CSharp
- VB
ms.openlocfilehash: ef29091e9d78dd51abd539d3f185434a71b57138
ms.sourcegitcommit: e301979e3049ce412d19b094c60ed95b316a8f8c
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 12/16/2020
ms.locfileid: "97593785"
---
# <a name="ca2000-dispose-objects-before-losing-scope"></a><span data-ttu-id="c0535-103">CA2000: Objekte verwerfen, bevor Bereich verloren geht.</span><span class="sxs-lookup"><span data-stu-id="c0535-103">CA2000: Dispose objects before losing scope</span></span>

| | <span data-ttu-id="c0535-104">Wert</span><span class="sxs-lookup"><span data-stu-id="c0535-104">Value</span></span> |
|-|-|
| <span data-ttu-id="c0535-105">**Regel-ID**</span><span class="sxs-lookup"><span data-stu-id="c0535-105">**Rule ID**</span></span> |<span data-ttu-id="c0535-106">CA2000</span><span class="sxs-lookup"><span data-stu-id="c0535-106">CA2000</span></span>|
| <span data-ttu-id="c0535-107">**Kategorie**</span><span class="sxs-lookup"><span data-stu-id="c0535-107">**Category**</span></span> |<span data-ttu-id="c0535-108">Microsoft.Reliability</span><span class="sxs-lookup"><span data-stu-id="c0535-108">Microsoft.Reliability</span></span>|
| <span data-ttu-id="c0535-109">**Behebung ist unterbrechend oder nicht unterbrechend**</span><span class="sxs-lookup"><span data-stu-id="c0535-109">**Fix is breaking or non-breaking**</span></span> |<span data-ttu-id="c0535-110">Nicht unterbrechend</span><span class="sxs-lookup"><span data-stu-id="c0535-110">Non-breaking</span></span>|

## <a name="cause"></a><span data-ttu-id="c0535-111">Ursache</span><span class="sxs-lookup"><span data-stu-id="c0535-111">Cause</span></span>

<span data-ttu-id="c0535-112">Ein lokales Objekt eines <xref:System.IDisposable> Typs wird erstellt, aber das Objekt wird nicht verworfen, bevor alle Verweise auf das Objekt außerhalb des Gültigkeits Bereichs liegen.</span><span class="sxs-lookup"><span data-stu-id="c0535-112">A local object of an <xref:System.IDisposable> type is created, but the object is not disposed before all references to the object are out of scope.</span></span>

<span data-ttu-id="c0535-113">Standardmäßig analysiert diese Regel die gesamte CodeBase, aber dies ist [konfigurierbar](#configure-code-to-analyze).</span><span class="sxs-lookup"><span data-stu-id="c0535-113">By default, this rule analyzes the entire codebase, but this is [configurable](#configure-code-to-analyze).</span></span>

## <a name="rule-description"></a><span data-ttu-id="c0535-114">Regelbeschreibung</span><span class="sxs-lookup"><span data-stu-id="c0535-114">Rule description</span></span>

<span data-ttu-id="c0535-115">Wenn ein verwerfbares Objekt nicht explizit verworfen wird, bevor alle Verweise darauf außerhalb des gültigen Bereichs liegen, wird das Objekt zu einer unbestimmten Zeit verworfen, wenn der Garbage Collector den Finalizer des Objekts ausführt.</span><span class="sxs-lookup"><span data-stu-id="c0535-115">If a disposable object is not explicitly disposed before all references to it are out of scope, the object will be disposed at some indeterminate time when the garbage collector runs the finalizer of the object.</span></span> <span data-ttu-id="c0535-116">Da möglicherweise ein Ausnahmeereignis auftritt, durch das die Ausführung des Finalizers des Objekts verhindert wird, muss das Objekt stattdessen explizit verworfen werden.</span><span class="sxs-lookup"><span data-stu-id="c0535-116">Because an exceptional event might occur that will prevent the finalizer of the object from running, the object should be explicitly disposed instead.</span></span>

## <a name="special-cases"></a><span data-ttu-id="c0535-117">Spezialfälle</span><span class="sxs-lookup"><span data-stu-id="c0535-117">Special cases</span></span>

<span data-ttu-id="c0535-118">Die Regel CA2000 wird nicht für lokale Objekte der folgenden Typen ausgelöst, auch wenn das Objekt nicht verworfen wird:</span><span class="sxs-lookup"><span data-stu-id="c0535-118">Rule CA2000 does not fire for local objects of the following types even if the object is not disposed:</span></span>

- <xref:System.IO.Stream?displayProperty=nameWithType>
- <xref:System.IO.StringReader?displayProperty=nameWithType>
- <xref:System.IO.TextReader?displayProperty=nameWithType>
- <xref:System.IO.TextWriter?displayProperty=nameWithType>
- <xref:System.Resources.IResourceReader?displayProperty=nameWithType>

<span data-ttu-id="c0535-119">Wenn Sie ein Objekt eines dieser Typen an einen Konstruktor übergeben und dann einem Feld zuweisen, wird eine Freigabe *Besitz Übertragung* an den neu erstellten Typ angegeben.</span><span class="sxs-lookup"><span data-stu-id="c0535-119">Passing an object of one of these types to a constructor and then assigning it to a field indicates a *dispose ownership transfer* to the newly constructed type.</span></span> <span data-ttu-id="c0535-120">Das heißt, der neu konstruierte Typ ist nun für das Freigeben des Objekts verantwortlich.</span><span class="sxs-lookup"><span data-stu-id="c0535-120">That is, the newly constructed type is now responsible for disposing of the object.</span></span> <span data-ttu-id="c0535-121">Wenn Ihr Code ein Objekt von einem dieser Typen an einen Konstruktor übergibt, tritt kein Verstoß gegen die Regel CA2000 auf, auch wenn das Objekt nicht verworfen wird, bevor alle Verweise darauf außerhalb des gültigen Bereichs liegen.</span><span class="sxs-lookup"><span data-stu-id="c0535-121">If your code passes an object of one of these types to a constructor, no violation of rule CA2000 occurs even if the object is not disposed before all references to it are out of scope.</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="c0535-122">Behandeln von Verstößen</span><span class="sxs-lookup"><span data-stu-id="c0535-122">How to fix violations</span></span>

<span data-ttu-id="c0535-123">Um einen Verstoß gegen diese Regel zu beheben, rufen Sie <xref:System.IDisposable.Dispose%2A> für das Objekt auf, bevor sich alle Verweise darauf außerhalb des gültigen Bereichs befinden.</span><span class="sxs-lookup"><span data-stu-id="c0535-123">To fix a violation of this rule, call <xref:System.IDisposable.Dispose%2A> on the object before all references to it are out of scope.</span></span>

<span data-ttu-id="c0535-124">Sie können die- [ `using` Anweisung](../../../csharp/language-reference/keywords/using-statement.md) ( [`Using`](../../../visual-basic/language-reference/statements/using-statement.md) in Visual Basic) verwenden, um Objekte zu umschließen, die implementieren <xref:System.IDisposable> .</span><span class="sxs-lookup"><span data-stu-id="c0535-124">You can use the [`using` statement](../../../csharp/language-reference/keywords/using-statement.md) ([`Using`](../../../visual-basic/language-reference/statements/using-statement.md) in Visual Basic) to wrap objects that implement <xref:System.IDisposable>.</span></span> <span data-ttu-id="c0535-125">Objekte, die auf diese Weise umschließt werden, werden am Ende des- `using` Blocks automatisch verworfen.</span><span class="sxs-lookup"><span data-stu-id="c0535-125">Objects that are wrapped in this manner are automatically disposed at the end of the `using` block.</span></span> <span data-ttu-id="c0535-126">Die folgenden Situationen dürfen jedoch nicht mit einer-Anweisung behandelt werden `using` :</span><span class="sxs-lookup"><span data-stu-id="c0535-126">However, the following situations should not or cannot be handled with a `using` statement:</span></span>

- <span data-ttu-id="c0535-127">Um ein verwerfbares Objekt zurückzugeben, muss das-Objekt in einem-Block außerhalb eines-Blocks erstellt werden `try/finally` `using` .</span><span class="sxs-lookup"><span data-stu-id="c0535-127">To return a disposable object, the object must constructed in a `try/finally` block outside of a `using` block.</span></span>

- <span data-ttu-id="c0535-128">Initialisieren Sie Member eines verwerfbaren Objekts nicht im Konstruktor einer- `using` Anweisung.</span><span class="sxs-lookup"><span data-stu-id="c0535-128">Do not initialize members of a disposable object in the constructor of a `using` statement.</span></span>

- <span data-ttu-id="c0535-129">Wenn Konstruktoren, die nur durch einen Ausnahmehandler geschützt sind, im [Erwerbs Teil einer- `using` Anweisung](../../../csharp/language-reference/keywords/using-statement.md)geschnigt werden, kann ein Fehler im äußeren Konstruktor dazu führen, dass das Objekt, das vom geschsted-Konstruktor erstellt wurde, nie geschlossen wird.</span><span class="sxs-lookup"><span data-stu-id="c0535-129">When constructors that are protected by only one exception handler are nested in the [acquisition part of a `using` statement](../../../csharp/language-reference/keywords/using-statement.md), a failure in the outer constructor can result in the object created by the nested constructor never being closed.</span></span> <span data-ttu-id="c0535-130">Im folgenden Beispiel kann ein Fehler im <xref:System.IO.StreamReader> Konstruktor dazu führen, <xref:System.IO.FileStream> dass das Objekt nie geschlossen wird.</span><span class="sxs-lookup"><span data-stu-id="c0535-130">In the following example, a failure in the <xref:System.IO.StreamReader> constructor can result in the <xref:System.IO.FileStream> object never being closed.</span></span> <span data-ttu-id="c0535-131">CA2000 markiert in diesem Fall einen Verstoß gegen die Regel.</span><span class="sxs-lookup"><span data-stu-id="c0535-131">CA2000 flags a violation of the rule in this case.</span></span>

   ```csharp
   using (StreamReader sr = new StreamReader(new FileStream("C:\myfile.txt", FileMode.Create)))
   { ... }
   ```

- <span data-ttu-id="c0535-132">Dynamische Objekte sollten ein Shadow-Objekt verwenden, um das Lösch Muster von Objekten zu implementieren <xref:System.IDisposable> .</span><span class="sxs-lookup"><span data-stu-id="c0535-132">Dynamic objects should use a shadow object to implement the dispose pattern of <xref:System.IDisposable> objects.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="c0535-133">Wann sollten Warnungen unterdrückt werden?</span><span class="sxs-lookup"><span data-stu-id="c0535-133">When to suppress warnings</span></span>

<span data-ttu-id="c0535-134">Unterdrücken Sie eine Warnung dieser Regel nur, wenn Folgendes gilt:</span><span class="sxs-lookup"><span data-stu-id="c0535-134">Do not suppress a warning from this rule unless:</span></span>

- <span data-ttu-id="c0535-135">Sie haben eine Methode für das Objekt aufgerufen, das aufruft, z. b. `Dispose`<xref:System.IO.Stream.Close%2A></span><span class="sxs-lookup"><span data-stu-id="c0535-135">You've called a method on your object that calls `Dispose`, such as <xref:System.IO.Stream.Close%2A></span></span>
- <span data-ttu-id="c0535-136">Die Methode, die die Warnung ausgelöst hat, gibt ein <xref:System.IDisposable> Objekt zurück, das das Objekt umschließt</span><span class="sxs-lookup"><span data-stu-id="c0535-136">The method that raised the warning returns an <xref:System.IDisposable> object that wraps your object</span></span>
- <span data-ttu-id="c0535-137">Die Zuweisungs Methode hat keinen Freigabe Besitz. Das heißt, die Verantwortung für das Verwerfen des Objekts wird an ein anderes Objekt oder einen Wrapper übertragen, das in der-Methode erstellt und an den Aufrufer zurückgegeben wird</span><span class="sxs-lookup"><span data-stu-id="c0535-137">The allocating method does not have dispose ownership; that is, the responsibility to dispose the object is transferred to another object or wrapper that's created in the method and returned to the caller</span></span>

## <a name="configure-code-to-analyze"></a><span data-ttu-id="c0535-138">Konfigurieren des zu analysierenden Codes</span><span class="sxs-lookup"><span data-stu-id="c0535-138">Configure code to analyze</span></span>

<span data-ttu-id="c0535-139">Verwenden Sie die folgenden Optionen, um zu konfigurieren, für welche Teile Ihrer Codebasis diese Regel ausgeführt werden soll.</span><span class="sxs-lookup"><span data-stu-id="c0535-139">Use the following options to configure which parts of your codebase to run this rule on.</span></span>

- [<span data-ttu-id="c0535-140">Bestimmte Symbole ausschließen</span><span class="sxs-lookup"><span data-stu-id="c0535-140">Exclude specific symbols</span></span>](#exclude-specific-symbols)
- [<span data-ttu-id="c0535-141">Bestimmte Typen und deren abgeleitete Typen ausschließen</span><span class="sxs-lookup"><span data-stu-id="c0535-141">Exclude specific types and their derived types</span></span>](#exclude-specific-types-and-their-derived-types)

<span data-ttu-id="c0535-142">Diese Optionen können nur für diese Regel, für alle Regeln oder für alle Regeln in dieser Kategorie (Zuverlässigkeit) konfiguriert werden.</span><span class="sxs-lookup"><span data-stu-id="c0535-142">You can configure these options for just this rule, for all rules, or for all rules in this category (Reliability).</span></span> <span data-ttu-id="c0535-143">Weitere Informationen finden Sie unter [Konfigurationsoptionen für die Code Qualitäts Regel](../code-quality-rule-options.md).</span><span class="sxs-lookup"><span data-stu-id="c0535-143">For more information, see [Code quality rule configuration options](../code-quality-rule-options.md).</span></span>

[!INCLUDE[excluded-symbol-names](~/includes/code-analysis/excluded-symbol-names.md)]

[!INCLUDE[excluded-type-names-with-derived-types](~/includes/code-analysis/excluded-type-names-with-derived-types.md)]

## <a name="related-rules"></a><span data-ttu-id="c0535-144">Verwandte Regeln</span><span class="sxs-lookup"><span data-stu-id="c0535-144">Related rules</span></span>

- [<span data-ttu-id="c0535-145">CA2213: Verwerfbare Felder verwerfen.</span><span class="sxs-lookup"><span data-stu-id="c0535-145">CA2213: Disposable fields should be disposed</span></span>](ca2213.md)

## <a name="example-1"></a><span data-ttu-id="c0535-146">Beispiel 1</span><span class="sxs-lookup"><span data-stu-id="c0535-146">Example 1</span></span>

<span data-ttu-id="c0535-147">Wenn Sie eine Methode implementieren, die ein verwerfbares Objekt zurückgibt, verwenden Sie einen try/letzenblock ohne einen catch-Block, um sicherzustellen, dass das Objekt verworfen wird.</span><span class="sxs-lookup"><span data-stu-id="c0535-147">If you're implementing a method that returns a disposable object, use a try/finally block without a catch block to make sure that the object is disposed.</span></span> <span data-ttu-id="c0535-148">Mit einem try/finally-Block lassen Sie Ausnahmen zu, die am Fehlerpunkt ausgelöst werden sollen, und stellen sicher, dass das Objekt verworfen wird.</span><span class="sxs-lookup"><span data-stu-id="c0535-148">By using a try/finally block, you allow exceptions to be raised at the fault point and make sure that object is disposed.</span></span>

<span data-ttu-id="c0535-149">In der OpenPort1-Methode kann der Aufruf zum Öffnen des SerialPorts des ISerializable-Objekts oder der Aufruf von SomeMethod fehlschlagen.</span><span class="sxs-lookup"><span data-stu-id="c0535-149">In the OpenPort1 method, the call to open the ISerializable object SerialPort or the call to SomeMethod can fail.</span></span> <span data-ttu-id="c0535-150">Eine CA2000-Warnung wird für diese Implementierung ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="c0535-150">A CA2000 warning is raised on this implementation.</span></span>

<span data-ttu-id="c0535-151">In der OpenPort2-Methode werden zwei SerialPort-Objekte deklariert und auf NULL festgelegt:</span><span class="sxs-lookup"><span data-stu-id="c0535-151">In the OpenPort2 method, two SerialPort objects are declared and set to null:</span></span>

- <span data-ttu-id="c0535-152">`tempPort` zum Testen, ob die Methodenoperationen erfolgreich ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="c0535-152">`tempPort`, which is used to test that the method operations succeed.</span></span>

- <span data-ttu-id="c0535-153">`port`, der für den Rückgabewert der-Methode verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="c0535-153">`port`, which is used for the return value of the method.</span></span>

<span data-ttu-id="c0535-154">`tempPort` wird erstellt und in einem `try`-Block geöffnet. Alle anderen erforderlichen Arbeiten werden im gleichen `try`-Block ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="c0535-154">The `tempPort` is constructed and opened in a `try` block, and any other required work is performed in the same `try` block.</span></span> <span data-ttu-id="c0535-155">Am Ende des `try`-Blocks wird dem `port`-Objekt, das zurückgegeben wird, der geöffnete Port zugewiesen und das `tempPort`-Objekt wird auf `null` festgelegt.</span><span class="sxs-lookup"><span data-stu-id="c0535-155">At the end of the `try` block, the opened port is assigned to the `port` object that will be returned and the `tempPort` object is set to `null`.</span></span>

<span data-ttu-id="c0535-156">Der `finally`-Block überprüft den Wert von `tempPort`.</span><span class="sxs-lookup"><span data-stu-id="c0535-156">The `finally` block checks the value of `tempPort`.</span></span> <span data-ttu-id="c0535-157">Wenn nicht NULL, ist eine Operation in der Methode fehlgeschlagen und `tempPort` wird geschlossen, um sicherzustellen, dass alle Ressourcen freigegeben werden.</span><span class="sxs-lookup"><span data-stu-id="c0535-157">If it is not null, an operation in the method has failed, and `tempPort` is closed to make sure that any resources are released.</span></span> <span data-ttu-id="c0535-158">Das zurückgegebene Port-Objekt enthält das geöffnete SerialPort-Objekt, wenn die Operationen der Methode erfolgreich waren, oder es ist NULL, wenn eine Operation fehlschlug.</span><span class="sxs-lookup"><span data-stu-id="c0535-158">The returned port object will contain the opened SerialPort object if the operations of the method succeeded, or it will be null if an operation failed.</span></span>

```csharp
public SerialPort OpenPort1(string portName)
{
   SerialPort port = new SerialPort(portName);
   port.Open();  //CA2000 fires because this might throw
   SomeMethod(); //Other method operations can fail
   return port;
}

public SerialPort OpenPort2(string portName)
{
   SerialPort tempPort = null;
   SerialPort port = null;
   try
   {
      tempPort = new SerialPort(portName);
      tempPort.Open();
      SomeMethod();
      //Add any other methods above this line
      port = tempPort;
      tempPort = null;

   }
   finally
   {
      if (tempPort != null)
      {
         tempPort.Close();
      }
   }
   return port;
}
```

```vb
Public Function OpenPort1(ByVal PortName As String) As SerialPort

   Dim port As New SerialPort(PortName)
   port.Open()    'CA2000 fires because this might throw
   SomeMethod()   'Other method operations can fail
   Return port

End Function

Public Function OpenPort2(ByVal PortName As String) As SerialPort

   Dim tempPort As SerialPort = Nothing
   Dim port As SerialPort = Nothing

   Try
      tempPort = New SerialPort(PortName)
      tempPort.Open()
      SomeMethod()
      'Add any other methods above this line
      port = tempPort
      tempPort = Nothing

   Finally
      If Not tempPort Is Nothing Then
         tempPort.Close()
      End If

   End Try

   Return port

End Function
```

## <a name="example-2"></a><span data-ttu-id="c0535-159">Beispiel 2</span><span class="sxs-lookup"><span data-stu-id="c0535-159">Example 2</span></span>

<span data-ttu-id="c0535-160">Standardmäßig überprüft der Visual Basic Compiler alle arithmetischen Operatoren auf Überlauf.</span><span class="sxs-lookup"><span data-stu-id="c0535-160">By default, the Visual Basic compiler has all arithmetic operators check for overflow.</span></span> <span data-ttu-id="c0535-161">Daher kann jede arithmetische Visual Basic-Operation eine <xref:System.OverflowException> auslösen.</span><span class="sxs-lookup"><span data-stu-id="c0535-161">Therefore, any Visual Basic arithmetic operation might throw an <xref:System.OverflowException>.</span></span> <span data-ttu-id="c0535-162">Dies kann zu unerwarteten Regelverletzungen führen, z. B. CA2000.</span><span class="sxs-lookup"><span data-stu-id="c0535-162">This could lead to unexpected violations in rules such as CA2000.</span></span> <span data-ttu-id="c0535-163">Die folgende CreateReader1-Funktion erzeugt z. B. eine CA2000-Verletzung, da der Visual Basic-Compiler einen Befehl zur Überlaufprüfung für die Hinzufügung ausgibt, die eine Ausnahme auslösen könnte, durch die der StreamReader nicht verworfen werden würde.</span><span class="sxs-lookup"><span data-stu-id="c0535-163">For example, the following CreateReader1 function will produce a CA2000 violation because the Visual Basic compiler is emitting an overflow checking instruction for the addition that could throw an exception that would cause the StreamReader not to be disposed.</span></span>

<span data-ttu-id="c0535-164">Um dieses zu korrigieren, können Sie das Ausgeben von Überlaufprüfungen durch den Visual Basic-Compiler im Projekt deaktivieren, oder Sie können den Code entsprechend der folgenden CreateReader2-Funktion ändern.</span><span class="sxs-lookup"><span data-stu-id="c0535-164">To fix this, you can disable the emitting of overflow checks by the Visual Basic compiler in your project or you can modify your code as in the following CreateReader2 function.</span></span>

<span data-ttu-id="c0535-165">Um das Ausgeben von Überlauf Prüfungen zu deaktivieren, klicken Sie in Projektmappen-Explorer mit der rechten Maustaste auf den Projektnamen, und klicken Sie dann auf **Eigenschaften**.</span><span class="sxs-lookup"><span data-stu-id="c0535-165">To disable the emitting of overflow checks, right-click the project name in Solution Explorer and then click **Properties**.</span></span> <span data-ttu-id="c0535-166">Klicken Sie auf **Kompilieren**, klicken Sie auf **Erweiterte Kompilierungsoptionen**, und aktivieren Sie dann ganz Zahl **Überlauf Prüfungen entfernen**.</span><span class="sxs-lookup"><span data-stu-id="c0535-166">Click **Compile**, click **Advanced Compile Options**, and then check **Remove integer overflow checks**.</span></span>

:::code language="vb" source="snippets/vb/all-rules/ca2000-dispose-objects-before-losing-scope-vboverflow_1.vb":::

## <a name="see-also"></a><span data-ttu-id="c0535-167">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="c0535-167">See also</span></span>

- <xref:System.IDisposable>
- [<span data-ttu-id="c0535-168">Dispose-Muster</span><span class="sxs-lookup"><span data-stu-id="c0535-168">Dispose Pattern</span></span>](../../../standard/garbage-collection/implementing-dispose.md)
