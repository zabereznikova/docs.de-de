---
title: Semaphore und SemaphoreSlim
description: Erfahren Sie mehr über Semaphore und SemaphoreSlim. Bei der Klasse Semaphore handelt es sich um einen einfachen Wrapper um das Win32-Semaphorobjekt. Die Klasse SemaphoreSlim ist eine schnelle, einfache Variante der Klasse Semaphore.
ms.date: 03/30/2017
ms.technology: dotnet-standard
helpviewer_keywords:
- counting semaphores
- semaphores
- threading [.NET], cross-process synchronization
- Semaphore class, about Semaphore class
- SemaphoreSlim class, about SemaphoreSlim class
- threading [.NET], Semaphore class
ms.assetid: 7722a333-b974-47a2-a7c0-f09097fb644e
ms.openlocfilehash: b9c13ace086b4df08108a844aea78e5d550e6958
ms.sourcegitcommit: 7588b1f16b7608bc6833c05f91ae670c22ef56f8
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 11/02/2020
ms.locfileid: "93188938"
---
# <a name="semaphore-and-semaphoreslim"></a><span data-ttu-id="a5740-105">Semaphore und SemaphoreSlim</span><span class="sxs-lookup"><span data-stu-id="a5740-105">Semaphore and SemaphoreSlim</span></span>

<span data-ttu-id="a5740-106">Die <xref:System.Threading.Semaphore?displayProperty=nameWithType>-Klasse stellt ein benanntes (systemweites) oder lokales Semaphor dar.</span><span class="sxs-lookup"><span data-stu-id="a5740-106">The <xref:System.Threading.Semaphore?displayProperty=nameWithType> class represents a named (systemwide) or local semaphore.</span></span> <span data-ttu-id="a5740-107">Dabei handelt es sich um einen einfachen Wrapper um das Win32-Semaphorobjekt.</span><span class="sxs-lookup"><span data-stu-id="a5740-107">It is a thin wrapper around the Win32 semaphore object.</span></span> <span data-ttu-id="a5740-108">Win32-Semaphoren sind zählende Semaphoren, die zum Steuern des Zugriffs auf einen Ressourcenpool verwendet werden können.</span><span class="sxs-lookup"><span data-stu-id="a5740-108">Win32 semaphores are counting semaphores, which can be used to control access to a pool of resources.</span></span>  
  
 <span data-ttu-id="a5740-109">Die <xref:System.Threading.SemaphoreSlim>-Klasse stellt ein einfaches, schnelles Semaphor dar, das zum Warten innerhalb eines einzelnen Prozesses verwendet werden kann, wenn die Wartezeiten voraussichtlich sehr kurz sind.</span><span class="sxs-lookup"><span data-stu-id="a5740-109">The <xref:System.Threading.SemaphoreSlim> class represents a lightweight, fast semaphore that can be used for waiting within a single process when wait times are expected to be very short.</span></span> <span data-ttu-id="a5740-110"><xref:System.Threading.SemaphoreSlim> basiert im möglichst hohen Maße auf Synchronisierungsprimitiven, die von Common Language Runtime (CLR) bereitgestellt werden.</span><span class="sxs-lookup"><span data-stu-id="a5740-110"><xref:System.Threading.SemaphoreSlim> relies as much as possible on synchronization primitives provided by the common language runtime (CLR).</span></span> <span data-ttu-id="a5740-111">Es stellt jedoch auch verzögert initialisierte, Kernel-basierte Wait-Handles zur Unterstützung des Wartens auf mehrere Semaphoren bereit.</span><span class="sxs-lookup"><span data-stu-id="a5740-111">However, it also provides lazily initialized, kernel-based wait handles as necessary to support waiting on multiple semaphores.</span></span> <span data-ttu-id="a5740-112"><xref:System.Threading.SemaphoreSlim> unterstützt auch die Verwendung von Abbruchtoken, unterstützt aber keine benannten Semaphoren oder die Verwendung eines Wait-Handles für die Synchronisierung.</span><span class="sxs-lookup"><span data-stu-id="a5740-112"><xref:System.Threading.SemaphoreSlim> also supports the use of cancellation tokens, but it does not support named semaphores or the use of a wait handle for synchronization.</span></span>  
  
## <a name="managing-a-limited-resource"></a><span data-ttu-id="a5740-113">Verwalten einer beschränkten Ressource</span><span class="sxs-lookup"><span data-stu-id="a5740-113">Managing a Limited Resource</span></span>  
 <span data-ttu-id="a5740-114">Threads wechseln in den Semaphor durch Aufrufen der <xref:System.Threading.WaitHandle.WaitOne%2A>-Methode, die von der <xref:System.Threading.WaitHandle>-Klasse geerbt wird, wenn es sich um ein <xref:System.Threading.Semaphore?displayProperty=nameWithType>-Objekt handelt, bzw. von der <xref:System.Threading.SemaphoreSlim.Wait%2A?displayProperty=nameWithType>- oder <xref:System.Threading.SemaphoreSlim.WaitAsync%2A?displayProperty=nameWithType>-Methode, wenn es sich um ein <xref:System.Threading.SemaphoreSlim>-Objekt handelt.</span><span class="sxs-lookup"><span data-stu-id="a5740-114">Threads enter the semaphore by calling the <xref:System.Threading.WaitHandle.WaitOne%2A> method, which is inherited from the <xref:System.Threading.WaitHandle> class, in the case of a <xref:System.Threading.Semaphore?displayProperty=nameWithType> object, or the <xref:System.Threading.SemaphoreSlim.Wait%2A?displayProperty=nameWithType> or <xref:System.Threading.SemaphoreSlim.WaitAsync%2A?displayProperty=nameWithType> method, in the case of a <xref:System.Threading.SemaphoreSlim> object.</span></span> <span data-ttu-id="a5740-115">Wenn der Aufruf zurückgegeben wird, wird der Zähler des Semaphors dekrementiert.</span><span class="sxs-lookup"><span data-stu-id="a5740-115">When the call returns, the count on the semaphore is decremented.</span></span> <span data-ttu-id="a5740-116">Wenn ein Thread den Zugang anfordert und die Anzahl null ist, wird der Thread blockiert.</span><span class="sxs-lookup"><span data-stu-id="a5740-116">When a thread requests entry and the count is zero, the thread blocks.</span></span> <span data-ttu-id="a5740-117">Da Threads das Semaphor durch Aufrufen von Freigeben der <xref:System.Threading.Semaphore.Release%2A?displayProperty=nameWithType>- oder <xref:System.Threading.SemaphoreSlim.Release%2A?displayProperty=nameWithType>-Methode freigeben, erhalten blockierte Threads Zugang.</span><span class="sxs-lookup"><span data-stu-id="a5740-117">As threads release the semaphore by calling the <xref:System.Threading.Semaphore.Release%2A?displayProperty=nameWithType> or <xref:System.Threading.SemaphoreSlim.Release%2A?displayProperty=nameWithType> method, blocked threads are allowed to enter.</span></span> <span data-ttu-id="a5740-118">Für die Aufnahme von blockierten Threads in das Semaphor gibt es keine festgelegte Reihenfolge, z. B. First in, First Out (FIFO) oder Last in, First Out (LIFO).</span><span class="sxs-lookup"><span data-stu-id="a5740-118">There is no guaranteed order, such as first-in, first-out (FIFO) or last-in, first-out (LIFO), for blocked threads to enter the semaphore.</span></span>  
  
 <span data-ttu-id="a5740-119">Ein Thread kann in das Semaphor mehrfach durch wiederholtes Aufrufen der <xref:System.Threading.Semaphore?displayProperty=nameWithType>-Methode des <xref:System.Threading.WaitHandle.WaitOne%2A>-Objekts oder der <xref:System.Threading.SemaphoreSlim>-Methode des <xref:System.Threading.SemaphoreSlim.Wait%2A>-Objekts wechseln.</span><span class="sxs-lookup"><span data-stu-id="a5740-119">A thread can enter the semaphore multiple times by calling the <xref:System.Threading.Semaphore?displayProperty=nameWithType> object's <xref:System.Threading.WaitHandle.WaitOne%2A> method or the  <xref:System.Threading.SemaphoreSlim> object's <xref:System.Threading.SemaphoreSlim.Wait%2A> method repeatedly.</span></span> <span data-ttu-id="a5740-120">Um das Semaphor freizugeben, kann der Thread entweder die <xref:System.Threading.Semaphore.Release?displayProperty=nameWithType>- oder <xref:System.Threading.SemaphoreSlim.Release?displayProperty=nameWithType>-Methodenüberladung aufrufen oder die <xref:System.Threading.Semaphore.Release%28System.Int32%29?displayProperty=nameWithType>- oder <xref:System.Threading.SemaphoreSlim.Release%28System.Int32%29?displayProperty=nameWithType>-Methodenüberladung aufrufen und die Anzahl der freizugebenden Einträge angeben.</span><span class="sxs-lookup"><span data-stu-id="a5740-120">To release the semaphore, the thread can either call the <xref:System.Threading.Semaphore.Release?displayProperty=nameWithType> or <xref:System.Threading.SemaphoreSlim.Release?displayProperty=nameWithType> method overload the same number of times, or call the <xref:System.Threading.Semaphore.Release%28System.Int32%29?displayProperty=nameWithType> or <xref:System.Threading.SemaphoreSlim.Release%28System.Int32%29?displayProperty=nameWithType> method overload and specify the number of entries to be released.</span></span>  
  
### <a name="semaphores-and-thread-identity"></a><span data-ttu-id="a5740-121">Semaphoren und Threadidentität</span><span class="sxs-lookup"><span data-stu-id="a5740-121">Semaphores and Thread Identity</span></span>  
 <span data-ttu-id="a5740-122">Die zwei Semaphoren erzwingen keine Threadidentität für Aufrufe der Methoden <xref:System.Threading.WaitHandle.WaitOne%2A>, <xref:System.Threading.SemaphoreSlim.Wait%2A>, <xref:System.Threading.Semaphore.Release%2A> und <xref:System.Threading.SemaphoreSlim.Release%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="a5740-122">The two semaphore types do not enforce thread identity on calls to the <xref:System.Threading.WaitHandle.WaitOne%2A>, <xref:System.Threading.SemaphoreSlim.Wait%2A>, <xref:System.Threading.Semaphore.Release%2A>, and <xref:System.Threading.SemaphoreSlim.Release%2A?displayProperty=nameWithType> methods.</span></span> <span data-ttu-id="a5740-123">Ein häufiges Verwendungsszenario für Semaphoren umfasst beispielsweise einen Producerthread und einem Consumerthread, wobei ein Thread den Zähler des Semaphors immer erhöht und der andere ihn immer verringert.</span><span class="sxs-lookup"><span data-stu-id="a5740-123">For example, a common usage scenario for semaphores involves a producer thread and a consumer thread, with one thread always incrementing the semaphore count and the other always decrementing it.</span></span>  
  
 <span data-ttu-id="a5740-124">Der Programmierer ist dafür verantwortlich, sicherzustellen, dass ein Thread das Semaphor nicht zu oft freigibt.</span><span class="sxs-lookup"><span data-stu-id="a5740-124">It is the programmer's responsibility to ensure that a thread does not release the semaphore too many times.</span></span> <span data-ttu-id="a5740-125">Angenommen, ein Semaphor hat einen maximalen Zähler von zwei und Thread A sowie Thread B wechseln beide in das Semaphor.</span><span class="sxs-lookup"><span data-stu-id="a5740-125">For example, suppose a semaphore has a maximum count of two, and that thread A and thread B both enter the semaphore.</span></span> <span data-ttu-id="a5740-126">Wenn ein Programmierfehler in Thread B dazu führt, dass `Release` zweimal aufgerufen wird, sind beide Aufrufe erfolgreich.</span><span class="sxs-lookup"><span data-stu-id="a5740-126">If a programming error in thread B causes it to call  `Release` twice, both calls succeed.</span></span> <span data-ttu-id="a5740-127">Der Zähler des Semaphors ist voll, und wenn Thread A schließlich `Release` aufruft, wird eine <xref:System.Threading.SemaphoreFullException> ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="a5740-127">The count on the semaphore is full, and when thread A eventually calls `Release`, a <xref:System.Threading.SemaphoreFullException> is thrown.</span></span>  
  
## <a name="named-semaphores"></a><span data-ttu-id="a5740-128">Benannte Semaphoren</span><span class="sxs-lookup"><span data-stu-id="a5740-128">Named Semaphores</span></span>  
 <span data-ttu-id="a5740-129">Das Windows-Betriebssystem ermöglicht es, Semaphoren zu benennen.</span><span class="sxs-lookup"><span data-stu-id="a5740-129">The Windows operating system allows semaphores to have names.</span></span> <span data-ttu-id="a5740-130">Ein benanntes Semaphor ist systemweit sichtbar.</span><span class="sxs-lookup"><span data-stu-id="a5740-130">A named semaphore is system wide.</span></span> <span data-ttu-id="a5740-131">Das heißt, sobald das benannte Semaphor erstellt wurde, ist es für alle Threads in allen Prozessen sichtbar.</span><span class="sxs-lookup"><span data-stu-id="a5740-131">That is, once the named semaphore is created, it is visible to all threads in all processes.</span></span> <span data-ttu-id="a5740-132">Folglich kann ein benanntes Semaphore zum Synchronisieren der Aktivitäten von Prozessen und Threads verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="a5740-132">Thus, named semaphore can be used to synchronize the activities of processes as well as threads.</span></span>  
  
 <span data-ttu-id="a5740-133">Sie können ein <xref:System.Threading.Semaphore>-Objekt erstellen, das ein benanntes Systemsemaphor darstellt, indem Sie einen der Konstruktoren verwenden, die einen Namen angeben.</span><span class="sxs-lookup"><span data-stu-id="a5740-133">You can create a <xref:System.Threading.Semaphore> object that represents a named system semaphore by using one of the constructors that specifies a name.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="a5740-134">Da benannte Semaphoren systemweit sichtbar sind, ist es möglich, mehrere <xref:System.Threading.Semaphore>-Objekte zu haben, die dasselbe benannte Semaphor darstellen.</span><span class="sxs-lookup"><span data-stu-id="a5740-134">Because named semaphores are system wide, it is possible to have multiple <xref:System.Threading.Semaphore> objects that represent the same named semaphore.</span></span> <span data-ttu-id="a5740-135">Bei jedem Aufruf eines Konstruktors oder der <xref:System.Threading.Semaphore.OpenExisting%2A?displayProperty=nameWithType>-Methode wird ein neues <xref:System.Threading.Semaphore>-Objekt erstellt.</span><span class="sxs-lookup"><span data-stu-id="a5740-135">Each time you call a constructor or the <xref:System.Threading.Semaphore.OpenExisting%2A?displayProperty=nameWithType> method, a new <xref:System.Threading.Semaphore> object is created.</span></span> <span data-ttu-id="a5740-136">Wenn Sie wiederholt denselben Namen angeben, werden mehrere Objekte erstellt, die desselbe benannte Semaphor darstellen.</span><span class="sxs-lookup"><span data-stu-id="a5740-136">Specifying the same name repeatedly creates multiple objects that represent the same named semaphore.</span></span>  
  
 <span data-ttu-id="a5740-137">Vorsicht ist geboten, wenn Sie benannte Semaphoren verwenden.</span><span class="sxs-lookup"><span data-stu-id="a5740-137">Be careful when you use named semaphores.</span></span> <span data-ttu-id="a5740-138">Da sie systemweit sichtbar sind, kann ein anderer Prozess, der den gleichen Namen verwendet, unerwartet in das Semaphor wechseln.</span><span class="sxs-lookup"><span data-stu-id="a5740-138">Because they are system wide, another process that uses the same name can enter your semaphore unexpectedly.</span></span> <span data-ttu-id="a5740-139">Böswilliger Code, der auf demselben Computer ausgeführt wird, könnte dies als Grundlage für einen Denial-of-Service-Angriff verwenden.</span><span class="sxs-lookup"><span data-stu-id="a5740-139">Malicious code executing on the same computer could use this as the basis of a denial-of-service attack.</span></span>  
  
 <span data-ttu-id="a5740-140">Verwenden Sie die Zugriffssteuerungssicherheit zum Schutz eines <xref:System.Threading.Semaphore>-Objekts, das ein benanntes Semaphor darstellt, vorzugsweise unter Verwendung eines Konstruktors, der <xref:System.Security.AccessControl.SemaphoreSecurity?displayProperty=nameWithType>-Objekt angibt.</span><span class="sxs-lookup"><span data-stu-id="a5740-140">Use access control security to protect a <xref:System.Threading.Semaphore> object that represents a named semaphore, preferably by using a constructor that specifies a <xref:System.Security.AccessControl.SemaphoreSecurity?displayProperty=nameWithType> object.</span></span> <span data-ttu-id="a5740-141">Sie können die Zugriffssteuerungssicherheit auch mithilfe der <xref:System.Threading.Semaphore.SetAccessControl%2A?displayProperty=nameWithType>-Methode anwenden, allerdings bleibt so ein Verwundbarkeitszeitfenster zwischen der Erstellung und dem Schutz des Semaphors.</span><span class="sxs-lookup"><span data-stu-id="a5740-141">You can also apply access control security using the <xref:System.Threading.Semaphore.SetAccessControl%2A?displayProperty=nameWithType> method, but this leaves a window of vulnerability between the time the semaphore is created and the time it is protected.</span></span> <span data-ttu-id="a5740-142">Der Schutz von Semaphoren mit Zugriffssteuerungssicherheit hilft beim Verhindern böswilliger Angriffe, das Problem unbeabsichtigter Namenskonflikte wird dadurch aber nicht gelöst.</span><span class="sxs-lookup"><span data-stu-id="a5740-142">Protecting semaphores with access control security helps prevent malicious attacks, but does not solve the problem of unintentional name collisions.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a5740-143">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="a5740-143">See also</span></span>

- <xref:System.Threading.Semaphore>
- <xref:System.Threading.SemaphoreSlim>
- [<span data-ttu-id="a5740-144">Threading Objects and Features (Threadingobjekte und -funktionen)</span><span class="sxs-lookup"><span data-stu-id="a5740-144">Threading Objects and Features</span></span>](threading-objects-and-features.md)
