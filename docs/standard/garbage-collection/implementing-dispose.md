---
title: Implementieren einer Dispose-Methode
ms.date: 04/07/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- Dispose method
- garbage collection, Dispose method
ms.assetid: eb4e1af0-3b48-4fbc-ad4e-fc2f64138bf9
ms.openlocfilehash: 0583329ae75fa54cf000212479895ccebdbd30d8
ms.sourcegitcommit: fbb8a593a511ce667992502a3ce6d8f65c594edf
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 11/16/2019
ms.locfileid: "74142055"
---
# <a name="implementing-a-dispose-method"></a><span data-ttu-id="d1f34-102">Implementieren einer Dispose-Methode</span><span class="sxs-lookup"><span data-stu-id="d1f34-102">Implementing a Dispose method</span></span>

<span data-ttu-id="d1f34-103">Sie implementieren eine <xref:System.IDisposable.Dispose%2A>-Methode, um nicht verwaltete Ressourcen freizugeben, die von Ihrer Anwendung verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="d1f34-103">You implement a <xref:System.IDisposable.Dispose%2A> method to release unmanaged resources used by your application.</span></span> <span data-ttu-id="d1f34-104">Der .NET-Garbage Collector ordnet nicht verwalteten Arbeitsspeicher weder zu noch gibt er diesen frei.</span><span class="sxs-lookup"><span data-stu-id="d1f34-104">The .NET garbage collector does not allocate or release unmanaged memory.</span></span>  
  
<span data-ttu-id="d1f34-105">Das Muster für das Verwerfen eines Objekts, [Dispose-Muster](implementing-dispose.md) genannt, legt die Ordnung für die Lebensdauer eines Objekts fest.</span><span class="sxs-lookup"><span data-stu-id="d1f34-105">The pattern for disposing an object, referred to as a [dispose pattern](implementing-dispose.md), imposes order on the lifetime of an object.</span></span> <span data-ttu-id="d1f34-106">Das Dispose-Muster wird nur für Objekte verwendet, die auf nicht verwaltete Ressourcen zugreifen, wie etwa Datei- und Pipehandles, Registrierungshandles, Wait-Handles oder Zeiger auf Blöcke nicht verwalteten Speichers.</span><span class="sxs-lookup"><span data-stu-id="d1f34-106">The dispose pattern is used only for objects that access unmanaged resources, such as file and pipe handles, registry handles, wait handles, or pointers to blocks of unmanaged memory.</span></span> <span data-ttu-id="d1f34-107">Dies liegt daran, dass der Garbage Collector beim Freigeben nicht verwendeter verwalteter Objekte sehr effizient ist, nicht verwaltete Objekt jedoch nicht freigeben kann.</span><span class="sxs-lookup"><span data-stu-id="d1f34-107">This is because the garbage collector is very efficient at reclaiming unused managed objects, but it is unable to reclaim unmanaged objects.</span></span>  
  
<span data-ttu-id="d1f34-108">Das Dispose-Muster weist zwei Varianten auf:</span><span class="sxs-lookup"><span data-stu-id="d1f34-108">The dispose pattern has two variations:</span></span>  
  
- <span data-ttu-id="d1f34-109">Sie umschließen jede nicht verwaltete Ressource, die ein Typ verwendet, in einem SafeHandle (also in einer von <xref:System.Runtime.InteropServices.SafeHandle?displayProperty=nameWithType> abgeleiteten Klasse).</span><span class="sxs-lookup"><span data-stu-id="d1f34-109">You wrap each unmanaged resource that a type uses in a safe handle (that is, in a class derived from <xref:System.Runtime.InteropServices.SafeHandle?displayProperty=nameWithType>).</span></span> <span data-ttu-id="d1f34-110">In diesem Fall implementieren Sie die <xref:System.IDisposable>-Schnittstelle und eine zusätzliche `Dispose(Boolean)`-Methode.</span><span class="sxs-lookup"><span data-stu-id="d1f34-110">In this case, you implement the <xref:System.IDisposable> interface and an additional `Dispose(Boolean)` method.</span></span> <span data-ttu-id="d1f34-111">Dies ist die empfohlene Variante und erfordert nicht das Überschreiben der <xref:System.Object.Finalize%2A?displayProperty=nameWithType>-Methode.</span><span class="sxs-lookup"><span data-stu-id="d1f34-111">This is the recommended variation and doesn't require overriding the <xref:System.Object.Finalize%2A?displayProperty=nameWithType> method.</span></span>  
  
  > [!NOTE]
  > <span data-ttu-id="d1f34-112">Der <xref:Microsoft.Win32.SafeHandles?displayProperty=nameWithType>-Namespace stellt einen Satz von Klassen bereit, die von <xref:System.Runtime.InteropServices.SafeHandle> abgeleitet werden und im Abschnitt [Verwenden von SafeHandles](#SafeHandles) aufgeführt sind.</span><span class="sxs-lookup"><span data-stu-id="d1f34-112">The <xref:Microsoft.Win32.SafeHandles?displayProperty=nameWithType> namespace provides a set of classes derived from <xref:System.Runtime.InteropServices.SafeHandle>, which are listed in the [Using safe handles](#SafeHandles) section.</span></span> <span data-ttu-id="d1f34-113">Wenn Sie keine Klasse finden können, die Ihre nicht verwaltete Ressource freigeben kann, können Sie eine eigene Unterklasse von <xref:System.Runtime.InteropServices.SafeHandle> implementieren.</span><span class="sxs-lookup"><span data-stu-id="d1f34-113">If you can't find a class that is suitable for releasing your unmanaged resource, you can implement your own subclass of <xref:System.Runtime.InteropServices.SafeHandle>.</span></span>  
  
- <span data-ttu-id="d1f34-114">Sie implementieren die <xref:System.IDisposable>-Schnittstelle und eine zusätzliche `Dispose(Boolean)`-Methode, und Sie überschreiben auch die <xref:System.Object.Finalize%2A?displayProperty=nameWithType>-Methode.</span><span class="sxs-lookup"><span data-stu-id="d1f34-114">You implement the <xref:System.IDisposable> interface and an additional `Dispose(Boolean)` method, and you also override the <xref:System.Object.Finalize%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="d1f34-115">Sie müssen <xref:System.Object.Finalize%2A> überschreiben, um sicherzustellen, dass nicht verwaltete Ressourcen verworfen werden, wenn die <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType>-Implementierung nicht von einem Consumer Ihres Typs aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="d1f34-115">You must override <xref:System.Object.Finalize%2A> to ensure that unmanaged resources are disposed of if your <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> implementation is not called by a consumer of your type.</span></span> <span data-ttu-id="d1f34-116">Wenn Sie das unter dem vorherigen Aufzählungspunkt beschriebene empfohlene Verfahren anwenden, führt die <xref:System.Runtime.InteropServices.SafeHandle?displayProperty=nameWithType>-Klasse dies für Sie durch.</span><span class="sxs-lookup"><span data-stu-id="d1f34-116">If you use the recommended technique discussed in the previous bullet, the <xref:System.Runtime.InteropServices.SafeHandle?displayProperty=nameWithType> class does this on your behalf.</span></span>  
  
<span data-ttu-id="d1f34-117">Um sicherzustellen, dass Ressourcen immer entsprechend bereinigt werden, sollte eine <xref:System.IDisposable.Dispose%2A>-Methode auch mehrmals aufgerufen werden können, ohne eine Ausnahme auszulösen.</span><span class="sxs-lookup"><span data-stu-id="d1f34-117">To help ensure that resources are always cleaned up appropriately, a <xref:System.IDisposable.Dispose%2A> method should be callable multiple times without throwing an exception.</span></span>  
  
<span data-ttu-id="d1f34-118">Das Codebeispiel für die <xref:System.GC.KeepAlive%2A?displayProperty=nameWithType>-Methode veranschaulicht, wie durch agressive Garbage Collection die Ausführung eines Finalizers bewirkt werden kann, während ein Member des freigegebenen Objekts noch ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="d1f34-118">The code example provided for the <xref:System.GC.KeepAlive%2A?displayProperty=nameWithType> method shows how aggressive garbage collection can cause a finalizer to run while a member of the reclaimed object is still executing.</span></span> <span data-ttu-id="d1f34-119">Es empfiehlt sich, die <xref:System.GC.KeepAlive%2A>-Methode am Ende einer längeren <xref:System.IDisposable.Dispose%2A>-Methode aufzurufen.</span><span class="sxs-lookup"><span data-stu-id="d1f34-119">It is a good idea to call the <xref:System.GC.KeepAlive%2A> method at the end of a lengthy <xref:System.IDisposable.Dispose%2A> method.</span></span>  
  
<a name="Dispose2"></a>
## <a name="dispose-and-disposeboolean"></a><span data-ttu-id="d1f34-120">Dispose() und Dispose(Boolean)</span><span class="sxs-lookup"><span data-stu-id="d1f34-120">Dispose() and Dispose(Boolean)</span></span>  

<span data-ttu-id="d1f34-121">Die <xref:System.IDisposable>-Schnittstelle erfordert die Implementierung einer einzelnen parameterlosen Methode, <xref:System.IDisposable.Dispose%2A>.</span><span class="sxs-lookup"><span data-stu-id="d1f34-121">The <xref:System.IDisposable> interface requires the implementation of a single parameterless method, <xref:System.IDisposable.Dispose%2A>.</span></span> <span data-ttu-id="d1f34-122">Für das Dispose-Muster müssen jedoch zwei `Dispose`-Methoden implementiert werden:</span><span class="sxs-lookup"><span data-stu-id="d1f34-122">However, the dispose pattern requires two `Dispose` methods to be implemented:</span></span>  
  
- <span data-ttu-id="d1f34-123">Eine öffentliche, nicht virtuelle (`NonInheritable` in Visual Basic) <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType>-Implementierung, die keine Parameter aufweist.</span><span class="sxs-lookup"><span data-stu-id="d1f34-123">A public non-virtual (`NonInheritable` in Visual Basic) <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> implementation that has no parameters.</span></span>  
  
- <span data-ttu-id="d1f34-124">Eine geschützte, virtuelle (`Overridable` in Visual Basic) `Dispose`-Methode mit der folgenden Signatur:</span><span class="sxs-lookup"><span data-stu-id="d1f34-124">A protected virtual (`Overridable` in Visual Basic) `Dispose` method whose signature is:</span></span>  
  
  [!code-csharp[Conceptual.Disposable#8](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.disposable/cs/dispose1.cs#8)]
  [!code-vb[Conceptual.Disposable#8](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.disposable/vb/dispose1.vb#8)]  
  
### <a name="the-dispose-overload"></a><span data-ttu-id="d1f34-125">Die Dispose() Überladung</span><span class="sxs-lookup"><span data-stu-id="d1f34-125">The Dispose() overload</span></span>

<span data-ttu-id="d1f34-126">Da die öffentliche, nicht virtuelle (`NonInheritable` in Visual Basic), parameterlose `Dispose`-Methode von einem Consumer des Typs aufgerufen wird, besteht ihr Zweck darin, nicht verwaltete Ressourcen freizugeben und anzugeben, dass der Finalizer, sofern vorhanden, nicht ausgeführt werden muss.</span><span class="sxs-lookup"><span data-stu-id="d1f34-126">Because the public, non-virtual (`NonInheritable` in Visual Basic), parameterless `Dispose` method is called by a consumer of the type, its purpose is to free unmanaged resources and to indicate that the finalizer, if one is present, doesn't have to run.</span></span> <span data-ttu-id="d1f34-127">Daher weist sie eine Standardimplementierung auf:</span><span class="sxs-lookup"><span data-stu-id="d1f34-127">Because of this, it has a standard implementation:</span></span>  
  
[!code-csharp[Conceptual.Disposable#7](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.disposable/cs/dispose1.cs#7)]
[!code-vb[Conceptual.Disposable#7](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.disposable/vb/dispose1.vb#7)]  
  
<span data-ttu-id="d1f34-128">Die `Dispose`-Methode führt die Bereinigung aller Objekte aus, damit der Garbage Collector nicht mehr die <xref:System.Object.Finalize%2A?displayProperty=nameWithType>-Überschreibung der Objekte aufrufen muss.</span><span class="sxs-lookup"><span data-stu-id="d1f34-128">The `Dispose` method performs all object cleanup, so the garbage collector no longer needs to call the objects' <xref:System.Object.Finalize%2A?displayProperty=nameWithType> override.</span></span> <span data-ttu-id="d1f34-129">Daher verhindert der Aufruf der <xref:System.GC.SuppressFinalize%2A>-Methode, dass der Garbage Collector den Finalizer ausführt.</span><span class="sxs-lookup"><span data-stu-id="d1f34-129">Therefore, the call to the <xref:System.GC.SuppressFinalize%2A> method prevents the garbage collector from running the finalizer.</span></span> <span data-ttu-id="d1f34-130">Wenn der Typ keinen Finalizer aufweist, bleibt der Aufruf von <xref:System.GC.SuppressFinalize%2A?displayProperty=nameWithType> ohne Auswirkungen.</span><span class="sxs-lookup"><span data-stu-id="d1f34-130">If the type has no finalizer, the call to <xref:System.GC.SuppressFinalize%2A?displayProperty=nameWithType> has no effect.</span></span> <span data-ttu-id="d1f34-131">Beachten Sie, dass die tatsächliche Arbeit des Freigebens nicht verwalteter Ressourcen durch die zweite Überladung der `Dispose`-Methode ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="d1f34-131">Note that the actual work of releasing unmanaged resources is performed by the second overload of the `Dispose` method.</span></span>  
  
### <a name="the-disposeboolean-overload"></a><span data-ttu-id="d1f34-132">Die Dispose(Boolean) Überladung</span><span class="sxs-lookup"><span data-stu-id="d1f34-132">The Dispose(Boolean) overload</span></span>

<span data-ttu-id="d1f34-133">In der zweiten Überladung ist der *disposing*-Parameter ein <xref:System.Boolean>, der angibt, ob der Methodenaufruf von einer <xref:System.IDisposable.Dispose%2A>-Methode (der Wert ist `true`) oder von einem Finalizer (der Wert ist `false`) stammt.</span><span class="sxs-lookup"><span data-stu-id="d1f34-133">In the second overload, the *disposing* parameter is a <xref:System.Boolean> that indicates whether the method call comes from a <xref:System.IDisposable.Dispose%2A> method (its value is `true`) or from a finalizer (its value is `false`).</span></span>  
  
<span data-ttu-id="d1f34-134">Der Text der Methode besteht aus zwei Codeblöcken:</span><span class="sxs-lookup"><span data-stu-id="d1f34-134">The body of the method consists of two blocks of code:</span></span>  
  
- <span data-ttu-id="d1f34-135">Ein Block, der nicht verwaltete Ressourcen freigibt.</span><span class="sxs-lookup"><span data-stu-id="d1f34-135">A block that frees unmanaged resources.</span></span> <span data-ttu-id="d1f34-136">Dieser Block wird unabhängig vom Wert des `disposing`-Parameters ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="d1f34-136">This block executes regardless of the value of the `disposing` parameter.</span></span>  
  
- <span data-ttu-id="d1f34-137">Ein bedingter Block, der verwaltete Ressourcen freigibt.</span><span class="sxs-lookup"><span data-stu-id="d1f34-137">A conditional block that frees managed resources.</span></span> <span data-ttu-id="d1f34-138">Dieser Block wird ausgeführt, wenn der Wert von `disposing` gleich `true` ist.</span><span class="sxs-lookup"><span data-stu-id="d1f34-138">This block executes if the value of `disposing` is `true`.</span></span> <span data-ttu-id="d1f34-139">Die verwalteten Ressourcen, die freigegeben werden, können Folgendes umfassen:</span><span class="sxs-lookup"><span data-stu-id="d1f34-139">The managed resources that it frees can include:</span></span>  
  
  <span data-ttu-id="d1f34-140">**Verwaltete Objekte, die <xref:System.IDisposable> implementieren.**</span><span class="sxs-lookup"><span data-stu-id="d1f34-140">**Managed objects that implement <xref:System.IDisposable>.**</span></span> <span data-ttu-id="d1f34-141">Der bedingte Block kann verwendet werden, um deren <xref:System.IDisposable.Dispose%2A>-Implementierung aufzurufen.</span><span class="sxs-lookup"><span data-stu-id="d1f34-141">The conditional block can be used to call their <xref:System.IDisposable.Dispose%2A> implementation.</span></span> <span data-ttu-id="d1f34-142">Wenn Sie ein SafeHandle verwendet haben, um die nicht verwaltete Ressource einschließen, sollten Sie die <xref:System.Runtime.InteropServices.SafeHandle.Dispose%28System.Boolean%29?displayProperty=nameWithType>-Implementierung hier aufrufen.</span><span class="sxs-lookup"><span data-stu-id="d1f34-142">If you have used a safe handle to wrap your unmanaged resource, you should call the <xref:System.Runtime.InteropServices.SafeHandle.Dispose%28System.Boolean%29?displayProperty=nameWithType> implementation here.</span></span>  
  
  <span data-ttu-id="d1f34-143">**Verwaltete Objekte, die viel Arbeitsspeicher belegen oder knappe Ressourcen nutzen.**</span><span class="sxs-lookup"><span data-stu-id="d1f34-143">**Managed objects that consume large amounts of memory or consume scarce resources.**</span></span> <span data-ttu-id="d1f34-144">Durch die explizite Freigabe in der `Dispose`-Methode werden diese Objekte schneller freigegeben, als wenn sie vom Garbage Collector nicht deterministisch freigegeben werden würden.</span><span class="sxs-lookup"><span data-stu-id="d1f34-144">Freeing these objects explicitly in the `Dispose` method releases them faster than if they were reclaimed non-deterministically by the garbage collector.</span></span>  
  
<span data-ttu-id="d1f34-145">Wenn der Methodenaufruf von einem Finalizer stammt (das heißt, *disposing* ist `false`), wird nur der Code ausgeführt, der nicht verwaltete Ressourcen freigibt.</span><span class="sxs-lookup"><span data-stu-id="d1f34-145">If the method call comes from a finalizer (that is, if *disposing* is `false`), only the code that frees unmanaged resources executes.</span></span> <span data-ttu-id="d1f34-146">Die Reihenfolge, in der der Garbage Collector verwaltete Objekte während des Abschlusses zerstört, ist nicht definiert. Durch Aufrufen dieser `Dispose`-Überladung mit dem Wert `false` wird daher verhindert, dass der Finalizer versucht, verwaltete Ressourcen freizugeben, die möglicherweise bereits freigegeben wurden.</span><span class="sxs-lookup"><span data-stu-id="d1f34-146">Because the order in which the garbage collector destroys managed objects during finalization is not defined, calling this `Dispose` overload with a value of `false` prevents the finalizer from trying to release managed resources that may have already been reclaimed.</span></span>  
  
## <a name="implementing-the-dispose-pattern-for-a-base-class"></a><span data-ttu-id="d1f34-147">Implementieren des Dispose-Musters für eine Basisklasse</span><span class="sxs-lookup"><span data-stu-id="d1f34-147">Implementing the dispose pattern for a base class</span></span>

<span data-ttu-id="d1f34-148">Wenn Sie das Dispose-Muster für eine Basisklasse implementieren, müssen Sie Folgendes bereitstellen:</span><span class="sxs-lookup"><span data-stu-id="d1f34-148">If you implement the dispose pattern for a base class, you must provide the following:</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="d1f34-149">Sie sollten dieses Muster für alle Basisklassen implementieren, die <xref:System.IDisposable.Dispose> implementieren und nicht `sealed` (`NotInheritable` in Visual Basic) sind.</span><span class="sxs-lookup"><span data-stu-id="d1f34-149">You should implement this pattern for all base classes that implement <xref:System.IDisposable.Dispose> and are not `sealed` (`NotInheritable` in Visual Basic).</span></span>  
  
- <span data-ttu-id="d1f34-150">Eine <xref:System.IDisposable.Dispose%2A>-Implementierung, die die `Dispose(Boolean)`-Methode aufruft.</span><span class="sxs-lookup"><span data-stu-id="d1f34-150">A <xref:System.IDisposable.Dispose%2A> implementation that calls the `Dispose(Boolean)` method.</span></span>  
  
- <span data-ttu-id="d1f34-151">Eine `Dispose(Boolean)`-Methode, die die eigentliche Arbeit des Freigebens von Ressourcen ausführt.</span><span class="sxs-lookup"><span data-stu-id="d1f34-151">A `Dispose(Boolean)` method that performs the actual work of releasing resources.</span></span>  
  
- <span data-ttu-id="d1f34-152">Entweder eine von <xref:System.Runtime.InteropServices.SafeHandle> abgeleitete Klasse, die die nicht verwaltete Ressource einschließt (empfohlen) oder eine Überschreibung der <xref:System.Object.Finalize%2A?displayProperty=nameWithType>-Methode.</span><span class="sxs-lookup"><span data-stu-id="d1f34-152">Either a class derived from <xref:System.Runtime.InteropServices.SafeHandle> that wraps your unmanaged resource (recommended), or an override to the <xref:System.Object.Finalize%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="d1f34-153">Die <xref:System.Runtime.InteropServices.SafeHandle>-Klasse stellt einen Finalizer bereit, wodurch Sie keinen programmieren müssen.</span><span class="sxs-lookup"><span data-stu-id="d1f34-153">The <xref:System.Runtime.InteropServices.SafeHandle> class provides a finalizer that frees you from having to code one.</span></span>  
  
<span data-ttu-id="d1f34-154">Im Folgenden finden Sie das allgemeine Muster für die Implementierung des Dispose-Musters für eine Basisklasse, die ein SafeHandle verwendet.</span><span class="sxs-lookup"><span data-stu-id="d1f34-154">Here's the general pattern for implementing the dispose pattern for a base class that uses a safe handle.</span></span>  
  
[!code-csharp[System.IDisposable#3](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.idisposable/cs/base1.cs#3)]
[!code-vb[System.IDisposable#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.idisposable/vb/base1.vb#3)]  
  
> [!NOTE]
> <span data-ttu-id="d1f34-155">Im vorherigen Beispiel wird ein <xref:Microsoft.Win32.SafeHandles.SafeFileHandle>-Objekt zum Veranschaulichen des Musters verwendet; stattdessen kann auch ein beliebiges anderes von <xref:System.Runtime.InteropServices.SafeHandle> abgeleitetes Objekt verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="d1f34-155">The previous example uses a <xref:Microsoft.Win32.SafeHandles.SafeFileHandle> object to illustrate the pattern; any object derived from <xref:System.Runtime.InteropServices.SafeHandle> could be used instead.</span></span> <span data-ttu-id="d1f34-156">Beachten Sie, dass im Beispiel das <xref:Microsoft.Win32.SafeHandles.SafeFileHandle>-Objekt nicht ordnungsgemäß instanziiert wird.</span><span class="sxs-lookup"><span data-stu-id="d1f34-156">Note that the example does not properly instantiate its <xref:Microsoft.Win32.SafeHandles.SafeFileHandle> object.</span></span>  
  
<span data-ttu-id="d1f34-157">Im Folgenden finden Sie das allgemeine Muster für die Implementierung des Dispose-Musters für eine Basisklasse, die <xref:System.Object.Finalize%2A?displayProperty=nameWithType> überschreibt.</span><span class="sxs-lookup"><span data-stu-id="d1f34-157">Here's the general pattern for implementing the dispose pattern for a base class that overrides <xref:System.Object.Finalize%2A?displayProperty=nameWithType>.</span></span>  
  
[!code-csharp[System.IDisposable#5](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.idisposable/cs/base2.cs#5)]
[!code-vb[System.IDisposable#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.idisposable/vb/base2.vb#5)]  
  
> [!NOTE]
> <span data-ttu-id="d1f34-158">In C# überschreiben Sie <xref:System.Object.Finalize%2A?displayProperty=nameWithType> durch Definieren eines [Destruktors](../../csharp/programming-guide/classes-and-structs/destructors.md).</span><span class="sxs-lookup"><span data-stu-id="d1f34-158">In C#, you override <xref:System.Object.Finalize%2A?displayProperty=nameWithType> by defining a [destructor](../../csharp/programming-guide/classes-and-structs/destructors.md).</span></span>  
  
## <a name="implementing-the-dispose-pattern-for-a-derived-class"></a><span data-ttu-id="d1f34-159">Implementieren des Dispose-Musters für eine abgeleitete Klasse</span><span class="sxs-lookup"><span data-stu-id="d1f34-159">Implementing the dispose pattern for a derived class</span></span>

<span data-ttu-id="d1f34-160">Eine Klasse, die von einer Klasse abgeleitet ist, die die <xref:System.IDisposable>-Schnittstelle implementiert, sollte <xref:System.IDisposable> nicht implementieren, da die Basisklassenimplementierung von <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> von den abgeleiteten Klassen geerbt wird.</span><span class="sxs-lookup"><span data-stu-id="d1f34-160">A class derived from a class that implements the <xref:System.IDisposable> interface shouldn't implement <xref:System.IDisposable>, because the base class implementation of <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> is inherited by its derived classes.</span></span> <span data-ttu-id="d1f34-161">Zum Freigeben von Ressourcen einer abgeleiteten Klasse stellen Sie stattdessen Folgendes bereit:</span><span class="sxs-lookup"><span data-stu-id="d1f34-161">Instead, to release resources of a derived class, you provide the following:</span></span>  
  
- <span data-ttu-id="d1f34-162">Eine `protected Dispose(Boolean)`-Methode, die die Basisklassenmethode überschreibt und die eigentliche Freigabe der Ressourcen der abgeleiteten Klasse durchführt.</span><span class="sxs-lookup"><span data-stu-id="d1f34-162">A `protected Dispose(Boolean)` method that overrides the base class method and performs the actual work of releasing the resources of the derived class.</span></span> <span data-ttu-id="d1f34-163">Diese Methode sollte auch die `Dispose(Boolean)`-Methode der Basisklasse aufrufen und ihren disposing-Status für das Argument übergeben.</span><span class="sxs-lookup"><span data-stu-id="d1f34-163">This method should also call the `Dispose(Boolean)` method of the base class and pass its disposing status for the argument.</span></span>  
  
- <span data-ttu-id="d1f34-164">Entweder eine von <xref:System.Runtime.InteropServices.SafeHandle> abgeleitete Klasse, die die nicht verwaltete Ressource einschließt (empfohlen) oder eine Überschreibung der <xref:System.Object.Finalize%2A?displayProperty=nameWithType>-Methode.</span><span class="sxs-lookup"><span data-stu-id="d1f34-164">Either a class derived from <xref:System.Runtime.InteropServices.SafeHandle> that wraps your unmanaged resource (recommended), or an override to the <xref:System.Object.Finalize%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="d1f34-165">Die <xref:System.Runtime.InteropServices.SafeHandle>-Klasse stellt einen Finalizer bereit, wodurch Sie keinen programmieren müssen.</span><span class="sxs-lookup"><span data-stu-id="d1f34-165">The <xref:System.Runtime.InteropServices.SafeHandle> class provides a finalizer that frees you from having to code one.</span></span> <span data-ttu-id="d1f34-166">Wenn Sie einen Finalizer bereitstellen, sollte er die `Dispose(Boolean)`-Überladung mit einem *disposing*-Argument mit dem Wert `false` aufrufen.</span><span class="sxs-lookup"><span data-stu-id="d1f34-166">If you do provide a finalizer, it should call the `Dispose(Boolean)` overload with a *disposing* argument of `false`.</span></span>  
  
<span data-ttu-id="d1f34-167">Im Folgenden finden Sie das allgemeine Muster für das Implementieren des Dispose-Musters für eine abgeleitete Klasse, die ein SafeHandle verwendet:</span><span class="sxs-lookup"><span data-stu-id="d1f34-167">Here's the general pattern for implementing the dispose pattern for a derived class that uses a safe handle:</span></span>  
  
[!code-csharp[System.IDisposable#4](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.idisposable/cs/derived1.cs#4)]
[!code-vb[System.IDisposable#4](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.idisposable/vb/derived1.vb#4)]  
  
> [!NOTE]
> <span data-ttu-id="d1f34-168">Im vorherigen Beispiel wird ein <xref:Microsoft.Win32.SafeHandles.SafeFileHandle>-Objekt zum Veranschaulichen des Musters verwendet; stattdessen kann auch ein beliebiges anderes von <xref:System.Runtime.InteropServices.SafeHandle> abgeleitetes Objekt verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="d1f34-168">The previous example uses a <xref:Microsoft.Win32.SafeHandles.SafeFileHandle> object to illustrate the pattern; any object derived from <xref:System.Runtime.InteropServices.SafeHandle> could be used instead.</span></span> <span data-ttu-id="d1f34-169">Beachten Sie, dass im Beispiel das <xref:Microsoft.Win32.SafeHandles.SafeFileHandle>-Objekt nicht ordnungsgemäß instanziiert wird.</span><span class="sxs-lookup"><span data-stu-id="d1f34-169">Note that the example does not properly instantiate its <xref:Microsoft.Win32.SafeHandles.SafeFileHandle> object.</span></span>  
  
<span data-ttu-id="d1f34-170">Im Folgenden finden Sie das allgemeine Muster für das Implementieren des Dispose-Musters für eine abgeleitete Klasse, die <xref:System.Object.Finalize%2A?displayProperty=nameWithType> überschreibt:</span><span class="sxs-lookup"><span data-stu-id="d1f34-170">Here's the general pattern for implementing the dispose pattern for a derived class that overrides <xref:System.Object.Finalize%2A?displayProperty=nameWithType>:</span></span>  
  
[!code-csharp[System.IDisposable#6](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.idisposable/cs/derived2.cs#6)]
[!code-vb[System.IDisposable#6](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.idisposable/vb/derived2.vb#6)]  
  
> [!NOTE]
> <span data-ttu-id="d1f34-171">In C# überschreiben Sie <xref:System.Object.Finalize%2A?displayProperty=nameWithType> durch Definieren eines [Destruktors](../../csharp/programming-guide/classes-and-structs/destructors.md).</span><span class="sxs-lookup"><span data-stu-id="d1f34-171">In C#, you override <xref:System.Object.Finalize%2A?displayProperty=nameWithType> by defining a [destructor](../../csharp/programming-guide/classes-and-structs/destructors.md).</span></span>  
  
<a name="SafeHandles"></a>   
## <a name="using-safe-handles"></a><span data-ttu-id="d1f34-172">Verwenden von SafeHandles</span><span class="sxs-lookup"><span data-stu-id="d1f34-172">Using safe handles</span></span>

<span data-ttu-id="d1f34-173">Das Schreiben von Code für den Finalizer eines Objekts ist eine komplexe Aufgabe, die Probleme verursachen kann, wenn sie nicht ordnungsgemäß gelöst wird.</span><span class="sxs-lookup"><span data-stu-id="d1f34-173">Writing code for an object's finalizer is a complex task that can cause problems if not done correctly.</span></span> <span data-ttu-id="d1f34-174">Daher wird empfohlen, <xref:System.Runtime.InteropServices.SafeHandle?displayProperty=nameWithType>-Objekte zu erstellen, anstatt einen Finalizer zu implementieren.</span><span class="sxs-lookup"><span data-stu-id="d1f34-174">Therefore, we recommend that you construct <xref:System.Runtime.InteropServices.SafeHandle?displayProperty=nameWithType> objects instead of implementing a finalizer.</span></span>  
  
<span data-ttu-id="d1f34-175">Von der <xref:System.Runtime.InteropServices.SafeHandle?displayProperty=nameWithType>-Klasse abgeleitete Klassen vereinfachen Probleme mit der Objektlebensdauer, indem sie Handles ohne Unterbrechung zuweisen und freigeben.</span><span class="sxs-lookup"><span data-stu-id="d1f34-175">Classes derived from the <xref:System.Runtime.InteropServices.SafeHandle?displayProperty=nameWithType> class simplify object lifetime issues by assigning and releasing handles without interruption.</span></span> <span data-ttu-id="d1f34-176">Sie enthalten einen kritischen Finalizer, der auf jeden Fall ausgeführt wird, während eine Anwendungsdomäne entladen wird.</span><span class="sxs-lookup"><span data-stu-id="d1f34-176">They contain a critical finalizer that is guaranteed to run while an application domain is unloading.</span></span> <span data-ttu-id="d1f34-177">Weitere Informationen zu den Vorteilen bei der Verwendung von SafeHandle finden Sie unter <xref:System.Runtime.InteropServices.SafeHandle?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="d1f34-177">For more information about the advantages of using a safe handle, see <xref:System.Runtime.InteropServices.SafeHandle?displayProperty=nameWithType>.</span></span> <span data-ttu-id="d1f34-178">Die folgenden abgeleiteten Klassen im <xref:Microsoft.Win32.SafeHandles>-Namespace stellen SafeHandles bereit:</span><span class="sxs-lookup"><span data-stu-id="d1f34-178">The following derived classes in the <xref:Microsoft.Win32.SafeHandles> namespace provide safe handles:</span></span>  
  
- <span data-ttu-id="d1f34-179">Die Klasse <xref:Microsoft.Win32.SafeHandles.SafeFileHandle>, <xref:Microsoft.Win32.SafeHandles.SafeMemoryMappedFileHandle> und <xref:Microsoft.Win32.SafeHandles.SafePipeHandle>, für Dateien, Speicherabbilddateien und Pipes.</span><span class="sxs-lookup"><span data-stu-id="d1f34-179">The <xref:Microsoft.Win32.SafeHandles.SafeFileHandle>, <xref:Microsoft.Win32.SafeHandles.SafeMemoryMappedFileHandle>, and <xref:Microsoft.Win32.SafeHandles.SafePipeHandle> class, for files, memory mapped files, and pipes.</span></span>  
  
- <span data-ttu-id="d1f34-180">Die <xref:Microsoft.Win32.SafeHandles.SafeMemoryMappedViewHandle>-Klasse, für Speicheransichten.</span><span class="sxs-lookup"><span data-stu-id="d1f34-180">The <xref:Microsoft.Win32.SafeHandles.SafeMemoryMappedViewHandle> class, for memory views.</span></span>  
  
- <span data-ttu-id="d1f34-181">Die Klassen <xref:Microsoft.Win32.SafeHandles.SafeNCryptKeyHandle>, <xref:Microsoft.Win32.SafeHandles.SafeNCryptProviderHandle> und <xref:Microsoft.Win32.SafeHandles.SafeNCryptSecretHandle>, für Kryptografiekonstrukte.</span><span class="sxs-lookup"><span data-stu-id="d1f34-181">The <xref:Microsoft.Win32.SafeHandles.SafeNCryptKeyHandle>, <xref:Microsoft.Win32.SafeHandles.SafeNCryptProviderHandle>, and <xref:Microsoft.Win32.SafeHandles.SafeNCryptSecretHandle> classes, for cryptography constructs.</span></span>  
  
- <span data-ttu-id="d1f34-182">Die <xref:Microsoft.Win32.SafeHandles.SafeRegistryHandle>-Klasse, für Registrierungsschlüssel.</span><span class="sxs-lookup"><span data-stu-id="d1f34-182">The <xref:Microsoft.Win32.SafeHandles.SafeRegistryHandle> class, for registry keys.</span></span>  
  
- <span data-ttu-id="d1f34-183">Die <xref:Microsoft.Win32.SafeHandles.SafeWaitHandle>-Klasse, für Wait-Handles.</span><span class="sxs-lookup"><span data-stu-id="d1f34-183">The <xref:Microsoft.Win32.SafeHandles.SafeWaitHandle> class, for wait handles.</span></span>  
  
<a name="base"></a>   
## <a name="using-a-safe-handle-to-implement-the-dispose-pattern-for-a-base-class"></a><span data-ttu-id="d1f34-184">Verwenden eines SafeHandles zum Implementieren des Dispose-Musters für eine Basisklasse</span><span class="sxs-lookup"><span data-stu-id="d1f34-184">Using a safe handle to implement the dispose pattern for a base class</span></span>

<span data-ttu-id="d1f34-185">Das folgende Beispiel zeigt das Dispose-Muster für eine Basisklasse, `DisposableStreamResource`, die ein SafeHandle verwendet, um nicht verwaltete Ressourcen zu kapseln.</span><span class="sxs-lookup"><span data-stu-id="d1f34-185">The following example illustrates the dispose pattern for a base class, `DisposableStreamResource`, that uses a safe handle to encapsulate unmanaged resources.</span></span> <span data-ttu-id="d1f34-186">Es definiert eine `DisposableResource`-Klasse, die ein <xref:Microsoft.Win32.SafeHandles.SafeFileHandle> verwendet, um ein <xref:System.IO.Stream>-Objekt zu umschließen, das eine offene Datei darstellt.</span><span class="sxs-lookup"><span data-stu-id="d1f34-186">It defines a `DisposableResource` class that uses a <xref:Microsoft.Win32.SafeHandles.SafeFileHandle> to wrap a <xref:System.IO.Stream> object that represents an open file.</span></span> <span data-ttu-id="d1f34-187">Die `DisposableResource`-Methode enthält auch eine einzelne Eigenschaft, `Size`, die die Gesamtzahl von Bytes im Dateistream zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="d1f34-187">The `DisposableResource` method also includes a single property, `Size`, that returns the total number of bytes in the file stream.</span></span>  
  
[!code-csharp[Conceptual.Disposable#9](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.disposable/cs/base1.cs#9)]
[!code-vb[Conceptual.Disposable#9](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.disposable/vb/base1.vb#9)]  
  
<a name="derived"></a>   
## <a name="using-a-safe-handle-to-implement-the-dispose-pattern-for-a-derived-class"></a><span data-ttu-id="d1f34-188">Verwenden eines SafeHandles zum Implementieren des Dispose-Musters für eine abgeleitete Klasse</span><span class="sxs-lookup"><span data-stu-id="d1f34-188">Using a safe handle to implement the dispose pattern for a derived class</span></span>

<span data-ttu-id="d1f34-189">Das folgende Beispiel zeigt das Dispose-Muster für eine abgeleitete Klasse, `DisposableStreamResource2`, die von der `DisposableStreamResource`-Klasse erbt, die im vorherigen Beispiel dargestellt wurde.</span><span class="sxs-lookup"><span data-stu-id="d1f34-189">The following example illustrates the dispose pattern for a derived class, `DisposableStreamResource2`, that inherits from the `DisposableStreamResource` class presented in the previous example.</span></span> <span data-ttu-id="d1f34-190">Die Klasse fügt eine zusätzliche Methode, `WriteFileInfo`, hinzu und verwendet ein <xref:Microsoft.Win32.SafeHandles.SafeFileHandle>-Objekt, um das Handle der überschreibbaren Datei zu umschließen.</span><span class="sxs-lookup"><span data-stu-id="d1f34-190">The class adds an additional method, `WriteFileInfo`, and uses a <xref:Microsoft.Win32.SafeHandles.SafeFileHandle> object to wrap the handle of the writable file.</span></span>  
  
[!code-csharp[Conceptual.Disposable#10](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.disposable/cs/derived1.cs#10)]
[!code-vb[Conceptual.Disposable#10](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.disposable/vb/derived1.vb#10)]  
  
## <a name="see-also"></a><span data-ttu-id="d1f34-191">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="d1f34-191">See also</span></span>

- <xref:System.GC.SuppressFinalize%2A>
- <xref:System.IDisposable>
- <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType>
- <xref:Microsoft.Win32.SafeHandles>
- <xref:System.Runtime.InteropServices.SafeHandle?displayProperty=nameWithType>
- <xref:System.Object.Finalize%2A?displayProperty=nameWithType>
- [<span data-ttu-id="d1f34-192">Vorgehensweise: Definieren und Verarbeiten von Klassen und Strukturen (C++/CLI)</span><span class="sxs-lookup"><span data-stu-id="d1f34-192">How to: Define and Consume Classes and Structs (C++/CLI)</span></span>](/cpp/dotnet/how-to-define-and-consume-classes-and-structs-cpp-cli)
- [<span data-ttu-id="d1f34-193">Dispose-Muster</span><span class="sxs-lookup"><span data-stu-id="d1f34-193">Dispose Pattern</span></span>](implementing-dispose.md)
