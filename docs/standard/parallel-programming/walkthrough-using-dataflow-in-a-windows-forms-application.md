---
title: 'Exemplarische Vorgehensweise: Datenfluss in einer Windows Forms-Anwendung verwenden'
ms.date: 03/30/2017
helpviewer_keywords:
- TPL dataflow library, in Windows Forms
- Task Parallel Library, dataflows
- Windows Forms, and TPL
ms.assetid: 9c65cdf7-660c-409f-89ea-59d7ec8e127c
ms.openlocfilehash: c09259afdc5ede32791ba895ca012cdc2a0a1c18
ms.sourcegitcommit: 965a5af7918acb0a3fd3baf342e15d511ef75188
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 11/18/2020
ms.locfileid: "94829946"
---
# <a name="walkthrough-using-dataflow-in-a-windows-forms-application"></a><span data-ttu-id="087e9-102">Exemplarische Vorgehensweise: Datenfluss in einer Windows Forms-Anwendung verwenden</span><span class="sxs-lookup"><span data-stu-id="087e9-102">Walkthrough: Using Dataflow in a Windows Forms Application</span></span>
<span data-ttu-id="087e9-103">Dieses Dokument veranschaulicht, wie ein Netzwerk von Datenflussblöcken erstellt wird, die eine Bildverarbeitung in einer Windows Forms-Anwendung durchführen.</span><span class="sxs-lookup"><span data-stu-id="087e9-103">This document demonstrates how to create a network of dataflow blocks that perform image processing in a Windows Forms application.</span></span>  
  
 <span data-ttu-id="087e9-104">In diesem Beispiel werden Bilddateien aus dem angegebenen Ordner geladen, es wird ein zusammengesetztes Bild erstellt und das Ergebnis wird angezeigt.</span><span class="sxs-lookup"><span data-stu-id="087e9-104">This example loads image files from the specified folder, creates a composite image, and displays the result.</span></span> <span data-ttu-id="087e9-105">Im Beispiel wird das Datenflussmodell verwendet, um Bilder durch das Netzwerk zu leiten.</span><span class="sxs-lookup"><span data-stu-id="087e9-105">The example uses the dataflow model to route images through the network.</span></span> <span data-ttu-id="087e9-106">Im Datenflussmodell kommunizieren unabhängige Komponenten eines Programms durch Senden von Nachrichten miteinander.</span><span class="sxs-lookup"><span data-stu-id="087e9-106">In the dataflow model, independent components of a program communicate with one another by sending messages.</span></span> <span data-ttu-id="087e9-107">Wenn eine Komponente eine Nachricht empfängt, führt sie eine Aktion aus und übergibt dann das Ergebnis an eine andere Komponente.</span><span class="sxs-lookup"><span data-stu-id="087e9-107">When a component receives a message, it performs some action and then passes the result to another component.</span></span> <span data-ttu-id="087e9-108">Dies ist vergleichbar mit dem Ablaufsteuerungsmodell, in dem eine Anwendung Steuerungsstrukturen wie bedingte Anweisungen, Schleifen usw.verwendet, um die Reihenfolge der Vorgänge in einem Programm zu steuern.</span><span class="sxs-lookup"><span data-stu-id="087e9-108">Compare this with the control flow model, in which an application uses control structures, for example, conditional statements, loops, and so on, to control the order of operations in a program.</span></span>  
  
## <a name="prerequisites"></a><span data-ttu-id="087e9-109">Voraussetzungen</span><span class="sxs-lookup"><span data-stu-id="087e9-109">Prerequisites</span></span>  
 <span data-ttu-id="087e9-110">Lesen Sie das Thema [Datenfluss](dataflow-task-parallel-library.md), bevor Sie mit dieser exemplarischen Vorgehensweise beginnen.</span><span class="sxs-lookup"><span data-stu-id="087e9-110">Read [Dataflow](dataflow-task-parallel-library.md) before you start this walkthrough.</span></span>  

[!INCLUDE [tpl-install-instructions](../../../includes/tpl-install-instructions.md)]

## <a name="sections"></a><span data-ttu-id="087e9-111">Abschnitte</span><span class="sxs-lookup"><span data-stu-id="087e9-111">Sections</span></span>  
 <span data-ttu-id="087e9-112">Diese exemplarische Vorgehensweise enthält folgende Abschnitte:</span><span class="sxs-lookup"><span data-stu-id="087e9-112">This walkthrough contains the following sections:</span></span>  
  
- [<span data-ttu-id="087e9-113">Erstellen der Windows Forms-Anwendung</span><span class="sxs-lookup"><span data-stu-id="087e9-113">Creating the Windows Forms Application</span></span>](#winforms)  
  
- [<span data-ttu-id="087e9-114">Erstellen des Datenflussnetzwerks</span><span class="sxs-lookup"><span data-stu-id="087e9-114">Creating the Dataflow Network</span></span>](#network)  
  
- [<span data-ttu-id="087e9-115">Verbinden des Datenflussnetzwerks mit der Benutzeroberfläche</span><span class="sxs-lookup"><span data-stu-id="087e9-115">Connecting the Dataflow Network to the User Interface</span></span>](#ui)  
  
- [<span data-ttu-id="087e9-116">Vollständiges Beispiel</span><span class="sxs-lookup"><span data-stu-id="087e9-116">The Complete Example</span></span>](#complete)  
  
<a name="winforms"></a>
## <a name="creating-the-windows-forms-application"></a><span data-ttu-id="087e9-117">Erstellen der Windows Forms-Anwendung</span><span class="sxs-lookup"><span data-stu-id="087e9-117">Creating the Windows Forms Application</span></span>  
 <span data-ttu-id="087e9-118">In diesem Abschnitt wird beschrieben, wie Sie die grundlegende Windows Forms-Anwendung erstellen und Steuerelemente zum Hauptformular hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="087e9-118">This section describes how to create the basic Windows Forms application and add controls to the main form.</span></span>  
  
### <a name="to-create-the-windows-forms-application"></a><span data-ttu-id="087e9-119">Erstellen der Windows Forms-Anwendung</span><span class="sxs-lookup"><span data-stu-id="087e9-119">To Create the Windows Forms Application</span></span>  
  
1. <span data-ttu-id="087e9-120">Erstellen Sie in Visual Studio ein Visual C#- oder Visual Basic-Projekt des Typs **Windows Forms-Anwendung**.</span><span class="sxs-lookup"><span data-stu-id="087e9-120">In Visual Studio, create a Visual C# or Visual Basic **Windows Forms Application** project.</span></span> <span data-ttu-id="087e9-121">In diesem Dokument hat das Projekt den Namen `CompositeImages`.</span><span class="sxs-lookup"><span data-stu-id="087e9-121">In this document, the project is named `CompositeImages`.</span></span>  
  
2. <span data-ttu-id="087e9-122">Fügen Sie im Formulardesigner für das Hauptformular „Form1.cs“ („Form1.vb“ in Visual Basic) ein <xref:System.Windows.Forms.ToolStrip>-Steuerelement hinzu.</span><span class="sxs-lookup"><span data-stu-id="087e9-122">On the form designer for the main form, Form1.cs (Form1.vb for Visual Basic), add a <xref:System.Windows.Forms.ToolStrip> control.</span></span>  
  
3. <span data-ttu-id="087e9-123">Fügen Sie dem <xref:System.Windows.Forms.ToolStrip>-Steuerelement ein <xref:System.Windows.Forms.ToolStripButton>-Steuerelement hinzu.</span><span class="sxs-lookup"><span data-stu-id="087e9-123">Add a <xref:System.Windows.Forms.ToolStripButton> control to the <xref:System.Windows.Forms.ToolStrip> control.</span></span> <span data-ttu-id="087e9-124">Legen Sie die <xref:System.Windows.Forms.ToolStripItem.DisplayStyle%2A>-Eigenschaft auf <xref:System.Windows.Forms.ToolStripItemDisplayStyle.Text> und die <xref:System.Windows.Forms.ToolStripItem.Text%2A>-Eigenschaft auf **Ordner auswählen** fest.</span><span class="sxs-lookup"><span data-stu-id="087e9-124">Set the <xref:System.Windows.Forms.ToolStripItem.DisplayStyle%2A> property to <xref:System.Windows.Forms.ToolStripItemDisplayStyle.Text> and the <xref:System.Windows.Forms.ToolStripItem.Text%2A> property to **Choose Folder**.</span></span>  
  
4. <span data-ttu-id="087e9-125">Fügen Sie dem <xref:System.Windows.Forms.ToolStrip>-Steuerelement ein zweites <xref:System.Windows.Forms.ToolStripButton>-Steuerelement hinzu.</span><span class="sxs-lookup"><span data-stu-id="087e9-125">Add a second <xref:System.Windows.Forms.ToolStripButton> control to the <xref:System.Windows.Forms.ToolStrip> control.</span></span> <span data-ttu-id="087e9-126">Legen Sie die <xref:System.Windows.Forms.ToolStripItem.DisplayStyle%2A>-Eigenschaft auf <xref:System.Windows.Forms.ToolStripItemDisplayStyle.Text>, die <xref:System.Windows.Forms.ToolStripItem.Text%2A>-Eigenschaft auf **Abbrechen** und die <xref:System.Windows.Forms.ToolStripItem.Enabled%2A>-Eigenschaft auf `False` fest.</span><span class="sxs-lookup"><span data-stu-id="087e9-126">Set the <xref:System.Windows.Forms.ToolStripItem.DisplayStyle%2A> property to <xref:System.Windows.Forms.ToolStripItemDisplayStyle.Text>, the <xref:System.Windows.Forms.ToolStripItem.Text%2A> property to **Cancel**, and the <xref:System.Windows.Forms.ToolStripItem.Enabled%2A> property to `False`.</span></span>  
  
5. <span data-ttu-id="087e9-127">Fügen Sie dem Hauptformular ein <xref:System.Windows.Forms.PictureBox>-Objekt hinzu.</span><span class="sxs-lookup"><span data-stu-id="087e9-127">Add a <xref:System.Windows.Forms.PictureBox> object to the main form.</span></span> <span data-ttu-id="087e9-128">Legen Sie die <xref:System.Windows.Forms.Control.Dock%2A>-Eigenschaft auf <xref:System.Windows.Forms.DockStyle.Fill> fest.</span><span class="sxs-lookup"><span data-stu-id="087e9-128">Set the <xref:System.Windows.Forms.Control.Dock%2A> property to <xref:System.Windows.Forms.DockStyle.Fill>.</span></span>  
  
<a name="network"></a>
## <a name="creating-the-dataflow-network"></a><span data-ttu-id="087e9-129">Erstellen des Datenflussnetzwerks</span><span class="sxs-lookup"><span data-stu-id="087e9-129">Creating the Dataflow Network</span></span>  
 <span data-ttu-id="087e9-130">Dieser Abschnitt beschreibt das Erstellen eines Datenflussnetzwerks, das Bildverarbeitung durchführt.</span><span class="sxs-lookup"><span data-stu-id="087e9-130">This section describes how to create the dataflow network that performs image processing.</span></span>  
  
### <a name="to-create-the-dataflow-network"></a><span data-ttu-id="087e9-131">Erstellen des Datenflussnetzwerks</span><span class="sxs-lookup"><span data-stu-id="087e9-131">To Create the Dataflow Network</span></span>  
  
1. <span data-ttu-id="087e9-132">Fügen Sie Ihrem Projekt einen Verweis auf „System.Threading.Tasks.Dataflow.dll“ hinzu.</span><span class="sxs-lookup"><span data-stu-id="087e9-132">Add a reference to System.Threading.Tasks.Dataflow.dll to your project.</span></span>  
  
2. <span data-ttu-id="087e9-133">Stellen Sie sicher, dass „Form1.cs“ („Form1.vb“ für Visual Basic) die folgenden `using`-Anweisungen (`Using` in Visual Basic) enthält:</span><span class="sxs-lookup"><span data-stu-id="087e9-133">Ensure that Form1.cs (Form1.vb for Visual Basic) contains the following `using` (`Using` in Visual Basic) statements:</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#1)]  
  
3. <span data-ttu-id="087e9-134">Fügen Sie der `Form1`-Klasse die folgenden Datenmember hinzu:</span><span class="sxs-lookup"><span data-stu-id="087e9-134">Add the following data members to the `Form1` class:</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#2](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#2)]  
  
4. <span data-ttu-id="087e9-135">Fügen Sie der `Form1`-Klasse die folgende `CreateImageProcessingNetwork`-Methode hinzu:</span><span class="sxs-lookup"><span data-stu-id="087e9-135">Add the following method, `CreateImageProcessingNetwork`, to the `Form1` class.</span></span> <span data-ttu-id="087e9-136">Diese Methode erstellt das Bildverarbeitungsnetzwerk.</span><span class="sxs-lookup"><span data-stu-id="087e9-136">This method creates the image processing network.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#3](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#3)]  
  
5. <span data-ttu-id="087e9-137">Implementieren Sie die `LoadBitmaps`-Methode.</span><span class="sxs-lookup"><span data-stu-id="087e9-137">Implement the `LoadBitmaps` method.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#4](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#4)]  
  
6. <span data-ttu-id="087e9-138">Implementieren Sie die `CreateCompositeBitmap`-Methode.</span><span class="sxs-lookup"><span data-stu-id="087e9-138">Implement the `CreateCompositeBitmap` method.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#5](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#5)]  
  
    > [!NOTE]
    > <span data-ttu-id="087e9-139">Die C#-Version der `CreateCompositeBitmap`-Methode verwendet Zeiger, um eine effiziente Verarbeitung der <xref:System.Drawing.Bitmap?displayProperty=nameWithType>-Objekte zu ermöglichen.</span><span class="sxs-lookup"><span data-stu-id="087e9-139">The C# version of the `CreateCompositeBitmap` method uses pointers to enable efficient processing of the <xref:System.Drawing.Bitmap?displayProperty=nameWithType> objects.</span></span> <span data-ttu-id="087e9-140">Aus diesem Grund müssen Sie die Option **Unsicheren Code zulassen** in Ihrem Projekt aktivieren, um das [unsafe](../../csharp/language-reference/keywords/unsafe.md)-Schlüsselwort zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="087e9-140">Therefore, you must enable the **Allow unsafe code** option in your project in order to use the [unsafe](../../csharp/language-reference/keywords/unsafe.md) keyword.</span></span> <span data-ttu-id="087e9-141">Weitere Informationen zum Aktivieren von unsicheren Codes in einem Visual C#-Projekt finden Sie unter [Seite „Erstellen“, Projekt-Designer (C#)](/visualstudio/ide/reference/build-page-project-designer-csharp).</span><span class="sxs-lookup"><span data-stu-id="087e9-141">For more information about how to enable unsafe code in a Visual C# project, see [Build Page, Project Designer (C#)](/visualstudio/ide/reference/build-page-project-designer-csharp).</span></span>  
  
 <span data-ttu-id="087e9-142">In der folgenden Tabelle werden die Member des Netzwerks beschrieben.</span><span class="sxs-lookup"><span data-stu-id="087e9-142">The following table describes the members of the network.</span></span>  
  
|<span data-ttu-id="087e9-143">Member</span><span class="sxs-lookup"><span data-stu-id="087e9-143">Member</span></span>|<span data-ttu-id="087e9-144">Geben Sie Folgendes ein:</span><span class="sxs-lookup"><span data-stu-id="087e9-144">Type</span></span>|<span data-ttu-id="087e9-145">Beschreibung</span><span class="sxs-lookup"><span data-stu-id="087e9-145">Description</span></span>|  
|------------|----------|-----------------|  
|`loadBitmaps`|<xref:System.Threading.Tasks.Dataflow.TransformBlock%602>|<span data-ttu-id="087e9-146">Akzeptiert einen Ordnerpfad als Eingabe und erzeugt eine Auflistung von <xref:System.Drawing.Bitmap>-Objekten als Ausgabe.</span><span class="sxs-lookup"><span data-stu-id="087e9-146">Takes a folder path as input and produces a collection of <xref:System.Drawing.Bitmap> objects as output.</span></span>|  
|`createCompositeBitmap`|<xref:System.Threading.Tasks.Dataflow.TransformBlock%602>|<span data-ttu-id="087e9-147">Akzeptiert eine Auflistung von <xref:System.Drawing.Bitmap>-Objekten als Eingabe und erzeugt eine zusammengesetzte Bitmap als Ausgabe.</span><span class="sxs-lookup"><span data-stu-id="087e9-147">Takes a collection of <xref:System.Drawing.Bitmap> objects as input and produces a composite bitmap as output.</span></span>|  
|`displayCompositeBitmap`|<xref:System.Threading.Tasks.Dataflow.ActionBlock%601>|<span data-ttu-id="087e9-148">Zeigt die zusammengesetzte Bitmap im Formular an.</span><span class="sxs-lookup"><span data-stu-id="087e9-148">Displays the composite bitmap on the form.</span></span>|  
|`operationCancelled`|<xref:System.Threading.Tasks.Dataflow.ActionBlock%601>|<span data-ttu-id="087e9-149">Zeigt ein Bild an, um anzugeben, dass der Vorgang abgebrochen wird, und ermöglicht es dem Benutzer, einen anderen Ordner auszuwählen.</span><span class="sxs-lookup"><span data-stu-id="087e9-149">Displays an image to indicate that the operation is canceled and enables the user to select another folder.</span></span>|  
  
 <span data-ttu-id="087e9-150">Um die Datenflussblöcke zu einem Netzwerk zu verbinden, wird in diesem Beispiel die <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A>-Methode verwendet.</span><span class="sxs-lookup"><span data-stu-id="087e9-150">To connect the dataflow blocks to form a network, this example uses the <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A> method.</span></span> <span data-ttu-id="087e9-151">Die <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A>-Methode enthält eine überladene Version, die ein <xref:System.Predicate%601>-Objekt akzeptiert, das definiert, ob der Zielblock eine Nachricht akzeptiert oder ablehnt.</span><span class="sxs-lookup"><span data-stu-id="087e9-151">The <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A> method contains an overloaded version that takes a <xref:System.Predicate%601> object that determines whether the target block accepts or rejects a message.</span></span> <span data-ttu-id="087e9-152">Dieser Filtermechanismus aktiviert Nachrichtenblöcke so, dass sie nur bestimmte Werte empfangen.</span><span class="sxs-lookup"><span data-stu-id="087e9-152">This filtering mechanism enables message blocks to receive only certain values.</span></span> <span data-ttu-id="087e9-153">In diesem Beispiel kann das Netzwerk auf zwei Arten verzweigen.</span><span class="sxs-lookup"><span data-stu-id="087e9-153">In this example, the network can branch in one of two ways.</span></span> <span data-ttu-id="087e9-154">Die Hauptverzweigung lädt die Bilder vom Datenträger, erstellt das zusammengesetzte Bild und zeigt das Bild auf dem Formular an.</span><span class="sxs-lookup"><span data-stu-id="087e9-154">The main branch loads the images from disk, creates the composite image, and displays that image on the form.</span></span> <span data-ttu-id="087e9-155">Die alternative Verzweigung bricht den aktuellen Vorgang ab.</span><span class="sxs-lookup"><span data-stu-id="087e9-155">The alternate branch cancels the current operation.</span></span> <span data-ttu-id="087e9-156">Die <xref:System.Predicate%601>-Objekte aktivieren die Datenflussblöcke entlang der Hauptverzweigung, um zur alternativen Verzweigung zu wechseln, indem bestimmte Nachrichten zurückgewiesen werden.</span><span class="sxs-lookup"><span data-stu-id="087e9-156">The <xref:System.Predicate%601> objects enable the dataflow blocks along the main branch to switch to the alternative branch by rejecting certain messages.</span></span> <span data-ttu-id="087e9-157">Wenn der Benutzer beispielsweise den Vorgang abbricht, erzeugt der Datenflussblock `createCompositeBitmap``null` (`Nothing` in Visual Basic) als Ausgabe.</span><span class="sxs-lookup"><span data-stu-id="087e9-157">For example, if the user cancels the operation, the dataflow block `createCompositeBitmap` produces `null` (`Nothing` in Visual Basic) as its output.</span></span> <span data-ttu-id="087e9-158">Der Datenflussblock `displayCompositeBitmap` lehnt `null`-Eingabewerte ab, und daher wird die Nachricht `operationCancelled` bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="087e9-158">The dataflow block `displayCompositeBitmap` rejects `null` input values, and therefore, the message is offered to `operationCancelled`.</span></span> <span data-ttu-id="087e9-159">Der Datenflussblock `operationCancelled` akzeptiert alle Nachrichten und zeigt daher ein Bild an, um anzugeben, dass der Vorgang abgebrochen wird.</span><span class="sxs-lookup"><span data-stu-id="087e9-159">The dataflow block `operationCancelled` accepts all messages and therefore, displays an image to indicate that the operation is canceled.</span></span>  
  
 <span data-ttu-id="087e9-160">Die folgende Abbildung zeigt das Bildverarbeitungsnetzwerk:</span><span class="sxs-lookup"><span data-stu-id="087e9-160">The following illustration shows the image processing network:</span></span>  
  
 ![Abbildung des Bildverarbeitungsnetzwerks](./media/walkthrough-using-dataflow-in-a-windows-forms-application/dataflow-winforms-image-processing.png)  
  
 <span data-ttu-id="087e9-162">Da die `displayCompositeBitmap`- und `operationCancelled`-Datenflussblöcke als Benutzeroberfläche agiert, ist es wichtig, dass diese Aktionen im Benutzeroberflächenthread erfolgen.</span><span class="sxs-lookup"><span data-stu-id="087e9-162">Because the `displayCompositeBitmap` and `operationCancelled` dataflow blocks act on the user interface, it is important that these actions occur on the user-interface thread.</span></span> <span data-ttu-id="087e9-163">Um dies zu erreichen, stellen diese Objekte während der Erstellung ein <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions>-Objekt bereit, für das die <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A>-Eigenschaft auf <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType> festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="087e9-163">To accomplish this, during construction, these objects each provide a <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions> object that has the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A> property set to <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="087e9-164">Die <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType>-Methode erstellt ein <xref:System.Threading.Tasks.TaskScheduler>-Objekt, das Arbeiten im aktuellen Synchronisierungskontext durchführt.</span><span class="sxs-lookup"><span data-stu-id="087e9-164">The <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType> method creates a <xref:System.Threading.Tasks.TaskScheduler> object that performs work on the current synchronization context.</span></span> <span data-ttu-id="087e9-165">Da die `CreateImageProcessingNetwork`-Methode vom Handler der Schaltfläche **Ordner auswählen** aufgerufen wird, die im Benutzeroberflächenthread ausgeführt wird, werden die Aktionen für den `displayCompositeBitmap`- und den `operationCancelled`-Datenflussblock ebenfalls im Benutzeroberflächenthread ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="087e9-165">Because the `CreateImageProcessingNetwork` method is called from the handler of the **Choose Folder** button, which runs on the user-interface thread, the actions for the `displayCompositeBitmap` and `operationCancelled` dataflow blocks also run on the user-interface thread.</span></span>  
  
 <span data-ttu-id="087e9-166">In diesem Beispiel wird ein gemeinsames Abbruchtoken verwendet, anstatt die <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A>-Eigenschaft festzulegen, da die <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A>-Eigenschaft die Ausführung des Datenflussblocks endgültig abbricht.</span><span class="sxs-lookup"><span data-stu-id="087e9-166">This example uses a shared cancellation token instead of setting the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> property because the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> property permanently cancels dataflow block execution.</span></span> <span data-ttu-id="087e9-167">Dank eines Abbruchtokens kann dieses Beispiel das gleiche Datenflussnetzwerk mehrmals wiederverwenden, und zwar selbst dann, wenn der Benutzer einen oder mehrere Vorgänge abbricht.</span><span class="sxs-lookup"><span data-stu-id="087e9-167">A cancellation token enables this example to reuse the same dataflow network multiple times, even when the user cancels one or more operations.</span></span> <span data-ttu-id="087e9-168">Ein Beispiel für die Verwendung von <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> für den endgültigen Abbruch der Ausführung des Datenflussblocks finden Sie unter [Gewusst wie: Abbrechen eines Datenflussblocks](how-to-cancel-a-dataflow-block.md).</span><span class="sxs-lookup"><span data-stu-id="087e9-168">For an example that uses <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> to permanently cancel the execution of a dataflow block, see [How to: Cancel a Dataflow Block](how-to-cancel-a-dataflow-block.md).</span></span>  
  
<a name="ui"></a>
## <a name="connecting-the-dataflow-network-to-the-user-interface"></a><span data-ttu-id="087e9-169">Verbinden des Datenflussnetzwerks mit der Benutzeroberfläche</span><span class="sxs-lookup"><span data-stu-id="087e9-169">Connecting the Dataflow Network to the User Interface</span></span>  
 <span data-ttu-id="087e9-170">In diesem Abschnitt wird beschrieben, wie Sie das Datenflussnetzwerk mit der Benutzeroberfläche verbinden.</span><span class="sxs-lookup"><span data-stu-id="087e9-170">This section describes how to connect the dataflow network to the user interface.</span></span> <span data-ttu-id="087e9-171">Die Erstellung des zusammengesetzten Bildes und der Abbruch des Vorgangs werden über die Schaltflächen **Ordner auswählen** und **Abbrechen** initiiert.</span><span class="sxs-lookup"><span data-stu-id="087e9-171">The creation of the composite image and cancellation of the operation are initiated from the **Choose Folder** and **Cancel** buttons.</span></span> <span data-ttu-id="087e9-172">Wenn der Benutzer eine dieser Schaltflächen auswählt, wird die entsprechende Aktion auf asynchrone Weise initiiert.</span><span class="sxs-lookup"><span data-stu-id="087e9-172">When the user chooses either of these buttons, the appropriate action is initiated in an asynchronous manner.</span></span>  
  
### <a name="to-connect-the-dataflow-network-to-the-user-interface"></a><span data-ttu-id="087e9-173">Verbinden des Datenflussnetzwerks mit der Benutzeroberfläche</span><span class="sxs-lookup"><span data-stu-id="087e9-173">To Connect the Dataflow Network to the User Interface</span></span>  
  
1. <span data-ttu-id="087e9-174">Erstellen Sie im Formulardesigner für das Hauptformular einen Ereignishandler für das <xref:System.Windows.Forms.ToolStripItem.Click>-Ereignis der Schaltfläche **Ordner auswählen**.</span><span class="sxs-lookup"><span data-stu-id="087e9-174">On the form designer for the main form, create an event handler for the <xref:System.Windows.Forms.ToolStripItem.Click> event for the **Choose Folder** button.</span></span>  
  
2. <span data-ttu-id="087e9-175">Implementieren Sie das <xref:System.Windows.Forms.ToolStripItem.Click>-Ereignis für die Schaltfläche **Ordner auswählen**.</span><span class="sxs-lookup"><span data-stu-id="087e9-175">Implement the <xref:System.Windows.Forms.ToolStripItem.Click> event for the **Choose Folder** button.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#6](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#6)]  
  
3. <span data-ttu-id="087e9-176">Erstellen Sie im Formulardesigner für das Hauptformular einen Ereignishandler für das <xref:System.Windows.Forms.ToolStripItem.Click>-Ereignis der Schaltfläche **Abbrechen**.</span><span class="sxs-lookup"><span data-stu-id="087e9-176">On the form designer for the main form, create an event handler for the <xref:System.Windows.Forms.ToolStripItem.Click> event for the **Cancel** button.</span></span>  
  
4. <span data-ttu-id="087e9-177">Implementieren Sie das <xref:System.Windows.Forms.ToolStripItem.Click>-Ereignis für die Schaltfläche **Abbrechen**.</span><span class="sxs-lookup"><span data-stu-id="087e9-177">Implement the <xref:System.Windows.Forms.ToolStripItem.Click> event for the **Cancel** button.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#7](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#7)]  
  
<a name="complete"></a>
## <a name="the-complete-example"></a><span data-ttu-id="087e9-178">Vollständiges Beispiel</span><span class="sxs-lookup"><span data-stu-id="087e9-178">The Complete Example</span></span>  
 <span data-ttu-id="087e9-179">Das folgende Beispiel enthält den vollständigen Code für diese exemplarische Vorgehensweise.</span><span class="sxs-lookup"><span data-stu-id="087e9-179">The following example shows the complete code for this walkthrough.</span></span>  
  
 [!code-csharp[TPLDataflow_CompositeImages#100](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#100)]  
  
 <span data-ttu-id="087e9-180">Die folgende Abbildung zeigt die normale Ausgabe für den gemeinsamen Ordner „\Sample Pictures\“.</span><span class="sxs-lookup"><span data-stu-id="087e9-180">The following illustration shows typical output for the common \Sample Pictures\ folder.</span></span>  
  
 <span data-ttu-id="087e9-181">![Die Windows Forms-Anwendung](media/tpldataflow-compositeimages.gif "TPLDataflow_CompositeImages")</span><span class="sxs-lookup"><span data-stu-id="087e9-181">![The Windows Forms Application](media/tpldataflow-compositeimages.gif "TPLDataflow_CompositeImages")</span></span>  

## <a name="see-also"></a><span data-ttu-id="087e9-182">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="087e9-182">See also</span></span>

- [<span data-ttu-id="087e9-183">Dataflow (Datenfluss)</span><span class="sxs-lookup"><span data-stu-id="087e9-183">Dataflow</span></span>](dataflow-task-parallel-library.md)
