---
title: 'Gewusst wie: Einen Taskplaner in einem Datenflussblock angeben'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- TPL dataflow library, linking to task scheduler in TPL
- Task Parallel Library, dataflows
- task scheduler, linking from TPL
ms.assetid: 27ece374-ed5b-49ef-9cec-b20db34a65e8
ms.openlocfilehash: b8c27c1ca61356b36183bb74b8360e41f5324d25
ms.sourcegitcommit: d8020797a6657d0fbbdff362b80300815f682f94
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 11/24/2020
ms.locfileid: "95722439"
---
# <a name="how-to-specify-a-task-scheduler-in-a-dataflow-block"></a><span data-ttu-id="80397-102">Gewusst wie: Einen Taskplaner in einem Datenflussblock angeben</span><span class="sxs-lookup"><span data-stu-id="80397-102">How to: Specify a Task Scheduler in a Dataflow Block</span></span>

<span data-ttu-id="80397-103">Dieses Dokument veranschaulicht, wie Sie einen bestimmten Taskplaner zuweisen, wenn Sie Datenfluss in Ihrer Anwendung verwenden.</span><span class="sxs-lookup"><span data-stu-id="80397-103">This document demonstrates how to associate a specific task scheduler when you use dataflow in your application.</span></span> <span data-ttu-id="80397-104">Das Beispiel verwendet die <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair?displayProperty=nameWithType>-Klasse in einer Windows Forms-Anwendung, um anzuzeigen, wann die Readeraufgaben aktiv sind und wann eine Writeraufgabe aktiv ist.</span><span class="sxs-lookup"><span data-stu-id="80397-104">The example uses the <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair?displayProperty=nameWithType> class in a Windows Forms application to show when reader tasks are active and when a writer task is active.</span></span> <span data-ttu-id="80397-105">Darüber hinaus verwendet das Beispiel die <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType>-Methode, um zu ermögliche, dass ein Datenflussblock im Benutzeroberflächenthread ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="80397-105">It also uses the <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType> method to enable a dataflow block to run on the user-interface thread.</span></span>

[!INCLUDE [tpl-install-instructions](../../../includes/tpl-install-instructions.md)]

## <a name="to-create-the-windows-forms-application"></a><span data-ttu-id="80397-106">Erstellen der Windows Forms-Anwendung</span><span class="sxs-lookup"><span data-stu-id="80397-106">To Create the Windows Forms Application</span></span>  
  
1. <span data-ttu-id="80397-107">Erstellen Sie ein Visual C#- oder Visual Basic-**Windows Forms**-Anwendungsprojekt.</span><span class="sxs-lookup"><span data-stu-id="80397-107">Create a Visual C# or Visual Basic **Windows Forms Application** project.</span></span> <span data-ttu-id="80397-108">In den folgenden Schritten wird das Projekt `WriterReadersWinForms` benannt.</span><span class="sxs-lookup"><span data-stu-id="80397-108">In the following steps, the project is named `WriterReadersWinForms`.</span></span>  
  
2. <span data-ttu-id="80397-109">Fügen Sie im Formulardesigner für das Hauptformular „Form1.cs“ („Form1.vb“ in Visual Basic) vier <xref:System.Windows.Forms.CheckBox>-Steuerelemente hinzu.</span><span class="sxs-lookup"><span data-stu-id="80397-109">On the form designer for the main form, Form1.cs (Form1.vb for Visual Basic), add four <xref:System.Windows.Forms.CheckBox> controls.</span></span> <span data-ttu-id="80397-110">Legen Sie die <xref:System.Windows.Forms.Control.Text%2A>-Eigenschaft auf **Reader 1** für `checkBox1`, **Reader 2** für `checkBox2`, **Reader 3** für `checkBox3` und **Writer** für `checkBox4` fest.</span><span class="sxs-lookup"><span data-stu-id="80397-110">Set the <xref:System.Windows.Forms.Control.Text%2A> property to **Reader 1** for `checkBox1`, **Reader 2** for `checkBox2`, **Reader 3** for `checkBox3`, and **Writer** for `checkBox4`.</span></span> <span data-ttu-id="80397-111">Legen Sie die <xref:System.Windows.Forms.Control.Enabled%2A>-Eigenschaft für jedes Steuerelement auf `False` fest.</span><span class="sxs-lookup"><span data-stu-id="80397-111">Set the <xref:System.Windows.Forms.Control.Enabled%2A> property for each control to `False`.</span></span>  
  
3. <span data-ttu-id="80397-112">Fügen Sie dem Formular ein <xref:System.Windows.Forms.Timer>-Steuerelement hinzu.</span><span class="sxs-lookup"><span data-stu-id="80397-112">Add a <xref:System.Windows.Forms.Timer> control to the form.</span></span> <span data-ttu-id="80397-113">Legen Sie die <xref:System.Windows.Forms.Timer.Interval%2A>-Eigenschaft auf `2500` fest.</span><span class="sxs-lookup"><span data-stu-id="80397-113">Set the <xref:System.Windows.Forms.Timer.Interval%2A> property to `2500`.</span></span>  
  
## <a name="adding-dataflow-functionality"></a><span data-ttu-id="80397-114">Hinzufügen der Datenflussfunktionalität</span><span class="sxs-lookup"><span data-stu-id="80397-114">Adding Dataflow Functionality</span></span>  

 <span data-ttu-id="80397-115">In diesem Abschnitt wird beschrieben, wie Sie die Datenflussblöcke erstellen, die Teil der Anwendung sind, und wie Sie die einzelnen Blöcke einem Aufgabenplaner zuordnen.</span><span class="sxs-lookup"><span data-stu-id="80397-115">This section describes how to create the dataflow blocks that participate in the application and how to associate each one with a task scheduler.</span></span>  
  
### <a name="to-add-dataflow-functionality-to-the-application"></a><span data-ttu-id="80397-116">Hinzufügen von Datenflussfunktionalität zur Anwendung</span><span class="sxs-lookup"><span data-stu-id="80397-116">To Add Dataflow Functionality to the Application</span></span>  
  
1. <span data-ttu-id="80397-117">Fügen Sie dem Projekt einen Verweis auf „System.Threading.Tasks.Dataflow.dll“ hinzu.</span><span class="sxs-lookup"><span data-stu-id="80397-117">In your project, add a reference to System.Threading.Tasks.Dataflow.dll.</span></span>  
  
2. <span data-ttu-id="80397-118">Stellen Sie sicher, dass „Form1.cs“ („Form1.vb“ für Visual Basic) die folgenden `using`-Anweisungen (`Imports` in Visual Basic) enthält.</span><span class="sxs-lookup"><span data-stu-id="80397-118">Ensure that Form1.cs (Form1.vb for Visual Basic) contains the following `using` statements (`Imports` in Visual Basic).</span></span>  
  
     [!code-csharp[TPLDataflow_WriterReadersWinForms#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#1)]
     [!code-vb[TPLDataflow_WriterReadersWinForms#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#1)]  
  
3. <span data-ttu-id="80397-119">Fügen Sie ein <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601>-Datenmember zur `Form1`-Klasse hinzu.</span><span class="sxs-lookup"><span data-stu-id="80397-119">Add a <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> data member to the `Form1` class.</span></span>  
  
     [!code-csharp[TPLDataflow_WriterReadersWinForms#2](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#2)]
     [!code-vb[TPLDataflow_WriterReadersWinForms#2](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#2)]  
  
4. <span data-ttu-id="80397-120">Erstellen Sie im `Form1`-Konstuktor nach dem Aufruf von `InitializeComponent` ein <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>-Objekt, das den Status der <xref:System.Windows.Forms.CheckBox>-Objekte wechselt.</span><span class="sxs-lookup"><span data-stu-id="80397-120">In the `Form1` constructor, after the call to `InitializeComponent`, create an <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object that toggles the state of <xref:System.Windows.Forms.CheckBox> objects.</span></span>  
  
     [!code-csharp[TPLDataflow_WriterReadersWinForms#3](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#3)]
     [!code-vb[TPLDataflow_WriterReadersWinForms#3](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#3)]  
  
5. <span data-ttu-id="80397-121">Erstellen Sie im `Form1`-Konstruktor ein <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair>-Objekt und vier <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>-Objekte, ein <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>-Objekt für jedes <xref:System.Windows.Forms.CheckBox>-Objekt.</span><span class="sxs-lookup"><span data-stu-id="80397-121">In the `Form1` constructor, create a <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair> object and four <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> objects, one <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object for each <xref:System.Windows.Forms.CheckBox> object.</span></span> <span data-ttu-id="80397-122">Geben Sie für jedes <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>-Objekt ein <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions>-Objekt an, für das die <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A>-Eigenschaft auf die <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair.ConcurrentScheduler%2A>-Eigenschaft der Reader und die <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair.ExclusiveScheduler%2A>-Eigenschaft für den Writer festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="80397-122">For each <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object, specify a <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions> object that has the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A> property set to the <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair.ConcurrentScheduler%2A> property for the readers, and the <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair.ExclusiveScheduler%2A> property for the writer.</span></span>  
  
     [!code-csharp[TPLDataflow_WriterReadersWinForms#4](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#4)]
     [!code-vb[TPLDataflow_WriterReadersWinForms#4](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#4)]  
  
6. <span data-ttu-id="80397-123">Starten Sie im `Form1`-Konstruktor das <xref:System.Windows.Forms.Timer>-Objekt.</span><span class="sxs-lookup"><span data-stu-id="80397-123">In the `Form1` constructor, start the <xref:System.Windows.Forms.Timer> object.</span></span>  
  
     [!code-csharp[TPLDataflow_WriterReadersWinForms#5](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#5)]
     [!code-vb[TPLDataflow_WriterReadersWinForms#5](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#5)]  
  
7. <span data-ttu-id="80397-124">Erstellen Sie im Formular-Designer für das Hauptformular einen Ereignishandler für das <xref:System.Windows.Forms.Timer.Tick>-Ereignis des Timers.</span><span class="sxs-lookup"><span data-stu-id="80397-124">On the form designer for the main form, create an event handler for the <xref:System.Windows.Forms.Timer.Tick> event for the timer.</span></span>  
  
8. <span data-ttu-id="80397-125">Implementieren Sie das <xref:System.Windows.Forms.Timer.Tick>-Ereignis für den Timer.</span><span class="sxs-lookup"><span data-stu-id="80397-125">Implement the <xref:System.Windows.Forms.Timer.Tick> event for the timer.</span></span>  
  
     [!code-csharp[TPLDataflow_WriterReadersWinForms#6](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#6)]
     [!code-vb[TPLDataflow_WriterReadersWinForms#6](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#6)]  
  
 <span data-ttu-id="80397-126">Da der `toggleCheckBox`-Datenflussblock als Benutzeroberfläche agiert, ist es wichtig, dass diese Aktion im Benutzeroberflächenthread erfolgt.</span><span class="sxs-lookup"><span data-stu-id="80397-126">Because the `toggleCheckBox` dataflow block acts on the user interface, it is important that this action occur on the user-interface thread.</span></span> <span data-ttu-id="80397-127">Um dies zu erreichen, stellt dieses Objekt während der Erstellung ein <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions>-Objekt bereit, für das die <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A>-Eigenschaft auf <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType> festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="80397-127">To accomplish this, during construction this object provides a <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions> object that has the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A> property set to <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="80397-128">Die <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A>-Methode erstellt ein <xref:System.Threading.Tasks.TaskScheduler>-Objekt, das Arbeiten im aktuellen Synchronisierungskontext durchführt.</span><span class="sxs-lookup"><span data-stu-id="80397-128">The <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A> method creates a <xref:System.Threading.Tasks.TaskScheduler> object that performs work on the current synchronization context.</span></span> <span data-ttu-id="80397-129">Da der `Form1`-Konstruktor über den Benutzeroberflächenthread aufgerufen wird, wird die Aktion für den `toggleCheckBox`-Datenflussblock ebenfalls im Benutzeroberflächenthread ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="80397-129">Because the `Form1` constructor is called from the user-interface thread, the action for the `toggleCheckBox` dataflow block also runs on the user-interface thread.</span></span>  
  
 <span data-ttu-id="80397-130">Dieses Beispiel verwendet außerdem die <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair>-Klasse, um die gleichzeitige Ausführung einiger Datenflussblöcke zu aktivieren. Außerdem ermöglicht sie, dass ein anderer Datenflussblock exklusiv für alle anderen Datenflussblöcke ausgeführt wird, die auf dem gleichen <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair>-Objekt ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="80397-130">This example also uses the <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair> class to enable some dataflow blocks to act concurrently, and another dataflow block to act exclusive with respect to all other dataflow blocks that run on the same <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair> object.</span></span> <span data-ttu-id="80397-131">Dieses Verfahren ist nützlich, wenn mehrere Datenflussblöcke eine Ressource gemeinsam nutzen und einige davon exklusiven Zugriff auf die Ressource benötigen, da es aufgrund dieses Verfahrens nicht mehr notwendig ist, den Zugriff auf diese Ressource manuell zu synchronisieren.</span><span class="sxs-lookup"><span data-stu-id="80397-131">This technique is useful when multiple dataflow blocks share a resource and some require exclusive access to that resource, because it eliminates the requirement to manually synchronize access to that resource.</span></span> <span data-ttu-id="80397-132">Dadurch, dass die manuelle Synchronisierung entfällt, kann Code effizienter gestaltet werden.</span><span class="sxs-lookup"><span data-stu-id="80397-132">The elimination of manual synchronization can make code more efficient.</span></span>  
  
## <a name="example"></a><span data-ttu-id="80397-133">Beispiel</span><span class="sxs-lookup"><span data-stu-id="80397-133">Example</span></span>  

 <span data-ttu-id="80397-134">Im folgenden Beispiel wird der vollständige Code für „Form1.cs“ („Form1.vb“ in Visual Basic) gezeigt.</span><span class="sxs-lookup"><span data-stu-id="80397-134">The following example shows the complete code for Form1.cs (Form1.vb for Visual Basic).</span></span>  
  
 [!code-csharp[TPLDataflow_WriterReadersWinForms#100](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#100)]
 [!code-vb[TPLDataflow_WriterReadersWinForms#100](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#100)]  
  
## <a name="see-also"></a><span data-ttu-id="80397-135">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="80397-135">See also</span></span>

- [<span data-ttu-id="80397-136">Dataflow (Datenfluss)</span><span class="sxs-lookup"><span data-stu-id="80397-136">Dataflow</span></span>](dataflow-task-parallel-library.md)
