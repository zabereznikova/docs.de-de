---
title: Angefügte und getrennte untergeordnete Aufgaben
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- tasks, child tasks
ms.assetid: c95788bf-90a6-4e96-b7bc-58e36a228cc5
ms.openlocfilehash: 3b9bc2a854dfdee724c2059b3298b67da799284b
ms.sourcegitcommit: d8020797a6657d0fbbdff362b80300815f682f94
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 11/24/2020
ms.locfileid: "95734295"
---
# <a name="attached-and-detached-child-tasks"></a><span data-ttu-id="63bd1-102">Angefügte und getrennte untergeordnete Aufgaben</span><span class="sxs-lookup"><span data-stu-id="63bd1-102">Attached and Detached Child Tasks</span></span>

<span data-ttu-id="63bd1-103">Eine *untergeordnete Aufgabe* (oder *geschachtelte Aufgabe*) ist eine <xref:System.Threading.Tasks.Task?displayProperty=nameWithType>-Instanz, die im Benutzerdelegaten einer anderen Aufgabe erstellt wird, die als *übergeordnete Aufgabe* bezeichnet wird.</span><span class="sxs-lookup"><span data-stu-id="63bd1-103">A *child task* (or *nested task*) is a <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> instance that is created in the user delegate of another task, which is known as the *parent task*.</span></span> <span data-ttu-id="63bd1-104">Eine untergeordnete Aufgabe kann entweder getrennt oder angefügt werden.</span><span class="sxs-lookup"><span data-stu-id="63bd1-104">A child task can be either detached or attached.</span></span> <span data-ttu-id="63bd1-105">Eine *getrennte untergeordnete Aufgabe* ist eine Aufgabe, die unabhängig von der übergeordneten ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="63bd1-105">A *detached child task* is a task that executes independently of its parent.</span></span> <span data-ttu-id="63bd1-106">Eine *angefügte ungeordnete Aufgabe* ist eine geschachtelte Aufgabe, die mit der Option <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent?displayProperty=nameWithType> erstellt wird, deren übergeordnete Aufgabe nicht explizit oder standardmäßig verhindert, dass die Aufgabe angefügt wird.</span><span class="sxs-lookup"><span data-stu-id="63bd1-106">An *attached child task* is a nested task that is created with the <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent?displayProperty=nameWithType> option whose parent does not explicitly or by default prohibit it from being attached.</span></span> <span data-ttu-id="63bd1-107">Eine Aufgabe kann beliebig viele angefügte oder getrennte untergeordnete Aufgaben erstellen. Die Anzahl wird lediglich durch die Systemressourcen beschränkt.</span><span class="sxs-lookup"><span data-stu-id="63bd1-107">A task may create any number of attached and detached child tasks, limited only by system resources.</span></span>  
  
 <span data-ttu-id="63bd1-108">In der folgenden Tabelle sind die grundlegenden Unterschiede zwischen den zwei Arten von untergeordneten Aufgaben aufgeführt.</span><span class="sxs-lookup"><span data-stu-id="63bd1-108">The following table lists the basic differences between the two kinds of child tasks.</span></span>  
  
|<span data-ttu-id="63bd1-109">Kategorie</span><span class="sxs-lookup"><span data-stu-id="63bd1-109">Category</span></span>|<span data-ttu-id="63bd1-110">Getrennte untergeordnete Aufgaben</span><span class="sxs-lookup"><span data-stu-id="63bd1-110">Detached child tasks</span></span>|<span data-ttu-id="63bd1-111">Angefügte untergeordnete Aufgaben</span><span class="sxs-lookup"><span data-stu-id="63bd1-111">Attached child tasks</span></span>|  
|--------------|--------------------------|--------------------------|  
|<span data-ttu-id="63bd1-112">Das übergeordnete Element wartet auf den Abschluss der untergeordneten Aufgaben.</span><span class="sxs-lookup"><span data-stu-id="63bd1-112">Parent waits for child tasks to complete.</span></span>|<span data-ttu-id="63bd1-113">Nein</span><span class="sxs-lookup"><span data-stu-id="63bd1-113">No</span></span>|<span data-ttu-id="63bd1-114">Ja</span><span class="sxs-lookup"><span data-stu-id="63bd1-114">Yes</span></span>|  
|<span data-ttu-id="63bd1-115">Das übergeordnete Element gibt von untergeordneten Aufgaben ausgelöste Ausnahmen weiter.</span><span class="sxs-lookup"><span data-stu-id="63bd1-115">Parent propagates exceptions thrown by child tasks.</span></span>|<span data-ttu-id="63bd1-116">Nein</span><span class="sxs-lookup"><span data-stu-id="63bd1-116">No</span></span>|<span data-ttu-id="63bd1-117">Ja</span><span class="sxs-lookup"><span data-stu-id="63bd1-117">Yes</span></span>|  
|<span data-ttu-id="63bd1-118">Der Status des übergeordneten Elements hängt vom Status des untergeordneten Elements ab.</span><span class="sxs-lookup"><span data-stu-id="63bd1-118">Status of parent depends on status of child.</span></span>|<span data-ttu-id="63bd1-119">Nein</span><span class="sxs-lookup"><span data-stu-id="63bd1-119">No</span></span>|<span data-ttu-id="63bd1-120">Ja</span><span class="sxs-lookup"><span data-stu-id="63bd1-120">Yes</span></span>|  
  
 <span data-ttu-id="63bd1-121">In den meisten Szenarios empfiehlt sich jedoch die Verwendung von getrennten untergeordneten Aufgabe, da die Beziehungen zu anderen Aufgaben weniger komplex sind.</span><span class="sxs-lookup"><span data-stu-id="63bd1-121">In most scenarios, we recommend that you use detached child tasks, because their relationships with other tasks are less complex.</span></span> <span data-ttu-id="63bd1-122">Aus diesem Grund werden in übergeordneten Aufgaben erstellte Aufgaben standardmäßig getrennt. Um die angefügte untergeordnete Aufgabe zu erstellen, müssen Sie die <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent?displayProperty=nameWithType>-Option explizit angeben.</span><span class="sxs-lookup"><span data-stu-id="63bd1-122">That is why tasks created inside parent tasks are detached by default, and you must explicitly specify the <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent?displayProperty=nameWithType> option to create an attached child task.</span></span>  
  
## <a name="detached-child-tasks"></a><span data-ttu-id="63bd1-123">Getrennte untergeordnete Aufgaben</span><span class="sxs-lookup"><span data-stu-id="63bd1-123">Detached child tasks</span></span>  

 <span data-ttu-id="63bd1-124">Obwohl eine untergeordnete Aufgabe durch eine übergeordnete Aufgabe erstellt wird, hängt diese standardmäßig von der übergeordneten Aufgabe ab.</span><span class="sxs-lookup"><span data-stu-id="63bd1-124">Although a child task is created by a parent task, by default it is independent of the parent task.</span></span> <span data-ttu-id="63bd1-125">Im folgenden Beispiel erstellt eine übergeordnete Aufgabe eine einfache untergeordnete Aufgabe:</span><span class="sxs-lookup"><span data-stu-id="63bd1-125">In the following example, a parent task creates one simple child task.</span></span> <span data-ttu-id="63bd1-126">Wenn Sie den Beispielcode mehrmals ausführen, stellen Sie möglicherweise fest, dass sich die Ausgabe von der Ausgabe im Beispiel unterscheidet und dass die Ausgabe sich möglicherweise bei jeder Ausführung des Codes ändert.</span><span class="sxs-lookup"><span data-stu-id="63bd1-126">If you run the example code multiple times, you may notice that the output from the example differs from that shown, and also that the output may change each time you run the code.</span></span> <span data-ttu-id="63bd1-127">Dies liegt daran, dass die übergeordnete und die untergeordnete Aufgabe unabhängig voneinander ausgeführt werden; das untergeordnete Element ist eine getrennte Aufgabe.</span><span class="sxs-lookup"><span data-stu-id="63bd1-127">This occurs because the parent task and child tasks execute independently of each other; the child is a detached task.</span></span> <span data-ttu-id="63bd1-128">Im Beispiel wird nur auf den Abschluss der übergeordneten Aufgabe gewartet, und die untergeordnete Aufgabe wird möglicherweise nicht ausgeführt oder abgeschlossen, ehe die Konsolen-App beendet wird.</span><span class="sxs-lookup"><span data-stu-id="63bd1-128">The example waits only for the parent task to complete, and the child task may not execute or complete before the console app terminates.</span></span>  
  
 [!code-csharp[TPL_ChildTasks#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_childtasks/cs/nested1.cs#1)]
 [!code-vb[TPL_ChildTasks#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_childtasks/vb/nested1.vb#1)]  
  
 <span data-ttu-id="63bd1-129">Wenn die untergeordnete Aufgabe durch ein <xref:System.Threading.Tasks.Task%601>-Objekt statt einem <xref:System.Threading.Tasks.Task>-Objekt dargestellt wird, können Sie sicherstellen, dass die übergeordnete Aufgabe auf das Abschließen der Aufgabe des untergeordneten Elements wartet, indem Sie auf die <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType>-Eigenschaft des untergeordneten Elements zugreift, auch wenn es sich dabei um eine getrennte untergeordnete Aufgabe handelt.</span><span class="sxs-lookup"><span data-stu-id="63bd1-129">If the child task is represented by a <xref:System.Threading.Tasks.Task%601> object rather than a <xref:System.Threading.Tasks.Task> object, you can ensure that the parent task will wait for the child to complete by accessing the <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property of the child even if it is a detached child task.</span></span> <span data-ttu-id="63bd1-130">Die <xref:System.Threading.Tasks.Task%601.Result%2A>-Eigenschaft blockiert, wie im folgenden Beispiel gezeigt, bis die Aufgabe abgeschlossen ist.</span><span class="sxs-lookup"><span data-stu-id="63bd1-130">The <xref:System.Threading.Tasks.Task%601.Result%2A> property blocks until its task completes, as the following example shows.</span></span>  
  
 [!code-csharp[TPL_ChildTasks#4](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_childtasks/cs/childtasks.cs#4)]
 [!code-vb[TPL_ChildTasks#4](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_childtasks/vb/tpl_childtasks.vb#4)]  
  
## <a name="attached-child-tasks"></a><span data-ttu-id="63bd1-131">Angefügte untergeordnete Aufgaben</span><span class="sxs-lookup"><span data-stu-id="63bd1-131">Attached child tasks</span></span>  

 <span data-ttu-id="63bd1-132">Anders als getrennte untergeordnete Aufgaben werden angefügte untergeordnete Aufgaben eng mit dem übergeordneten Element synchronisiert.</span><span class="sxs-lookup"><span data-stu-id="63bd1-132">Unlike detached child tasks, attached child tasks are closely synchronized with the parent.</span></span> <span data-ttu-id="63bd1-133">Sie können die getrennte untergeordnete Aufgabe im vorherigen Beispiel in eine angefügte untergeordnete Aufgabe ändern, indem Sie wie im folgenden Beispiel gezeigt die <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent?displayProperty=nameWithType>-Option in der Aufgabenerstellungsanweisung verwenden.</span><span class="sxs-lookup"><span data-stu-id="63bd1-133">You can change the detached child task in the previous example to an attached child task by using the <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent?displayProperty=nameWithType> option in the task creation statement, as shown in the following example.</span></span> <span data-ttu-id="63bd1-134">In diesem Code schließt die angefügte untergeordnete Aufgabe vor ihrem übergeordneten Element ab.</span><span class="sxs-lookup"><span data-stu-id="63bd1-134">In this code, the attached child task completes before its parent.</span></span> <span data-ttu-id="63bd1-135">Deshalb ist das Ergebnis im Beispiel bei jedem Ausführen des Codes gleich.</span><span class="sxs-lookup"><span data-stu-id="63bd1-135">As a result, the output from the example is the same each time you run the code.</span></span>  
  
 [!code-csharp[TPL_ChildTasks#2](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_childtasks/cs/child1.cs#2)]
 [!code-vb[TPL_ChildTasks#2](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_childtasks/vb/child1.vb#2)]  
  
 <span data-ttu-id="63bd1-136">Mithilfe von angefügten untergeordneten Aufgaben können Sie synchronisierte Diagramme von asynchronen Vorgängen erstellen.</span><span class="sxs-lookup"><span data-stu-id="63bd1-136">You can use attached child tasks to create tightly synchronized graphs of asynchronous operations.</span></span>  
  
 <span data-ttu-id="63bd1-137">Die untergeordnete Aufgabe kann jedoch nur dann an die übergeordnete Aufgabe angefügt werden, wenn die übergeordnete Aufgabe das Anfügen von untergeordneten Aufgaben nicht verhindert.</span><span class="sxs-lookup"><span data-stu-id="63bd1-137">However, a child task can attach to its parent only if its parent does not prohibit attached child tasks.</span></span> <span data-ttu-id="63bd1-138">Übergeordnete Aufgaben können explizit verhindern, dass untergeordnete Aufgaben angefügt werden, indem die <xref:System.Threading.Tasks.TaskCreationOptions.DenyChildAttach?displayProperty=nameWithType>-Option des Klassenkonstruktors der übergeordneten Aufgabe oder die <xref:System.Threading.Tasks.TaskFactory.StartNew%2A?displayProperty=nameWithType>-Methode angegeben wird.</span><span class="sxs-lookup"><span data-stu-id="63bd1-138">Parent tasks can explicitly prevent child tasks from attaching to them by specifying the <xref:System.Threading.Tasks.TaskCreationOptions.DenyChildAttach?displayProperty=nameWithType> option in the parent task's class constructor or the <xref:System.Threading.Tasks.TaskFactory.StartNew%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="63bd1-139">Übergeordnete Aufgaben verhindern das Anfügen von untergeordneten Aufgaben explizit, wenn sie mithilfe des Aufrufs der <xref:System.Threading.Tasks.Task.Run%2A?displayProperty=nameWithType>-Methode erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="63bd1-139">Parent tasks implicitly prevent child tasks from attaching to them if they are created by calling the <xref:System.Threading.Tasks.Task.Run%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="63bd1-140">Dies wird anhand des folgenden Beispiels veranschaulicht.</span><span class="sxs-lookup"><span data-stu-id="63bd1-140">The following example illustrates this.</span></span> <span data-ttu-id="63bd1-141">Es ist weitestgehend mit dem vorherigen Beispiel identisch, allerdings wurde die übergeordnete Aufgabe hier mit der <xref:System.Threading.Tasks.Task.Run%28System.Action%29?displayProperty=nameWithType>-Methode und nicht mit der <xref:System.Threading.Tasks.TaskFactory.StartNew%28System.Action%29?displayProperty=nameWithType>-Methode erstellt.</span><span class="sxs-lookup"><span data-stu-id="63bd1-141">It is identical to the previous example, except that the parent task is created by calling the <xref:System.Threading.Tasks.Task.Run%28System.Action%29?displayProperty=nameWithType> method rather than the <xref:System.Threading.Tasks.TaskFactory.StartNew%28System.Action%29?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="63bd1-142">Da die untergeordnete Aufgabe nicht an die übergeordnete Aufgabe angefügt werden kann, ist die Ausgabe dieses Beispiels nicht vorhersehbar.</span><span class="sxs-lookup"><span data-stu-id="63bd1-142">Because the child task is not able to attach to its parent, the output from the example is unpredictable.</span></span> <span data-ttu-id="63bd1-143">Da die standardmäßigen Aufgabenerstellungsoptionen für <xref:System.Threading.Tasks.Task.Run%2A?displayProperty=nameWithType>-Überladungen <xref:System.Threading.Tasks.TaskCreationOptions.DenyChildAttach?displayProperty=nameWithType> einschließen, entspricht dieses Beispiel funktional dem ersten Beispiel im Abschnitt „Getrennte untergeordnete Aufgaben“.</span><span class="sxs-lookup"><span data-stu-id="63bd1-143">Because the default task creation options for the <xref:System.Threading.Tasks.Task.Run%2A?displayProperty=nameWithType> overloads include <xref:System.Threading.Tasks.TaskCreationOptions.DenyChildAttach?displayProperty=nameWithType>, this example is functionally equivalent to the first example in the "Detached child tasks" section.</span></span>  
  
 [!code-csharp[TPL_ChildTasks#3](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_childtasks/cs/child1a.cs#3)]
 [!code-vb[TPL_ChildTasks#3](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_childtasks/vb/child1a.vb#3)]  
  
## <a name="exceptions-in-child-tasks"></a><span data-ttu-id="63bd1-144">Ausnahmen in untergeordneten Aufgaben</span><span class="sxs-lookup"><span data-stu-id="63bd1-144">Exceptions in child tasks</span></span>  

 <span data-ttu-id="63bd1-145">Wenn eine getrennte untergeordnete Aufgabe eine Ausnahme auslöst, muss diese direkt in der übergeordneten Aufgabe beachtet oder behandelt werden, ebenso wie dies bei nicht geschachtelten Aufgaben der Fall ist.</span><span class="sxs-lookup"><span data-stu-id="63bd1-145">If a detached child task throws an exception, that exception must be observed or handled directly in the parent task just as with any non-nested task.</span></span> <span data-ttu-id="63bd1-146">Wenn eine angefügte untergeordnete Aufgabe eine Ausnahme auslöst, wird die Ausnahme automatisch an die übergeordnete Aufgabe weitergeleitet und an den Thread zurückgesendet, der wartet oder auf die <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType>-Eigenschaft der Aufgabe zugreifen möchte.</span><span class="sxs-lookup"><span data-stu-id="63bd1-146">If an attached child task throws an exception, the exception is automatically propagated to the parent task and back to the thread that waits or tries to access the task's <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="63bd1-147">Daher können durch Verwendung angefügter untergeordneter Aufgaben alle Ausnahmen an nur einem Punkt, beim Aufruf von <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> im aufrufenden Thread, verarbeitet werden.</span><span class="sxs-lookup"><span data-stu-id="63bd1-147">Therefore, by using attached child tasks, you can handle all exceptions at just one point in the call to <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> on the calling thread.</span></span> <span data-ttu-id="63bd1-148">Weitere Informationen finden Sie unter [Ausnahmebehandlung (Task Parallel Library)](exception-handling-task-parallel-library.md).</span><span class="sxs-lookup"><span data-stu-id="63bd1-148">For more information, see [Exception Handling](exception-handling-task-parallel-library.md).</span></span>  
  
## <a name="cancellation-and-child-tasks"></a><span data-ttu-id="63bd1-149">Abbruch und untergeordnete Aufgaben</span><span class="sxs-lookup"><span data-stu-id="63bd1-149">Cancellation and child tasks</span></span>  

 <span data-ttu-id="63bd1-150">Das Abbrechen einer Aufgabe ist kooperativ.</span><span class="sxs-lookup"><span data-stu-id="63bd1-150">Task cancellation is cooperative.</span></span> <span data-ttu-id="63bd1-151">Um "abbrechbar" zu sein, muss jede angefügte oder getrennte untergeordnete Aufgabe den Status des Abbruchtokens überwachen.</span><span class="sxs-lookup"><span data-stu-id="63bd1-151">That is, to be cancelable, every attached or detached child task must monitor the status of the cancellation token.</span></span> <span data-ttu-id="63bd1-152">Wenn Sie mit einer Abbruchanforderung ein übergeordnetes Element und alle untergeordneten Elemente abbrechen möchten, übergeben Sie das gleiche Token als Argument an alle Aufgaben und stellen in jeder Aufgabe die Logik zum Reagieren auf die Anforderung in bereit.</span><span class="sxs-lookup"><span data-stu-id="63bd1-152">If you want to cancel a parent and all its children by using one cancellation request, you pass the same token as an argument to all tasks and provide in each task the logic to respond to the request in each task.</span></span> <span data-ttu-id="63bd1-153">Weitere Informationen finden Sie unter [Aufgabenabbruch](task-cancellation.md) und [Gewusst wie: Abbrechen eine Aufgabe und der zugehörigen untergeordneten Aufgaben](how-to-cancel-a-task-and-its-children.md).</span><span class="sxs-lookup"><span data-stu-id="63bd1-153">For more information, see [Task Cancellation](task-cancellation.md) and [How to: Cancel a Task and Its Children](how-to-cancel-a-task-and-its-children.md).</span></span>  
  
### <a name="when-the-parent-cancels"></a><span data-ttu-id="63bd1-154">Abbruch eines übergeordneten Elements</span><span class="sxs-lookup"><span data-stu-id="63bd1-154">When the parent cancels</span></span>  

 <span data-ttu-id="63bd1-155">Wenn eine übergeordnete Aufgabe abgebrochen wird, bevor eine untergeordnete Aufgabe gestartet wurde, wird die untergeordnete Aufgabe nie gestartet.</span><span class="sxs-lookup"><span data-stu-id="63bd1-155">If a parent cancels itself before its child task is started, the child never starts.</span></span> <span data-ttu-id="63bd1-156">Wenn ein übergeordnetes Element nach dem Start einer untergeordneten Aufgabe abgebrochen wird, wird die untergeordnete bis zum Abschluss ausgeführt, sofern keine eigene Abbruchlogik vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="63bd1-156">If a parent cancels itself after its child task has already started, the child runs to completion unless it has its own cancellation logic.</span></span> <span data-ttu-id="63bd1-157">Weitere Informationen finden Sie unter [Aufgabenabbruch](task-cancellation.md).</span><span class="sxs-lookup"><span data-stu-id="63bd1-157">For more information, see [Task Cancellation](task-cancellation.md).</span></span>  
  
### <a name="when-a-detached-child-task-cancels"></a><span data-ttu-id="63bd1-158">Abbruch einer getrennten untergeordneten Aufgabe</span><span class="sxs-lookup"><span data-stu-id="63bd1-158">When a detached child task cancels</span></span>  

 <span data-ttu-id="63bd1-159">Wenn eine getrennte untergeordnete Aufgabe mit dem gleichen Token abgebrochen wird, das an die übergeordnete Aufgabe übergeben wurde, und das übergeordnete Element nicht auf die untergeordnete Aufgabe wartet, wird keine Ausnahme weitergeleitet, da die Ausnahme als Kooperationsabbruch ohne Auswirkungen behandelt wird.</span><span class="sxs-lookup"><span data-stu-id="63bd1-159">If a detached child task cancels itself by using the same token that was passed to the parent, and the parent does not wait for the child task, no exception is propagated, because the exception is treated as benign cooperation cancellation.</span></span> <span data-ttu-id="63bd1-160">Dieses Verhalten stimmt mit dem beliebiger Aufgaben der obersten Ebene überein.</span><span class="sxs-lookup"><span data-stu-id="63bd1-160">This behavior is the same as that of any top-level task.</span></span>  
  
### <a name="when-an-attached-child-task-cancels"></a><span data-ttu-id="63bd1-161">Abbruch einer angefügten untergeordneten Aufgabe</span><span class="sxs-lookup"><span data-stu-id="63bd1-161">When an attached child task cancels</span></span>  

 <span data-ttu-id="63bd1-162">Wenn eine angefügte untergeordnete Aufgabe mit dem gleichen Token abgebrochen wird, das an die übergeordnete Aufgabe übergeben wurde, wird eine <xref:System.Threading.Tasks.TaskCanceledException> an den Verbindungsthread in einer <xref:System.AggregateException> weitergeleitet.</span><span class="sxs-lookup"><span data-stu-id="63bd1-162">When an attached child task cancels itself by using the same token that was passed to its parent task, a <xref:System.Threading.Tasks.TaskCanceledException> is propagated to the joining thread inside an <xref:System.AggregateException>.</span></span> <span data-ttu-id="63bd1-163">Sie müssen auf die übergeordnete Aufgabe warten, damit Sie die Ausnahmen ohne Auswirkung zusammen mit allen einen Fehler auslösenden Ausnahmen behandeln können, die durch ein Diagramm angefügter untergeordneter Aufgaben nach oben weitergeleitet werden.</span><span class="sxs-lookup"><span data-stu-id="63bd1-163">You must wait for the parent task so that you can handle all benign exceptions in addition to all faulting exceptions that are propagated up through a graph of attached child tasks.</span></span>  
  
 <span data-ttu-id="63bd1-164">Weitere Informationen finden Sie unter [Ausnahmebehandlung (Task Parallel Library)](exception-handling-task-parallel-library.md).</span><span class="sxs-lookup"><span data-stu-id="63bd1-164">For more information, see [Exception Handling](exception-handling-task-parallel-library.md).</span></span>  
  
## <a name="preventing-a-child-task-from-attaching-to-its-parent"></a><span data-ttu-id="63bd1-165">Verhindern, dass sich eine untergeordnete Aufgabe mit ihrem übergeordneten Element verbindet</span><span class="sxs-lookup"><span data-stu-id="63bd1-165">Preventing a child task from attaching to its parent</span></span>  

 <span data-ttu-id="63bd1-166">Ein Ausnahmefehler, der durch eine untergeordnete Aufgabe ausgelöst wird, wird an die übergeordnete Aufgabe weitergegeben.</span><span class="sxs-lookup"><span data-stu-id="63bd1-166">An unhandled exception that is thrown by a child task is propagated to the parent task.</span></span> <span data-ttu-id="63bd1-167">Sie können dieses Verhalten nutzen, um alle Ausnahmen von untergeordneten Aufgaben einer Stammaufgabe zu beobachten anstatt eine Aufgabenstruktur zu durchlaufen.</span><span class="sxs-lookup"><span data-stu-id="63bd1-167">You can use this behavior to observe all child task exceptions from one root task instead of traversing a tree of tasks.</span></span> <span data-ttu-id="63bd1-168">Die Ausnahmeweitergabe kann jedoch problematisch werden, wenn eine übergeordnete Aufgabe einen Anhang aus einem anderen Code erwartet.</span><span class="sxs-lookup"><span data-stu-id="63bd1-168">However, exception propagation can be problematic when a parent task does not expect attachment from other code.</span></span> <span data-ttu-id="63bd1-169">Betrachten Sie beispielsweise eine Anwendung, die eine Bibliothekskomponente eines Drittanbietern aus einem <xref:System.Threading.Tasks.Task>-Objekt aufruft.</span><span class="sxs-lookup"><span data-stu-id="63bd1-169">For example, consider an app that calls a third-party library component from a <xref:System.Threading.Tasks.Task> object.</span></span> <span data-ttu-id="63bd1-170">Wenn die Bibliothekskomponente von Drittanbietern auch ein <xref:System.Threading.Tasks.Task>-Objekt erstellt und <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent?displayProperty=nameWithType> angibt, um es zur übergeordneten Aufgabe anzufügen, werden alle Ausnahmefehler, die in der untergeordneten Aufgabe auftreten, an das übergeordnete Element weitergegeben.</span><span class="sxs-lookup"><span data-stu-id="63bd1-170">If the third-party library component also creates a <xref:System.Threading.Tasks.Task> object and specifies <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent?displayProperty=nameWithType> to attach it to the parent task, any unhandled exceptions that occur in the child task propagate to the parent.</span></span> <span data-ttu-id="63bd1-171">Dies kann zu unerwartetem Verhalten in der Haupt-App führen.</span><span class="sxs-lookup"><span data-stu-id="63bd1-171">This could lead to unexpected behavior in the main app.</span></span>  
  
 <span data-ttu-id="63bd1-172">Wenn eine untergeordnete Aufgabe nicht an die übergeordnete Aufgabe angefügt werden soll, geben Sie die <xref:System.Threading.Tasks.TaskCreationOptions.DenyChildAttach?displayProperty=nameWithType>-Option an, wenn Sie das übergeordnete <xref:System.Threading.Tasks.Task> oder das <xref:System.Threading.Tasks.Task%601>-Objekt erstellen.</span><span class="sxs-lookup"><span data-stu-id="63bd1-172">To prevent a child task from attaching to its parent task, specify the <xref:System.Threading.Tasks.TaskCreationOptions.DenyChildAttach?displayProperty=nameWithType> option when you create the parent <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601> object.</span></span> <span data-ttu-id="63bd1-173">Wenn eine Aufgabe versucht, sich an ihre übergeordnete Aufgabe anzufügen und für die übergeordnete Aufgabe die <xref:System.Threading.Tasks.TaskCreationOptions.DenyChildAttach?displayProperty=nameWithType>-Option festgelegt wurde, kann die untergeordnete Aufgabe nicht an die übergeordnete Aufgabe angefügt werden und wird so ausgeführt, als sei die <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent?displayProperty=nameWithType>-Option nicht festgelegt worden.</span><span class="sxs-lookup"><span data-stu-id="63bd1-173">When a task tries to attach to its parent and the parent specifies the <xref:System.Threading.Tasks.TaskCreationOptions.DenyChildAttach?displayProperty=nameWithType> option, the child task will not be able to attach to a parent and will execute just as if the <xref:System.Threading.Tasks.TaskCreationOptions.AttachedToParent?displayProperty=nameWithType> option was not specified.</span></span>  
  
 <span data-ttu-id="63bd1-174">Sie können auch verhindern, dass sich eine untergeordnete Aufgabe an das übergeordnete Element anfügt, wenn die untergeordnete Aufgabe nicht rechtzeitig beendet wird.</span><span class="sxs-lookup"><span data-stu-id="63bd1-174">You might also want to prevent a child task from attaching to its parent when the child task does not finish in a timely manner.</span></span> <span data-ttu-id="63bd1-175">Da eine übergeordnete Aufgabe nicht beendet wird, ehe alle untergeordneten Aufgaben abgeschlossen sind, kann eine untergeordnete Aufgabe mit langer Laufzeit zu einer Verschlechterung der Leistung der gesamten App führen.</span><span class="sxs-lookup"><span data-stu-id="63bd1-175">Because a parent task does not finish until all child tasks finish, a long-running child task can cause the overall app to perform poorly.</span></span> <span data-ttu-id="63bd1-176">Ein Beispiel zur Verbesserung der App-Leistung durch Verhindern des Anfügens einer Aufgabe an das übergeordnete Element finden Sie unter [Gewusst wie: Verhindern des Anfügens einer untergeordneten Aufgabe an die übergeordnete Aufgabe](how-to-prevent-a-child-task-from-attaching-to-its-parent.md).</span><span class="sxs-lookup"><span data-stu-id="63bd1-176">For an example that shows how to improve app performance by preventing a task from attaching to its parent task, see [How to: Prevent a Child Task from Attaching to its Parent](how-to-prevent-a-child-task-from-attaching-to-its-parent.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="63bd1-177">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="63bd1-177">See also</span></span>

- [<span data-ttu-id="63bd1-178">Parallele Programmierung</span><span class="sxs-lookup"><span data-stu-id="63bd1-178">Parallel Programming</span></span>](index.md)
- [<span data-ttu-id="63bd1-179">Datenparallelität</span><span class="sxs-lookup"><span data-stu-id="63bd1-179">Data Parallelism</span></span>](data-parallelism-task-parallel-library.md)
