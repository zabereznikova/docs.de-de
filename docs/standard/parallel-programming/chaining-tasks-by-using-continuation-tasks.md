---
title: Verketten von Tasks mithilfe von Fortsetzungstasks
description: Erfahren Sie, wie Sie in .NET Tasks mithilfe von Fortsetzungstasks verketten. Ein Fortsetzungstask ist ein asynchroner Task, der von einem anderen Task aufgerufen wird.
ms.date: 07/20/2020
dev_langs:
- csharp
- vb
helpviewer_keywords:
- tasks, continuations
ms.assetid: 0b45e9a2-de28-46ce-8212-1817280ed42d
ms.openlocfilehash: c7afbc1bb22a1743aed8e4ebd0a06c4f3fb57e86
ms.sourcegitcommit: 965a5af7918acb0a3fd3baf342e15d511ef75188
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 11/18/2020
ms.locfileid: "94830609"
---
# <a name="chaining-tasks-using-continuation-tasks"></a><span data-ttu-id="54c87-104">Verketten von Tasks mithilfe von Fortsetzungstasks</span><span class="sxs-lookup"><span data-stu-id="54c87-104">Chaining tasks using continuation tasks</span></span>

<span data-ttu-id="54c87-105">Bei der asynchronen Programmierung ruft ein asynchroner Vorgang nach seinem Abschluss häufig einen zweiten Vorgang auf.</span><span class="sxs-lookup"><span data-stu-id="54c87-105">In asynchronous programming, it's common for one asynchronous operation, on completion, to invoke a second operation.</span></span> <span data-ttu-id="54c87-106">Fortsetzungen ermöglichen es nachfolgenden Vorgängen, die Ergebnisse des ersten Vorgangs zu nutzen.</span><span class="sxs-lookup"><span data-stu-id="54c87-106">Continuations allow decedent operations to consume the results of the first operation.</span></span> <span data-ttu-id="54c87-107">In der Vergangenheit wurden für diese Fortsetzungen vor allem Rückrufmethoden genutzt.</span><span class="sxs-lookup"><span data-stu-id="54c87-107">Traditionally, continuations have been done by using callback methods.</span></span> <span data-ttu-id="54c87-108">In der Task Parallel Library wird die gleiche Funktionalität durch _Fortsetzungsaufgaben_ bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="54c87-108">In the Task Parallel Library, the same functionality is provided by _continuation tasks_.</span></span> <span data-ttu-id="54c87-109">Ein Fortsetzungstask (auch kurz als Fortsetzung bezeichnet) ist ein asynchroner Task, der von einem anderen Task, dem _Vorgänger_, nach dessen Beendigung aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="54c87-109">A continuation task (also known just as a continuation) is an asynchronous task that's invoked by another task, known as the _antecedent_, when the antecedent finishes.</span></span>

<span data-ttu-id="54c87-110">Fortsetzungen können relativ einfach eingesetzt werden, sind dabei jedoch sehr leistungsstark und flexibel.</span><span class="sxs-lookup"><span data-stu-id="54c87-110">Continuations are relatively easy to use, but are nevertheless powerful and flexible.</span></span> <span data-ttu-id="54c87-111">Sie haben unter anderem folgende Möglichkeiten:</span><span class="sxs-lookup"><span data-stu-id="54c87-111">For example, you can:</span></span>

- <span data-ttu-id="54c87-112">Übergeben von Daten vom Vorgänger an die Fortsetzung</span><span class="sxs-lookup"><span data-stu-id="54c87-112">Pass data from the antecedent to the continuation.</span></span>
- <span data-ttu-id="54c87-113">Angeben der präzisen Bedingungen, unter denen die Fortsetzung aufgerufen bzw. nicht aufgerufen wird</span><span class="sxs-lookup"><span data-stu-id="54c87-113">Specify the precise conditions under which the continuation will be invoked or not invoked.</span></span>
- <span data-ttu-id="54c87-114">Abbrechen einer Fortsetzung vor dem Starten oder kooperativ während ihrer Ausführung</span><span class="sxs-lookup"><span data-stu-id="54c87-114">Cancel a continuation either before it starts or cooperatively as it is running.</span></span>
- <span data-ttu-id="54c87-115">Bereitstellen von Hinweisen zur Planung der Fortsetzung</span><span class="sxs-lookup"><span data-stu-id="54c87-115">Provide hints about how the continuation should be scheduled.</span></span>
- <span data-ttu-id="54c87-116">Aufrufen mehrerer Fortsetzungen durch den gleichen Vorgänger</span><span class="sxs-lookup"><span data-stu-id="54c87-116">Invoke multiple continuations from the same antecedent.</span></span>
- <span data-ttu-id="54c87-117">Aufrufen einer Fortsetzung, wenn alle Vorgänger abgeschlossen werden oder einer von mehreren Vorgängern abgeschlossen wird</span><span class="sxs-lookup"><span data-stu-id="54c87-117">Invoke one continuation when all or any one of multiple antecedents complete.</span></span>
- <span data-ttu-id="54c87-118">Verketten von Fortsetzungen der Reihe nach auf eine beliebige Länge</span><span class="sxs-lookup"><span data-stu-id="54c87-118">Chain continuations one after another to any arbitrary length.</span></span>
- <span data-ttu-id="54c87-119">Beheben von durch den Vorgänger ausgelösten Ausnahmen mithilfe einer Fortsetzung</span><span class="sxs-lookup"><span data-stu-id="54c87-119">Use a continuation to handle exceptions thrown by the antecedent.</span></span>

## <a name="about-continuations"></a><span data-ttu-id="54c87-120">Über Fortsetzungen</span><span class="sxs-lookup"><span data-stu-id="54c87-120">About continuations</span></span>

<span data-ttu-id="54c87-121">Eine Fortsetzung ist eine Aufgabe, die im <xref:System.Threading.Tasks.TaskStatus.WaitingForActivation> -Zustand erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="54c87-121">A continuation is a task that is created in the <xref:System.Threading.Tasks.TaskStatus.WaitingForActivation> state.</span></span> <span data-ttu-id="54c87-122">Sie wird automatisch aktiviert, wenn ihre Vorgängeraufgabe bzw. -aufgaben abgeschlossen wird bzw. werden.</span><span class="sxs-lookup"><span data-stu-id="54c87-122">It is activated automatically when its antecedent task or tasks complete.</span></span> <span data-ttu-id="54c87-123">Das Aufrufen von <xref:System.Threading.Tasks.Task.Start%2A?displayProperty=nameWithType> für eine Fortsetzung in Benutzercode löst eine <xref:System.InvalidOperationException?displayProperty=nameWithType> -Ausnahme aus.</span><span class="sxs-lookup"><span data-stu-id="54c87-123">Calling <xref:System.Threading.Tasks.Task.Start%2A?displayProperty=nameWithType> on a continuation in user code throws an <xref:System.InvalidOperationException?displayProperty=nameWithType> exception.</span></span>

<span data-ttu-id="54c87-124">Eine Fortsetzung ist selbst ein <xref:System.Threading.Tasks.Task> und blockiert nicht den Thread, in dem sie gestartet wird.</span><span class="sxs-lookup"><span data-stu-id="54c87-124">A continuation is itself a <xref:System.Threading.Tasks.Task> and does not block the thread on which it is started.</span></span> <span data-ttu-id="54c87-125">Rufen Sie die <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> -Methode auf, um den Thread bis zum Abschluss der Fortsetzungsaufgabe zu blockieren.</span><span class="sxs-lookup"><span data-stu-id="54c87-125">Call the <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> method to block until the continuation task finishes.</span></span>

## <a name="create-a-continuation-for-a-single-antecedent"></a><span data-ttu-id="54c87-126">Erstellen einer Fortsetzung für einen einzelnen Vorgänger</span><span class="sxs-lookup"><span data-stu-id="54c87-126">Create a continuation for a single antecedent</span></span>

<span data-ttu-id="54c87-127">Sie erstellen eine Fortsetzung, die durch Aufrufen der Methode <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType> ausgeführt wird, wenn ihr Vorgänger abgeschlossen wurde.</span><span class="sxs-lookup"><span data-stu-id="54c87-127">You create a continuation that executes when its antecedent has completed by calling the <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="54c87-128">Im folgenden Beispiel ist das grundlegende Muster dargestellt (aus Gründen der Übersichtlichkeit wird die Ausnahmebehandlung ausgelassen).</span><span class="sxs-lookup"><span data-stu-id="54c87-128">The following example shows the basic pattern (for clarity, exception handling is omitted).</span></span> <span data-ttu-id="54c87-129">Es führt eine Vorgängeraufgabe `taskA`aus, der ein <xref:System.DayOfWeek> -Objekt zurückgibt, der den Namen des aktuellen Wochentags angibt.</span><span class="sxs-lookup"><span data-stu-id="54c87-129">It executes an antecedent task, `taskA`, that returns a <xref:System.DayOfWeek> object that indicates the name of the current day of the week.</span></span> <span data-ttu-id="54c87-130">Nach Abschluss des Vorgängers wird der Fortsetzungsaufgabe `continuation` der Vorgänger übergeben; sie zeigt dann eine Zeichenfolge an, die dessen Ergebnis beinhaltet.</span><span class="sxs-lookup"><span data-stu-id="54c87-130">When the antecedent completes, the continuation task, `continuation`, is passed the antecedent and displays a string that includes its result.</span></span>

> [!NOTE]
> <span data-ttu-id="54c87-131">Die C#-Beispiele in diesem Artikel verwenden den `async`-Modifizierer und die `Main`-Methode.</span><span class="sxs-lookup"><span data-stu-id="54c87-131">The C# samples in this article make use of the `async` modifier on the `Main` method.</span></span> <span data-ttu-id="54c87-132">Dieses Feature ist in C# 7.1 und höher verfügbar.</span><span class="sxs-lookup"><span data-stu-id="54c87-132">That feature is available in C# 7.1 and later.</span></span> <span data-ttu-id="54c87-133">In älteren Versionen wird beim Kompilieren des Beispielcodes [`CS5001`](../../csharp/misc/cs5001.md) generiert.</span><span class="sxs-lookup"><span data-stu-id="54c87-133">Previous versions generate [`CS5001`](../../csharp/misc/cs5001.md) when compiling this sample code.</span></span> <span data-ttu-id="54c87-134">Sie müssen deshalb als Sprachversion C# 7.1 oder höher verwenden.</span><span class="sxs-lookup"><span data-stu-id="54c87-134">You'll need to set the language version to C# 7.1 or newer.</span></span> <span data-ttu-id="54c87-135">Im Artikel [Auswählen der C#-Sprachversion](../../csharp/language-reference/configure-language-version.md) erfahren Sie, wie Sie die Sprachversion konfigurieren können.</span><span class="sxs-lookup"><span data-stu-id="54c87-135">You can learn how to configure the language version in the article on [configure language version](../../csharp/language-reference/configure-language-version.md).</span></span>

:::code language="csharp" source="snippets/cs/simple1.cs":::

[!code-vb[TPL_Continuations#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/simple1.vb#1)]

## <a name="create-a-continuation-for-multiple-antecedents"></a><span data-ttu-id="54c87-136">Erstellen einer Fortsetzung für mehrere Vorgänger</span><span class="sxs-lookup"><span data-stu-id="54c87-136">Create a continuation for multiple antecedents</span></span>

<span data-ttu-id="54c87-137">Sie können auch eine Fortsetzung erstellen, die ausgeführt wird, wenn beliebige oder alle Aufgaben einer Gruppe abgeschlossen wurden.</span><span class="sxs-lookup"><span data-stu-id="54c87-137">You can also create a continuation that will run when any or all of a group of tasks has completed.</span></span> <span data-ttu-id="54c87-138">Zum Ausführen einer Fortsetzung nach dem Abschluss aller Vorgängeraufgaben rufen Sie die statische (`Shared` in Visual Basic) <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType> -Methode oder die <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAll%2A?displayProperty=nameWithType> -Instanzmethode auf.</span><span class="sxs-lookup"><span data-stu-id="54c87-138">To execute a continuation when all antecedent tasks have completed, you call the static (`Shared` in Visual Basic) <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType> method or the instance <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAll%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="54c87-139">Zum Ausführen einer Fortsetzung nach dem Abschluss einer beliebigen Vorgängeraufgabe rufen Sie die statische (`Shared` in Visual Basic) <xref:System.Threading.Tasks.Task.WhenAny%2A?displayProperty=nameWithType> -Methode oder die <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAny%2A?displayProperty=nameWithType> -Instanzmethode auf.</span><span class="sxs-lookup"><span data-stu-id="54c87-139">To execute a continuation when any of the antecedent tasks has completed, you call the static (`Shared` in Visual Basic) <xref:System.Threading.Tasks.Task.WhenAny%2A?displayProperty=nameWithType> method or the instance <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAny%2A?displayProperty=nameWithType> method.</span></span>

<span data-ttu-id="54c87-140">Aufrufe der Überladungen <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType> und <xref:System.Threading.Tasks.Task.WhenAny%2A?displayProperty=nameWithType> blockieren nicht den aufrufenden Thread.</span><span class="sxs-lookup"><span data-stu-id="54c87-140">Calls to the <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType> and <xref:System.Threading.Tasks.Task.WhenAny%2A?displayProperty=nameWithType> overloads do not block the calling thread.</span></span> <span data-ttu-id="54c87-141">Allerdings rufen Sie in der Regel alle Methoden außer <xref:System.Threading.Tasks.Task.WhenAll%28System.Collections.Generic.IEnumerable%7BSystem.Threading.Tasks.Task%7D%29?displayProperty=nameWithType> und <xref:System.Threading.Tasks.Task.WhenAll%28System.Threading.Tasks.Task%5B%5D%29?displayProperty=nameWithType> auf, um die zurückgegebene <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType>-Eigenschaft abzurufen, die den aufrufenden Thread blockiert.</span><span class="sxs-lookup"><span data-stu-id="54c87-141">However, you typically call all but the <xref:System.Threading.Tasks.Task.WhenAll%28System.Collections.Generic.IEnumerable%7BSystem.Threading.Tasks.Task%7D%29?displayProperty=nameWithType> and <xref:System.Threading.Tasks.Task.WhenAll%28System.Threading.Tasks.Task%5B%5D%29?displayProperty=nameWithType> methods to retrieve the returned <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property, which does block the calling thread.</span></span>

<span data-ttu-id="54c87-142">Im folgenden Beispiel wird die <xref:System.Threading.Tasks.Task.WhenAll%28System.Collections.Generic.IEnumerable%7BSystem.Threading.Tasks.Task%7D%29?displayProperty=nameWithType> -Methode aufgerufen, um eine Fortsetzungsaufgabe zu erstellen, die die Ergebnisse ihrer zehn Vorgängeraufgaben wiedergibt.</span><span class="sxs-lookup"><span data-stu-id="54c87-142">The following example calls the <xref:System.Threading.Tasks.Task.WhenAll%28System.Collections.Generic.IEnumerable%7BSystem.Threading.Tasks.Task%7D%29?displayProperty=nameWithType> method to create a continuation task that reflects the results of its 10 antecedent tasks.</span></span> <span data-ttu-id="54c87-143">Jede Vorgängeraufgabe errechnet das Quadrat eines Indexwerts aus dem Bereich von 1 bis 10.</span><span class="sxs-lookup"><span data-stu-id="54c87-143">Each antecedent task squares an index value that ranges from one to 10.</span></span> <span data-ttu-id="54c87-144">Wenn die Vorgänger erfolgreich ausgeführt werden (also ihre <xref:System.Threading.Tasks.Task.Status%2A?displayProperty=nameWithType> -Eigenschaft <xref:System.Threading.Tasks.TaskStatus.RanToCompletion?displayProperty=nameWithType>ist), stellt die <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> -Eigenschaft der Fortsetzung ein Array der <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> -Werte dar, die von den einzelnen Vorgängern zurückgegeben wurden.</span><span class="sxs-lookup"><span data-stu-id="54c87-144">If the antecedents complete successfully (their <xref:System.Threading.Tasks.Task.Status%2A?displayProperty=nameWithType> property is <xref:System.Threading.Tasks.TaskStatus.RanToCompletion?displayProperty=nameWithType>), the <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property of the continuation is an array of the <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> values returned by each antecedent.</span></span> <span data-ttu-id="54c87-145">Im Beispiel werden sie addiert, um die Summe der Quadrate für alle Zahlen zwischen eins und zehn zu berechnen.</span><span class="sxs-lookup"><span data-stu-id="54c87-145">The example adds them to compute the sum of squares for all numbers between one and 10.</span></span>

:::code language="csharp" source="snippets/cs/whenall1.cs":::

[!code-vb[TPL_Continuations#5](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/whenall1.vb#5)]

## <a name="continuation-options"></a><span data-ttu-id="54c87-146">Fortsetzungsoptionen</span><span class="sxs-lookup"><span data-stu-id="54c87-146">Continuation options</span></span>

<span data-ttu-id="54c87-147">Wenn Sie eine Fortsetzung einer einzelnen Aufgabe erstellen, können Sie eine <xref:System.Threading.Tasks.Task.ContinueWith%2A> -Überladung erstellen, die einen <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> -Enumerationswert annimmt, um die Bedingungen anzugeben, unter denen die Vorgängeraufgabe die Fortsetzung startet.</span><span class="sxs-lookup"><span data-stu-id="54c87-147">When you create a single-task continuation, you can use a <xref:System.Threading.Tasks.Task.ContinueWith%2A> overload that takes a <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> enumeration value to specify the conditions under which the continuation starts.</span></span> <span data-ttu-id="54c87-148">Sie können beispielsweise angeben, dass die Fortsetzung nur ausgeführt werden soll, wenn der Vorgänger erfolgreich abgeschlossen wird, oder nur, wenn er in einem Fehlerzustand abgeschlossen wird.</span><span class="sxs-lookup"><span data-stu-id="54c87-148">For example, you can specify that the continuation is to run only if the antecedent completes successfully, or only if it completes in a faulted state.</span></span> <span data-ttu-id="54c87-149">Wenn die Bedingung zu dem Zeitpunkt, zu dem der Vorgänger bereit ist, die Fortsetzung aufzurufen, nicht erfüllt ist, geht die Fortsetzung direkt in den Zustand <xref:System.Threading.Tasks.TaskStatus.Canceled?displayProperty=nameWithType> über und kann anschließend nicht mehr gestartet werden.</span><span class="sxs-lookup"><span data-stu-id="54c87-149">If the condition is not true when the antecedent is ready to invoke the continuation, the continuation transitions directly to the <xref:System.Threading.Tasks.TaskStatus.Canceled?displayProperty=nameWithType> state and subsequently cannot be started.</span></span>

<span data-ttu-id="54c87-150">Eine Reihe von Fortsetzungsmethoden für mehrere Aufgaben, wie etwa Überladungen der Methode <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAll%2A?displayProperty=nameWithType> , beinhalten außerdem einen Parameter <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="54c87-150">A number of multi-task continuation methods, such as overloads of the <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAll%2A?displayProperty=nameWithType> method, also include a <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> parameter.</span></span> <span data-ttu-id="54c87-151">Allerdings ist nur eine Teilmenge aller Elemente der <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> -Enumeration gültig.</span><span class="sxs-lookup"><span data-stu-id="54c87-151">Only a subset of all <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> enumeration members are valid, however.</span></span> <span data-ttu-id="54c87-152">Sie können <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> -Werte angeben, die Entsprechungen in der <xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=nameWithType> -Enumeration aufweisen, wie etwa <xref:System.Threading.Tasks.TaskContinuationOptions.AttachedToParent?displayProperty=nameWithType>, <xref:System.Threading.Tasks.TaskContinuationOptions.LongRunning?displayProperty=nameWithType>und <xref:System.Threading.Tasks.TaskContinuationOptions.PreferFairness?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="54c87-152">You can specify <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> values that have counterparts in the <xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=nameWithType> enumeration, such as <xref:System.Threading.Tasks.TaskContinuationOptions.AttachedToParent?displayProperty=nameWithType>, <xref:System.Threading.Tasks.TaskContinuationOptions.LongRunning?displayProperty=nameWithType>, and <xref:System.Threading.Tasks.TaskContinuationOptions.PreferFairness?displayProperty=nameWithType>.</span></span> <span data-ttu-id="54c87-153">Wenn Sie für eine Fortsetzung mit mehreren Aufgaben die `NotOn` -Option oder die `OnlyOn` -Option angeben, wird zur Laufzeit eine <xref:System.ArgumentOutOfRangeException> -Ausnahme ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="54c87-153">If you specify any of the `NotOn` or `OnlyOn` options with a multi-task continuation, an <xref:System.ArgumentOutOfRangeException> exception will be thrown at run time.</span></span>

<span data-ttu-id="54c87-154">Weitere Informationen zu den Optionen für die Fortsetzung von Aufgaben finden Sie im Thema <xref:System.Threading.Tasks.TaskContinuationOptions> .</span><span class="sxs-lookup"><span data-stu-id="54c87-154">For more information on task continuation options, see the <xref:System.Threading.Tasks.TaskContinuationOptions> topic.</span></span>

## <a name="pass-data-to-a-continuation"></a><span data-ttu-id="54c87-155">Übergeben von Daten an eine Fortsetzung</span><span class="sxs-lookup"><span data-stu-id="54c87-155">Pass data to a continuation</span></span>

<span data-ttu-id="54c87-156">Die Methode <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType> übergibt einen Verweis auf den Vorgänger als Argument an den Benutzerstellvertreter der Fortsetzung.</span><span class="sxs-lookup"><span data-stu-id="54c87-156">The <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType> method passes a reference to the antecedent to the user delegate of the continuation as an argument.</span></span> <span data-ttu-id="54c87-157">Wenn es sich beim dem Vorgänger um ein <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType> -Objekt handelt und die Aufgabe bis zum Abschluss ausgeführt wurde, kann die Fortsetzung auf die <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> -Eigenschaft der Aufgabe zugreifen.</span><span class="sxs-lookup"><span data-stu-id="54c87-157">If the antecedent is a <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType> object, and the task ran until it was completed, then the continuation can access the <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property of the task.</span></span>

<span data-ttu-id="54c87-158">Die <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> -Eigenschaft ist bis zum Abschluss der Aufgabe blockiert.</span><span class="sxs-lookup"><span data-stu-id="54c87-158">The <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property blocks until the task has completed.</span></span> <span data-ttu-id="54c87-159">Wenn die Aufgabe jedoch abgebrochen oder als fehlerhaft gekennzeichnet wurde, wird beim Versuch, auf die <xref:System.Threading.Tasks.Task%601.Result%2A> -Eigenschaft zuzugreifen, eine <xref:System.AggregateException> -Ausnahme ausgegeben.</span><span class="sxs-lookup"><span data-stu-id="54c87-159">However, if the task was canceled or faulted, attempting to access the <xref:System.Threading.Tasks.Task%601.Result%2A> property throws an <xref:System.AggregateException> exception.</span></span> <span data-ttu-id="54c87-160">Sie können dieses Problem vermeiden, indem Sie die <xref:System.Threading.Tasks.TaskContinuationOptions.OnlyOnRanToCompletion> -Option wie im folgenden Beispiel gezeigt angeben.</span><span class="sxs-lookup"><span data-stu-id="54c87-160">You can avoid this problem by using the <xref:System.Threading.Tasks.TaskContinuationOptions.OnlyOnRanToCompletion> option, as shown in the following example.</span></span>

:::code language="csharp" source="snippets/cs/result1.cs":::

[!code-vb[TPL_Continuations#2](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/result1.vb#2)]

<span data-ttu-id="54c87-161">Wenn die Fortsetzung auch dann ausgeführt werden soll, wenn der Vorgänger nicht erfolgreich bis zum Abschluss ausgeführt wurde, müssen Sie Vorkehrungen gegen diese Ausnahme treffen.</span><span class="sxs-lookup"><span data-stu-id="54c87-161">If you want the continuation to run even if the antecedent did not run to successful completion, you must guard against the exception.</span></span> <span data-ttu-id="54c87-162">Ein Ansatz besteht darin, die Eigenschaft <xref:System.Threading.Tasks.Task.Status%2A?displayProperty=nameWithType> des Vorgängers zu prüfen und den Zugriff auf die Eigenschaft <xref:System.Threading.Tasks.Task%601.Result%2A> nur zu versuchen, wenn der Zustand nicht <xref:System.Threading.Tasks.TaskStatus.Faulted> oder <xref:System.Threading.Tasks.TaskStatus.Canceled>ist.</span><span class="sxs-lookup"><span data-stu-id="54c87-162">One approach is to test the <xref:System.Threading.Tasks.Task.Status%2A?displayProperty=nameWithType> property of the antecedent, and only attempt to access the <xref:System.Threading.Tasks.Task%601.Result%2A> property if the status is not <xref:System.Threading.Tasks.TaskStatus.Faulted> or <xref:System.Threading.Tasks.TaskStatus.Canceled>.</span></span> <span data-ttu-id="54c87-163">Sie können jedoch auch die <xref:System.Threading.Tasks.Task.Exception%2A> -Eigenschaft des Vorgängers überprüfen.</span><span class="sxs-lookup"><span data-stu-id="54c87-163">You can also examine the <xref:System.Threading.Tasks.Task.Exception%2A> property of the antecedent.</span></span> <span data-ttu-id="54c87-164">Weitere Informationen finden Sie unter [Ausnahmebehandlung (Task Parallel Library)](exception-handling-task-parallel-library.md).</span><span class="sxs-lookup"><span data-stu-id="54c87-164">For more information, see [Exception Handling](exception-handling-task-parallel-library.md).</span></span> <span data-ttu-id="54c87-165">Im folgenden Beispiel wird das vorhergehende Beispiel verändert, und der Zugriff auf die Eigenschaft <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> des Vorgängers erfolgt nur, wenn dessen Zustand <xref:System.Threading.Tasks.TaskStatus.RanToCompletion?displayProperty=nameWithType>ist.</span><span class="sxs-lookup"><span data-stu-id="54c87-165">The following example modifies the previous example to access antecedent's <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property only if its status is <xref:System.Threading.Tasks.TaskStatus.RanToCompletion?displayProperty=nameWithType>.</span></span>

:::code language="csharp" source="snippets/cs/result2.cs":::

[!code-vb[TPL_Continuations#7](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/result2.vb#7)]

## <a name="cancel-a-continuation"></a><span data-ttu-id="54c87-166">Abbrechen einer Fortsetzung</span><span class="sxs-lookup"><span data-stu-id="54c87-166">Cancel a continuation</span></span>

<span data-ttu-id="54c87-167">Die <xref:System.Threading.Tasks.Task.Status%2A?displayProperty=nameWithType> -Eigenschaft einer Fortsetzung wird in den folgenden Situationen auf <xref:System.Threading.Tasks.TaskStatus.Canceled?displayProperty=nameWithType> festgelegt:</span><span class="sxs-lookup"><span data-stu-id="54c87-167">The <xref:System.Threading.Tasks.Task.Status%2A?displayProperty=nameWithType> property of a continuation is set to <xref:System.Threading.Tasks.TaskStatus.Canceled?displayProperty=nameWithType> in the following situations:</span></span>

- <span data-ttu-id="54c87-168">Sie löst als Antwort auf eine Abbruchanforderung eine <xref:System.OperationCanceledException> -Ausnahme aus.</span><span class="sxs-lookup"><span data-stu-id="54c87-168">It throws an <xref:System.OperationCanceledException> exception in response to a cancellation request.</span></span> <span data-ttu-id="54c87-169">Wenn die Ausnahme das gleiche Token enthält, das an die Fortsetzung übergeben wurde, wird dies als Bestätigung des kooperativen Abbruchs interpretiert, wie dies bei allen Aufgaben der Fall ist.</span><span class="sxs-lookup"><span data-stu-id="54c87-169">As with any task, if the exception contains the same token that was passed to the continuation, it is treated as an acknowledgment of cooperative cancellation.</span></span>
- <span data-ttu-id="54c87-170">Der Fortsetzung wird ein <xref:System.Threading.CancellationToken?displayProperty=nameWithType> übergeben, dessen <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> -Eigenschaft auf `true`festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="54c87-170">The continuation is passed a <xref:System.Threading.CancellationToken?displayProperty=nameWithType> whose <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> property is `true`.</span></span> <span data-ttu-id="54c87-171">In diesem Fall wird die Fortsetzung nicht gestartet und geht in den Zustand <xref:System.Threading.Tasks.TaskStatus.Canceled?displayProperty=nameWithType> über.</span><span class="sxs-lookup"><span data-stu-id="54c87-171">In this case, the continuation does not start, and it transitions to the <xref:System.Threading.Tasks.TaskStatus.Canceled?displayProperty=nameWithType> state.</span></span>
- <span data-ttu-id="54c87-172">Die Fortsetzung wird nie ausgeführt, das die von ihrem <xref:System.Threading.Tasks.TaskContinuationOptions> -Argument festgelegte Bedingung nicht erfüllt wurde.</span><span class="sxs-lookup"><span data-stu-id="54c87-172">The continuation never runs because the condition set by its <xref:System.Threading.Tasks.TaskContinuationOptions> argument was not met.</span></span> <span data-ttu-id="54c87-173">Wenn beispielsweise ein Vorgänger in einen <xref:System.Threading.Tasks.TaskStatus.Faulted?displayProperty=nameWithType> -Zustand übergeht, wird seine Fortsetzung, der die Option <xref:System.Threading.Tasks.TaskContinuationOptions.NotOnFaulted?displayProperty=nameWithType> übergeben wurde, nicht ausgeführt, sondern geht stattdessen in den <xref:System.Threading.Tasks.TaskStatus.Canceled> -Zustand über.</span><span class="sxs-lookup"><span data-stu-id="54c87-173">For example, if an antecedent goes into a <xref:System.Threading.Tasks.TaskStatus.Faulted?displayProperty=nameWithType> state, its continuation that was passed the <xref:System.Threading.Tasks.TaskContinuationOptions.NotOnFaulted?displayProperty=nameWithType> option will not run but will transition to the <xref:System.Threading.Tasks.TaskStatus.Canceled> state.</span></span>

<span data-ttu-id="54c87-174">Wenn eine Aufgabe und die zugehörige Fortsetzung zwei Teile des gleichen logischen Vorgangs sind, können Sie das gleiche Abbruchtoken an beide Aufgaben übergeben, wie im folgenden Beispiel gezeigt.</span><span class="sxs-lookup"><span data-stu-id="54c87-174">If a task and its continuation represent two parts of the same logical operation, you can pass the same cancellation token to both tasks, as shown in the following example.</span></span> <span data-ttu-id="54c87-175">Es besteht aus einem Vorgänger, der eine Liste mit ganzen Zahlen erstellt, die durch 33 teilbar sind und übergibt sie an die Fortsetzung.</span><span class="sxs-lookup"><span data-stu-id="54c87-175">It consists of an antecedent that generates a list of integers that are divisible by 33, which it passes to the continuation.</span></span> <span data-ttu-id="54c87-176">Die Fortsetzung zeigt ihrerseits die Liste an.</span><span class="sxs-lookup"><span data-stu-id="54c87-176">The continuation in turn displays the list.</span></span> <span data-ttu-id="54c87-177">Sowohl der Vorgänger als auch die Fortsetzung werden regelmäßig in zufälligen Intervallen angehalten.</span><span class="sxs-lookup"><span data-stu-id="54c87-177">Both the antecedent and the continuation pause regularly for random intervals.</span></span> <span data-ttu-id="54c87-178">Darüber hinaus wird ein <xref:System.Threading.Timer?displayProperty=nameWithType> -Objekt verwendet, um die Methode `Elapsed` nach einem fünf Sekunden betragenden Timeoutintervall auszuführen.</span><span class="sxs-lookup"><span data-stu-id="54c87-178">In addition, a <xref:System.Threading.Timer?displayProperty=nameWithType> object is used to execute the `Elapsed` method after a five-second timeout interval.</span></span> <span data-ttu-id="54c87-179">In diesem Beispiel wird die <xref:System.Threading.CancellationTokenSource.Cancel%2A?displayProperty=nameWithType> -Methode aufgerufen, die bewirkt, dass die aktuell ausgeführte Aufgabe die <xref:System.Threading.CancellationToken.ThrowIfCancellationRequested%2A?displayProperty=nameWithType> -Methode aufruft.</span><span class="sxs-lookup"><span data-stu-id="54c87-179">This example calls the <xref:System.Threading.CancellationTokenSource.Cancel%2A?displayProperty=nameWithType> method, which causes the currently executing task to call the <xref:System.Threading.CancellationToken.ThrowIfCancellationRequested%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="54c87-180">Ob die Methode <xref:System.Threading.CancellationTokenSource.Cancel%2A?displayProperty=nameWithType> während der Ausführung des Vorgängers oder seiner Fortsetzung aufgerufen wird, hängt von der Dauer der zufällig generierten Pausen ab.</span><span class="sxs-lookup"><span data-stu-id="54c87-180">Whether the <xref:System.Threading.CancellationTokenSource.Cancel%2A?displayProperty=nameWithType> method is called when the antecedent or its continuation is executing depends on the duration of the randomly generated pauses.</span></span> <span data-ttu-id="54c87-181">Wenn der Vorgänger abgebrochen wurde, wird die Fortsetzung nicht gestartet.</span><span class="sxs-lookup"><span data-stu-id="54c87-181">If the antecedent is canceled, the continuation will not start.</span></span> <span data-ttu-id="54c87-182">Wenn der Vorgänger nicht abgebrochen wird, kann das Token trotzdem zum Abbrechen der Fortsetzung verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="54c87-182">If the antecedent is not canceled, the token can still be used to cancel the continuation.</span></span>

:::code language="csharp" source="snippets/cs/cancellation1.cs":::

[!code-vb[TPL_Continuations#3](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/cancellation1.vb#3)]

<span data-ttu-id="54c87-183">Ferner können Sie die Ausführung einer Fortsetzung verhindern, wenn deren Vorgänger abgebrochen wird, ohne der Fortsetzung durch Angeben der Option <xref:System.Threading.Tasks.TaskContinuationOptions.NotOnCanceled?displayProperty=nameWithType> beim Erstellen der Fortsetzung ein Abbruchtoken zu übergeben.</span><span class="sxs-lookup"><span data-stu-id="54c87-183">You can also prevent a continuation from executing if its antecedent is canceled without supplying the continuation a cancellation token by specifying the <xref:System.Threading.Tasks.TaskContinuationOptions.NotOnCanceled?displayProperty=nameWithType> option when you create the continuation.</span></span> <span data-ttu-id="54c87-184">Im Folgenden finden Sie ein einfaches Beispiel.</span><span class="sxs-lookup"><span data-stu-id="54c87-184">The following is a simple example.</span></span>

:::code language="csharp" source="snippets/cs/cancellation2.cs":::

[!code-vb[TPL_Continuations#8](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/cancellation2.vb#8)]

<span data-ttu-id="54c87-185">Nachdem eine Fortsetzung in den Zustand <xref:System.Threading.Tasks.TaskStatus.Canceled> übergegangen ist, wirkt sich dies möglicherweise auf nachfolgende Fortsetzungen aus. Dies ist abhängig von den <xref:System.Threading.Tasks.TaskContinuationOptions> , die für die Fortsetzungen angegeben wurden.</span><span class="sxs-lookup"><span data-stu-id="54c87-185">After a continuation goes into the <xref:System.Threading.Tasks.TaskStatus.Canceled> state, it may affect continuations that follow, depending on the <xref:System.Threading.Tasks.TaskContinuationOptions> that were specified for those continuations.</span></span>

<span data-ttu-id="54c87-186">Fortsetzungen, die verworfen wurden, werden nicht gestartet.</span><span class="sxs-lookup"><span data-stu-id="54c87-186">Continuations that are disposed will not start.</span></span>

## <a name="continuations-and-child-tasks"></a><span data-ttu-id="54c87-187">Fortsetzungen und untergeordnete Tasks</span><span class="sxs-lookup"><span data-stu-id="54c87-187">Continuations and child tasks</span></span>

<span data-ttu-id="54c87-188">Eine Fortsetzung wird erst ausgeführt, wenn der Vorgänger und all zugehörigen untergeordneten Aufgaben abgeschlossen wurden.</span><span class="sxs-lookup"><span data-stu-id="54c87-188">A continuation does not run until the antecedent and all of its attached child tasks have completed.</span></span> <span data-ttu-id="54c87-189">Die Fortsetzung wartet jedoch nicht, bis getrennte untergeordnete Aufgaben beendet wurden.</span><span class="sxs-lookup"><span data-stu-id="54c87-189">The continuation does not wait for detached child tasks to finish.</span></span> <span data-ttu-id="54c87-190">Die beiden folgenden Beispiele veranschaulichen untergeordnete Aufgaben, die an einen Vorgänger, der eine Fortsetzung erstellt, angefügt und von ihm getrennt werden.</span><span class="sxs-lookup"><span data-stu-id="54c87-190">The following two examples illustrate child tasks that are attached to and detached from an antecedent that creates a continuation.</span></span> <span data-ttu-id="54c87-191">Im folgenden Beispiel wird die Fortsetzung nur ausgeführt, wenn alle untergeordneten Aufgaben abgeschlossen wurden und die mehrfache Ausführung des Beispiels stets die gleiche Ausgabe erzeugt.</span><span class="sxs-lookup"><span data-stu-id="54c87-191">In the following example, the continuation runs only after all child tasks have completed, and running the example multiple times produces identical output each time.</span></span> <span data-ttu-id="54c87-192">Der Vorgänger im Beispiel wird durch Aufrufen der Methode <xref:System.Threading.Tasks.TaskFactory.StartNew%2A?displayProperty=nameWithType> gestartet. Daher erstellt die Methode <xref:System.Threading.Tasks.Task.Run%2A?displayProperty=nameWithType> standardmäßig eine übergeordnete Aufgabe, deren Standardoption zur Aufgabenerstellung <xref:System.Threading.Tasks.TaskCreationOptions.DenyChildAttach?displayProperty=nameWithType> ist.</span><span class="sxs-lookup"><span data-stu-id="54c87-192">The example launches the antecedent by calling the <xref:System.Threading.Tasks.TaskFactory.StartNew%2A?displayProperty=nameWithType> method, since by default the <xref:System.Threading.Tasks.Task.Run%2A?displayProperty=nameWithType> method creates a parent task whose default task creation option is <xref:System.Threading.Tasks.TaskCreationOptions.DenyChildAttach?displayProperty=nameWithType>.</span></span>

:::code language="csharp" source="snippets/cs/attached1.cs":::

[!code-vb[TPL_Continuations#9](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/attached1.vb#9)]

<span data-ttu-id="54c87-193">Wenn jedoch untergeordnete Aufgaben vom Vorgänger getrennt werden, wird die Fortsetzung ausgeführt, sobald der Vorgänger abgeschlossen wurde, unabhängig vom Zustand der untergeordneten Aufgaben.</span><span class="sxs-lookup"><span data-stu-id="54c87-193">If child tasks are detached from the antecedent, however, the continuation runs as soon as the antecedent has terminated, regardless of the state of the child tasks.</span></span> <span data-ttu-id="54c87-194">Daher können mehrfache Ausführungen des folgenden Beispiels veränderliche Ausgaben erzeugen, die davon abhängen, wie der Taskplaner die einzelnen untergeordneten Aufgaben verarbeitet hat.</span><span class="sxs-lookup"><span data-stu-id="54c87-194">As a result, multiple runs of the following example can produce variable output that depends on how the task scheduler handled each child task.</span></span>

:::code language="csharp" source="snippets/cs/detached1.cs":::

[!code-vb[TPL_Continuations#10](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/detached1.vb#10)]

<span data-ttu-id="54c87-195">Der Endstatus der Vorgängeraufgabe hängt vom Endstatus aller zugehörigen untergeordneten Aufgaben ab.</span><span class="sxs-lookup"><span data-stu-id="54c87-195">The final status of the antecedent task depends on the final status of any attached child tasks.</span></span> <span data-ttu-id="54c87-196">Der Status getrennter untergeordneter Aufgaben wirkt sich nicht auf das übergeordnete Element aus.</span><span class="sxs-lookup"><span data-stu-id="54c87-196">The status of detached child tasks does not affect the parent.</span></span> <span data-ttu-id="54c87-197">Weitere Informationen finden Sie unter [Angefügte und getrennte untergeordnete Aufgaben](attached-and-detached-child-tasks.md).</span><span class="sxs-lookup"><span data-stu-id="54c87-197">For more information, see [Attached and Detached Child Tasks](attached-and-detached-child-tasks.md).</span></span>

## <a name="associate-state-with-continuations"></a><span data-ttu-id="54c87-198">Zuordnen eines Zustands zu Fortsetzungen</span><span class="sxs-lookup"><span data-stu-id="54c87-198">Associate state with continuations</span></span>

<span data-ttu-id="54c87-199">Sie können einer Aufgabenfortsetzung einen die oft ausgegebene Befehlszeilen  Zustand zuordnen.</span><span class="sxs-lookup"><span data-stu-id="54c87-199">You can associate arbitrary state with a task continuation.</span></span> <span data-ttu-id="54c87-200">Die <xref:System.Threading.Tasks.Task.ContinueWith%2A> -Methode stellt überladene Versionen bereit, von denen jede einen <xref:System.Object> -Wert annimmt, der den Zustand der Fortsetzung darstellt.</span><span class="sxs-lookup"><span data-stu-id="54c87-200">The <xref:System.Threading.Tasks.Task.ContinueWith%2A> method provides overloaded versions that each take an <xref:System.Object> value that represents the state of the continuation.</span></span> <span data-ttu-id="54c87-201">Sie können später mit der <xref:System.Threading.Tasks.Task.AsyncState%2A?displayProperty=nameWithType> -Eigenschaft auf dieses Zustandsobjekt zugreifen.</span><span class="sxs-lookup"><span data-stu-id="54c87-201">You can later access this state object by using the <xref:System.Threading.Tasks.Task.AsyncState%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="54c87-202">Das Zustandsobjekt ist `null` , wenn kein Wert angegeben wird.</span><span class="sxs-lookup"><span data-stu-id="54c87-202">This state object is `null` if you do not provide a value.</span></span>

<span data-ttu-id="54c87-203">Der Fortsetzungszustand ist bei der Verwendung der TPL nützlich, wenn Sie vorhandenen Code konvertieren, der das [Asynchrone Programmiermodell (APM)](../asynchronous-programming-patterns/asynchronous-programming-model-apm.md) verwendet.</span><span class="sxs-lookup"><span data-stu-id="54c87-203">Continuation state is useful when you convert existing code that uses the [Asynchronous Programming Model (APM)](../asynchronous-programming-patterns/asynchronous-programming-model-apm.md) to use the TPL.</span></span> <span data-ttu-id="54c87-204">Im APM stellen Sie in der Regel den Objektzustand in der **Begin**_Method_-Methode bereit und greifen später mithilfe der <xref:System.IAsyncResult.AsyncState%2A?displayProperty=nameWithType>-Eigenschaft auf diesen Zustand zu.</span><span class="sxs-lookup"><span data-stu-id="54c87-204">In the APM, you typically provide object state in the **Begin**_Method_ method and later access that state by using the <xref:System.IAsyncResult.AsyncState%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="54c87-205">Mithilfe der <xref:System.Threading.Tasks.Task.ContinueWith%2A> -Methode können Sie diesen Zustand beibehalten, wenn Sie Code konvertieren, der das APM zur Verwendung der TPL verwendet.</span><span class="sxs-lookup"><span data-stu-id="54c87-205">By using the <xref:System.Threading.Tasks.Task.ContinueWith%2A> method, you can preserve this state when you convert code that uses the APM to use the TPL.</span></span>

<span data-ttu-id="54c87-206">Der Fortsetzungszustand kann außerdem hilfreich sein, wenn Sie mit <xref:System.Threading.Tasks.Task>-Objekten im Visual Studio-Debugger arbeiten.</span><span class="sxs-lookup"><span data-stu-id="54c87-206">Continuation state can also be useful when you work with <xref:System.Threading.Tasks.Task> objects in the Visual Studio debugger.</span></span> <span data-ttu-id="54c87-207">Beispielsweise wird im Fenster **Parallele Aufgaben** in der Spalte **Aufgabe** die Zeichenfolgendarstellung des Zustandsobjekts für jede Aufgabe angezeigt.</span><span class="sxs-lookup"><span data-stu-id="54c87-207">For example, in the **Parallel Tasks** window, the **Task** column displays the string representation of the state object for each task.</span></span> <span data-ttu-id="54c87-208">Weitere Informationen zum Fenster **Parallele Aufgaben** finden Sie unter [Verwenden des Fensters „Aufgaben“](/visualstudio/debugger/using-the-tasks-window).</span><span class="sxs-lookup"><span data-stu-id="54c87-208">For more information about the **Parallel Tasks** window, see [Using the Tasks Window](/visualstudio/debugger/using-the-tasks-window).</span></span>

<span data-ttu-id="54c87-209">Im folgenden Beispiel wird die Verwendung eines Fortsetzungszustands gezeigt.</span><span class="sxs-lookup"><span data-stu-id="54c87-209">The following example shows how to use continuation state.</span></span> <span data-ttu-id="54c87-210">Es erstellt eine Kette von Fortsetzungsaufgaben.</span><span class="sxs-lookup"><span data-stu-id="54c87-210">It creates a chain of continuation tasks.</span></span> <span data-ttu-id="54c87-211">Jede Aufgabe stellt die aktuelle Uhrzeit, ein <xref:System.DateTime> -Objekt, für den `state` -Parameter der <xref:System.Threading.Tasks.Task.ContinueWith%2A> -Methode bereit.</span><span class="sxs-lookup"><span data-stu-id="54c87-211">Each task provides the current time, a <xref:System.DateTime> object, for the `state` parameter of the <xref:System.Threading.Tasks.Task.ContinueWith%2A> method.</span></span> <span data-ttu-id="54c87-212">Jedes <xref:System.DateTime> -Objekt stellt die Erstellungszeit der Fortsetzungsaufgabe dar.</span><span class="sxs-lookup"><span data-stu-id="54c87-212">Each <xref:System.DateTime> object represents the time at which the continuation task is created.</span></span> <span data-ttu-id="54c87-213">Jede Aufgabe erzeugt als Ergebnis ein zweites <xref:System.DateTime> -Objekt, das die Beendigungszeit der Aufgabe darstellt.</span><span class="sxs-lookup"><span data-stu-id="54c87-213">Each task produces as its result a second <xref:System.DateTime> object that represents the time at which the task finishes.</span></span> <span data-ttu-id="54c87-214">Nach der Beendigung aller Aufgaben zeigt dieses Beispiel die Erstellungszeit und die Beendigungszeit jeder Fortsetzungsaufgabe an.</span><span class="sxs-lookup"><span data-stu-id="54c87-214">After all tasks finish, this example displays the creation time and the time at which each continuation task finishes.</span></span>

:::code language="csharp" source="snippets/cs/continuationstate.cs":::

[!code-vb[TPL_ContinuationState#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuationstate/vb/continuationstate.vb#1)]

## <a name="continuations-that-return-task-types"></a><span data-ttu-id="54c87-215">Fortsetzungen, die Tasktypen zurückgeben</span><span class="sxs-lookup"><span data-stu-id="54c87-215">Continuations that return Task types</span></span>

<span data-ttu-id="54c87-216">Zuweilen ist es erforderlich, eine Fortsetzung zu verketten, die einen <xref:System.Threading.Tasks.Task>-Typ zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="54c87-216">Sometimes you may need to chain a continuation that returns a <xref:System.Threading.Tasks.Task> type.</span></span> <span data-ttu-id="54c87-217">Diese werden als geschachtelte Tasks bezeichnet und kommen recht häufig vor.</span><span class="sxs-lookup"><span data-stu-id="54c87-217">These are referred to as nested tasks, and they are common.</span></span> <span data-ttu-id="54c87-218">Wenn ein übergeordneter Task <xref:System.Threading.Tasks.Task%601.ContinueWith%2A?displayProperty=nameWithType> aufruft und eine `continuationFunction` angibt, die einen Task zurückgibt, rufen Sie <xref:System.Threading.Tasks.TaskExtensions.Unwrap%2A> auf, um einen Proxytask zu erstellen, der den asynchronen Vorgang von `<Task<Task<T>>>` oder `Task(Of Task(Of T))` (Visual Basic) repräsentiert.</span><span class="sxs-lookup"><span data-stu-id="54c87-218">When a parent task calls <xref:System.Threading.Tasks.Task%601.ContinueWith%2A?displayProperty=nameWithType>, and provides a `continuationFunction` that is task returning you call <xref:System.Threading.Tasks.TaskExtensions.Unwrap%2A> to create a proxy task that represents the asynchronous operation of the `<Task<Task<T>>>` or `Task(Of Task(Of T))` (Visual Basic).</span></span>

<span data-ttu-id="54c87-219">Das folgende Beispiel zeigt, wie Fortsetzungen verwendet werden, die zusätzliche Funktionen umschließen, die Tasks zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="54c87-219">The following example shows how to use continuations that wrap additional task returning functions.</span></span> <span data-ttu-id="54c87-220">Die Umschließung jeder Fortsetzung kann aufgehoben werden, um den inneren Task verfügbar zu machen, der umschlossen war.</span><span class="sxs-lookup"><span data-stu-id="54c87-220">Each continuation can be unwrapped, exposing the inner task that was wrapped.</span></span>

:::code language="csharp" source="snippets/cs/unwrap.cs":::
:::code language="vb" source="snippets/vb/unwrap.vb":::

<span data-ttu-id="54c87-221">Weitere Informationen zur Verwendung von <xref:System.Threading.Tasks.TaskExtensions.Unwrap%2A> finden Sie unter [Gewusst wie: Entpacken einer geschachtelten Aufgabe](how-to-unwrap-a-nested-task.md).</span><span class="sxs-lookup"><span data-stu-id="54c87-221">For more information on using <xref:System.Threading.Tasks.TaskExtensions.Unwrap%2A>, see [How to: Unwrap a nested Task](how-to-unwrap-a-nested-task.md).</span></span>

## <a name="handle-exceptions-thrown-from-continuations"></a><span data-ttu-id="54c87-222">Behandeln von durch Fortsetzungen ausgelösten Ausnahmen</span><span class="sxs-lookup"><span data-stu-id="54c87-222">Handle exceptions thrown from continuations</span></span>

<span data-ttu-id="54c87-223">Eine Vorgänger-Fortsetzung-Beziehung ist keine Beziehung zwischen übergeordneten und untergeordneten Elementen.</span><span class="sxs-lookup"><span data-stu-id="54c87-223">An antecedent-continuation relationship is not a parent-child relationship.</span></span> <span data-ttu-id="54c87-224">Durch Fortsetzungen ausgelöste Ausnahmen werden nicht an den Vorgänger weitergegeben.</span><span class="sxs-lookup"><span data-stu-id="54c87-224">Exceptions thrown by continuations are not propagated to the antecedent.</span></span> <span data-ttu-id="54c87-225">Behandeln Sie Ausnahmen, die von Fortsetzungen ausgelöst wurden, daher wie bei allen anderen Aufgaben (siehe unten):</span><span class="sxs-lookup"><span data-stu-id="54c87-225">Therefore, handle exceptions thrown by continuations as you would handle them in any other task, as follows:</span></span>

- <span data-ttu-id="54c87-226">Verwenden Sie die Methode <xref:System.Threading.Tasks.Task.Wait%2A>, <xref:System.Threading.Tasks.Task.WaitAll%2A>oder <xref:System.Threading.Tasks.Task.WaitAny%2A> bzw. die generische Entsprechung, um auf die Fortsetzung zu warten.</span><span class="sxs-lookup"><span data-stu-id="54c87-226">You can use the <xref:System.Threading.Tasks.Task.Wait%2A>, <xref:System.Threading.Tasks.Task.WaitAll%2A>, or <xref:System.Threading.Tasks.Task.WaitAny%2A> method, or its generic counterpart, to wait on the continuation.</span></span> <span data-ttu-id="54c87-227">Sie können in der gleichen `try` -Anweisung auf einen Vorgänger und seine Fortsetzungen warten, wie im folgenden Beispiel gezeigt.</span><span class="sxs-lookup"><span data-stu-id="54c87-227">You can wait for an antecedent and its continuations in the same `try` statement, as shown in the following example.</span></span>

:::code language="csharp" source="snippets/cs/exception1.cs":::

[!code-vb[TPL_Continuations#6](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/exception1.vb#6)]

- <span data-ttu-id="54c87-228">Sie können eine zweite Fortsetzung verwenden, um die <xref:System.Threading.Tasks.Task.Exception%2A> -Eigenschaft der ersten Fortsetzung zu beachten.</span><span class="sxs-lookup"><span data-stu-id="54c87-228">You can use a second continuation to observe the <xref:System.Threading.Tasks.Task.Exception%2A> property of the first continuation.</span></span> <span data-ttu-id="54c87-229">In folgenden Beispiel versucht eine Aufgabe, aus einer nicht vorhandenen Datei zu lesen.</span><span class="sxs-lookup"><span data-stu-id="54c87-229">In the following example, a task attempts to read from a non-existent file.</span></span> <span data-ttu-id="54c87-230">In einem solchen Fall zeigt die Fortsetzung Informationen über die Ausnahme in der vorhergehenden Aufgabe an.</span><span class="sxs-lookup"><span data-stu-id="54c87-230">The continuation then displays information about the exception in the antecedent task.</span></span>

:::code language="csharp" source="snippets/cs/exception2.cs" id="example":::

[!code-vb[TPL_Continuations#4](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/exception2.vb#4)]

<span data-ttu-id="54c87-231">Da die Ausführung mit der Option <xref:System.Threading.Tasks.TaskContinuationOptions.OnlyOnFaulted?displayProperty=nameWithType> erfolgt ist, wird die Fortsetzung nur ausgeführt, wenn im Vorgänger eine Ausnahme auftritt, daher kann sie davon ausgehen, dass die Eigenschaft <xref:System.Threading.Tasks.Task.Exception%2A> des Vorgängers nicht `null`ist.</span><span class="sxs-lookup"><span data-stu-id="54c87-231">Because it was run with the <xref:System.Threading.Tasks.TaskContinuationOptions.OnlyOnFaulted?displayProperty=nameWithType> option, the continuation executes only if an exception occurs in the antecedent, and therefore it can assume that the antecedent's <xref:System.Threading.Tasks.Task.Exception%2A> property is not `null`.</span></span> <span data-ttu-id="54c87-232">Wenn die Fortsetzung unabhängig davon ausgeführt wird, ob im Vorgänger eine Ausnahme ausgelöst wurde, muss entsprechend eine Prüfung darauf erfolgen, dass die Eigenschaft <xref:System.Threading.Tasks.Task.Exception%2A> des Vorgängers nicht `null` ist, bevor versucht wird, die Ausnahme zu behandeln, wie im folgenden Beispiel dargestellt.</span><span class="sxs-lookup"><span data-stu-id="54c87-232">If the continuation executes whether or not an exception is thrown in the antecedent, it would have to check whether the antecedent's <xref:System.Threading.Tasks.Task.Exception%2A> property is not `null` before attempting to handle the exception, as the following code fragment shows.</span></span>

:::code language="csharp" source="snippets/cs/exception2.cs" id="exception":::

[!code-vb[TPL_Continuations#11](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/exception2.vb#11)]

<span data-ttu-id="54c87-233">Weitere Informationen finden Sie unter [Ausnahmebehandlung (Task Parallel Library)](exception-handling-task-parallel-library.md).</span><span class="sxs-lookup"><span data-stu-id="54c87-233">For more information, see [Exception Handling](exception-handling-task-parallel-library.md).</span></span>

- <span data-ttu-id="54c87-234">Wenn die Fortsetzung eine angefügte untergeordnete Aufgabe ist, die mit der <xref:System.Threading.Tasks.TaskContinuationOptions.AttachedToParent?displayProperty=nameWithType> -Option erstellt wurde, werden die zugehörigen Ausnahmen vom übergeordneten Element an den aufrufenden Thread zurückgegeben, wie dies auch bei allen anderen angefügten untergeordneten Elementen der Fall ist.</span><span class="sxs-lookup"><span data-stu-id="54c87-234">If the continuation is an attached child task that was created by using the <xref:System.Threading.Tasks.TaskContinuationOptions.AttachedToParent?displayProperty=nameWithType> option, its exceptions will be propagated by the parent back to the calling thread, as is the case in any other attached child.</span></span> <span data-ttu-id="54c87-235">Weitere Informationen finden Sie unter [Angefügte und getrennte untergeordnete Aufgaben](attached-and-detached-child-tasks.md).</span><span class="sxs-lookup"><span data-stu-id="54c87-235">For more information, see [Attached and Detached Child Tasks](attached-and-detached-child-tasks.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="54c87-236">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="54c87-236">See also</span></span>

- [<span data-ttu-id="54c87-237">Task Parallel Library (TPL)</span><span class="sxs-lookup"><span data-stu-id="54c87-237">Task Parallel Library (TPL)</span></span>](task-parallel-library-tpl.md)
