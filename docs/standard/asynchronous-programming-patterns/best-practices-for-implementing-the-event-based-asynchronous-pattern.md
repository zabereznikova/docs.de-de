---
title: Bewährte Verfahrensweisen für das Implementieren des ereignisbasierten asynchronen Entwurfsmusters
ms.date: 03/30/2017
ms.technology: dotnet-standard
helpviewer_keywords:
- Event-based Asynchronous Pattern
- ProgressChangedEventArgs class
- BackgroundWorker component
- events [.NET Framework], asynchronous
- AsyncOperationManager class
- threading [.NET Framework], asynchronous features
- AsyncOperation class
- AsyncCompletedEventArgs class
ms.assetid: 4acd2094-4f46-4eff-9190-92d0d9ff47db
ms.openlocfilehash: 66979415f2951acc78dc4eb7b2aafe3c84e85397
ms.sourcegitcommit: 33deec3e814238fb18a49b2a7e89278e27888291
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 06/02/2020
ms.locfileid: "84289940"
---
# <a name="best-practices-for-implementing-the-event-based-asynchronous-pattern"></a><span data-ttu-id="3fadd-102">Bewährte Verfahrensweisen für das Implementieren des ereignisbasierten asynchronen Entwurfsmusters</span><span class="sxs-lookup"><span data-stu-id="3fadd-102">Best Practices for Implementing the Event-based Asynchronous Pattern</span></span>
<span data-ttu-id="3fadd-103">Das ereignisbasierte asynchrone Muster bietet Ihnen eine effektive Methode, um asynchrones Verhalten in Klassen mit einer vertrauten Ereignis- und Delegatsemantik verfügbar zu machen.</span><span class="sxs-lookup"><span data-stu-id="3fadd-103">The Event-based Asynchronous Pattern provides you with an effective way to expose asynchronous behavior in classes, with familiar event and delegate semantics.</span></span> <span data-ttu-id="3fadd-104">Für eine Implementierung des ereignisbasierten asynchronen Musters müssen Sie einige spezielle Verhaltensanforderungen befolgen.</span><span class="sxs-lookup"><span data-stu-id="3fadd-104">To implement Event-based Asynchronous Pattern, you need to follow some specific behavioral requirements.</span></span> <span data-ttu-id="3fadd-105">In den folgenden Abschnitten sind Anforderungen und Richtlinien beschrieben, die Sie bei der Implementierung einer Klasse berücksichtigen sollten, die dem ereignisbasierten asynchronen Muster folgt.</span><span class="sxs-lookup"><span data-stu-id="3fadd-105">The following sections describe requirements and guidelines you should consider when you implement a class that follows the Event-based Asynchronous Pattern.</span></span>  
  
 <span data-ttu-id="3fadd-106">Eine Übersicht finden Sie unter [Implementieren des ereignisbasierten asynchronen Entwurfsmusters](implementing-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="3fadd-106">For an overview, see [Implementing the Event-based Asynchronous Pattern](implementing-the-event-based-asynchronous-pattern.md).</span></span>  
  
## <a name="required-behavioral-guarantees"></a><span data-ttu-id="3fadd-107">Erforderliche Verhaltensgarantien</span><span class="sxs-lookup"><span data-stu-id="3fadd-107">Required Behavioral Guarantees</span></span>  
 <span data-ttu-id="3fadd-108">Wenn Sie das ereignisbasierte asynchrone Muster implementieren, müssen Sie eine Reihe von Garantien bereitstellen, um sicherzustellen, dass sich Ihre Klasse ordnungsgemäß verhält und die Clients Ihrer Klasse sich auf dieses Verhalten verlassen können.</span><span class="sxs-lookup"><span data-stu-id="3fadd-108">If you implement the Event-based Asynchronous Pattern, you must provide a number of guarantees to ensure that your class will behave properly and clients of your class can rely on such behavior.</span></span>  
  
### <a name="completion"></a><span data-ttu-id="3fadd-109">Abschluss</span><span class="sxs-lookup"><span data-stu-id="3fadd-109">Completion</span></span>  
 <span data-ttu-id="3fadd-110">Rufen Sie immer den Ereignishandler <em>MethodName</em>**Completed** auf, wenn ein erfolgreicher Abschluss, ein Fehler oder ein Abbruch vorliegt.</span><span class="sxs-lookup"><span data-stu-id="3fadd-110">Always invoke the <em>MethodName</em>**Completed** event handler when you have successful completion, an error, or a cancellation.</span></span> <span data-ttu-id="3fadd-111">Anwendungen sollten niemals auf eine Situation treffen, in der sie im Leerlauf bleiben und ein Abschluss niemals erfolgt.</span><span class="sxs-lookup"><span data-stu-id="3fadd-111">Applications should never encounter a situation where they remain idle and completion never occurs.</span></span> <span data-ttu-id="3fadd-112">Eine Ausnahme dieser Regel ist, wenn der asynchrone Vorgang an sich so entwickelt wurde, dass er nie abgeschlossen wird.</span><span class="sxs-lookup"><span data-stu-id="3fadd-112">One exception to this rule is if the asynchronous operation itself is designed so that it never completes.</span></span>  
  
### <a name="completed-event-and-eventargs"></a><span data-ttu-id="3fadd-113">Abgeschlossenes Event und EventArgs</span><span class="sxs-lookup"><span data-stu-id="3fadd-113">Completed Event and EventArgs</span></span>  
 <span data-ttu-id="3fadd-114">Wenden Sie für jede separate <em>MethodName</em>**Async**-Methode die folgenden Entwurfsanforderungen an:</span><span class="sxs-lookup"><span data-stu-id="3fadd-114">For each separate <em>MethodName</em>**Async** method, apply the following design requirements:</span></span>  
  
- <span data-ttu-id="3fadd-115">Definieren Sie ein <em>MethodName</em>**Completed**-Ereignis in derselben Klasse wie die Methode.</span><span class="sxs-lookup"><span data-stu-id="3fadd-115">Define a <em>MethodName</em>**Completed** event on the same class as the method.</span></span>  
  
- <span data-ttu-id="3fadd-116">Definieren Sie eine <xref:System.EventArgs>-Klasse und einen begleitenden Delegaten für das <em>MethodName</em>**Completed**-Ereignis, das von der <xref:System.ComponentModel.AsyncCompletedEventArgs>-Klasse abgeleitet ist.</span><span class="sxs-lookup"><span data-stu-id="3fadd-116">Define an <xref:System.EventArgs> class and accompanying delegate for the <em>MethodName</em>**Completed** event that derives from the <xref:System.ComponentModel.AsyncCompletedEventArgs> class.</span></span> <span data-ttu-id="3fadd-117">Der Standardklassenname sollte die Form <em>MethodName</em>**CompletedEventArgs** aufweisen.</span><span class="sxs-lookup"><span data-stu-id="3fadd-117">The default class name should be of the form <em>MethodName</em>**CompletedEventArgs**.</span></span>  
  
- <span data-ttu-id="3fadd-118">Stellen Sie sicher, dass die Klasse <xref:System.EventArgs> für die Rückgabewerte der Methode <em>MethodName</em> spezifisch ist.</span><span class="sxs-lookup"><span data-stu-id="3fadd-118">Ensure that the <xref:System.EventArgs> class is specific to the return values of the <em>MethodName</em> method.</span></span> <span data-ttu-id="3fadd-119">Wenn Sie die Klasse <xref:System.EventArgs> verwenden, sollten Sie von Entwicklern niemals verlangen, das Ergebnis umzuwandeln.</span><span class="sxs-lookup"><span data-stu-id="3fadd-119">When you use the <xref:System.EventArgs> class, you should never require developers to cast the result.</span></span>  
  
     <span data-ttu-id="3fadd-120">Das folgende Codebeispiel zeigt jeweils eine gute und eine schlechte Implementierung dieser Entwurfsanforderung.</span><span class="sxs-lookup"><span data-stu-id="3fadd-120">The following code example shows good and bad implementation of this design requirement respectively.</span></span>  
  
```csharp  
// Good design  
private void Form1_MethodNameCompleted(object sender, xxxCompletedEventArgs e)
{
    DemoType result = e.Result;  
}  
  
// Bad design  
private void Form1_MethodNameCompleted(object sender, MethodNameCompletedEventArgs e)
{
    DemoType result = (DemoType)(e.Result);  
}  
```  
  
- <span data-ttu-id="3fadd-121">Definieren Sie keine <xref:System.EventArgs>-Klasse zum Zurückgeben von Methoden, die `void` zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="3fadd-121">Do not define an <xref:System.EventArgs> class for returning methods that return `void`.</span></span> <span data-ttu-id="3fadd-122">Verwenden Sie stattdessen eine Instanz der <xref:System.ComponentModel.AsyncCompletedEventArgs>-Klasse.</span><span class="sxs-lookup"><span data-stu-id="3fadd-122">Instead, use an instance of the <xref:System.ComponentModel.AsyncCompletedEventArgs> class.</span></span>  
  
- <span data-ttu-id="3fadd-123">Stellen Sie sicher, dass Sie immer das <em>MethodName</em>**Completed**-Ereignis auslösen.</span><span class="sxs-lookup"><span data-stu-id="3fadd-123">Ensure that you always raise the <em>MethodName</em>**Completed** event.</span></span> <span data-ttu-id="3fadd-124">Dieses Ereignis sollte bei einem erfolgreichen Abschluss, einem Fehler oder einem Abbruch ausgelöst werden.</span><span class="sxs-lookup"><span data-stu-id="3fadd-124">This event should be raised on successful completion, on an error, or on cancellation.</span></span> <span data-ttu-id="3fadd-125">Anwendungen sollten niemals auf eine Situation treffen, in der sie im Leerlauf bleiben und ein Abschluss niemals erfolgt.</span><span class="sxs-lookup"><span data-stu-id="3fadd-125">Applications should never encounter a situation where they remain idle and completion never occurs.</span></span>  
  
- <span data-ttu-id="3fadd-126">Stellen Sie sicher, dass Sie alle Ausnahmen abfangen, die im asynchronen Vorgang auftreten und die abgefangene Ausnahme der Eigenschaft <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> zuweisen.</span><span class="sxs-lookup"><span data-stu-id="3fadd-126">Ensure that you catch any exceptions that occur in the asynchronous operation and assign the caught exception to the <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> property.</span></span>  
  
- <span data-ttu-id="3fadd-127">Wenn beim Abschließen der Aufgabe ein Fehler aufgetreten ist, sollte auf die Ergebnisse nicht zugegriffen werden können.</span><span class="sxs-lookup"><span data-stu-id="3fadd-127">If there was an error completing the task, the results should not be accessible.</span></span> <span data-ttu-id="3fadd-128">Wenn die Eigenschaft <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> nicht `null` entspricht, stellen Sie sicher, dass der Zugriff auf eine beliebige Eigenschaft in der <xref:System.EventArgs>-Struktur eine Ausnahme auslöst.</span><span class="sxs-lookup"><span data-stu-id="3fadd-128">When the <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> property is not `null`, ensure that accessing any property in the <xref:System.EventArgs> structure raises an exception.</span></span> <span data-ttu-id="3fadd-129">Verwenden Sie die Methode <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A>, um diese Überprüfung durchzuführen.</span><span class="sxs-lookup"><span data-stu-id="3fadd-129">Use the <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A> method to perform this verification.</span></span>  
  
- <span data-ttu-id="3fadd-130">Modellieren Sie einen Timeout als Fehler.</span><span class="sxs-lookup"><span data-stu-id="3fadd-130">Model a time out as an error.</span></span> <span data-ttu-id="3fadd-131">Wenn es zu einem Timeout kommt, lösen Sie das <em>MethodName</em>**Completed**-Ereignis aus und weisen der Eigenschaft <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> eine <xref:System.TimeoutException> zu.</span><span class="sxs-lookup"><span data-stu-id="3fadd-131">When a time out occurs, raise the <em>MethodName</em>**Completed** event and assign a <xref:System.TimeoutException> to the <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> property.</span></span>  
  
- <span data-ttu-id="3fadd-132">Wenn Ihre Klasse mehrere gleichzeitige Aufrufe unterstützt, stellen Sie sicher, dass das <em>MethodName</em>**Completed**-Ereignis das geeignete `userSuppliedState`-Objekt enthält.</span><span class="sxs-lookup"><span data-stu-id="3fadd-132">If your class supports multiple concurrent invocations, ensure that the <em>MethodName</em>**Completed** event contains the appropriate `userSuppliedState` object.</span></span>  
  
- <span data-ttu-id="3fadd-133">Stellen Sie sicher, dass das <em>MethodName</em>**Completed**-Ereignis im geeigneten Thread und zum geeigneten Zeitpunkt im Anwendungslebenszyklus ausgelöst wird.</span><span class="sxs-lookup"><span data-stu-id="3fadd-133">Ensure that the <em>MethodName</em>**Completed** event is raised on the appropriate thread and at the appropriate time in the application lifecycle.</span></span> <span data-ttu-id="3fadd-134">Weitere Informationen finden Sie im Abschnitt „Threading und Kontexte“.</span><span class="sxs-lookup"><span data-stu-id="3fadd-134">For more information, see the Threading and Contexts section.</span></span>  
  
### <a name="simultaneously-executing-operations"></a><span data-ttu-id="3fadd-135">Gleichzeitige Ausführung von Vorgängen</span><span class="sxs-lookup"><span data-stu-id="3fadd-135">Simultaneously Executing Operations</span></span>  
  
- <span data-ttu-id="3fadd-136">Wenn Ihre Klasse mehrere gleichzeitige Aufrufe unterstützt, ermöglichen Sie dem Entwickler, jeden Aufruf separat nachzuverfolgen. Hierzu definieren Sie die <em>MethodName</em>**Async**-Überladung, die einen State-Parameter mit Objektwert oder eine Task-ID namens `userSuppliedState` akzeptiert.</span><span class="sxs-lookup"><span data-stu-id="3fadd-136">If your class supports multiple concurrent invocations, enable the developer to track each invocation separately by defining the <em>MethodName</em>**Async** overload that takes an object-valued state parameter, or task ID, called `userSuppliedState`.</span></span> <span data-ttu-id="3fadd-137">Dieser Parameter sollte immer der letzte Parameter in der Signatur der <em>MethodName</em>**Async**-Methode sein.</span><span class="sxs-lookup"><span data-stu-id="3fadd-137">This parameter should always be the last parameter in the <em>MethodName</em>**Async** method's signature.</span></span>  
  
- <span data-ttu-id="3fadd-138">Wenn Ihre Klasse die <em>MethodName</em>**Async**-Überladung definiert, die einen State-Parameter mit Objektwert oder eine Task-ID akzeptiert, stellen Sie sicher, dass Sie die Lebensdauer des Vorgangs mit dieser Task-ID nachverfolgen und eine Rückgabe an den Abschlusshandler erfolgt.</span><span class="sxs-lookup"><span data-stu-id="3fadd-138">If your class defines the <em>MethodName</em>**Async** overload that takes an object-valued state parameter, or task ID, be sure to track the lifetime of the operation with that task ID, and be sure to provide it back into the completion handler.</span></span> <span data-ttu-id="3fadd-139">Es sind Hilfsklassen zur Unterstützung verfügbar.</span><span class="sxs-lookup"><span data-stu-id="3fadd-139">There are helper classes available to assist.</span></span> <span data-ttu-id="3fadd-140">Weitere Informationen zur Parallelitätsverwaltung finden Sie unter [Gewusst wie: Implementieren einer Komponente, die das ereignisbasierte asynchrone Muster unterstützt](component-that-supports-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="3fadd-140">For more information on concurrency management, see [How to: Implement a Component That Supports the Event-based Asynchronous Pattern](component-that-supports-the-event-based-asynchronous-pattern.md).</span></span>  
  
- <span data-ttu-id="3fadd-141">Wenn Ihre Klasse die <em>MethodName</em>**Async**-Methode ohne den State-Parameter definiert und nicht mehrere gleichzeitige Aufrufe unterstützt, stellen Sie sicher, dass jeder Versuch, <em>MethodName</em>**Async** aufzurufen, bevor der vorherige <em>MethodName</em>**Async**-Aufruf abgeschlossen wurde, eine <xref:System.InvalidOperationException> auslöst.</span><span class="sxs-lookup"><span data-stu-id="3fadd-141">If your class defines the <em>MethodName</em>**Async** method without the state parameter, and it does not support multiple concurrent invocations, ensure that any attempt to invoke <em>MethodName</em>**Async** before the prior <em>MethodName</em>**Async** invocation has completed raises an <xref:System.InvalidOperationException>.</span></span>  
  
- <span data-ttu-id="3fadd-142">Im Allgemeinen sollte keine Ausnahme ausgelöst werden, wenn die <em>MethodName</em>**Async**-Methode ohne den `userSuppliedState`-Parameter mehrmals aufgerufen wird, sodass mehrere ausstehende Vorgänge vorhanden sind.</span><span class="sxs-lookup"><span data-stu-id="3fadd-142">In general, do not raise an exception if the <em>MethodName</em>**Async** method without the `userSuppliedState` parameter is invoked multiple times so that there are multiple outstanding operations.</span></span> <span data-ttu-id="3fadd-143">Sie können eine Ausnahme auslösen, wenn Ihre Klasse diese Situation explizit nicht verarbeiten kann, aber gehen Sie davon aus, dass Entwickler diese mehrfachen, nicht unterscheidbare Rückrufe handhaben können.</span><span class="sxs-lookup"><span data-stu-id="3fadd-143">You can raise an exception when your class explicitly cannot handle that situation, but assume that developers can handle these multiple indistinguishable callbacks</span></span>  
  
### <a name="accessing-results"></a><span data-ttu-id="3fadd-144">Zugreifen auf Ergebnisse</span><span class="sxs-lookup"><span data-stu-id="3fadd-144">Accessing Results</span></span>  
  
- <span data-ttu-id="3fadd-145">Wenn während der Ausführung des asynchronen Vorgangs ein Fehler aufgetreten ist, sollte ein Zugriff auf die Ergebnisse nicht möglich sein.</span><span class="sxs-lookup"><span data-stu-id="3fadd-145">If there was an error during execution of the asynchronous operation, the results should not be accessible.</span></span> <span data-ttu-id="3fadd-146">Stellen Sie sicher, dass beim Zugreifen auf eine beliebige Eigenschaft in <xref:System.ComponentModel.AsyncCompletedEventArgs>, wenn <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> nicht `null` ist, die von <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> referenziert Ausnahme ausgelöst wird.</span><span class="sxs-lookup"><span data-stu-id="3fadd-146">Ensure that accessing any property in the <xref:System.ComponentModel.AsyncCompletedEventArgs> when <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> is not `null` raises the exception referenced by <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A>.</span></span> <span data-ttu-id="3fadd-147">Die <xref:System.ComponentModel.AsyncCompletedEventArgs>-Klasse stellt für diesen Zweck die <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A>-Methode bereit.</span><span class="sxs-lookup"><span data-stu-id="3fadd-147">The <xref:System.ComponentModel.AsyncCompletedEventArgs> class provides the <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A> method for this purpose.</span></span>  
  
- <span data-ttu-id="3fadd-148">Stellen Sie sicher, dass bei allen Versuchen, auf das Ergebnis zuzugreifen, eine <xref:System.InvalidOperationException> ausgelöst wird, die angibt, dass der Vorgang abgebrochen wurde.</span><span class="sxs-lookup"><span data-stu-id="3fadd-148">Ensure that any attempt to access the result raises an <xref:System.InvalidOperationException> stating that the operation was canceled.</span></span> <span data-ttu-id="3fadd-149">Verwenden Sie die Methode <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A?displayProperty=nameWithType>, um diese Überprüfung durchzuführen.</span><span class="sxs-lookup"><span data-stu-id="3fadd-149">Use the <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A?displayProperty=nameWithType> method to perform this verification.</span></span>  
  
### <a name="progress-reporting"></a><span data-ttu-id="3fadd-150">Statusberichterstellung</span><span class="sxs-lookup"><span data-stu-id="3fadd-150">Progress Reporting</span></span>  
  
- <span data-ttu-id="3fadd-151">Unterstützen Sie die Statusberichterstellung, wenn möglich.</span><span class="sxs-lookup"><span data-stu-id="3fadd-151">Support progress reporting, if possible.</span></span> <span data-ttu-id="3fadd-152">Damit können Entwickler eine bessere Benutzerfreundlichkeit für die Anwendung bereitstellen, wenn sie Ihre Klasse verwenden.</span><span class="sxs-lookup"><span data-stu-id="3fadd-152">This enables developers to provide a better application user experience when they use your class.</span></span>  
  
- <span data-ttu-id="3fadd-153">Wenn Sie ein **ProgressChanged**- oder <em>MethodName</em>**ProgressChanged**-Ereignis implementieren, stellen Sie sicher, dass solche Ereignisse nicht für einen bestimmten asynchronen Vorgang ausgelöst werden, nachdem das <em>MethodName</em>**Completed**-Ereignis dieses Vorgangs ausgelöst wurde.</span><span class="sxs-lookup"><span data-stu-id="3fadd-153">If you implement a **ProgressChanged** or <em>MethodName</em>**ProgressChanged** event, ensure that there are no such events raised for a particular asynchronous operation after that operation's <em>MethodName</em>**Completed** event has been raised.</span></span>  
  
- <span data-ttu-id="3fadd-154">Wenn der Standardwert für <xref:System.ComponentModel.ProgressChangedEventArgs> ausgefüllt wird, stellen Sie sicher, dass <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> immer als ein Prozentsatz interpretiert werden kann.</span><span class="sxs-lookup"><span data-stu-id="3fadd-154">If the standard <xref:System.ComponentModel.ProgressChangedEventArgs> is being populated, ensure that the <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> can always be interpreted as a percentage.</span></span> <span data-ttu-id="3fadd-155">Der Prozentsatz muss nicht präzise sein, sollte aber einen Prozentsatz darstellen.</span><span class="sxs-lookup"><span data-stu-id="3fadd-155">The percentage does not need to be accurate, but it should represent a percentage.</span></span> <span data-ttu-id="3fadd-156">Wenn die Metrik für Ihre Statusberichterstellung etwas anderes als ein Prozentsatz sein muss, leiten Sie eine Klasse von der <xref:System.ComponentModel.ProgressChangedEventArgs>-Klasse ab, und behalten Sie 0 für <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> bei.</span><span class="sxs-lookup"><span data-stu-id="3fadd-156">If your progress reporting metric must be something other than a percentage, derive a class from the <xref:System.ComponentModel.ProgressChangedEventArgs> class and leave <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> at 0.</span></span> <span data-ttu-id="3fadd-157">Vermeiden Sie die Verwendung einer anderen Berichtsmetrik als einen Prozentsatz.</span><span class="sxs-lookup"><span data-stu-id="3fadd-157">Avoid using a reporting metric other than a percentage.</span></span>  
  
- <span data-ttu-id="3fadd-158">Stellen Sie sicher, dass das `ProgressChanged`-Ereignis im geeigneten Thread und zum geeigneten Zeitpunkt im Anwendungslebenszyklus ausgelöst wird.</span><span class="sxs-lookup"><span data-stu-id="3fadd-158">Ensure that the `ProgressChanged` event is raised on the appropriate thread and at the appropriate time in the application lifecycle.</span></span> <span data-ttu-id="3fadd-159">Weitere Informationen finden Sie im Abschnitt „Threading und Kontexte“.</span><span class="sxs-lookup"><span data-stu-id="3fadd-159">For more information, see the Threading and Contexts section.</span></span>  
  
### <a name="isbusy-implementation"></a><span data-ttu-id="3fadd-160">IsBusy-Implementierung</span><span class="sxs-lookup"><span data-stu-id="3fadd-160">IsBusy Implementation</span></span>  
  
- <span data-ttu-id="3fadd-161">Machen Sie keine `IsBusy`-Eigenschaft verfügbar, wenn Ihre Klasse mehrere parallele Aufrufe unterstützt.</span><span class="sxs-lookup"><span data-stu-id="3fadd-161">Do not expose an `IsBusy` property if your class supports multiple concurrent invocations.</span></span> <span data-ttu-id="3fadd-162">XML-Webdienstproxies machen beispielsweise keine `IsBusy`-Eigenschaft verfügbar, weil sie mehrere parallele Aufrufe von asynchronen Methoden unterstützen.</span><span class="sxs-lookup"><span data-stu-id="3fadd-162">For example, XML Web service proxies do not expose an `IsBusy` property because they support multiple concurrent invocations of asynchronous methods.</span></span>  
  
- <span data-ttu-id="3fadd-163">Die `IsBusy`-Eigenschaft sollte `true` zurückgeben, nachdem die <em>MethodName</em>**Async**-Methode aufgerufen wurde und bevor das <em>MethodName</em>**Completed**-Ereignis ausgelöst wird.</span><span class="sxs-lookup"><span data-stu-id="3fadd-163">The `IsBusy` property should return `true` after the <em>MethodName</em>**Async** method has been called and before the <em>MethodName</em>**Completed** event has been raised.</span></span> <span data-ttu-id="3fadd-164">Andernfalls sollte `false` zurückgegeben werden.</span><span class="sxs-lookup"><span data-stu-id="3fadd-164">Otherwise it should return `false`.</span></span> <span data-ttu-id="3fadd-165">Die Komponenten <xref:System.ComponentModel.BackgroundWorker> und <xref:System.Net.WebClient> sind Beispiele für Klassen, die eine `IsBusy`-Eigenschaft verfügbar machen.</span><span class="sxs-lookup"><span data-stu-id="3fadd-165">The <xref:System.ComponentModel.BackgroundWorker> and <xref:System.Net.WebClient> components are examples of classes that expose an `IsBusy` property.</span></span>  
  
### <a name="cancellation"></a><span data-ttu-id="3fadd-166">Abbruch</span><span class="sxs-lookup"><span data-stu-id="3fadd-166">Cancellation</span></span>  
  
- <span data-ttu-id="3fadd-167">Unterstützen Sie einen Abbruch, wenn möglich.</span><span class="sxs-lookup"><span data-stu-id="3fadd-167">Support cancellation, if possible.</span></span> <span data-ttu-id="3fadd-168">Damit können Entwickler eine bessere Benutzerfreundlichkeit für die Anwendung bereitstellen, wenn sie Ihre Klasse verwenden.</span><span class="sxs-lookup"><span data-stu-id="3fadd-168">This enables developers to provide a better application user experience when they use your class.</span></span>  
  
- <span data-ttu-id="3fadd-169">Im Fall eines Abbruchs legen Sie das <xref:System.ComponentModel.AsyncCompletedEventArgs.Cancelled%2A>-Flag im <xref:System.ComponentModel.AsyncCompletedEventArgs>-Objekt fest.</span><span class="sxs-lookup"><span data-stu-id="3fadd-169">In the case of cancellation, set the <xref:System.ComponentModel.AsyncCompletedEventArgs.Cancelled%2A> flag in the <xref:System.ComponentModel.AsyncCompletedEventArgs> object.</span></span>  
  
- <span data-ttu-id="3fadd-170">Stellen Sie sicher, dass bei allen Versuchen, auf das Ergebnis zuzugreifen, eine <xref:System.InvalidOperationException> ausgelöst wird, die angibt, dass der Vorgang abgebrochen wurde.</span><span class="sxs-lookup"><span data-stu-id="3fadd-170">Ensure that any attempt to access the result raises an <xref:System.InvalidOperationException> stating that the operation was canceled.</span></span> <span data-ttu-id="3fadd-171">Verwenden Sie die Methode <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A?displayProperty=nameWithType>, um diese Überprüfung durchzuführen.</span><span class="sxs-lookup"><span data-stu-id="3fadd-171">Use the <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A?displayProperty=nameWithType> method to perform this verification.</span></span>  
  
- <span data-ttu-id="3fadd-172">Stellen Sie sicher, dass die Aufrufe an eine Abbruchmethode immer erfolgreich zurückgegeben werden und niemals eine Ausnahme auslösen.</span><span class="sxs-lookup"><span data-stu-id="3fadd-172">Ensure that calls to a cancellation method always return successfully, and never raise an exception.</span></span> <span data-ttu-id="3fadd-173">Im Allgemeinen wird ein Client nicht benachrichtigt, ob ein Vorgang zu einem gegebenen Zeitpunkt wirklich abbrechbar ist und ob ein zuvor ausgegebener Abbruch erfolgreich war.</span><span class="sxs-lookup"><span data-stu-id="3fadd-173">In general, a client is not notified as to whether an operation is truly cancelable at any given time, and is not notified as to whether a previously issued cancellation has succeeded.</span></span> <span data-ttu-id="3fadd-174">Die Anwendung wird jedoch immer benachrichtigt, wenn ein Abbruch erfolgreich war, da die Anwendung am Abschlussstatus teilnimmt.</span><span class="sxs-lookup"><span data-stu-id="3fadd-174">However, the application will always be given notification when a cancellation succeeded, because the application takes part in the completion status.</span></span>  
  
- <span data-ttu-id="3fadd-175">Lösen Sie das <em>MethodName</em>**Completed**-Ereignis aus, wenn der Vorgang abgebrochen wird.</span><span class="sxs-lookup"><span data-stu-id="3fadd-175">Raise the <em>MethodName</em>**Completed** event when the operation is canceled.</span></span>  
  
### <a name="errors-and-exceptions"></a><span data-ttu-id="3fadd-176">Fehler und Ausnahmen</span><span class="sxs-lookup"><span data-stu-id="3fadd-176">Errors and Exceptions</span></span>  
  
- <span data-ttu-id="3fadd-177">Fangen Sie alle Ausnahmen ab, die im asynchronen Vorgang auftreten, und legen Sie den Wert der <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A?displayProperty=nameWithType>-Eigenschaft auf diese Ausnahme fest.</span><span class="sxs-lookup"><span data-stu-id="3fadd-177">Catch any exceptions that occur in the asynchronous operation and set the value of the <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A?displayProperty=nameWithType> property to that exception.</span></span>  
  
### <a name="threading-and-contexts"></a><span data-ttu-id="3fadd-178">Threading und Kontexte</span><span class="sxs-lookup"><span data-stu-id="3fadd-178">Threading and Contexts</span></span>  
 <span data-ttu-id="3fadd-179">Für die korrekte Funktionsweise Ihrer Klasse ist es wichtig, dass die Ereignishandler des Clients im richtigen Thread oder Kontext des entsprechenden Anwendungsmodells aufgerufen werden, einschließlich ASP.NET- und Windows Forms-Anwendungen.</span><span class="sxs-lookup"><span data-stu-id="3fadd-179">For correct operation of your class, it is critical that the client's event handlers are invoked on the proper thread or context for the given application model, including ASP.NET and Windows Forms applications.</span></span> <span data-ttu-id="3fadd-180">Es werden zwei wichtige Hilfsklassen bereitgestellt, um sicherzustellen, dass sich Ihre asynchrone Klasse unter jedem Anwendungsmodell korrekt verhält: <xref:System.ComponentModel.AsyncOperation> und <xref:System.ComponentModel.AsyncOperationManager>.</span><span class="sxs-lookup"><span data-stu-id="3fadd-180">Two important helper classes are provided to ensure that your asynchronous class behaves correctly under any application model: <xref:System.ComponentModel.AsyncOperation> and <xref:System.ComponentModel.AsyncOperationManager>.</span></span>  
  
 <span data-ttu-id="3fadd-181"><xref:System.ComponentModel.AsyncOperationManager> stellt eine Methode bereit, <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A>, die <xref:System.ComponentModel.AsyncOperation> zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="3fadd-181"><xref:System.ComponentModel.AsyncOperationManager> provides one method, <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A>, which returns an <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="3fadd-182">Ihre <em>MethodName</em>**Async**-Methode ruft <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A> auf, und Ihre Klasse verwendet den zurückgegebenen <xref:System.ComponentModel.AsyncOperation>, um die Lebensdauer des asynchronen Tasks nachzuverfolgen.</span><span class="sxs-lookup"><span data-stu-id="3fadd-182">Your <em>MethodName</em>**Async** method calls <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A> and your class uses the returned <xref:System.ComponentModel.AsyncOperation> to track the lifetime of the asynchronous task.</span></span>  
  
 <span data-ttu-id="3fadd-183">Für einen Statusbericht, inkrementelle Ergebnisse und Abschluss auf dem Client rufen Sie die Methoden <xref:System.ComponentModel.AsyncOperation.Post%2A> und <xref:System.ComponentModel.AsyncOperation.OperationCompleted%2A> in <xref:System.ComponentModel.AsyncOperation> auf.</span><span class="sxs-lookup"><span data-stu-id="3fadd-183">To report progress, incremental results, and completion to the client, call the <xref:System.ComponentModel.AsyncOperation.Post%2A> and <xref:System.ComponentModel.AsyncOperation.OperationCompleted%2A> methods on the <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="3fadd-184"><xref:System.ComponentModel.AsyncOperation> ist für das Marshalling von Aufrufen an die Ereignishandler des Clients an den richtigen Thread oder Kontext verantwortlich.</span><span class="sxs-lookup"><span data-stu-id="3fadd-184"><xref:System.ComponentModel.AsyncOperation> is responsible for marshaling calls to the client's event handlers to the proper thread or context.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="3fadd-185">Sie können diese Regeln umgehen, wenn Sie explizit gegen die Richtlinie des Anwendungsmodell vorgehen möchten, aber dennoch von den anderen Vorteilen der Verwendung des ereignisbasierten asynchronen Musters profitieren.</span><span class="sxs-lookup"><span data-stu-id="3fadd-185">You can circumvent these rules if you explicitly want to go against the policy of the application model, but still benefit from the other advantages of using the Event-based Asynchronous Pattern.</span></span> <span data-ttu-id="3fadd-186">Möglicherweise möchten Sie zum Beispiel, dass eine in Windows Forms betriebene Klasse eine Freethread-Klasse ist.</span><span class="sxs-lookup"><span data-stu-id="3fadd-186">For example, you may want a class operating in Windows Forms to be free threaded.</span></span> <span data-ttu-id="3fadd-187">Sie können eine Freethread-Klasse erstellen, solange Entwickler die implizierten Einschränkungen verstehen.</span><span class="sxs-lookup"><span data-stu-id="3fadd-187">You can create a free threaded class, as long as developers understand the implied restrictions.</span></span> <span data-ttu-id="3fadd-188">Konsolenanwendungen führen keine Synchronisierung von <xref:System.ComponentModel.AsyncOperation.Post%2A>-Aufrufen durch.</span><span class="sxs-lookup"><span data-stu-id="3fadd-188">Console applications do not synchronize the execution of <xref:System.ComponentModel.AsyncOperation.Post%2A> calls.</span></span> <span data-ttu-id="3fadd-189">Das kann dazu führen, dass `ProgressChanged`-Ereignisse nicht in der richtigen Reihenfolge ausgelöst werden.</span><span class="sxs-lookup"><span data-stu-id="3fadd-189">This can cause `ProgressChanged` events to be raised out of order.</span></span> <span data-ttu-id="3fadd-190">Wenn Sie eine serialisierte Ausführung von <xref:System.ComponentModel.AsyncOperation.Post%2A>-Aufrufen wünschen, implementieren und installieren Sie eine <xref:System.Threading.SynchronizationContext?displayProperty=nameWithType>-Klasse.</span><span class="sxs-lookup"><span data-stu-id="3fadd-190">If you wish to have serialized execution of <xref:System.ComponentModel.AsyncOperation.Post%2A> calls, implement and install a <xref:System.Threading.SynchronizationContext?displayProperty=nameWithType> class.</span></span>  
  
 <span data-ttu-id="3fadd-191">Weitere Informationen zur Verwendung von <xref:System.ComponentModel.AsyncOperation> und <xref:System.ComponentModel.AsyncOperationManager> für Ihre asynchronen Vorgänge finden Sie unter [Gewusst wie: Implementieren einer Komponente, die das ereignisbasierte asynchrone Muster unterstützt](component-that-supports-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="3fadd-191">For more information about using <xref:System.ComponentModel.AsyncOperation> and <xref:System.ComponentModel.AsyncOperationManager> to enable your asynchronous operations, see [How to: Implement a Component That Supports the Event-based Asynchronous Pattern](component-that-supports-the-event-based-asynchronous-pattern.md).</span></span>  
  
## <a name="guidelines"></a><span data-ttu-id="3fadd-192">Richtlinien</span><span class="sxs-lookup"><span data-stu-id="3fadd-192">Guidelines</span></span>  
  
- <span data-ttu-id="3fadd-193">Idealerweise sollte jeder Methodenaufruf unabhängig von anderen erfolgen.</span><span class="sxs-lookup"><span data-stu-id="3fadd-193">Ideally, each method invocation should be independent of others.</span></span> <span data-ttu-id="3fadd-194">Sie sollten vermeiden, Aufrufe mit freigegebenen Ressourcen zu koppeln.</span><span class="sxs-lookup"><span data-stu-id="3fadd-194">You should avoid coupling invocations with shared resources.</span></span> <span data-ttu-id="3fadd-195">Wenn Ressourcen unter Aufrufen freigegeben werden sollen, müssen einen richtigen Synchronisierungsmechanismus in Ihrer Implementierung bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="3fadd-195">If resources are to be shared among invocations, you will need to provide a proper synchronization mechanism in your implementation.</span></span>  
  
- <span data-ttu-id="3fadd-196">Entwürfe, bei denen der Client eine Synchronisierung implementieren muss, sind nicht empfehlenswert.</span><span class="sxs-lookup"><span data-stu-id="3fadd-196">Designs that require the client to implement synchronization are discouraged.</span></span> <span data-ttu-id="3fadd-197">Wenn Sie beispielsweise eine asynchrone Methode haben, die ein globales statisches Objekt als Parameter erhält, könnten mehrere parallele Aufrufe einer solchen Methode zur Datenbeschädigungen oder Deadlocks führen.</span><span class="sxs-lookup"><span data-stu-id="3fadd-197">For example, you could have an asynchronous method that receives a global static object as a parameter; multiple concurrent invocations of such a method could result in data corruption or deadlocks.</span></span>  
  
- <span data-ttu-id="3fadd-198">Wenn Sie eine Methode mit der Überladung mit mehreren Aufrufen (`userState` in der Signatur) implementieren, muss Ihre Klasse eine Sammlung von Benutzerstatus oder Aufgaben-IDs und ihre entsprechenden ausstehenden Vorgänge verwalten.</span><span class="sxs-lookup"><span data-stu-id="3fadd-198">If you implement a method with the multiple-invocation overload (`userState` in the signature), your class will need to manage a collection of user states, or task IDs, and their corresponding pending operations.</span></span> <span data-ttu-id="3fadd-199">Diese Auflistung sollte mit `lock`-Regionen geschützt werden, da die verschiedenen Aufrufe `userState`-Objekte in der Auflistung hinzufügen und daraus entfernen.</span><span class="sxs-lookup"><span data-stu-id="3fadd-199">This collection should be protected with `lock` regions, because the various invocations add and remove `userState` objects in the collection.</span></span>  
  
- <span data-ttu-id="3fadd-200">Ziehen Sie die erneute Verwendung von `CompletedEventArgs`-Klassen in Betracht, wenn diese machbar und angemessen ist.</span><span class="sxs-lookup"><span data-stu-id="3fadd-200">Consider reusing `CompletedEventArgs` classes where feasible and appropriate.</span></span> <span data-ttu-id="3fadd-201">In diesem Fall ist die Benennung nicht konsistent mit dem Methodennamen, da ein gegebener Delegat und <xref:System.EventArgs>-Typ nicht an eine einzige Methode gebunden sind.</span><span class="sxs-lookup"><span data-stu-id="3fadd-201">In this case, the naming is not consistent with the method name, because a given delegate and <xref:System.EventArgs> type are not tied to a single method.</span></span> <span data-ttu-id="3fadd-202">Dennoch ist es niemals akzeptabel, Entwickler zu zwingen, den von einer Eigenschaft in <xref:System.EventArgs> abgerufenen Wert umzuwandeln.</span><span class="sxs-lookup"><span data-stu-id="3fadd-202">However, forcing developers to cast the value retrieved from a property on the <xref:System.EventArgs> is never acceptable.</span></span>  
  
- <span data-ttu-id="3fadd-203">Wenn Sie eine Klasse entwickeln, die von <xref:System.ComponentModel.Component> abgeleitet ist, implementieren und installieren Sie nicht Ihre eigene <xref:System.Threading.SynchronizationContext>-Klasse.</span><span class="sxs-lookup"><span data-stu-id="3fadd-203">If you are authoring a class that derives from <xref:System.ComponentModel.Component>, do not implement and install your own <xref:System.Threading.SynchronizationContext> class.</span></span> <span data-ttu-id="3fadd-204">Die verwendete <xref:System.Threading.SynchronizationContext> werden von Anwendungsmodellen, nicht von Komponenten gesteuert.</span><span class="sxs-lookup"><span data-stu-id="3fadd-204">Application models, not components, control the <xref:System.Threading.SynchronizationContext> that is used.</span></span>  
  
- <span data-ttu-id="3fadd-205">Wenn Sie Multithreading irgendeiner Art verwenden, setzen Sie sich potenziell ernsthaften und komplexen Fehlern aus.</span><span class="sxs-lookup"><span data-stu-id="3fadd-205">When you use multithreading of any sort, you potentially expose yourself to very serious and complex bugs.</span></span> <span data-ttu-id="3fadd-206">Bevor Sie eine Lösung implementieren, in der Multithreading verwendet wird, sollten Sie den Artikel [Verwaltetes Threading – bewährte Methoden](../threading/managed-threading-best-practices.md) lesen.</span><span class="sxs-lookup"><span data-stu-id="3fadd-206">Before implementing any solution that uses multithreading, see [Managed Threading Best Practices](../threading/managed-threading-best-practices.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="3fadd-207">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="3fadd-207">See also</span></span>

- <xref:System.ComponentModel.AsyncOperation>
- <xref:System.ComponentModel.AsyncOperationManager>
- <xref:System.ComponentModel.AsyncCompletedEventArgs>
- <xref:System.ComponentModel.ProgressChangedEventArgs>
- <xref:System.ComponentModel.BackgroundWorker>
- [<span data-ttu-id="3fadd-208">Implementieren des ereignisbasierten asynchronen Entwurfsmusters</span><span class="sxs-lookup"><span data-stu-id="3fadd-208">Implementing the Event-based Asynchronous Pattern</span></span>](implementing-the-event-based-asynchronous-pattern.md)
- [<span data-ttu-id="3fadd-209">Event-based Asynchronous Pattern (EAP) (Ereignisbasiertes asynchrones Muster (EAP))</span><span class="sxs-lookup"><span data-stu-id="3fadd-209">Event-based Asynchronous Pattern (EAP)</span></span>](event-based-asynchronous-pattern-eap.md)
- [<span data-ttu-id="3fadd-210">Deciding When to Implement the Event-based Asynchronous Pattern (Gründe für das Implementieren des ereignisbasierten asynchronen Musters)</span><span class="sxs-lookup"><span data-stu-id="3fadd-210">Deciding When to Implement the Event-based Asynchronous Pattern</span></span>](deciding-when-to-implement-the-event-based-asynchronous-pattern.md)
- [<span data-ttu-id="3fadd-211">Bewährte Verfahrensweisen für das Implementieren des ereignisbasierten asynchronen Entwurfsmusters</span><span class="sxs-lookup"><span data-stu-id="3fadd-211">Best Practices for Implementing the Event-based Asynchronous Pattern</span></span>](best-practices-for-implementing-the-event-based-asynchronous-pattern.md)
- [<span data-ttu-id="3fadd-212">How to: Use Components That Support the Event-based Asynchronous Pattern (Vorgehensweise: Verwenden von Komponenten, die das ereignisbasierte asynchrone Muster unterstützen)</span><span class="sxs-lookup"><span data-stu-id="3fadd-212">How to: Use Components That Support the Event-based Asynchronous Pattern</span></span>](how-to-use-components-that-support-the-event-based-asynchronous-pattern.md)
- [<span data-ttu-id="3fadd-213">Gewusst wie: Implementieren einer Komponente, die das ereignisbasierte asynchrone Muster unterstützt</span><span class="sxs-lookup"><span data-stu-id="3fadd-213">How to: Implement a Component That Supports the Event-based Asynchronous Pattern</span></span>](component-that-supports-the-event-based-asynchronous-pattern.md)
