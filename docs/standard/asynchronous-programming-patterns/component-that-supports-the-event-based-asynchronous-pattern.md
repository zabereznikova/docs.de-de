---
title: 'Gewusst wie: Implementieren einer Komponente, die das ereignisbasierte asynchrone Muster unterstützt'
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- Event-based Asynchronous Pattern
- ProgressChangedEventArgs class
- BackgroundWorker component
- events [.NET Framework], asynchronous
- Asynchronous Pattern
- AsyncOperationManager class
- threading [.NET Framework], asynchronous features
- components [.NET Framework], asynchronous
- AsyncOperation class
- threading [Windows Forms], asynchronous features
- AsyncCompletedEventArgs class
ms.assetid: 61f676b5-936f-40f6-83ce-f22805ec9c2f
ms.openlocfilehash: 8ea767976d82881d8f983c1b1e3cbf9475c73995
ms.sourcegitcommit: 27a15a55019f6b5f2733961738babe94aec0def3
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 09/15/2020
ms.locfileid: "90536040"
---
# <a name="how-to-implement-a-component-that-supports-the-event-based-asynchronous-pattern"></a><span data-ttu-id="d5aa3-102">Gewusst wie: Implementieren einer Komponente, die das ereignisbasierte asynchrone Muster unterstützt</span><span class="sxs-lookup"><span data-stu-id="d5aa3-102">How to: Implement a Component That Supports the Event-based Asynchronous Pattern</span></span>
<span data-ttu-id="d5aa3-103">Wenn Sie eine Klasse mit Vorgängen schreiben, die nennenswerte Verzögerungen verursachen können, sollten Sie die Klasse mit einer asynchronen Funktionalität ausstatten, indem Sie das ereignisbasierte asynchrone Muster implementieren. Informationen zu diesem Muster finden Sie unter [Übersicht über ereignisbasierte asynchrone Muster](event-based-asynchronous-pattern-overview.md).</span><span class="sxs-lookup"><span data-stu-id="d5aa3-103">If you are writing a class with some operations that may incur noticeable delays, consider giving it asynchronous functionality by implementing the [Event-based Asynchronous Pattern Overview](event-based-asynchronous-pattern-overview.md).</span></span>  
  
 <span data-ttu-id="d5aa3-104">Diese exemplarische Vorgehensweise veranschaulicht das Erstellen einer Komponente, die das ereignisbasierte asynchrone Muster implementiert.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-104">This walkthrough illustrates how to create a component that implements the Event-based Asynchronous Pattern.</span></span> <span data-ttu-id="d5aa3-105">Dieses Muster wird mithilfe von Hilfsklassen aus dem <xref:System.ComponentModel?displayProperty=nameWithType>-Namespace implementiert, wodurch eine einwandfreie Funktionsweise der Komponente unter jedem beliebigen Anwendungsmodell gewährleistet wird, z. B. ASP.NET, Konsolenanwendungen und Windows Forms-Anwendungen.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-105">It is implemented using helper classes from the <xref:System.ComponentModel?displayProperty=nameWithType> namespace, which ensures that the component works correctly under any application model, including ASP.NET, Console applications and Windows Forms applications.</span></span> <span data-ttu-id="d5aa3-106">Diese Komponente kann auch mit einem <xref:System.Windows.Forms.PropertyGrid>-Steuerelement und Ihren eigenen Designern gestaltet werden.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-106">This component is also designable with a <xref:System.Windows.Forms.PropertyGrid> control and your own custom designers.</span></span>  
  
 <span data-ttu-id="d5aa3-107">Wenn Sie diese exemplarische Vorgehensweise abgeschlossen haben, verfügen Sie über eine Anwendung, die Primzahlen asynchron berechnet.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-107">When you are through, you will have an application that computes prime numbers asynchronously.</span></span> <span data-ttu-id="d5aa3-108">Ihre Anwendung wird einen Thread für die Hauptbenutzeroberfläche und einen Thread für jede Primzahlenberechnung haben.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-108">Your application will have a main user interface (UI) thread and a thread for each prime number calculation.</span></span> <span data-ttu-id="d5aa3-109">Obwohl das Testen, ob eine große Zahl eine Primzahl ist, merklich Zeit in Anspruch nimmt, wird der Thread der Hauptbenutzeroberfläche nicht durch diese Verzögerung unterbrochen, und das Formular behält während der Berechnung seine Reaktionsfähigkeit.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-109">Although testing whether a large number is prime can take a noticeable amount of time, the main UI thread will not be interrupted by this delay, and the form will be responsive during the calculations.</span></span> <span data-ttu-id="d5aa3-110">Sie können beliebig viele Berechnungen gleichzeitig ausführen und ausstehende Berechnungen selektiv abbrechen.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-110">You will be able to run as many calculations as you like concurrently and selectively cancel pending calculations.</span></span>  
  
 <span data-ttu-id="d5aa3-111">In dieser exemplarischen Vorgehensweise werden u. a. folgende Aufgaben veranschaulicht:</span><span class="sxs-lookup"><span data-stu-id="d5aa3-111">Tasks illustrated in this walkthrough include:</span></span>  
  
- <span data-ttu-id="d5aa3-112">Erstellen der Komponente</span><span class="sxs-lookup"><span data-stu-id="d5aa3-112">Creating the Component</span></span>  
  
- <span data-ttu-id="d5aa3-113">Definieren von öffentlichen asynchrone Ereignisse und Delegaten</span><span class="sxs-lookup"><span data-stu-id="d5aa3-113">Defining Public Asynchronous Events and Delegates</span></span>  
  
- <span data-ttu-id="d5aa3-114">Definieren von privaten Delegaten</span><span class="sxs-lookup"><span data-stu-id="d5aa3-114">Defining Private Delegates</span></span>  
  
- <span data-ttu-id="d5aa3-115">Implementieren von öffentlichen Ereignissen</span><span class="sxs-lookup"><span data-stu-id="d5aa3-115">Implementing Public Events</span></span>  
  
- <span data-ttu-id="d5aa3-116">Implementieren der Abschlussmethode</span><span class="sxs-lookup"><span data-stu-id="d5aa3-116">Implementing the Completion Method</span></span>  
  
- <span data-ttu-id="d5aa3-117">Implementieren der Workermethoden</span><span class="sxs-lookup"><span data-stu-id="d5aa3-117">Implementing the Worker Methods</span></span>  
  
- <span data-ttu-id="d5aa3-118">Implementieren von Methoden zum Starten und Abbrechen</span><span class="sxs-lookup"><span data-stu-id="d5aa3-118">Implementing Start and Cancel Methods</span></span>  
  
 <span data-ttu-id="d5aa3-119">Informationen zum Kopieren des Codes in diesem Thema als einzelne Auflistung finden Sie unter [Gewusst wie: Implementieren eines Clients des ereignisbasierten asynchronen Musters](how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="d5aa3-119">To copy the code in this topic as a single listing, see [How to: Implement a Client of the Event-based Asynchronous Pattern](how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span></span>  
  
## <a name="creating-the-component"></a><span data-ttu-id="d5aa3-120">Erstellen der Komponente</span><span class="sxs-lookup"><span data-stu-id="d5aa3-120">Creating the Component</span></span>  
 <span data-ttu-id="d5aa3-121">Der erste Schritt besteht darin, die Komponente zu erstellen, die das ereignisbasierte asynchrone Muster implementiert.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-121">The first step is to create the component that will implement the Event-based Asynchronous Pattern.</span></span>  
  
### <a name="to-create-the-component"></a><span data-ttu-id="d5aa3-122">So erstellen Sie die Komponente</span><span class="sxs-lookup"><span data-stu-id="d5aa3-122">To create the component</span></span>  
  
- <span data-ttu-id="d5aa3-123">Erstellen Sie eine Klasse namens `PrimeNumberCalculator`, die von <xref:System.ComponentModel.Component> erbt.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-123">Create a class called `PrimeNumberCalculator` that inherits from <xref:System.ComponentModel.Component>.</span></span>  
  
## <a name="defining-public-asynchronous-events-and-delegates"></a><span data-ttu-id="d5aa3-124">Definieren von öffentlichen asynchrone Ereignisse und Delegaten</span><span class="sxs-lookup"><span data-stu-id="d5aa3-124">Defining Public Asynchronous Events and Delegates</span></span>  
 <span data-ttu-id="d5aa3-125">Die Komponente kommuniziert mit Clients mithilfe von Ereignissen.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-125">Your component communicates to clients using events.</span></span> <span data-ttu-id="d5aa3-126">Das Ereignis _MethodName_**Completed** warnt Clients bei Abschluss eines asynchronen Tasks, und das Ereignis _MethodName_**ProgressChanged** informiert Clients über den Fortschritt eines asynchronen Tasks.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-126">The _MethodName_**Completed** event alerts clients to the completion of an asynchronous task, and the _MethodName_**ProgressChanged** event informs clients of the progress of an asynchronous task.</span></span>  
  
### <a name="to-define-asynchronous-events-for-clients-of-your-component"></a><span data-ttu-id="d5aa3-127">So definieren Sie asynchrone Ereignisse für Clients der Komponente</span><span class="sxs-lookup"><span data-stu-id="d5aa3-127">To define asynchronous events for clients of your component:</span></span>  
  
1. <span data-ttu-id="d5aa3-128">Importieren Sie die Namespaces <xref:System.Threading?displayProperty=nameWithType> und <xref:System.Collections.Specialized?displayProperty=nameWithType> am Anfang der Datei.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-128">Import the <xref:System.Threading?displayProperty=nameWithType> and <xref:System.Collections.Specialized?displayProperty=nameWithType> namespaces at the top of your file.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#11](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#11)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#11](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#11)]  
  
2. <span data-ttu-id="d5aa3-129">Deklarieren Sie vor der Klassendefinition `PrimeNumberCalculator` Delegate für Fortschritts- und Abschlussereignisse.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-129">Before the `PrimeNumberCalculator` class definition, declare delegates for progress and completion events.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#7](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#7)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#7](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#7)]  
  
3. <span data-ttu-id="d5aa3-130">Deklarieren Sie in der Klassendefinition `PrimeNumberCalculator` Ereignisse, um Clients über Fortschritt und Abschluss zu informieren.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-130">In the `PrimeNumberCalculator` class definition, declare events for reporting progress and completion to clients.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#8](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#8)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#8](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#8)]  
  
4. <span data-ttu-id="d5aa3-131">Leiten Sie nach der Klassendefinition `PrimeNumberCalculator` die Klasse `CalculatePrimeCompletedEventArgs` ab, um den Ereignishandler des Clients über die Ergebnisse jeder Berechnung für das `CalculatePrimeCompleted`.event zu informieren.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-131">After the `PrimeNumberCalculator` class definition, derive the `CalculatePrimeCompletedEventArgs` class for reporting the outcome of each calculation to the client's event handler for the `CalculatePrimeCompleted`.event.</span></span> <span data-ttu-id="d5aa3-132">Zusätzlich zu den `AsyncCompletedEventArgs`-Eigenschaften bietet diese Klasse dem Client die Möglichkeit, die getesteten Zahlen, ob diese Primzahlen sind und deren ersten Divisor, wenn es keine Primzahl ist, zu ermitteln.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-132">In addition to the `AsyncCompletedEventArgs` properties, this class enables the client to determine what number was tested, whether it is prime, and what the first divisor is if it is not prime.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#6](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#6)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#6](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#6)]  
  
## <a name="checkpoint"></a><span data-ttu-id="d5aa3-133">Checkpoint</span><span class="sxs-lookup"><span data-stu-id="d5aa3-133">Checkpoint</span></span>  
 <span data-ttu-id="d5aa3-134">An diesem Punkt können Sie die Komponente erstellen.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-134">At this point, you can build the component.</span></span>  
  
### <a name="to-test-your-component"></a><span data-ttu-id="d5aa3-135">So testen Sie Ihre Komponente</span><span class="sxs-lookup"><span data-stu-id="d5aa3-135">To test your component</span></span>  
  
- <span data-ttu-id="d5aa3-136">Kompilieren Sie die Komponente.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-136">Compile the component.</span></span>  
  
     <span data-ttu-id="d5aa3-137">Sie erhalten zwei Compilerwarnungen:</span><span class="sxs-lookup"><span data-stu-id="d5aa3-137">You will receive two compiler warnings:</span></span>  
  
    ```console  
    warning CS0067: The event 'AsynchronousPatternExample.PrimeNumberCalculator.ProgressChanged' is never used  
    warning CS0067: The event 'AsynchronousPatternExample.PrimeNumberCalculator.CalculatePrimeCompleted' is never used  
    ```  
  
     <span data-ttu-id="d5aa3-138">Diese Warnungen werden im nächsten Abschnitt gelöscht.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-138">These warnings will be cleared in the next section.</span></span>  
  
## <a name="defining-private-delegates"></a><span data-ttu-id="d5aa3-139">Definieren von privaten Delegaten</span><span class="sxs-lookup"><span data-stu-id="d5aa3-139">Defining Private Delegates</span></span>  
 <span data-ttu-id="d5aa3-140">Die asynchronen Aspekte der Komponente `PrimeNumberCalculator` werden intern mit einem speziellen Delegaten, dem sogenannten <xref:System.Threading.SendOrPostCallback>, implementiert.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-140">The asynchronous aspects of the `PrimeNumberCalculator` component are implemented internally with a special delegate known as a <xref:System.Threading.SendOrPostCallback>.</span></span> <span data-ttu-id="d5aa3-141">Ein <xref:System.Threading.SendOrPostCallback> stellt eine Rückrufmethode dar, die für einen <xref:System.Threading.ThreadPool>-Thread ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-141">A <xref:System.Threading.SendOrPostCallback> represents a callback method that executes on a <xref:System.Threading.ThreadPool> thread.</span></span> <span data-ttu-id="d5aa3-142">Die Rückrufmethode muss über eine Signatur verfügen, die einen einzelnen Parameter vom Typ <xref:System.Object> enthält, was bedeutet, dass Sie den Status zwischen Delegaten in einer Wrapperklasse übergeben müssen.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-142">The callback method must have a signature that takes a single parameter of type <xref:System.Object>, which means you will need to pass state among delegates in a wrapper class.</span></span> <span data-ttu-id="d5aa3-143">Weitere Informationen finden Sie unter <xref:System.Threading.SendOrPostCallback>.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-143">For more information, see <xref:System.Threading.SendOrPostCallback>.</span></span>  
  
### <a name="to-implement-your-components-internal-asynchronous-behavior"></a><span data-ttu-id="d5aa3-144">So implementieren Sie internes asynchrones Verhalten der Komponente</span><span class="sxs-lookup"><span data-stu-id="d5aa3-144">To implement your component's internal asynchronous behavior:</span></span>  
  
1. <span data-ttu-id="d5aa3-145">Deklarieren und erstellen Sie die <xref:System.Threading.SendOrPostCallback>-Delegate in der Klasse `PrimeNumberCalculator`.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-145">Declare and create the <xref:System.Threading.SendOrPostCallback> delegates in the `PrimeNumberCalculator` class.</span></span> <span data-ttu-id="d5aa3-146">Erstellen Sie die <xref:System.Threading.SendOrPostCallback>-Objekte in der Hilfsprogrammmethode `InitializeDelegates`.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-146">Create the <xref:System.Threading.SendOrPostCallback> objects in a utility method called `InitializeDelegates`.</span></span>  
  
     <span data-ttu-id="d5aa3-147">Sie benötigen zwei Delegate: einen, um dem Client den Fortschritt, und einen, um dem Client den Abschluss zu melden.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-147">You will need two delegates: one for reporting progress to the client, and one for reporting completion to the client.</span></span>  

     [!code-csharp[System.ComponentModel.AsyncOperationManager#9](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#9)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#9](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#9)]  
    [!code-csharp[System.ComponentModel.AsyncOperationManager#20](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#20)]
    [!code-vb[System.ComponentModel.AsyncOperationManager#20](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#20)]  
  
2. <span data-ttu-id="d5aa3-148">Rufen Sie die `InitializeDelegates`-Methode im Konstruktor der Komponente auf.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-148">Call the `InitializeDelegates` method in your component's constructor.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#21](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#21)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#21](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#21)]  
  
3. <span data-ttu-id="d5aa3-149">Deklarieren Sie einen Delegaten in der Klasse `PrimeNumberCalculator`, der die eigentliche, asynchron auszuführende Arbeit übernimmt.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-149">Declare a delegate in the `PrimeNumberCalculator` class that handles the actual work to be done asynchronously.</span></span> <span data-ttu-id="d5aa3-150">Dieser Delegat umschließt die Workermethode, die testet, ob eine Zahl eine Primzahl ist.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-150">This delegate wraps the worker method that tests whether a number is prime.</span></span> <span data-ttu-id="d5aa3-151">Der Delegat nutzt einen <xref:System.ComponentModel.AsyncOperation>-Parameter, mit dem die Lebensdauer des asynchronen Vorgangs verfolgt wird.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-151">The delegate takes an <xref:System.ComponentModel.AsyncOperation> parameter, which will be used to track the lifetime of the asynchronous operation.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#22](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#22)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#22](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#22)]  
  
4. <span data-ttu-id="d5aa3-152">Erstellen Sie eine Auflistung, um die Lebensdauer ausstehender asynchroner Vorgänge zu verwalten.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-152">Create a collection for managing lifetimes of pending asynchronous operations.</span></span> <span data-ttu-id="d5aa3-153">Der Client muss die Möglichkeit haben, Vorgänge zu verfolgen, während sie ausgeführt und abgeschlossen werden. Diese Verfolgung erfolgt dadurch, dass der Client ein eindeutiges Token oder eine Task-ID übergeben muss, sobald er die asynchrone Methode aufruft.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-153">The client needs a way to track operations as they are executed and completed, and this tracking is done by requiring the client to pass a unique token, or task ID, when the client makes the call to the asynchronous method.</span></span> <span data-ttu-id="d5aa3-154">Die Komponente `PrimeNumberCalculator` muss jeden Aufruf verfolgen, indem sie die Task-ID mit dem entsprechenden Aufruf verknüpft.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-154">The `PrimeNumberCalculator` component must keep track of each call by associating the task ID with its corresponding invocation.</span></span> <span data-ttu-id="d5aa3-155">Wenn der Client eine Task-ID übergibt, die nicht eindeutig ist, muss die Komponente `PrimeNumberCalculator` eine Ausnahme auslösen.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-155">If the client passes a task ID that is not unique, the `PrimeNumberCalculator` component must raise an exception.</span></span>  
  
     <span data-ttu-id="d5aa3-156">Die Komponente `PrimeNumberCalculator` verfolgt die Task-ID mithilfe der speziellen Auflistungsklasse <xref:System.Collections.Specialized.HybridDictionary>.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-156">The `PrimeNumberCalculator` component keeps track of task ID by using a special collection class called a <xref:System.Collections.Specialized.HybridDictionary>.</span></span> <span data-ttu-id="d5aa3-157">Erstellen Sie in der Klassendefinition ein <xref:System.Collections.Specialized.HybridDictionary> namens `userTokenToLifetime`.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-157">In the class definition, create a <xref:System.Collections.Specialized.HybridDictionary> called `userTokenToLifetime`.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#23](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#23)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#23](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#23)]  
  
## <a name="implementing-public-events"></a><span data-ttu-id="d5aa3-158">Implementieren von öffentlichen Ereignissen</span><span class="sxs-lookup"><span data-stu-id="d5aa3-158">Implementing Public Events</span></span>  
 <span data-ttu-id="d5aa3-159">Komponenten, die das ereignisbasierte asynchrone Muster implementieren, kommunizieren mit Clients mithilfe von Ereignissen.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-159">Components that implement the Event-based Asynchronous Pattern communicate to clients using events.</span></span> <span data-ttu-id="d5aa3-160">Diese Ereignisse werden auf dem richtigen Thread mithilfe der Klasse <xref:System.ComponentModel.AsyncOperation> aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-160">These events are invoked on the proper thread with the help of the <xref:System.ComponentModel.AsyncOperation> class.</span></span>  
  
### <a name="to-raise-events-to-your-components-clients"></a><span data-ttu-id="d5aa3-161">So lösen Sie Ereignisse für die Komponente Ihres Clients aus</span><span class="sxs-lookup"><span data-stu-id="d5aa3-161">To raise events to your component's clients:</span></span>  
  
1. <span data-ttu-id="d5aa3-162">Implementieren Sie öffentliche Ereignisse für die Meldung an Clients.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-162">Implement public events for reporting to clients.</span></span> <span data-ttu-id="d5aa3-163">Sie benötigen ein Ereignis, um den Fortschritt, und eins, um den Abschluss zu melden.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-163">You will need an event for reporting progress and one for reporting completion.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#24](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#24)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#24](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#24)]  
  
## <a name="implementing-the-completion-method"></a><span data-ttu-id="d5aa3-164">Implementieren der Abschlussmethode</span><span class="sxs-lookup"><span data-stu-id="d5aa3-164">Implementing the Completion Method</span></span>  
 <span data-ttu-id="d5aa3-165">Der Abschlussdelegat ist die Methode, die das zugrundeliegende asynchrone Verhalten mit dem Threadingmodell „Free“ aufruft, sobald der asynchrone Vorgang durch erfolgreichen Abschluss, Fehler oder Abbruch beendet wird.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-165">The completion delegate is the method that the underlying, free-threaded asynchronous behavior will invoke when the asynchronous operation ends by successful completion, error, or cancellation.</span></span> <span data-ttu-id="d5aa3-166">Dieser Aufruf erfolgt auf einen beliebigen Thread.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-166">This invocation happens on an arbitrary thread.</span></span>  
  
 <span data-ttu-id="d5aa3-167">Bei dieser Methode wird die Task-ID des Clients aus der internen Auflistung eindeutiger Clienttoken entfernt.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-167">This method is where the client's task ID is removed from the internal collection of unique client tokens.</span></span> <span data-ttu-id="d5aa3-168">Diese Methode beendet auch die Lebensdauer eines bestimmten asynchronen Vorgangs, indem die Methode <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> für den entsprechenden <xref:System.ComponentModel.AsyncOperation> aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-168">This method also ends the lifetime of a particular asynchronous operation by calling the <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> method on the corresponding <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="d5aa3-169">Dieser Aufruf löst das Abschlussereignis für den Thread aus, der für das Anwendungsmodell geeignet ist.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-169">This call raises the completion event on the thread that is appropriate for the application model.</span></span> <span data-ttu-id="d5aa3-170">Nach dem Aufruf der Methode <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> kann diese Instanz von <xref:System.ComponentModel.AsyncOperation> nicht mehr verwendet werden, und alle nachfolgenden Verwendungsversuche werden eine Ausnahme auslösen.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-170">After the <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> method is called, this instance of <xref:System.ComponentModel.AsyncOperation> can no longer be used, and any subsequent attempts to use it will throw an exception.</span></span>  
  
 <span data-ttu-id="d5aa3-171">Die Signatur `CompletionMethod` muss alle Zustände enthalten, die erforderlich sind, um das Ergebnis des asynchronen Vorgangs zu beschreiben.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-171">The `CompletionMethod` signature must hold all state necessary to describe the outcome of the asynchronous operation.</span></span> <span data-ttu-id="d5aa3-172">Sie umfasst den Zustand für die Zahl, für die mit diesem bestimmten asynchronen Vorgang geprüft wurde, ob sie eine Primzahl ist, und den Wert ihres ersten Divisors, wenn es sich nicht um eine Primzahl handelt.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-172">It holds state for the number that was tested by this particular asynchronous operation, whether the number is prime, and the value of its first divisor if it is not a prime number.</span></span> <span data-ttu-id="d5aa3-173">Außerdem enthält Sie den Zustand, der alle aufgetretenen Ausnahmen beschreibt, und die entsprechende <xref:System.ComponentModel.AsyncOperation> für diesen bestimmten Task.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-173">It also holds state describing any exception that occurred, and the <xref:System.ComponentModel.AsyncOperation> corresponding to this particular task.</span></span>  
  
### <a name="to-complete-an-asynchronous-operation"></a><span data-ttu-id="d5aa3-174">So schließen Sie einen asynchronen Vorgang ab</span><span class="sxs-lookup"><span data-stu-id="d5aa3-174">To complete an asynchronous operation:</span></span>  
  
- <span data-ttu-id="d5aa3-175">Implementieren Sie die Abschlussmethode.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-175">Implement the completion method.</span></span> <span data-ttu-id="d5aa3-176">Sie nutzt sechs Parameter, die zum Ausfüllen von `CalculatePrimeCompletedEventArgs` verwendet werden, welches durch den `CalculatePrimeCompletedEventHandler` des Clients an den Client zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-176">It takes six parameters, which it uses to populate a `CalculatePrimeCompletedEventArgs` that is returned to the client through the client's `CalculatePrimeCompletedEventHandler`.</span></span> <span data-ttu-id="d5aa3-177">Das Task-ID-Token des Clients wird aus der internen Auflistung entfernt, und die Lebensdauer des asynchronen Vorgangs wird mit einem Aufruf von <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> beendet.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-177">It removes the client's task ID token from the internal collection, and it ends the asynchronous operation's lifetime with a call to <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A>.</span></span> <span data-ttu-id="d5aa3-178"><xref:System.ComponentModel.AsyncOperation> marshallt den Aufruf des Threads bzw. des Kontexts, der für das Anwendungsmodell geeignet ist.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-178">The <xref:System.ComponentModel.AsyncOperation> marshals the call to the thread or context that is appropriate for the application model.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#26](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#26)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#26](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#26)]  
  
## <a name="checkpoint"></a><span data-ttu-id="d5aa3-179">Checkpoint</span><span class="sxs-lookup"><span data-stu-id="d5aa3-179">Checkpoint</span></span>  
 <span data-ttu-id="d5aa3-180">An diesem Punkt können Sie die Komponente erstellen.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-180">At this point, you can build the component.</span></span>  
  
### <a name="to-test-your-component"></a><span data-ttu-id="d5aa3-181">So testen Sie Ihre Komponente</span><span class="sxs-lookup"><span data-stu-id="d5aa3-181">To test your component</span></span>  
  
- <span data-ttu-id="d5aa3-182">Kompilieren Sie die Komponente.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-182">Compile the component.</span></span>  
  
     <span data-ttu-id="d5aa3-183">Sie erhalten eine Compilerwarnung:</span><span class="sxs-lookup"><span data-stu-id="d5aa3-183">You will receive one compiler warning:</span></span>  
  
    ```console  
    warning CS0169: The private field 'AsynchronousPatternExample.PrimeNumberCalculator.workerDelegate' is never used  
    ```  
  
     <span data-ttu-id="d5aa3-184">Diese Warnung wird im nächsten Abschnitt aufgelöst.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-184">This warning will be resolved in the next section.</span></span>  
  
## <a name="implementing-the-worker-methods"></a><span data-ttu-id="d5aa3-185">Implementieren der Workermethoden</span><span class="sxs-lookup"><span data-stu-id="d5aa3-185">Implementing the Worker Methods</span></span>  
 <span data-ttu-id="d5aa3-186">Bisher haben Sie den unterstützenden asynchronen Code für die Komponente `PrimeNumberCalculator` implementiert.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-186">So far, you have implemented the supporting asynchronous code for the `PrimeNumberCalculator` component.</span></span> <span data-ttu-id="d5aa3-187">Jetzt können Sie den Code implementieren, der die eigentliche Arbeit übernimmt.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-187">Now you can implement the code that does the actual work.</span></span> <span data-ttu-id="d5aa3-188">Sie implementieren drei Methoden: `CalculateWorker`, `BuildPrimeNumberList` und `IsPrime`.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-188">You will implement three methods: `CalculateWorker`, `BuildPrimeNumberList`, and `IsPrime`.</span></span> <span data-ttu-id="d5aa3-189">Zusammen umfassen `BuildPrimeNumberList` und `IsPrime` einen bekannten Algorithmus namens „Sieb des Eratosthenes“, der bestimmt, ob eine Zahl eine Primzahl ist, indem er alle Primzahlen bis zur Quadratwurzel der Testzahl findet.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-189">Together, `BuildPrimeNumberList` and `IsPrime` comprise a well-known algorithm called the Sieve of Eratosthenes, which determines if a number is prime by finding all the prime numbers up to the square root of the test number.</span></span> <span data-ttu-id="d5aa3-190">Wenn keine Divisoren bis dahin gefunden werden, ist die zu testende Zahl eine Primzahl.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-190">If no divisors are found by that point, the test number is prime.</span></span>  
  
 <span data-ttu-id="d5aa3-191">Wenn diese Komponente für maximale Effizienz geschrieben würde, würde sie alle Primzahlen speichern, die durch verschiedene Aufrufe für verschiedene Testzahlen entdeckt wurden.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-191">If this component were written for maximum efficiency, it would remember all the prime numbers discovered by various invocations for different test numbers.</span></span> <span data-ttu-id="d5aa3-192">Zudem würde sie auch triviale Divisoren wie 2, 3 und 5 überprüfen.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-192">It would also check for trivial divisors like 2, 3, and 5.</span></span> <span data-ttu-id="d5aa3-193">In diesem Beispiel soll demonstriert werden, wie zeitaufwendige Vorgänge asynchron ausgeführt werden können, sodass diese Optimierungen als Übung für Sie belassen werden.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-193">The intent of this example is to demonstrate how time-consuming operations can be executed asynchronously, however, so these optimizations are left as an exercise for you.</span></span>  
  
 <span data-ttu-id="d5aa3-194">Die `CalculateWorker`-Methode wird von einem Delegaten umschlossen und mit einem Aufruf von `BeginInvoke` asynchron aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-194">The `CalculateWorker` method is wrapped in a delegate and is invoked asynchronously with a call to `BeginInvoke`.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="d5aa3-195">Die Fortschrittsmeldung wird in der `BuildPrimeNumberList`-Methode implementiert.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-195">Progress reporting is implemented in the `BuildPrimeNumberList` method.</span></span> <span data-ttu-id="d5aa3-196">Auf schnellen Computern können `ProgressChanged`-Ereignisse in rascher Folge ausgelöst werden.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-196">On fast computers, `ProgressChanged` events can be raised in rapid succession.</span></span> <span data-ttu-id="d5aa3-197">Der Clientthread, für den diese Ereignisse ausgelöst werden, muss diese Situation verarbeiten können.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-197">The client thread, on which these events are raised, must be able to handle this situation.</span></span> <span data-ttu-id="d5aa3-198">Der Code der Benutzeroberfläche erhält möglicherweise eine Flut von Meldungen, die er nicht bewältigen kann, sodass keine Reaktion mehr erfolgt.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-198">User interface code may be flooded with messages and unable to keep up, resulting in unresponsiveness.</span></span> <span data-ttu-id="d5aa3-199">Ein Beispiel für eine Benutzeroberfläche in einer solchen Situation finden Sie unter [Gewusst wie: Implementieren eines Clients des ereignisbasierten asynchronen Musters](how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="d5aa3-199">For an example user interface that handles this situation, see [How to: Implement a Client of the Event-based Asynchronous Pattern](how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span></span>  
  
### <a name="to-execute-the-prime-number-calculation-asynchronously"></a><span data-ttu-id="d5aa3-200">So führen Sie die asynchrone Berechnung der Primzahl aus</span><span class="sxs-lookup"><span data-stu-id="d5aa3-200">To execute the prime number calculation asynchronously:</span></span>  
  
1. <span data-ttu-id="d5aa3-201">Implementieren Sie die Hilfsprogrammmethode `TaskCanceled`.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-201">Implement the `TaskCanceled` utility method.</span></span> <span data-ttu-id="d5aa3-202">Diese überprüft die Auflistung der Tasklebensdauer für die angegebene Task-ID und gibt `true` zurück, wenn die Task-ID nicht gefunden wird.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-202">This checks the task lifetime collection for the given task ID, and returns `true` if the task ID is not found.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#32](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#32)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#32](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#32)]  
  
2. <span data-ttu-id="d5aa3-203">Implementieren Sie die `CalculateWorker`-Methode.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-203">Implement the `CalculateWorker` method.</span></span> <span data-ttu-id="d5aa3-204">Es werden zwei Parameter akzeptiert: eine zu testende Zahl und eine <xref:System.ComponentModel.AsyncOperation>-Klasse.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-204">It takes two parameters: a number to test, and an <xref:System.ComponentModel.AsyncOperation>.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#27](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#27)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#27](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#27)]  
  
3. <span data-ttu-id="d5aa3-205">Implementieren Sie `BuildPrimeNumberList`.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-205">Implement `BuildPrimeNumberList`.</span></span> <span data-ttu-id="d5aa3-206">Es werden zwei Parameter akzeptiert: die zu testende Zahl und eine <xref:System.ComponentModel.AsyncOperation>-Klasse.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-206">It takes two parameters: the number to test, and an <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="d5aa3-207">Die <xref:System.ComponentModel.AsyncOperation>-Klasse wird verwendet, um den Fortschritt und inkrementelle Ergebnisse zu melden.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-207">It uses the <xref:System.ComponentModel.AsyncOperation> to report progress and incremental results.</span></span> <span data-ttu-id="d5aa3-208">Dadurch wird sichergestellt, dass die Ereignishandler des Clients für den richtigen Thread oder Kontext für das Anwendungsmodell aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-208">This assures that the client's event handlers are called on the proper thread or context for the application model.</span></span> <span data-ttu-id="d5aa3-209">Wenn `BuildPrimeNumberList` eine Primzahl findet, wird dies als inkrementelles Ergebnis an den Clientereignishandler für das `ProgressChanged`-Ereignis weitergegeben.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-209">When `BuildPrimeNumberList` finds a prime number, it reports this as an incremental result to the client's event handler for the `ProgressChanged` event.</span></span> <span data-ttu-id="d5aa3-210">Dies erfordert eine von <xref:System.ComponentModel.ProgressChangedEventArgs> abgeleitete Klasse namens `CalculatePrimeProgressChangedEventArgs`, die über eine hinzugefügte Eigenschaft mit der Bezeichnung `LatestPrimeNumber` verfügt.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-210">This requires a class derived from <xref:System.ComponentModel.ProgressChangedEventArgs>, called `CalculatePrimeProgressChangedEventArgs`, which has one added property called `LatestPrimeNumber`.</span></span>  
  
     <span data-ttu-id="d5aa3-211">Die `BuildPrimeNumberList`-Methode ruft in regelmäßigen Abständen die `TaskCanceled`-Methode auf und wird beendet, wenn die Methode `true` zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-211">The `BuildPrimeNumberList` method also periodically calls the `TaskCanceled` method and exits if the method returns `true`.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#5](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#5)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#5](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#5)]  
  
4. <span data-ttu-id="d5aa3-212">Implementieren Sie `IsPrime`.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-212">Implement `IsPrime`.</span></span> <span data-ttu-id="d5aa3-213">Es werden drei Parameter akzeptiert: eine Liste der bekannten Primzahlen, die zu testende Zahl und ein Ausgabeparameter für den ersten gefundenen Divisor.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-213">It takes three parameters: a list of known prime numbers, the number to test, and an output parameter for the first divisor found.</span></span> <span data-ttu-id="d5aa3-214">Anhand der vorliegenden Primzahlenliste wird ermittelt, ob es sich bei der zu testenden Zahl um eine Primzahl handelt.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-214">Given the list of prime numbers, it determines if the test number is prime.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#28](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#28)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#28](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#28)]  
  
5. <span data-ttu-id="d5aa3-215">Leiten Sie `CalculatePrimeProgressChangedEventArgs` aus <xref:System.ComponentModel.ProgressChangedEventArgs> ab.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-215">Derive `CalculatePrimeProgressChangedEventArgs` from <xref:System.ComponentModel.ProgressChangedEventArgs>.</span></span> <span data-ttu-id="d5aa3-216">Diese Klasse ist notwendig, damit der Clientereignishandler für das `ProgressChanged`-Ereignis über inkrementelle Ergebnisse informiert wird.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-216">This class is necessary for reporting incremental results to the client's event handler for the `ProgressChanged` event.</span></span> <span data-ttu-id="d5aa3-217">Sie verfügt über eine zusätzliche Eigenschaft namens `LatestPrimeNumber`.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-217">It has one added property called `LatestPrimeNumber`.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#29](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#29)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#29](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#29)]  
  
## <a name="checkpoint"></a><span data-ttu-id="d5aa3-218">Checkpoint</span><span class="sxs-lookup"><span data-stu-id="d5aa3-218">Checkpoint</span></span>  
 <span data-ttu-id="d5aa3-219">An diesem Punkt können Sie die Komponente erstellen.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-219">At this point, you can build the component.</span></span>  
  
### <a name="to-test-your-component"></a><span data-ttu-id="d5aa3-220">So testen Sie Ihre Komponente</span><span class="sxs-lookup"><span data-stu-id="d5aa3-220">To test your component</span></span>  
  
- <span data-ttu-id="d5aa3-221">Kompilieren Sie die Komponente.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-221">Compile the component.</span></span>  
  
     <span data-ttu-id="d5aa3-222">Was nun noch geschrieben werden muss, sind die Methoden zum Starten und Abbrechen der asynchronen Vorgänge `CalculatePrimeAsync` und `CancelAsync`.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-222">All that remains to be written are the methods to start and cancel asynchronous operations, `CalculatePrimeAsync` and `CancelAsync`.</span></span>  
  
## <a name="implementing-the-start-and-cancel-methods"></a><span data-ttu-id="d5aa3-223">Implementieren von Methoden zum Starten und Abbrechen</span><span class="sxs-lookup"><span data-stu-id="d5aa3-223">Implementing the Start and Cancel Methods</span></span>  
 <span data-ttu-id="d5aa3-224">Sie starten die Workermethode auf ihrem eigenen Thread, indem Sie `BeginInvoke` über den Delegaten aufrufen, der sie umschließt.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-224">You start the worker method on its own thread by calling `BeginInvoke` on the delegate that wraps it.</span></span> <span data-ttu-id="d5aa3-225">Um die Lebensdauer eines bestimmten asynchronen Vorgangs zu verwalten, rufen Sie die <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A>-Methode für die Hilfsprogrammklasse <xref:System.ComponentModel.AsyncOperationManager> auf.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-225">To manage the lifetime of a particular asynchronous operation, you call the <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A> method on the <xref:System.ComponentModel.AsyncOperationManager> helper class.</span></span> <span data-ttu-id="d5aa3-226">Dadurch wird eine <xref:System.ComponentModel.AsyncOperation>-Klasse zurückgegeben, die Aufrufe für den Ereignishandler des Clients zum richtigen Thread oder Kontext marshallt.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-226">This returns an <xref:System.ComponentModel.AsyncOperation>, which marshals calls on the client's event handlers to the proper thread or context.</span></span>  
  
 <span data-ttu-id="d5aa3-227">Sie brechen einen bestimmten ausstehenden Vorgang ab, indem Sie <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> für die entsprechende <xref:System.ComponentModel.AsyncOperation>-Klasse aufrufen.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-227">You cancel a particular pending operation by calling <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> on its corresponding <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="d5aa3-228">Dadurch wird dieser Vorgang beendet, und alle nachfolgenden Aufrufe für <xref:System.ComponentModel.AsyncOperation> werden eine Ausnahme auslösen.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-228">This ends that operation, and any subsequent calls to its <xref:System.ComponentModel.AsyncOperation> will throw an exception.</span></span>  
  
### <a name="to-implement-start-and-cancel-functionality"></a><span data-ttu-id="d5aa3-229">So implementieren Sie die Funktionen zum Starten und Abbrechen</span><span class="sxs-lookup"><span data-stu-id="d5aa3-229">To implement Start and Cancel functionality:</span></span>  
  
1. <span data-ttu-id="d5aa3-230">Implementieren Sie die `CalculatePrimeAsync`-Methode.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-230">Implement the `CalculatePrimeAsync` method.</span></span> <span data-ttu-id="d5aa3-231">Stellen Sie sicher, dass das vom Client bereitgestellte Token (Task-ID) in Bezug auf alle Tokens der derzeit ausstehenden Tasks eindeutig ist.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-231">Make sure the client-supplied token (task ID) is unique with respect to all the tokens representing currently pending tasks.</span></span> <span data-ttu-id="d5aa3-232">Wenn der Client ein nicht eindeutiges Token übergibt, löst `CalculatePrimeAsync` eine Ausnahme aus.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-232">If the client passes in a non-unique token, `CalculatePrimeAsync` raises an exception.</span></span> <span data-ttu-id="d5aa3-233">Andernfalls wird das Token zur Task-ID-Auflistung hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-233">Otherwise, the token is added to the task ID collection.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#3](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#3)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#3](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#3)]  
  
2. <span data-ttu-id="d5aa3-234">Implementieren Sie die `CancelAsync`-Methode.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-234">Implement the `CancelAsync` method.</span></span> <span data-ttu-id="d5aa3-235">Wenn der `taskId`-Parameter in der Tokenauflistung vorhanden ist, wird er entfernt.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-235">If the `taskId` parameter exists in the token collection, it is removed.</span></span> <span data-ttu-id="d5aa3-236">Dies verhindert, dass noch nicht ausgeführte Tasks abgebrochen werden.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-236">This prevents canceled tasks that have not started from running.</span></span> <span data-ttu-id="d5aa3-237">Wenn der Task ausgeführt wird, wird er durch die `BuildPrimeNumberList`-Methode beendet, sobald diese erkennt, dass die Task-ID aus der Auflistung der Lebensdauer entfernt wurde.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-237">If the task is running, the `BuildPrimeNumberList` method exits when it detects that the task ID has been removed from the lifetime collection.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#4](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#4)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#4](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#4)]  
  
## <a name="checkpoint"></a><span data-ttu-id="d5aa3-238">Checkpoint</span><span class="sxs-lookup"><span data-stu-id="d5aa3-238">Checkpoint</span></span>  
 <span data-ttu-id="d5aa3-239">An diesem Punkt können Sie die Komponente erstellen.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-239">At this point, you can build the component.</span></span>  
  
### <a name="to-test-your-component"></a><span data-ttu-id="d5aa3-240">So testen Sie Ihre Komponente</span><span class="sxs-lookup"><span data-stu-id="d5aa3-240">To test your component</span></span>  
  
- <span data-ttu-id="d5aa3-241">Kompilieren Sie die Komponente.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-241">Compile the component.</span></span>  
  
 <span data-ttu-id="d5aa3-242">Die `PrimeNumberCalculator`-Komponente ist jetzt vollständig und einsatzbereit.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-242">The `PrimeNumberCalculator` component is now complete and ready to use.</span></span>  
  
 <span data-ttu-id="d5aa3-243">Ein Beispiel für einen Client, der die `PrimeNumberCalculator`-Komponente verwendet, finden Sie unter [Gewusst wie: Implementieren eines Clients des ereignisbasierten asynchronen Musters](how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="d5aa3-243">For an example client that uses the `PrimeNumberCalculator` component, see [How to: Implement a Client of the Event-based Asynchronous Pattern](how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span></span>  
  
## <a name="next-steps"></a><span data-ttu-id="d5aa3-244">Nächste Schritte</span><span class="sxs-lookup"><span data-stu-id="d5aa3-244">Next Steps</span></span>  
 <span data-ttu-id="d5aa3-245">Sie können dieses Beispiel ausfüllen, indem Sie `CalculatePrime` schreiben. Dies ist das synchrone Äquivalent der `CalculatePrimeAsync`-Methode.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-245">You can fill out this example by writing `CalculatePrime`, the synchronous equivalent of `CalculatePrimeAsync` method.</span></span> <span data-ttu-id="d5aa3-246">So wird die `PrimeNumberCalculator`-Komponente vollständig kompatibel mit dem ereignisbasierten asynchronen Muster.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-246">This will make the `PrimeNumberCalculator` component fully compliant with the Event-based Asynchronous Pattern.</span></span>  
  
 <span data-ttu-id="d5aa3-247">Sie können dieses Beispiel verbessern, indem Sie die Liste aller Primzahlen beibehalten, die durch verschiedene Aufrufe für verschiedene Testzahlen entdeckt wurden.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-247">You can improve this example by retaining the list of all the prime numbers discovered by various invocations for different test numbers.</span></span> <span data-ttu-id="d5aa3-248">Mit diesem Ansatz profitiert jeder Task von der Arbeit früherer Tasks.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-248">Using this approach, each task will benefit from the work done by previous tasks.</span></span> <span data-ttu-id="d5aa3-249">Achten Sie darauf, diese Liste mit `lock`-Regionen zu schützen, damit der Zugriff auf die Liste durch verschiedene Threads serialisiert wird.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-249">Be careful to protect this list with `lock` regions, so access to the list by different threads is serialized.</span></span>  
  
 <span data-ttu-id="d5aa3-250">Außerdem können Sie dieses Beispiel auch verbessern, indem Sie auf triviale Divisoren wie 2, 3 und 5 testen.</span><span class="sxs-lookup"><span data-stu-id="d5aa3-250">You can also improve this example by testing for trivial divisors, like 2, 3, and 5.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d5aa3-251">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="d5aa3-251">See also</span></span>

- [<span data-ttu-id="d5aa3-252">Gewusst wie: Ausführen eines Vorgangs im Hintergrund</span><span class="sxs-lookup"><span data-stu-id="d5aa3-252">How to: Run an Operation in the Background</span></span>](/dotnet/desktop/winforms/controls/how-to-run-an-operation-in-the-background)
- [<span data-ttu-id="d5aa3-253">Event-based Asynchronous Pattern Overview (Übersicht über ereignisbasierte asynchrone Muster)</span><span class="sxs-lookup"><span data-stu-id="d5aa3-253">Event-based Asynchronous Pattern Overview</span></span>](event-based-asynchronous-pattern-overview.md)
- [<span data-ttu-id="d5aa3-254">Event-based Asynchronous Pattern (EAP) (Ereignisbasiertes asynchrones Muster (EAP))</span><span class="sxs-lookup"><span data-stu-id="d5aa3-254">Event-based Asynchronous Pattern (EAP)</span></span>](event-based-asynchronous-pattern-eap.md)
